var xC=Object.defineProperty;var aw=n=>{throw TypeError(n)};var wC=(n,i,a)=>i in n?xC(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;var bC=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports);var Qt=(n,i,a)=>wC(n,typeof i!="symbol"?i+"":i,a),lw=(n,i,a)=>i.has(n)||aw("Cannot "+a);var I_=(n,i,a)=>(lw(n,i,"read from private field"),a?a.call(n):i.get(n)),_v=(n,i,a)=>i.has(n)?aw("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,a),yv=(n,i,a,f)=>(lw(n,i,"write to private field"),f?f.call(n,a):i.set(n,a),a);var sA=bC((lA,pg)=>{function SC(n,i){for(var a=0;a<i.length;a++){const f=i[a];if(typeof f!="string"&&!Array.isArray(f)){for(const x in f)if(x!=="default"&&!(x in n)){const T=Object.getOwnPropertyDescriptor(f,x);T&&Object.defineProperty(n,x,T.get?T:{enumerable:!0,get:()=>f[x]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))f(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const b of T.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&f(b)}).observe(document,{childList:!0,subtree:!0});function a(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function f(x){if(x.ep)return;x.ep=!0;const T=a(x);fetch(x.href,T)}})();var Ap=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Jb={exports:{}},qy={},Qb={exports:{}},Ln={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sg=Symbol.for("react.element"),TC=Symbol.for("react.portal"),CC=Symbol.for("react.fragment"),PC=Symbol.for("react.strict_mode"),EC=Symbol.for("react.profiler"),MC=Symbol.for("react.provider"),IC=Symbol.for("react.context"),kC=Symbol.for("react.forward_ref"),AC=Symbol.for("react.suspense"),zC=Symbol.for("react.memo"),RC=Symbol.for("react.lazy"),uw=Symbol.iterator;function LC(n){return n===null||typeof n!="object"?null:(n=uw&&n[uw]||n["@@iterator"],typeof n=="function"?n:null)}var e2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},t2=Object.assign,n2={};function lf(n,i,a){this.props=n,this.context=i,this.refs=n2,this.updater=a||e2}lf.prototype.isReactComponent={};lf.prototype.setState=function(n,i){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,i,"setState")};lf.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function r2(){}r2.prototype=lf.prototype;function i1(n,i,a){this.props=n,this.context=i,this.refs=n2,this.updater=a||e2}var o1=i1.prototype=new r2;o1.constructor=i1;t2(o1,lf.prototype);o1.isPureReactComponent=!0;var cw=Array.isArray,i2=Object.prototype.hasOwnProperty,s1={current:null},o2={key:!0,ref:!0,__self:!0,__source:!0};function s2(n,i,a){var f,x={},T=null,b=null;if(i!=null)for(f in i.ref!==void 0&&(b=i.ref),i.key!==void 0&&(T=""+i.key),i)i2.call(i,f)&&!o2.hasOwnProperty(f)&&(x[f]=i[f]);var u=arguments.length-2;if(u===1)x.children=a;else if(1<u){for(var j=Array(u),Z=0;Z<u;Z++)j[Z]=arguments[Z+2];x.children=j}if(n&&n.defaultProps)for(f in u=n.defaultProps,u)x[f]===void 0&&(x[f]=u[f]);return{$$typeof:sg,type:n,key:T,ref:b,props:x,_owner:s1.current}}function DC(n,i){return{$$typeof:sg,type:n.type,key:i,ref:n.ref,props:n.props,_owner:n._owner}}function a1(n){return typeof n=="object"&&n!==null&&n.$$typeof===sg}function FC(n){var i={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(a){return i[a]})}var hw=/\/+/g;function vv(n,i){return typeof n=="object"&&n!==null&&n.key!=null?FC(""+n.key):i.toString(36)}function K_(n,i,a,f,x){var T=typeof n;(T==="undefined"||T==="boolean")&&(n=null);var b=!1;if(n===null)b=!0;else switch(T){case"string":case"number":b=!0;break;case"object":switch(n.$$typeof){case sg:case TC:b=!0}}if(b)return b=n,x=x(b),n=f===""?"."+vv(b,0):f,cw(x)?(a="",n!=null&&(a=n.replace(hw,"$&/")+"/"),K_(x,i,a,"",function(Z){return Z})):x!=null&&(a1(x)&&(x=DC(x,a+(!x.key||b&&b.key===x.key?"":(""+x.key).replace(hw,"$&/")+"/")+n)),i.push(x)),1;if(b=0,f=f===""?".":f+":",cw(n))for(var u=0;u<n.length;u++){T=n[u];var j=f+vv(T,u);b+=K_(T,i,a,j,x)}else if(j=LC(n),typeof j=="function")for(n=j.call(n),u=0;!(T=n.next()).done;)T=T.value,j=f+vv(T,u++),b+=K_(T,i,a,j,x);else if(T==="object")throw i=String(n),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return b}function k_(n,i,a){if(n==null)return n;var f=[],x=0;return K_(n,f,"","",function(T){return i.call(a,T,x++)}),f}function BC(n){if(n._status===-1){var i=n._result;i=i(),i.then(function(a){(n._status===0||n._status===-1)&&(n._status=1,n._result=a)},function(a){(n._status===0||n._status===-1)&&(n._status=2,n._result=a)}),n._status===-1&&(n._status=0,n._result=i)}if(n._status===1)return n._result.default;throw n._result}var Fo={current:null},J_={transition:null},OC={ReactCurrentDispatcher:Fo,ReactCurrentBatchConfig:J_,ReactCurrentOwner:s1};function a2(){throw Error("act(...) is not supported in production builds of React.")}Ln.Children={map:k_,forEach:function(n,i,a){k_(n,function(){i.apply(this,arguments)},a)},count:function(n){var i=0;return k_(n,function(){i++}),i},toArray:function(n){return k_(n,function(i){return i})||[]},only:function(n){if(!a1(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ln.Component=lf;Ln.Fragment=CC;Ln.Profiler=EC;Ln.PureComponent=i1;Ln.StrictMode=PC;Ln.Suspense=AC;Ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OC;Ln.act=a2;Ln.cloneElement=function(n,i,a){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var f=t2({},n.props),x=n.key,T=n.ref,b=n._owner;if(i!=null){if(i.ref!==void 0&&(T=i.ref,b=s1.current),i.key!==void 0&&(x=""+i.key),n.type&&n.type.defaultProps)var u=n.type.defaultProps;for(j in i)i2.call(i,j)&&!o2.hasOwnProperty(j)&&(f[j]=i[j]===void 0&&u!==void 0?u[j]:i[j])}var j=arguments.length-2;if(j===1)f.children=a;else if(1<j){u=Array(j);for(var Z=0;Z<j;Z++)u[Z]=arguments[Z+2];f.children=u}return{$$typeof:sg,type:n.type,key:x,ref:T,props:f,_owner:b}};Ln.createContext=function(n){return n={$$typeof:IC,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:MC,_context:n},n.Consumer=n};Ln.createElement=s2;Ln.createFactory=function(n){var i=s2.bind(null,n);return i.type=n,i};Ln.createRef=function(){return{current:null}};Ln.forwardRef=function(n){return{$$typeof:kC,render:n}};Ln.isValidElement=a1;Ln.lazy=function(n){return{$$typeof:RC,_payload:{_status:-1,_result:n},_init:BC}};Ln.memo=function(n,i){return{$$typeof:zC,type:n,compare:i===void 0?null:i}};Ln.startTransition=function(n){var i=J_.transition;J_.transition={};try{n()}finally{J_.transition=i}};Ln.unstable_act=a2;Ln.useCallback=function(n,i){return Fo.current.useCallback(n,i)};Ln.useContext=function(n){return Fo.current.useContext(n)};Ln.useDebugValue=function(){};Ln.useDeferredValue=function(n){return Fo.current.useDeferredValue(n)};Ln.useEffect=function(n,i){return Fo.current.useEffect(n,i)};Ln.useId=function(){return Fo.current.useId()};Ln.useImperativeHandle=function(n,i,a){return Fo.current.useImperativeHandle(n,i,a)};Ln.useInsertionEffect=function(n,i){return Fo.current.useInsertionEffect(n,i)};Ln.useLayoutEffect=function(n,i){return Fo.current.useLayoutEffect(n,i)};Ln.useMemo=function(n,i){return Fo.current.useMemo(n,i)};Ln.useReducer=function(n,i,a){return Fo.current.useReducer(n,i,a)};Ln.useRef=function(n){return Fo.current.useRef(n)};Ln.useState=function(n){return Fo.current.useState(n)};Ln.useSyncExternalStore=function(n,i,a){return Fo.current.useSyncExternalStore(n,i,a)};Ln.useTransition=function(){return Fo.current.useTransition()};Ln.version="18.3.1";Qb.exports=Ln;var en=Qb.exports;const l1=Zy(en),dw=SC({__proto__:null,default:l1},[en]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NC=en,jC=Symbol.for("react.element"),UC=Symbol.for("react.fragment"),VC=Object.prototype.hasOwnProperty,GC=NC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$C={key:!0,ref:!0,__self:!0,__source:!0};function l2(n,i,a){var f,x={},T=null,b=null;a!==void 0&&(T=""+a),i.key!==void 0&&(T=""+i.key),i.ref!==void 0&&(b=i.ref);for(f in i)VC.call(i,f)&&!$C.hasOwnProperty(f)&&(x[f]=i[f]);if(n&&n.defaultProps)for(f in i=n.defaultProps,i)x[f]===void 0&&(x[f]=i[f]);return{$$typeof:jC,type:n,key:T,ref:b,props:x,_owner:GC.current}}qy.Fragment=UC;qy.jsx=l2;qy.jsxs=l2;Jb.exports=qy;var bn=Jb.exports,Qv={},u2={exports:{}},Ls={},c2={exports:{}},h2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function i(be,Ke){var ye=be.length;be.push(Ke);e:for(;0<ye;){var ue=ye-1>>>1,gt=be[ue];if(0<x(gt,Ke))be[ue]=Ke,be[ye]=gt,ye=ue;else break e}}function a(be){return be.length===0?null:be[0]}function f(be){if(be.length===0)return null;var Ke=be[0],ye=be.pop();if(ye!==Ke){be[0]=ye;e:for(var ue=0,gt=be.length,At=gt>>>1;ue<At;){var Lt=2*(ue+1)-1,bt=be[Lt],zt=Lt+1,Ft=be[zt];if(0>x(bt,ye))zt<gt&&0>x(Ft,bt)?(be[ue]=Ft,be[zt]=ye,ue=zt):(be[ue]=bt,be[Lt]=ye,ue=Lt);else if(zt<gt&&0>x(Ft,ye))be[ue]=Ft,be[zt]=ye,ue=zt;else break e}}return Ke}function x(be,Ke){var ye=be.sortIndex-Ke.sortIndex;return ye!==0?ye:be.id-Ke.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;n.unstable_now=function(){return T.now()}}else{var b=Date,u=b.now();n.unstable_now=function(){return b.now()-u}}var j=[],Z=[],me=1,ge=null,fe=3,oe=!1,Be=!1,_t=!1,xt=typeof setTimeout=="function"?setTimeout:null,Ie=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Te(be){for(var Ke=a(Z);Ke!==null;){if(Ke.callback===null)f(Z);else if(Ke.startTime<=be)f(Z),Ke.sortIndex=Ke.expirationTime,i(j,Ke);else break;Ke=a(Z)}}function Ne(be){if(_t=!1,Te(be),!Be)if(a(j)!==null)Be=!0,ze(ut);else{var Ke=a(Z);Ke!==null&&We(Ne,Ke.startTime-be)}}function ut(be,Ke){Be=!1,_t&&(_t=!1,Ie($),$=-1),oe=!0;var ye=fe;try{for(Te(Ke),ge=a(j);ge!==null&&(!(ge.expirationTime>Ke)||be&&!Ve());){var ue=ge.callback;if(typeof ue=="function"){ge.callback=null,fe=ge.priorityLevel;var gt=ue(ge.expirationTime<=Ke);Ke=n.unstable_now(),typeof gt=="function"?ge.callback=gt:ge===a(j)&&f(j),Te(Ke)}else f(j);ge=a(j)}if(ge!==null)var At=!0;else{var Lt=a(Z);Lt!==null&&We(Ne,Lt.startTime-Ke),At=!1}return At}finally{ge=null,fe=ye,oe=!1}}var ct=!1,ht=null,$=-1,le=5,pe=-1;function Ve(){return!(n.unstable_now()-pe<le)}function Fe(){if(ht!==null){var be=n.unstable_now();pe=be;var Ke=!0;try{Ke=ht(!0,be)}finally{Ke?je():(ct=!1,ht=null)}}else ct=!1}var je;if(typeof ne=="function")je=function(){ne(Fe)};else if(typeof MessageChannel<"u"){var Ye=new MessageChannel,Le=Ye.port2;Ye.port1.onmessage=Fe,je=function(){Le.postMessage(null)}}else je=function(){xt(Fe,0)};function ze(be){ht=be,ct||(ct=!0,je())}function We(be,Ke){$=xt(function(){be(n.unstable_now())},Ke)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(be){be.callback=null},n.unstable_continueExecution=function(){Be||oe||(Be=!0,ze(ut))},n.unstable_forceFrameRate=function(be){0>be||125<be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):le=0<be?Math.floor(1e3/be):5},n.unstable_getCurrentPriorityLevel=function(){return fe},n.unstable_getFirstCallbackNode=function(){return a(j)},n.unstable_next=function(be){switch(fe){case 1:case 2:case 3:var Ke=3;break;default:Ke=fe}var ye=fe;fe=Ke;try{return be()}finally{fe=ye}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(be,Ke){switch(be){case 1:case 2:case 3:case 4:case 5:break;default:be=3}var ye=fe;fe=be;try{return Ke()}finally{fe=ye}},n.unstable_scheduleCallback=function(be,Ke,ye){var ue=n.unstable_now();switch(typeof ye=="object"&&ye!==null?(ye=ye.delay,ye=typeof ye=="number"&&0<ye?ue+ye:ue):ye=ue,be){case 1:var gt=-1;break;case 2:gt=250;break;case 5:gt=1073741823;break;case 4:gt=1e4;break;default:gt=5e3}return gt=ye+gt,be={id:me++,callback:Ke,priorityLevel:be,startTime:ye,expirationTime:gt,sortIndex:-1},ye>ue?(be.sortIndex=ye,i(Z,be),a(j)===null&&be===a(Z)&&(_t?(Ie($),$=-1):_t=!0,We(Ne,ye-ue))):(be.sortIndex=gt,i(j,be),Be||oe||(Be=!0,ze(ut))),be},n.unstable_shouldYield=Ve,n.unstable_wrapCallback=function(be){var Ke=fe;return function(){var ye=fe;fe=Ke;try{return be.apply(this,arguments)}finally{fe=ye}}}})(h2);c2.exports=h2;var ZC=c2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qC=en,As=ZC;function kt(n){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d2=new Set,jm={};function bd(n,i){Kp(n,i),Kp(n+"Capture",i)}function Kp(n,i){for(jm[n]=i,n=0;n<i.length;n++)d2.add(i[n])}var ku=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ex=Object.prototype.hasOwnProperty,WC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pw={},fw={};function HC(n){return ex.call(fw,n)?!0:ex.call(pw,n)?!1:WC.test(n)?fw[n]=!0:(pw[n]=!0,!1)}function YC(n,i,a,f){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return f?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function XC(n,i,a,f){if(i===null||typeof i>"u"||YC(n,i,a,f))return!0;if(f)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function Bo(n,i,a,f,x,T,b){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=f,this.attributeNamespace=x,this.mustUseProperty=a,this.propertyName=n,this.type=i,this.sanitizeURL=T,this.removeEmptyString=b}var Qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Qi[n]=new Bo(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var i=n[0];Qi[i]=new Bo(i,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Qi[n]=new Bo(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Qi[n]=new Bo(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Qi[n]=new Bo(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Qi[n]=new Bo(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Qi[n]=new Bo(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Qi[n]=new Bo(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Qi[n]=new Bo(n,5,!1,n.toLowerCase(),null,!1,!1)});var u1=/[\-:]([a-z])/g;function c1(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var i=n.replace(u1,c1);Qi[i]=new Bo(i,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var i=n.replace(u1,c1);Qi[i]=new Bo(i,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var i=n.replace(u1,c1);Qi[i]=new Bo(i,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Qi[n]=new Bo(n,1,!1,n.toLowerCase(),null,!1,!1)});Qi.xlinkHref=new Bo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Qi[n]=new Bo(n,1,!1,n.toLowerCase(),null,!0,!0)});function h1(n,i,a,f){var x=Qi.hasOwnProperty(i)?Qi[i]:null;(x!==null?x.type!==0:f||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(XC(i,a,x,f)&&(a=null),f||x===null?HC(i)&&(a===null?n.removeAttribute(i):n.setAttribute(i,""+a)):x.mustUseProperty?n[x.propertyName]=a===null?x.type===3?!1:"":a:(i=x.attributeName,f=x.attributeNamespace,a===null?n.removeAttribute(i):(x=x.type,a=x===3||x===4&&a===!0?"":""+a,f?n.setAttributeNS(f,i,a):n.setAttribute(i,a))))}var Fu=qC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A_=Symbol.for("react.element"),zp=Symbol.for("react.portal"),Rp=Symbol.for("react.fragment"),d1=Symbol.for("react.strict_mode"),tx=Symbol.for("react.profiler"),p2=Symbol.for("react.provider"),f2=Symbol.for("react.context"),p1=Symbol.for("react.forward_ref"),nx=Symbol.for("react.suspense"),rx=Symbol.for("react.suspense_list"),f1=Symbol.for("react.memo"),Wc=Symbol.for("react.lazy"),m2=Symbol.for("react.offscreen"),mw=Symbol.iterator;function fm(n){return n===null||typeof n!="object"?null:(n=mw&&n[mw]||n["@@iterator"],typeof n=="function"?n:null)}var Xr=Object.assign,xv;function Tm(n){if(xv===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);xv=i&&i[1]||""}return`
`+xv+n}var wv=!1;function bv(n,i){if(!n||wv)return"";wv=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(Z){var f=Z}Reflect.construct(n,[],i)}else{try{i.call()}catch(Z){f=Z}n.call(i.prototype)}else{try{throw Error()}catch(Z){f=Z}n()}}catch(Z){if(Z&&f&&typeof Z.stack=="string"){for(var x=Z.stack.split(`
`),T=f.stack.split(`
`),b=x.length-1,u=T.length-1;1<=b&&0<=u&&x[b]!==T[u];)u--;for(;1<=b&&0<=u;b--,u--)if(x[b]!==T[u]){if(b!==1||u!==1)do if(b--,u--,0>u||x[b]!==T[u]){var j=`
`+x[b].replace(" at new "," at ");return n.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",n.displayName)),j}while(1<=b&&0<=u);break}}}finally{wv=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?Tm(n):""}function KC(n){switch(n.tag){case 5:return Tm(n.type);case 16:return Tm("Lazy");case 13:return Tm("Suspense");case 19:return Tm("SuspenseList");case 0:case 2:case 15:return n=bv(n.type,!1),n;case 11:return n=bv(n.type.render,!1),n;case 1:return n=bv(n.type,!0),n;default:return""}}function ix(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Rp:return"Fragment";case zp:return"Portal";case tx:return"Profiler";case d1:return"StrictMode";case nx:return"Suspense";case rx:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case f2:return(n.displayName||"Context")+".Consumer";case p2:return(n._context.displayName||"Context")+".Provider";case p1:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case f1:return i=n.displayName||null,i!==null?i:ix(n.type)||"Memo";case Wc:i=n._payload,n=n._init;try{return ix(n(i))}catch{}}return null}function JC(n){var i=n.type;switch(n.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=i.render,n=n.displayName||n.name||"",i.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ix(i);case 8:return i===d1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function ah(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function g2(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function QC(n){var i=g2(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),f=""+n[i];if(!n.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var x=a.get,T=a.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return x.call(this)},set:function(b){f=""+b,T.call(this,b)}}),Object.defineProperty(n,i,{enumerable:a.enumerable}),{getValue:function(){return f},setValue:function(b){f=""+b},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function z_(n){n._valueTracker||(n._valueTracker=QC(n))}function _2(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var a=i.getValue(),f="";return n&&(f=g2(n)?n.checked?"true":"false":n.value),n=f,n!==a?(i.setValue(n),!0):!1}function hy(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function ox(n,i){var a=i.checked;return Xr({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function gw(n,i){var a=i.defaultValue==null?"":i.defaultValue,f=i.checked!=null?i.checked:i.defaultChecked;a=ah(i.value!=null?i.value:a),n._wrapperState={initialChecked:f,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function y2(n,i){i=i.checked,i!=null&&h1(n,"checked",i,!1)}function sx(n,i){y2(n,i);var a=ah(i.value),f=i.type;if(a!=null)f==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(f==="submit"||f==="reset"){n.removeAttribute("value");return}i.hasOwnProperty("value")?ax(n,i.type,a):i.hasOwnProperty("defaultValue")&&ax(n,i.type,ah(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(n.defaultChecked=!!i.defaultChecked)}function _w(n,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var f=i.type;if(!(f!=="submit"&&f!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+n._wrapperState.initialValue,a||i===n.value||(n.value=i),n.defaultValue=i}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function ax(n,i,a){(i!=="number"||hy(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var Cm=Array.isArray;function $p(n,i,a,f){if(n=n.options,i){i={};for(var x=0;x<a.length;x++)i["$"+a[x]]=!0;for(a=0;a<n.length;a++)x=i.hasOwnProperty("$"+n[a].value),n[a].selected!==x&&(n[a].selected=x),x&&f&&(n[a].defaultSelected=!0)}else{for(a=""+ah(a),i=null,x=0;x<n.length;x++){if(n[x].value===a){n[x].selected=!0,f&&(n[x].defaultSelected=!0);return}i!==null||n[x].disabled||(i=n[x])}i!==null&&(i.selected=!0)}}function lx(n,i){if(i.dangerouslySetInnerHTML!=null)throw Error(kt(91));return Xr({},i,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function yw(n,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(kt(92));if(Cm(a)){if(1<a.length)throw Error(kt(93));a=a[0]}i=a}i==null&&(i=""),a=i}n._wrapperState={initialValue:ah(a)}}function v2(n,i){var a=ah(i.value),f=ah(i.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),i.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),f!=null&&(n.defaultValue=""+f)}function vw(n){var i=n.textContent;i===n._wrapperState.initialValue&&i!==""&&i!==null&&(n.value=i)}function x2(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ux(n,i){return n==null||n==="http://www.w3.org/1999/xhtml"?x2(i):n==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var R_,w2=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,f,x){MSApp.execUnsafeLocalFunction(function(){return n(i,a,f,x)})}:n}(function(n,i){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=i;else{for(R_=R_||document.createElement("div"),R_.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=R_.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;i.firstChild;)n.appendChild(i.firstChild)}});function Um(n,i){if(i){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=i;return}}n.textContent=i}var Am={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},eP=["Webkit","ms","Moz","O"];Object.keys(Am).forEach(function(n){eP.forEach(function(i){i=i+n.charAt(0).toUpperCase()+n.substring(1),Am[i]=Am[n]})});function b2(n,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||Am.hasOwnProperty(n)&&Am[n]?(""+i).trim():i+"px"}function S2(n,i){n=n.style;for(var a in i)if(i.hasOwnProperty(a)){var f=a.indexOf("--")===0,x=b2(a,i[a],f);a==="float"&&(a="cssFloat"),f?n.setProperty(a,x):n[a]=x}}var tP=Xr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cx(n,i){if(i){if(tP[n]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(kt(137,n));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(kt(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(kt(61))}if(i.style!=null&&typeof i.style!="object")throw Error(kt(62))}}function hx(n,i){if(n.indexOf("-")===-1)return typeof i.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dx=null;function m1(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var px=null,Zp=null,qp=null;function xw(n){if(n=ug(n)){if(typeof px!="function")throw Error(kt(280));var i=n.stateNode;i&&(i=Ky(i),px(n.stateNode,n.type,i))}}function T2(n){Zp?qp?qp.push(n):qp=[n]:Zp=n}function C2(){if(Zp){var n=Zp,i=qp;if(qp=Zp=null,xw(n),i)for(n=0;n<i.length;n++)xw(i[n])}}function P2(n,i){return n(i)}function E2(){}var Sv=!1;function M2(n,i,a){if(Sv)return n(i,a);Sv=!0;try{return P2(n,i,a)}finally{Sv=!1,(Zp!==null||qp!==null)&&(E2(),C2())}}function Vm(n,i){var a=n.stateNode;if(a===null)return null;var f=Ky(a);if(f===null)return null;a=f[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(kt(231,i,typeof a));return a}var fx=!1;if(ku)try{var mm={};Object.defineProperty(mm,"passive",{get:function(){fx=!0}}),window.addEventListener("test",mm,mm),window.removeEventListener("test",mm,mm)}catch{fx=!1}function nP(n,i,a,f,x,T,b,u,j){var Z=Array.prototype.slice.call(arguments,3);try{i.apply(a,Z)}catch(me){this.onError(me)}}var zm=!1,dy=null,py=!1,mx=null,rP={onError:function(n){zm=!0,dy=n}};function iP(n,i,a,f,x,T,b,u,j){zm=!1,dy=null,nP.apply(rP,arguments)}function oP(n,i,a,f,x,T,b,u,j){if(iP.apply(this,arguments),zm){if(zm){var Z=dy;zm=!1,dy=null}else throw Error(kt(198));py||(py=!0,mx=Z)}}function Sd(n){var i=n,a=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,i.flags&4098&&(a=i.return),n=i.return;while(n)}return i.tag===3?a:null}function I2(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function ww(n){if(Sd(n)!==n)throw Error(kt(188))}function sP(n){var i=n.alternate;if(!i){if(i=Sd(n),i===null)throw Error(kt(188));return i!==n?null:n}for(var a=n,f=i;;){var x=a.return;if(x===null)break;var T=x.alternate;if(T===null){if(f=x.return,f!==null){a=f;continue}break}if(x.child===T.child){for(T=x.child;T;){if(T===a)return ww(x),n;if(T===f)return ww(x),i;T=T.sibling}throw Error(kt(188))}if(a.return!==f.return)a=x,f=T;else{for(var b=!1,u=x.child;u;){if(u===a){b=!0,a=x,f=T;break}if(u===f){b=!0,f=x,a=T;break}u=u.sibling}if(!b){for(u=T.child;u;){if(u===a){b=!0,a=T,f=x;break}if(u===f){b=!0,f=T,a=x;break}u=u.sibling}if(!b)throw Error(kt(189))}}if(a.alternate!==f)throw Error(kt(190))}if(a.tag!==3)throw Error(kt(188));return a.stateNode.current===a?n:i}function k2(n){return n=sP(n),n!==null?A2(n):null}function A2(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var i=A2(n);if(i!==null)return i;n=n.sibling}return null}var z2=As.unstable_scheduleCallback,bw=As.unstable_cancelCallback,aP=As.unstable_shouldYield,lP=As.unstable_requestPaint,ci=As.unstable_now,uP=As.unstable_getCurrentPriorityLevel,g1=As.unstable_ImmediatePriority,R2=As.unstable_UserBlockingPriority,fy=As.unstable_NormalPriority,cP=As.unstable_LowPriority,L2=As.unstable_IdlePriority,Wy=null,Ll=null;function hP(n){if(Ll&&typeof Ll.onCommitFiberRoot=="function")try{Ll.onCommitFiberRoot(Wy,n,void 0,(n.current.flags&128)===128)}catch{}}var Ya=Math.clz32?Math.clz32:fP,dP=Math.log,pP=Math.LN2;function fP(n){return n>>>=0,n===0?32:31-(dP(n)/pP|0)|0}var L_=64,D_=4194304;function Pm(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function my(n,i){var a=n.pendingLanes;if(a===0)return 0;var f=0,x=n.suspendedLanes,T=n.pingedLanes,b=a&268435455;if(b!==0){var u=b&~x;u!==0?f=Pm(u):(T&=b,T!==0&&(f=Pm(T)))}else b=a&~x,b!==0?f=Pm(b):T!==0&&(f=Pm(T));if(f===0)return 0;if(i!==0&&i!==f&&!(i&x)&&(x=f&-f,T=i&-i,x>=T||x===16&&(T&4194240)!==0))return i;if(f&4&&(f|=a&16),i=n.entangledLanes,i!==0)for(n=n.entanglements,i&=f;0<i;)a=31-Ya(i),x=1<<a,f|=n[a],i&=~x;return f}function mP(n,i){switch(n){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gP(n,i){for(var a=n.suspendedLanes,f=n.pingedLanes,x=n.expirationTimes,T=n.pendingLanes;0<T;){var b=31-Ya(T),u=1<<b,j=x[b];j===-1?(!(u&a)||u&f)&&(x[b]=mP(u,i)):j<=i&&(n.expiredLanes|=u),T&=~u}}function gx(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function D2(){var n=L_;return L_<<=1,!(L_&4194240)&&(L_=64),n}function Tv(n){for(var i=[],a=0;31>a;a++)i.push(n);return i}function ag(n,i,a){n.pendingLanes|=i,i!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,i=31-Ya(i),n[i]=a}function _P(n,i){var a=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;var f=n.eventTimes;for(n=n.expirationTimes;0<a;){var x=31-Ya(a),T=1<<x;i[x]=0,f[x]=-1,n[x]=-1,a&=~T}}function _1(n,i){var a=n.entangledLanes|=i;for(n=n.entanglements;a;){var f=31-Ya(a),x=1<<f;x&i|n[f]&i&&(n[f]|=i),a&=~x}}var cr=0;function F2(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var B2,y1,O2,N2,j2,_x=!1,F_=[],Qc=null,eh=null,th=null,Gm=new Map,$m=new Map,Yc=[],yP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sw(n,i){switch(n){case"focusin":case"focusout":Qc=null;break;case"dragenter":case"dragleave":eh=null;break;case"mouseover":case"mouseout":th=null;break;case"pointerover":case"pointerout":Gm.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":$m.delete(i.pointerId)}}function gm(n,i,a,f,x,T){return n===null||n.nativeEvent!==T?(n={blockedOn:i,domEventName:a,eventSystemFlags:f,nativeEvent:T,targetContainers:[x]},i!==null&&(i=ug(i),i!==null&&y1(i)),n):(n.eventSystemFlags|=f,i=n.targetContainers,x!==null&&i.indexOf(x)===-1&&i.push(x),n)}function vP(n,i,a,f,x){switch(i){case"focusin":return Qc=gm(Qc,n,i,a,f,x),!0;case"dragenter":return eh=gm(eh,n,i,a,f,x),!0;case"mouseover":return th=gm(th,n,i,a,f,x),!0;case"pointerover":var T=x.pointerId;return Gm.set(T,gm(Gm.get(T)||null,n,i,a,f,x)),!0;case"gotpointercapture":return T=x.pointerId,$m.set(T,gm($m.get(T)||null,n,i,a,f,x)),!0}return!1}function U2(n){var i=ud(n.target);if(i!==null){var a=Sd(i);if(a!==null){if(i=a.tag,i===13){if(i=I2(a),i!==null){n.blockedOn=i,j2(n.priority,function(){O2(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Q_(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var a=yx(n.domEventName,n.eventSystemFlags,i[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var f=new a.constructor(a.type,a);dx=f,a.target.dispatchEvent(f),dx=null}else return i=ug(a),i!==null&&y1(i),n.blockedOn=a,!1;i.shift()}return!0}function Tw(n,i,a){Q_(n)&&a.delete(i)}function xP(){_x=!1,Qc!==null&&Q_(Qc)&&(Qc=null),eh!==null&&Q_(eh)&&(eh=null),th!==null&&Q_(th)&&(th=null),Gm.forEach(Tw),$m.forEach(Tw)}function _m(n,i){n.blockedOn===i&&(n.blockedOn=null,_x||(_x=!0,As.unstable_scheduleCallback(As.unstable_NormalPriority,xP)))}function Zm(n){function i(x){return _m(x,n)}if(0<F_.length){_m(F_[0],n);for(var a=1;a<F_.length;a++){var f=F_[a];f.blockedOn===n&&(f.blockedOn=null)}}for(Qc!==null&&_m(Qc,n),eh!==null&&_m(eh,n),th!==null&&_m(th,n),Gm.forEach(i),$m.forEach(i),a=0;a<Yc.length;a++)f=Yc[a],f.blockedOn===n&&(f.blockedOn=null);for(;0<Yc.length&&(a=Yc[0],a.blockedOn===null);)U2(a),a.blockedOn===null&&Yc.shift()}var Wp=Fu.ReactCurrentBatchConfig,gy=!0;function wP(n,i,a,f){var x=cr,T=Wp.transition;Wp.transition=null;try{cr=1,v1(n,i,a,f)}finally{cr=x,Wp.transition=T}}function bP(n,i,a,f){var x=cr,T=Wp.transition;Wp.transition=null;try{cr=4,v1(n,i,a,f)}finally{cr=x,Wp.transition=T}}function v1(n,i,a,f){if(gy){var x=yx(n,i,a,f);if(x===null)Lv(n,i,f,_y,a),Sw(n,f);else if(vP(x,n,i,a,f))f.stopPropagation();else if(Sw(n,f),i&4&&-1<yP.indexOf(n)){for(;x!==null;){var T=ug(x);if(T!==null&&B2(T),T=yx(n,i,a,f),T===null&&Lv(n,i,f,_y,a),T===x)break;x=T}x!==null&&f.stopPropagation()}else Lv(n,i,f,null,a)}}var _y=null;function yx(n,i,a,f){if(_y=null,n=m1(f),n=ud(n),n!==null)if(i=Sd(n),i===null)n=null;else if(a=i.tag,a===13){if(n=I2(i),n!==null)return n;n=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null);return _y=n,null}function V2(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uP()){case g1:return 1;case R2:return 4;case fy:case cP:return 16;case L2:return 536870912;default:return 16}default:return 16}}var Kc=null,x1=null,ey=null;function G2(){if(ey)return ey;var n,i=x1,a=i.length,f,x="value"in Kc?Kc.value:Kc.textContent,T=x.length;for(n=0;n<a&&i[n]===x[n];n++);var b=a-n;for(f=1;f<=b&&i[a-f]===x[T-f];f++);return ey=x.slice(n,1<f?1-f:void 0)}function ty(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function B_(){return!0}function Cw(){return!1}function Ds(n){function i(a,f,x,T,b){this._reactName=a,this._targetInst=x,this.type=f,this.nativeEvent=T,this.target=b,this.currentTarget=null;for(var u in n)n.hasOwnProperty(u)&&(a=n[u],this[u]=a?a(T):T[u]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?B_:Cw,this.isPropagationStopped=Cw,this}return Xr(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=B_)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=B_)},persist:function(){},isPersistent:B_}),i}var uf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},w1=Ds(uf),lg=Xr({},uf,{view:0,detail:0}),SP=Ds(lg),Cv,Pv,ym,Hy=Xr({},lg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:b1,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ym&&(ym&&n.type==="mousemove"?(Cv=n.screenX-ym.screenX,Pv=n.screenY-ym.screenY):Pv=Cv=0,ym=n),Cv)},movementY:function(n){return"movementY"in n?n.movementY:Pv}}),Pw=Ds(Hy),TP=Xr({},Hy,{dataTransfer:0}),CP=Ds(TP),PP=Xr({},lg,{relatedTarget:0}),Ev=Ds(PP),EP=Xr({},uf,{animationName:0,elapsedTime:0,pseudoElement:0}),MP=Ds(EP),IP=Xr({},uf,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),kP=Ds(IP),AP=Xr({},uf,{data:0}),Ew=Ds(AP),zP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DP(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=LP[n])?!!i[n]:!1}function b1(){return DP}var FP=Xr({},lg,{key:function(n){if(n.key){var i=zP[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=ty(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?RP[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:b1,charCode:function(n){return n.type==="keypress"?ty(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ty(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),BP=Ds(FP),OP=Xr({},Hy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mw=Ds(OP),NP=Xr({},lg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:b1}),jP=Ds(NP),UP=Xr({},uf,{propertyName:0,elapsedTime:0,pseudoElement:0}),VP=Ds(UP),GP=Xr({},Hy,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),$P=Ds(GP),ZP=[9,13,27,32],S1=ku&&"CompositionEvent"in window,Rm=null;ku&&"documentMode"in document&&(Rm=document.documentMode);var qP=ku&&"TextEvent"in window&&!Rm,$2=ku&&(!S1||Rm&&8<Rm&&11>=Rm),Iw=" ",kw=!1;function Z2(n,i){switch(n){case"keyup":return ZP.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function q2(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Lp=!1;function WP(n,i){switch(n){case"compositionend":return q2(i);case"keypress":return i.which!==32?null:(kw=!0,Iw);case"textInput":return n=i.data,n===Iw&&kw?null:n;default:return null}}function HP(n,i){if(Lp)return n==="compositionend"||!S1&&Z2(n,i)?(n=G2(),ey=x1=Kc=null,Lp=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return $2&&i.locale!=="ko"?null:i.data;default:return null}}var YP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Aw(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!YP[n.type]:i==="textarea"}function W2(n,i,a,f){T2(f),i=yy(i,"onChange"),0<i.length&&(a=new w1("onChange","change",null,a,f),n.push({event:a,listeners:i}))}var Lm=null,qm=null;function XP(n){iS(n,0)}function Yy(n){var i=Bp(n);if(_2(i))return n}function KP(n,i){if(n==="change")return i}var H2=!1;if(ku){var Mv;if(ku){var Iv="oninput"in document;if(!Iv){var zw=document.createElement("div");zw.setAttribute("oninput","return;"),Iv=typeof zw.oninput=="function"}Mv=Iv}else Mv=!1;H2=Mv&&(!document.documentMode||9<document.documentMode)}function Rw(){Lm&&(Lm.detachEvent("onpropertychange",Y2),qm=Lm=null)}function Y2(n){if(n.propertyName==="value"&&Yy(qm)){var i=[];W2(i,qm,n,m1(n)),M2(XP,i)}}function JP(n,i,a){n==="focusin"?(Rw(),Lm=i,qm=a,Lm.attachEvent("onpropertychange",Y2)):n==="focusout"&&Rw()}function QP(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Yy(qm)}function eE(n,i){if(n==="click")return Yy(i)}function tE(n,i){if(n==="input"||n==="change")return Yy(i)}function nE(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var Ka=typeof Object.is=="function"?Object.is:nE;function Wm(n,i){if(Ka(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var a=Object.keys(n),f=Object.keys(i);if(a.length!==f.length)return!1;for(f=0;f<a.length;f++){var x=a[f];if(!ex.call(i,x)||!Ka(n[x],i[x]))return!1}return!0}function Lw(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Dw(n,i){var a=Lw(n);n=0;for(var f;a;){if(a.nodeType===3){if(f=n+a.textContent.length,n<=i&&f>=i)return{node:a,offset:i-n};n=f}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Lw(a)}}function X2(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?X2(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function K2(){for(var n=window,i=hy();i instanceof n.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)n=i.contentWindow;else break;i=hy(n.document)}return i}function T1(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}function rE(n){var i=K2(),a=n.focusedElem,f=n.selectionRange;if(i!==a&&a&&a.ownerDocument&&X2(a.ownerDocument.documentElement,a)){if(f!==null&&T1(a)){if(i=f.start,n=f.end,n===void 0&&(n=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(n,a.value.length);else if(n=(i=a.ownerDocument||document)&&i.defaultView||window,n.getSelection){n=n.getSelection();var x=a.textContent.length,T=Math.min(f.start,x);f=f.end===void 0?T:Math.min(f.end,x),!n.extend&&T>f&&(x=f,f=T,T=x),x=Dw(a,T);var b=Dw(a,f);x&&b&&(n.rangeCount!==1||n.anchorNode!==x.node||n.anchorOffset!==x.offset||n.focusNode!==b.node||n.focusOffset!==b.offset)&&(i=i.createRange(),i.setStart(x.node,x.offset),n.removeAllRanges(),T>f?(n.addRange(i),n.extend(b.node,b.offset)):(i.setEnd(b.node,b.offset),n.addRange(i)))}}for(i=[],n=a;n=n.parentNode;)n.nodeType===1&&i.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)n=i[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var iE=ku&&"documentMode"in document&&11>=document.documentMode,Dp=null,vx=null,Dm=null,xx=!1;function Fw(n,i,a){var f=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;xx||Dp==null||Dp!==hy(f)||(f=Dp,"selectionStart"in f&&T1(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Dm&&Wm(Dm,f)||(Dm=f,f=yy(vx,"onSelect"),0<f.length&&(i=new w1("onSelect","select",null,i,a),n.push({event:i,listeners:f}),i.target=Dp)))}function O_(n,i){var a={};return a[n.toLowerCase()]=i.toLowerCase(),a["Webkit"+n]="webkit"+i,a["Moz"+n]="moz"+i,a}var Fp={animationend:O_("Animation","AnimationEnd"),animationiteration:O_("Animation","AnimationIteration"),animationstart:O_("Animation","AnimationStart"),transitionend:O_("Transition","TransitionEnd")},kv={},J2={};ku&&(J2=document.createElement("div").style,"AnimationEvent"in window||(delete Fp.animationend.animation,delete Fp.animationiteration.animation,delete Fp.animationstart.animation),"TransitionEvent"in window||delete Fp.transitionend.transition);function Xy(n){if(kv[n])return kv[n];if(!Fp[n])return n;var i=Fp[n],a;for(a in i)if(i.hasOwnProperty(a)&&a in J2)return kv[n]=i[a];return n}var Q2=Xy("animationend"),eS=Xy("animationiteration"),tS=Xy("animationstart"),nS=Xy("transitionend"),rS=new Map,Bw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ch(n,i){rS.set(n,i),bd(i,[n])}for(var Av=0;Av<Bw.length;Av++){var zv=Bw[Av],oE=zv.toLowerCase(),sE=zv[0].toUpperCase()+zv.slice(1);ch(oE,"on"+sE)}ch(Q2,"onAnimationEnd");ch(eS,"onAnimationIteration");ch(tS,"onAnimationStart");ch("dblclick","onDoubleClick");ch("focusin","onFocus");ch("focusout","onBlur");ch(nS,"onTransitionEnd");Kp("onMouseEnter",["mouseout","mouseover"]);Kp("onMouseLeave",["mouseout","mouseover"]);Kp("onPointerEnter",["pointerout","pointerover"]);Kp("onPointerLeave",["pointerout","pointerover"]);bd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bd("onBeforeInput",["compositionend","keypress","textInput","paste"]);bd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Em="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),aE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Em));function Ow(n,i,a){var f=n.type||"unknown-event";n.currentTarget=a,oP(f,i,void 0,n),n.currentTarget=null}function iS(n,i){i=(i&4)!==0;for(var a=0;a<n.length;a++){var f=n[a],x=f.event;f=f.listeners;e:{var T=void 0;if(i)for(var b=f.length-1;0<=b;b--){var u=f[b],j=u.instance,Z=u.currentTarget;if(u=u.listener,j!==T&&x.isPropagationStopped())break e;Ow(x,u,Z),T=j}else for(b=0;b<f.length;b++){if(u=f[b],j=u.instance,Z=u.currentTarget,u=u.listener,j!==T&&x.isPropagationStopped())break e;Ow(x,u,Z),T=j}}}if(py)throw n=mx,py=!1,mx=null,n}function kr(n,i){var a=i[Cx];a===void 0&&(a=i[Cx]=new Set);var f=n+"__bubble";a.has(f)||(oS(i,n,2,!1),a.add(f))}function Rv(n,i,a){var f=0;i&&(f|=4),oS(a,n,f,i)}var N_="_reactListening"+Math.random().toString(36).slice(2);function Hm(n){if(!n[N_]){n[N_]=!0,d2.forEach(function(a){a!=="selectionchange"&&(aE.has(a)||Rv(a,!1,n),Rv(a,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[N_]||(i[N_]=!0,Rv("selectionchange",!1,i))}}function oS(n,i,a,f){switch(V2(i)){case 1:var x=wP;break;case 4:x=bP;break;default:x=v1}a=x.bind(null,i,a,n),x=void 0,!fx||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(x=!0),f?x!==void 0?n.addEventListener(i,a,{capture:!0,passive:x}):n.addEventListener(i,a,!0):x!==void 0?n.addEventListener(i,a,{passive:x}):n.addEventListener(i,a,!1)}function Lv(n,i,a,f,x){var T=f;if(!(i&1)&&!(i&2)&&f!==null)e:for(;;){if(f===null)return;var b=f.tag;if(b===3||b===4){var u=f.stateNode.containerInfo;if(u===x||u.nodeType===8&&u.parentNode===x)break;if(b===4)for(b=f.return;b!==null;){var j=b.tag;if((j===3||j===4)&&(j=b.stateNode.containerInfo,j===x||j.nodeType===8&&j.parentNode===x))return;b=b.return}for(;u!==null;){if(b=ud(u),b===null)return;if(j=b.tag,j===5||j===6){f=T=b;continue e}u=u.parentNode}}f=f.return}M2(function(){var Z=T,me=m1(a),ge=[];e:{var fe=rS.get(n);if(fe!==void 0){var oe=w1,Be=n;switch(n){case"keypress":if(ty(a)===0)break e;case"keydown":case"keyup":oe=BP;break;case"focusin":Be="focus",oe=Ev;break;case"focusout":Be="blur",oe=Ev;break;case"beforeblur":case"afterblur":oe=Ev;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=Pw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=CP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=jP;break;case Q2:case eS:case tS:oe=MP;break;case nS:oe=VP;break;case"scroll":oe=SP;break;case"wheel":oe=$P;break;case"copy":case"cut":case"paste":oe=kP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=Mw}var _t=(i&4)!==0,xt=!_t&&n==="scroll",Ie=_t?fe!==null?fe+"Capture":null:fe;_t=[];for(var ne=Z,Te;ne!==null;){Te=ne;var Ne=Te.stateNode;if(Te.tag===5&&Ne!==null&&(Te=Ne,Ie!==null&&(Ne=Vm(ne,Ie),Ne!=null&&_t.push(Ym(ne,Ne,Te)))),xt)break;ne=ne.return}0<_t.length&&(fe=new oe(fe,Be,null,a,me),ge.push({event:fe,listeners:_t}))}}if(!(i&7)){e:{if(fe=n==="mouseover"||n==="pointerover",oe=n==="mouseout"||n==="pointerout",fe&&a!==dx&&(Be=a.relatedTarget||a.fromElement)&&(ud(Be)||Be[Au]))break e;if((oe||fe)&&(fe=me.window===me?me:(fe=me.ownerDocument)?fe.defaultView||fe.parentWindow:window,oe?(Be=a.relatedTarget||a.toElement,oe=Z,Be=Be?ud(Be):null,Be!==null&&(xt=Sd(Be),Be!==xt||Be.tag!==5&&Be.tag!==6)&&(Be=null)):(oe=null,Be=Z),oe!==Be)){if(_t=Pw,Ne="onMouseLeave",Ie="onMouseEnter",ne="mouse",(n==="pointerout"||n==="pointerover")&&(_t=Mw,Ne="onPointerLeave",Ie="onPointerEnter",ne="pointer"),xt=oe==null?fe:Bp(oe),Te=Be==null?fe:Bp(Be),fe=new _t(Ne,ne+"leave",oe,a,me),fe.target=xt,fe.relatedTarget=Te,Ne=null,ud(me)===Z&&(_t=new _t(Ie,ne+"enter",Be,a,me),_t.target=Te,_t.relatedTarget=xt,Ne=_t),xt=Ne,oe&&Be)t:{for(_t=oe,Ie=Be,ne=0,Te=_t;Te;Te=Ip(Te))ne++;for(Te=0,Ne=Ie;Ne;Ne=Ip(Ne))Te++;for(;0<ne-Te;)_t=Ip(_t),ne--;for(;0<Te-ne;)Ie=Ip(Ie),Te--;for(;ne--;){if(_t===Ie||Ie!==null&&_t===Ie.alternate)break t;_t=Ip(_t),Ie=Ip(Ie)}_t=null}else _t=null;oe!==null&&Nw(ge,fe,oe,_t,!1),Be!==null&&xt!==null&&Nw(ge,xt,Be,_t,!0)}}e:{if(fe=Z?Bp(Z):window,oe=fe.nodeName&&fe.nodeName.toLowerCase(),oe==="select"||oe==="input"&&fe.type==="file")var ut=KP;else if(Aw(fe))if(H2)ut=tE;else{ut=QP;var ct=JP}else(oe=fe.nodeName)&&oe.toLowerCase()==="input"&&(fe.type==="checkbox"||fe.type==="radio")&&(ut=eE);if(ut&&(ut=ut(n,Z))){W2(ge,ut,a,me);break e}ct&&ct(n,fe,Z),n==="focusout"&&(ct=fe._wrapperState)&&ct.controlled&&fe.type==="number"&&ax(fe,"number",fe.value)}switch(ct=Z?Bp(Z):window,n){case"focusin":(Aw(ct)||ct.contentEditable==="true")&&(Dp=ct,vx=Z,Dm=null);break;case"focusout":Dm=vx=Dp=null;break;case"mousedown":xx=!0;break;case"contextmenu":case"mouseup":case"dragend":xx=!1,Fw(ge,a,me);break;case"selectionchange":if(iE)break;case"keydown":case"keyup":Fw(ge,a,me)}var ht;if(S1)e:{switch(n){case"compositionstart":var $="onCompositionStart";break e;case"compositionend":$="onCompositionEnd";break e;case"compositionupdate":$="onCompositionUpdate";break e}$=void 0}else Lp?Z2(n,a)&&($="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&($="onCompositionStart");$&&($2&&a.locale!=="ko"&&(Lp||$!=="onCompositionStart"?$==="onCompositionEnd"&&Lp&&(ht=G2()):(Kc=me,x1="value"in Kc?Kc.value:Kc.textContent,Lp=!0)),ct=yy(Z,$),0<ct.length&&($=new Ew($,n,null,a,me),ge.push({event:$,listeners:ct}),ht?$.data=ht:(ht=q2(a),ht!==null&&($.data=ht)))),(ht=qP?WP(n,a):HP(n,a))&&(Z=yy(Z,"onBeforeInput"),0<Z.length&&(me=new Ew("onBeforeInput","beforeinput",null,a,me),ge.push({event:me,listeners:Z}),me.data=ht))}iS(ge,i)})}function Ym(n,i,a){return{instance:n,listener:i,currentTarget:a}}function yy(n,i){for(var a=i+"Capture",f=[];n!==null;){var x=n,T=x.stateNode;x.tag===5&&T!==null&&(x=T,T=Vm(n,a),T!=null&&f.unshift(Ym(n,T,x)),T=Vm(n,i),T!=null&&f.push(Ym(n,T,x))),n=n.return}return f}function Ip(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Nw(n,i,a,f,x){for(var T=i._reactName,b=[];a!==null&&a!==f;){var u=a,j=u.alternate,Z=u.stateNode;if(j!==null&&j===f)break;u.tag===5&&Z!==null&&(u=Z,x?(j=Vm(a,T),j!=null&&b.unshift(Ym(a,j,u))):x||(j=Vm(a,T),j!=null&&b.push(Ym(a,j,u)))),a=a.return}b.length!==0&&n.push({event:i,listeners:b})}var lE=/\r\n?/g,uE=/\u0000|\uFFFD/g;function jw(n){return(typeof n=="string"?n:""+n).replace(lE,`
`).replace(uE,"")}function j_(n,i,a){if(i=jw(i),jw(n)!==i&&a)throw Error(kt(425))}function vy(){}var wx=null,bx=null;function Sx(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Tx=typeof setTimeout=="function"?setTimeout:void 0,cE=typeof clearTimeout=="function"?clearTimeout:void 0,Uw=typeof Promise=="function"?Promise:void 0,hE=typeof queueMicrotask=="function"?queueMicrotask:typeof Uw<"u"?function(n){return Uw.resolve(null).then(n).catch(dE)}:Tx;function dE(n){setTimeout(function(){throw n})}function Dv(n,i){var a=i,f=0;do{var x=a.nextSibling;if(n.removeChild(a),x&&x.nodeType===8)if(a=x.data,a==="/$"){if(f===0){n.removeChild(x),Zm(i);return}f--}else a!=="$"&&a!=="$?"&&a!=="$!"||f++;a=x}while(a);Zm(i)}function nh(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return n}function Vw(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return n;i--}else a==="/$"&&i++}n=n.previousSibling}return null}var cf=Math.random().toString(36).slice(2),zl="__reactFiber$"+cf,Xm="__reactProps$"+cf,Au="__reactContainer$"+cf,Cx="__reactEvents$"+cf,pE="__reactListeners$"+cf,fE="__reactHandles$"+cf;function ud(n){var i=n[zl];if(i)return i;for(var a=n.parentNode;a;){if(i=a[Au]||a[zl]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(n=Vw(n);n!==null;){if(a=n[zl])return a;n=Vw(n)}return i}n=a,a=n.parentNode}return null}function ug(n){return n=n[zl]||n[Au],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Bp(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(kt(33))}function Ky(n){return n[Xm]||null}var Px=[],Op=-1;function hh(n){return{current:n}}function Ar(n){0>Op||(n.current=Px[Op],Px[Op]=null,Op--)}function br(n,i){Op++,Px[Op]=n.current,n.current=i}var lh={},wo=hh(lh),os=hh(!1),fd=lh;function Jp(n,i){var a=n.type.contextTypes;if(!a)return lh;var f=n.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===i)return f.__reactInternalMemoizedMaskedChildContext;var x={},T;for(T in a)x[T]=i[T];return f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=x),x}function ss(n){return n=n.childContextTypes,n!=null}function xy(){Ar(os),Ar(wo)}function Gw(n,i,a){if(wo.current!==lh)throw Error(kt(168));br(wo,i),br(os,a)}function sS(n,i,a){var f=n.stateNode;if(i=i.childContextTypes,typeof f.getChildContext!="function")return a;f=f.getChildContext();for(var x in f)if(!(x in i))throw Error(kt(108,JC(n)||"Unknown",x));return Xr({},a,f)}function wy(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||lh,fd=wo.current,br(wo,n),br(os,os.current),!0}function $w(n,i,a){var f=n.stateNode;if(!f)throw Error(kt(169));a?(n=sS(n,i,fd),f.__reactInternalMemoizedMergedChildContext=n,Ar(os),Ar(wo),br(wo,n)):Ar(os),br(os,a)}var Pu=null,Jy=!1,Fv=!1;function aS(n){Pu===null?Pu=[n]:Pu.push(n)}function mE(n){Jy=!0,aS(n)}function dh(){if(!Fv&&Pu!==null){Fv=!0;var n=0,i=cr;try{var a=Pu;for(cr=1;n<a.length;n++){var f=a[n];do f=f(!0);while(f!==null)}Pu=null,Jy=!1}catch(x){throw Pu!==null&&(Pu=Pu.slice(n+1)),z2(g1,dh),x}finally{cr=i,Fv=!1}}return null}var Np=[],jp=0,by=null,Sy=0,aa=[],la=0,md=null,Eu=1,Mu="";function sd(n,i){Np[jp++]=Sy,Np[jp++]=by,by=n,Sy=i}function lS(n,i,a){aa[la++]=Eu,aa[la++]=Mu,aa[la++]=md,md=n;var f=Eu;n=Mu;var x=32-Ya(f)-1;f&=~(1<<x),a+=1;var T=32-Ya(i)+x;if(30<T){var b=x-x%5;T=(f&(1<<b)-1).toString(32),f>>=b,x-=b,Eu=1<<32-Ya(i)+x|a<<x|f,Mu=T+n}else Eu=1<<T|a<<x|f,Mu=n}function C1(n){n.return!==null&&(sd(n,1),lS(n,1,0))}function P1(n){for(;n===by;)by=Np[--jp],Np[jp]=null,Sy=Np[--jp],Np[jp]=null;for(;n===md;)md=aa[--la],aa[la]=null,Mu=aa[--la],aa[la]=null,Eu=aa[--la],aa[la]=null}var ks=null,Ms=null,Dr=!1,Wa=null;function uS(n,i){var a=ua(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=n,i=n.deletions,i===null?(n.deletions=[a],n.flags|=16):i.push(a)}function Zw(n,i){switch(n.tag){case 5:var a=n.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(n.stateNode=i,ks=n,Ms=nh(i.firstChild),!0):!1;case 6:return i=n.pendingProps===""||i.nodeType!==3?null:i,i!==null?(n.stateNode=i,ks=n,Ms=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=md!==null?{id:Eu,overflow:Mu}:null,n.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=ua(18,null,null,0),a.stateNode=i,a.return=n,n.child=a,ks=n,Ms=null,!0):!1;default:return!1}}function Ex(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Mx(n){if(Dr){var i=Ms;if(i){var a=i;if(!Zw(n,i)){if(Ex(n))throw Error(kt(418));i=nh(a.nextSibling);var f=ks;i&&Zw(n,i)?uS(f,a):(n.flags=n.flags&-4097|2,Dr=!1,ks=n)}}else{if(Ex(n))throw Error(kt(418));n.flags=n.flags&-4097|2,Dr=!1,ks=n}}}function qw(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ks=n}function U_(n){if(n!==ks)return!1;if(!Dr)return qw(n),Dr=!0,!1;var i;if((i=n.tag!==3)&&!(i=n.tag!==5)&&(i=n.type,i=i!=="head"&&i!=="body"&&!Sx(n.type,n.memoizedProps)),i&&(i=Ms)){if(Ex(n))throw cS(),Error(kt(418));for(;i;)uS(n,i),i=nh(i.nextSibling)}if(qw(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(kt(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(i===0){Ms=nh(n.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}n=n.nextSibling}Ms=null}}else Ms=ks?nh(n.stateNode.nextSibling):null;return!0}function cS(){for(var n=Ms;n;)n=nh(n.nextSibling)}function Qp(){Ms=ks=null,Dr=!1}function E1(n){Wa===null?Wa=[n]:Wa.push(n)}var gE=Fu.ReactCurrentBatchConfig;function vm(n,i,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(kt(309));var f=a.stateNode}if(!f)throw Error(kt(147,n));var x=f,T=""+n;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===T?i.ref:(i=function(b){var u=x.refs;b===null?delete u[T]:u[T]=b},i._stringRef=T,i)}if(typeof n!="string")throw Error(kt(284));if(!a._owner)throw Error(kt(290,n))}return n}function V_(n,i){throw n=Object.prototype.toString.call(i),Error(kt(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n))}function Ww(n){var i=n._init;return i(n._payload)}function hS(n){function i(Ie,ne){if(n){var Te=Ie.deletions;Te===null?(Ie.deletions=[ne],Ie.flags|=16):Te.push(ne)}}function a(Ie,ne){if(!n)return null;for(;ne!==null;)i(Ie,ne),ne=ne.sibling;return null}function f(Ie,ne){for(Ie=new Map;ne!==null;)ne.key!==null?Ie.set(ne.key,ne):Ie.set(ne.index,ne),ne=ne.sibling;return Ie}function x(Ie,ne){return Ie=sh(Ie,ne),Ie.index=0,Ie.sibling=null,Ie}function T(Ie,ne,Te){return Ie.index=Te,n?(Te=Ie.alternate,Te!==null?(Te=Te.index,Te<ne?(Ie.flags|=2,ne):Te):(Ie.flags|=2,ne)):(Ie.flags|=1048576,ne)}function b(Ie){return n&&Ie.alternate===null&&(Ie.flags|=2),Ie}function u(Ie,ne,Te,Ne){return ne===null||ne.tag!==6?(ne=Gv(Te,Ie.mode,Ne),ne.return=Ie,ne):(ne=x(ne,Te),ne.return=Ie,ne)}function j(Ie,ne,Te,Ne){var ut=Te.type;return ut===Rp?me(Ie,ne,Te.props.children,Ne,Te.key):ne!==null&&(ne.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===Wc&&Ww(ut)===ne.type)?(Ne=x(ne,Te.props),Ne.ref=vm(Ie,ne,Te),Ne.return=Ie,Ne):(Ne=ly(Te.type,Te.key,Te.props,null,Ie.mode,Ne),Ne.ref=vm(Ie,ne,Te),Ne.return=Ie,Ne)}function Z(Ie,ne,Te,Ne){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==Te.containerInfo||ne.stateNode.implementation!==Te.implementation?(ne=$v(Te,Ie.mode,Ne),ne.return=Ie,ne):(ne=x(ne,Te.children||[]),ne.return=Ie,ne)}function me(Ie,ne,Te,Ne,ut){return ne===null||ne.tag!==7?(ne=pd(Te,Ie.mode,Ne,ut),ne.return=Ie,ne):(ne=x(ne,Te),ne.return=Ie,ne)}function ge(Ie,ne,Te){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=Gv(""+ne,Ie.mode,Te),ne.return=Ie,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case A_:return Te=ly(ne.type,ne.key,ne.props,null,Ie.mode,Te),Te.ref=vm(Ie,null,ne),Te.return=Ie,Te;case zp:return ne=$v(ne,Ie.mode,Te),ne.return=Ie,ne;case Wc:var Ne=ne._init;return ge(Ie,Ne(ne._payload),Te)}if(Cm(ne)||fm(ne))return ne=pd(ne,Ie.mode,Te,null),ne.return=Ie,ne;V_(Ie,ne)}return null}function fe(Ie,ne,Te,Ne){var ut=ne!==null?ne.key:null;if(typeof Te=="string"&&Te!==""||typeof Te=="number")return ut!==null?null:u(Ie,ne,""+Te,Ne);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case A_:return Te.key===ut?j(Ie,ne,Te,Ne):null;case zp:return Te.key===ut?Z(Ie,ne,Te,Ne):null;case Wc:return ut=Te._init,fe(Ie,ne,ut(Te._payload),Ne)}if(Cm(Te)||fm(Te))return ut!==null?null:me(Ie,ne,Te,Ne,null);V_(Ie,Te)}return null}function oe(Ie,ne,Te,Ne,ut){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return Ie=Ie.get(Te)||null,u(ne,Ie,""+Ne,ut);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case A_:return Ie=Ie.get(Ne.key===null?Te:Ne.key)||null,j(ne,Ie,Ne,ut);case zp:return Ie=Ie.get(Ne.key===null?Te:Ne.key)||null,Z(ne,Ie,Ne,ut);case Wc:var ct=Ne._init;return oe(Ie,ne,Te,ct(Ne._payload),ut)}if(Cm(Ne)||fm(Ne))return Ie=Ie.get(Te)||null,me(ne,Ie,Ne,ut,null);V_(ne,Ne)}return null}function Be(Ie,ne,Te,Ne){for(var ut=null,ct=null,ht=ne,$=ne=0,le=null;ht!==null&&$<Te.length;$++){ht.index>$?(le=ht,ht=null):le=ht.sibling;var pe=fe(Ie,ht,Te[$],Ne);if(pe===null){ht===null&&(ht=le);break}n&&ht&&pe.alternate===null&&i(Ie,ht),ne=T(pe,ne,$),ct===null?ut=pe:ct.sibling=pe,ct=pe,ht=le}if($===Te.length)return a(Ie,ht),Dr&&sd(Ie,$),ut;if(ht===null){for(;$<Te.length;$++)ht=ge(Ie,Te[$],Ne),ht!==null&&(ne=T(ht,ne,$),ct===null?ut=ht:ct.sibling=ht,ct=ht);return Dr&&sd(Ie,$),ut}for(ht=f(Ie,ht);$<Te.length;$++)le=oe(ht,Ie,$,Te[$],Ne),le!==null&&(n&&le.alternate!==null&&ht.delete(le.key===null?$:le.key),ne=T(le,ne,$),ct===null?ut=le:ct.sibling=le,ct=le);return n&&ht.forEach(function(Ve){return i(Ie,Ve)}),Dr&&sd(Ie,$),ut}function _t(Ie,ne,Te,Ne){var ut=fm(Te);if(typeof ut!="function")throw Error(kt(150));if(Te=ut.call(Te),Te==null)throw Error(kt(151));for(var ct=ut=null,ht=ne,$=ne=0,le=null,pe=Te.next();ht!==null&&!pe.done;$++,pe=Te.next()){ht.index>$?(le=ht,ht=null):le=ht.sibling;var Ve=fe(Ie,ht,pe.value,Ne);if(Ve===null){ht===null&&(ht=le);break}n&&ht&&Ve.alternate===null&&i(Ie,ht),ne=T(Ve,ne,$),ct===null?ut=Ve:ct.sibling=Ve,ct=Ve,ht=le}if(pe.done)return a(Ie,ht),Dr&&sd(Ie,$),ut;if(ht===null){for(;!pe.done;$++,pe=Te.next())pe=ge(Ie,pe.value,Ne),pe!==null&&(ne=T(pe,ne,$),ct===null?ut=pe:ct.sibling=pe,ct=pe);return Dr&&sd(Ie,$),ut}for(ht=f(Ie,ht);!pe.done;$++,pe=Te.next())pe=oe(ht,Ie,$,pe.value,Ne),pe!==null&&(n&&pe.alternate!==null&&ht.delete(pe.key===null?$:pe.key),ne=T(pe,ne,$),ct===null?ut=pe:ct.sibling=pe,ct=pe);return n&&ht.forEach(function(Fe){return i(Ie,Fe)}),Dr&&sd(Ie,$),ut}function xt(Ie,ne,Te,Ne){if(typeof Te=="object"&&Te!==null&&Te.type===Rp&&Te.key===null&&(Te=Te.props.children),typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case A_:e:{for(var ut=Te.key,ct=ne;ct!==null;){if(ct.key===ut){if(ut=Te.type,ut===Rp){if(ct.tag===7){a(Ie,ct.sibling),ne=x(ct,Te.props.children),ne.return=Ie,Ie=ne;break e}}else if(ct.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===Wc&&Ww(ut)===ct.type){a(Ie,ct.sibling),ne=x(ct,Te.props),ne.ref=vm(Ie,ct,Te),ne.return=Ie,Ie=ne;break e}a(Ie,ct);break}else i(Ie,ct);ct=ct.sibling}Te.type===Rp?(ne=pd(Te.props.children,Ie.mode,Ne,Te.key),ne.return=Ie,Ie=ne):(Ne=ly(Te.type,Te.key,Te.props,null,Ie.mode,Ne),Ne.ref=vm(Ie,ne,Te),Ne.return=Ie,Ie=Ne)}return b(Ie);case zp:e:{for(ct=Te.key;ne!==null;){if(ne.key===ct)if(ne.tag===4&&ne.stateNode.containerInfo===Te.containerInfo&&ne.stateNode.implementation===Te.implementation){a(Ie,ne.sibling),ne=x(ne,Te.children||[]),ne.return=Ie,Ie=ne;break e}else{a(Ie,ne);break}else i(Ie,ne);ne=ne.sibling}ne=$v(Te,Ie.mode,Ne),ne.return=Ie,Ie=ne}return b(Ie);case Wc:return ct=Te._init,xt(Ie,ne,ct(Te._payload),Ne)}if(Cm(Te))return Be(Ie,ne,Te,Ne);if(fm(Te))return _t(Ie,ne,Te,Ne);V_(Ie,Te)}return typeof Te=="string"&&Te!==""||typeof Te=="number"?(Te=""+Te,ne!==null&&ne.tag===6?(a(Ie,ne.sibling),ne=x(ne,Te),ne.return=Ie,Ie=ne):(a(Ie,ne),ne=Gv(Te,Ie.mode,Ne),ne.return=Ie,Ie=ne),b(Ie)):a(Ie,ne)}return xt}var ef=hS(!0),dS=hS(!1),Ty=hh(null),Cy=null,Up=null,M1=null;function I1(){M1=Up=Cy=null}function k1(n){var i=Ty.current;Ar(Ty),n._currentValue=i}function Ix(n,i,a){for(;n!==null;){var f=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,f!==null&&(f.childLanes|=i)):f!==null&&(f.childLanes&i)!==i&&(f.childLanes|=i),n===a)break;n=n.return}}function Hp(n,i){Cy=n,M1=Up=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&i&&(is=!0),n.firstContext=null)}function ha(n){var i=n._currentValue;if(M1!==n)if(n={context:n,memoizedValue:i,next:null},Up===null){if(Cy===null)throw Error(kt(308));Up=n,Cy.dependencies={lanes:0,firstContext:n}}else Up=Up.next=n;return i}var cd=null;function A1(n){cd===null?cd=[n]:cd.push(n)}function pS(n,i,a,f){var x=i.interleaved;return x===null?(a.next=a,A1(i)):(a.next=x.next,x.next=a),i.interleaved=a,zu(n,f)}function zu(n,i){n.lanes|=i;var a=n.alternate;for(a!==null&&(a.lanes|=i),a=n,n=n.return;n!==null;)n.childLanes|=i,a=n.alternate,a!==null&&(a.childLanes|=i),a=n,n=n.return;return a.tag===3?a.stateNode:null}var Hc=!1;function z1(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fS(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Iu(n,i){return{eventTime:n,lane:i,tag:0,payload:null,callback:null,next:null}}function rh(n,i,a){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,Xn&2){var x=f.pending;return x===null?i.next=i:(i.next=x.next,x.next=i),f.pending=i,zu(n,a)}return x=f.interleaved,x===null?(i.next=i,A1(f)):(i.next=x.next,x.next=i),f.interleaved=i,zu(n,a)}function ny(n,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var f=i.lanes;f&=n.pendingLanes,a|=f,i.lanes=a,_1(n,a)}}function Hw(n,i){var a=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,a===f)){var x=null,T=null;if(a=a.firstBaseUpdate,a!==null){do{var b={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};T===null?x=T=b:T=T.next=b,a=a.next}while(a!==null);T===null?x=T=i:T=T.next=i}else x=T=i;a={baseState:f.baseState,firstBaseUpdate:x,lastBaseUpdate:T,shared:f.shared,effects:f.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=i:n.next=i,a.lastBaseUpdate=i}function Py(n,i,a,f){var x=n.updateQueue;Hc=!1;var T=x.firstBaseUpdate,b=x.lastBaseUpdate,u=x.shared.pending;if(u!==null){x.shared.pending=null;var j=u,Z=j.next;j.next=null,b===null?T=Z:b.next=Z,b=j;var me=n.alternate;me!==null&&(me=me.updateQueue,u=me.lastBaseUpdate,u!==b&&(u===null?me.firstBaseUpdate=Z:u.next=Z,me.lastBaseUpdate=j))}if(T!==null){var ge=x.baseState;b=0,me=Z=j=null,u=T;do{var fe=u.lane,oe=u.eventTime;if((f&fe)===fe){me!==null&&(me=me.next={eventTime:oe,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var Be=n,_t=u;switch(fe=i,oe=a,_t.tag){case 1:if(Be=_t.payload,typeof Be=="function"){ge=Be.call(oe,ge,fe);break e}ge=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=_t.payload,fe=typeof Be=="function"?Be.call(oe,ge,fe):Be,fe==null)break e;ge=Xr({},ge,fe);break e;case 2:Hc=!0}}u.callback!==null&&u.lane!==0&&(n.flags|=64,fe=x.effects,fe===null?x.effects=[u]:fe.push(u))}else oe={eventTime:oe,lane:fe,tag:u.tag,payload:u.payload,callback:u.callback,next:null},me===null?(Z=me=oe,j=ge):me=me.next=oe,b|=fe;if(u=u.next,u===null){if(u=x.shared.pending,u===null)break;fe=u,u=fe.next,fe.next=null,x.lastBaseUpdate=fe,x.shared.pending=null}}while(!0);if(me===null&&(j=ge),x.baseState=j,x.firstBaseUpdate=Z,x.lastBaseUpdate=me,i=x.shared.interleaved,i!==null){x=i;do b|=x.lane,x=x.next;while(x!==i)}else T===null&&(x.shared.lanes=0);_d|=b,n.lanes=b,n.memoizedState=ge}}function Yw(n,i,a){if(n=i.effects,i.effects=null,n!==null)for(i=0;i<n.length;i++){var f=n[i],x=f.callback;if(x!==null){if(f.callback=null,f=a,typeof x!="function")throw Error(kt(191,x));x.call(f)}}}var cg={},Dl=hh(cg),Km=hh(cg),Jm=hh(cg);function hd(n){if(n===cg)throw Error(kt(174));return n}function R1(n,i){switch(br(Jm,i),br(Km,n),br(Dl,cg),n=i.nodeType,n){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:ux(null,"");break;default:n=n===8?i.parentNode:i,i=n.namespaceURI||null,n=n.tagName,i=ux(i,n)}Ar(Dl),br(Dl,i)}function tf(){Ar(Dl),Ar(Km),Ar(Jm)}function mS(n){hd(Jm.current);var i=hd(Dl.current),a=ux(i,n.type);i!==a&&(br(Km,n),br(Dl,a))}function L1(n){Km.current===n&&(Ar(Dl),Ar(Km))}var Hr=hh(0);function Ey(n){for(var i=n;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Bv=[];function D1(){for(var n=0;n<Bv.length;n++)Bv[n]._workInProgressVersionPrimary=null;Bv.length=0}var ry=Fu.ReactCurrentDispatcher,Ov=Fu.ReactCurrentBatchConfig,gd=0,Yr=null,xi=null,zi=null,My=!1,Fm=!1,Qm=0,_E=0;function yo(){throw Error(kt(321))}function F1(n,i){if(i===null)return!1;for(var a=0;a<i.length&&a<n.length;a++)if(!Ka(n[a],i[a]))return!1;return!0}function B1(n,i,a,f,x,T){if(gd=T,Yr=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,ry.current=n===null||n.memoizedState===null?wE:bE,n=a(f,x),Fm){T=0;do{if(Fm=!1,Qm=0,25<=T)throw Error(kt(301));T+=1,zi=xi=null,i.updateQueue=null,ry.current=SE,n=a(f,x)}while(Fm)}if(ry.current=Iy,i=xi!==null&&xi.next!==null,gd=0,zi=xi=Yr=null,My=!1,i)throw Error(kt(300));return n}function O1(){var n=Qm!==0;return Qm=0,n}function kl(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zi===null?Yr.memoizedState=zi=n:zi=zi.next=n,zi}function da(){if(xi===null){var n=Yr.alternate;n=n!==null?n.memoizedState:null}else n=xi.next;var i=zi===null?Yr.memoizedState:zi.next;if(i!==null)zi=i,xi=n;else{if(n===null)throw Error(kt(310));xi=n,n={memoizedState:xi.memoizedState,baseState:xi.baseState,baseQueue:xi.baseQueue,queue:xi.queue,next:null},zi===null?Yr.memoizedState=zi=n:zi=zi.next=n}return zi}function eg(n,i){return typeof i=="function"?i(n):i}function Nv(n){var i=da(),a=i.queue;if(a===null)throw Error(kt(311));a.lastRenderedReducer=n;var f=xi,x=f.baseQueue,T=a.pending;if(T!==null){if(x!==null){var b=x.next;x.next=T.next,T.next=b}f.baseQueue=x=T,a.pending=null}if(x!==null){T=x.next,f=f.baseState;var u=b=null,j=null,Z=T;do{var me=Z.lane;if((gd&me)===me)j!==null&&(j=j.next={lane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),f=Z.hasEagerState?Z.eagerState:n(f,Z.action);else{var ge={lane:me,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null};j===null?(u=j=ge,b=f):j=j.next=ge,Yr.lanes|=me,_d|=me}Z=Z.next}while(Z!==null&&Z!==T);j===null?b=f:j.next=u,Ka(f,i.memoizedState)||(is=!0),i.memoizedState=f,i.baseState=b,i.baseQueue=j,a.lastRenderedState=f}if(n=a.interleaved,n!==null){x=n;do T=x.lane,Yr.lanes|=T,_d|=T,x=x.next;while(x!==n)}else x===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function jv(n){var i=da(),a=i.queue;if(a===null)throw Error(kt(311));a.lastRenderedReducer=n;var f=a.dispatch,x=a.pending,T=i.memoizedState;if(x!==null){a.pending=null;var b=x=x.next;do T=n(T,b.action),b=b.next;while(b!==x);Ka(T,i.memoizedState)||(is=!0),i.memoizedState=T,i.baseQueue===null&&(i.baseState=T),a.lastRenderedState=T}return[T,f]}function gS(){}function _S(n,i){var a=Yr,f=da(),x=i(),T=!Ka(f.memoizedState,x);if(T&&(f.memoizedState=x,is=!0),f=f.queue,N1(xS.bind(null,a,f,n),[n]),f.getSnapshot!==i||T||zi!==null&&zi.memoizedState.tag&1){if(a.flags|=2048,tg(9,vS.bind(null,a,f,x,i),void 0,null),Li===null)throw Error(kt(349));gd&30||yS(a,i,x)}return x}function yS(n,i,a){n.flags|=16384,n={getSnapshot:i,value:a},i=Yr.updateQueue,i===null?(i={lastEffect:null,stores:null},Yr.updateQueue=i,i.stores=[n]):(a=i.stores,a===null?i.stores=[n]:a.push(n))}function vS(n,i,a,f){i.value=a,i.getSnapshot=f,wS(i)&&bS(n)}function xS(n,i,a){return a(function(){wS(i)&&bS(n)})}function wS(n){var i=n.getSnapshot;n=n.value;try{var a=i();return!Ka(n,a)}catch{return!0}}function bS(n){var i=zu(n,1);i!==null&&Xa(i,n,1,-1)}function Xw(n){var i=kl();return typeof n=="function"&&(n=n()),i.memoizedState=i.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:eg,lastRenderedState:n},i.queue=n,n=n.dispatch=xE.bind(null,Yr,n),[i.memoizedState,n]}function tg(n,i,a,f){return n={tag:n,create:i,destroy:a,deps:f,next:null},i=Yr.updateQueue,i===null?(i={lastEffect:null,stores:null},Yr.updateQueue=i,i.lastEffect=n.next=n):(a=i.lastEffect,a===null?i.lastEffect=n.next=n:(f=a.next,a.next=n,n.next=f,i.lastEffect=n)),n}function SS(){return da().memoizedState}function iy(n,i,a,f){var x=kl();Yr.flags|=n,x.memoizedState=tg(1|i,a,void 0,f===void 0?null:f)}function Qy(n,i,a,f){var x=da();f=f===void 0?null:f;var T=void 0;if(xi!==null){var b=xi.memoizedState;if(T=b.destroy,f!==null&&F1(f,b.deps)){x.memoizedState=tg(i,a,T,f);return}}Yr.flags|=n,x.memoizedState=tg(1|i,a,T,f)}function Kw(n,i){return iy(8390656,8,n,i)}function N1(n,i){return Qy(2048,8,n,i)}function TS(n,i){return Qy(4,2,n,i)}function CS(n,i){return Qy(4,4,n,i)}function PS(n,i){if(typeof i=="function")return n=n(),i(n),function(){i(null)};if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function ES(n,i,a){return a=a!=null?a.concat([n]):null,Qy(4,4,PS.bind(null,i,n),a)}function j1(){}function MS(n,i){var a=da();i=i===void 0?null:i;var f=a.memoizedState;return f!==null&&i!==null&&F1(i,f[1])?f[0]:(a.memoizedState=[n,i],n)}function IS(n,i){var a=da();i=i===void 0?null:i;var f=a.memoizedState;return f!==null&&i!==null&&F1(i,f[1])?f[0]:(n=n(),a.memoizedState=[n,i],n)}function kS(n,i,a){return gd&21?(Ka(a,i)||(a=D2(),Yr.lanes|=a,_d|=a,n.baseState=!0),i):(n.baseState&&(n.baseState=!1,is=!0),n.memoizedState=a)}function yE(n,i){var a=cr;cr=a!==0&&4>a?a:4,n(!0);var f=Ov.transition;Ov.transition={};try{n(!1),i()}finally{cr=a,Ov.transition=f}}function AS(){return da().memoizedState}function vE(n,i,a){var f=oh(n);if(a={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null},zS(n))RS(i,a);else if(a=pS(n,i,a,f),a!==null){var x=Do();Xa(a,n,f,x),LS(a,i,f)}}function xE(n,i,a){var f=oh(n),x={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null};if(zS(n))RS(i,x);else{var T=n.alternate;if(n.lanes===0&&(T===null||T.lanes===0)&&(T=i.lastRenderedReducer,T!==null))try{var b=i.lastRenderedState,u=T(b,a);if(x.hasEagerState=!0,x.eagerState=u,Ka(u,b)){var j=i.interleaved;j===null?(x.next=x,A1(i)):(x.next=j.next,j.next=x),i.interleaved=x;return}}catch{}finally{}a=pS(n,i,x,f),a!==null&&(x=Do(),Xa(a,n,f,x),LS(a,i,f))}}function zS(n){var i=n.alternate;return n===Yr||i!==null&&i===Yr}function RS(n,i){Fm=My=!0;var a=n.pending;a===null?i.next=i:(i.next=a.next,a.next=i),n.pending=i}function LS(n,i,a){if(a&4194240){var f=i.lanes;f&=n.pendingLanes,a|=f,i.lanes=a,_1(n,a)}}var Iy={readContext:ha,useCallback:yo,useContext:yo,useEffect:yo,useImperativeHandle:yo,useInsertionEffect:yo,useLayoutEffect:yo,useMemo:yo,useReducer:yo,useRef:yo,useState:yo,useDebugValue:yo,useDeferredValue:yo,useTransition:yo,useMutableSource:yo,useSyncExternalStore:yo,useId:yo,unstable_isNewReconciler:!1},wE={readContext:ha,useCallback:function(n,i){return kl().memoizedState=[n,i===void 0?null:i],n},useContext:ha,useEffect:Kw,useImperativeHandle:function(n,i,a){return a=a!=null?a.concat([n]):null,iy(4194308,4,PS.bind(null,i,n),a)},useLayoutEffect:function(n,i){return iy(4194308,4,n,i)},useInsertionEffect:function(n,i){return iy(4,2,n,i)},useMemo:function(n,i){var a=kl();return i=i===void 0?null:i,n=n(),a.memoizedState=[n,i],n},useReducer:function(n,i,a){var f=kl();return i=a!==void 0?a(i):i,f.memoizedState=f.baseState=i,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},f.queue=n,n=n.dispatch=vE.bind(null,Yr,n),[f.memoizedState,n]},useRef:function(n){var i=kl();return n={current:n},i.memoizedState=n},useState:Xw,useDebugValue:j1,useDeferredValue:function(n){return kl().memoizedState=n},useTransition:function(){var n=Xw(!1),i=n[0];return n=yE.bind(null,n[1]),kl().memoizedState=n,[i,n]},useMutableSource:function(){},useSyncExternalStore:function(n,i,a){var f=Yr,x=kl();if(Dr){if(a===void 0)throw Error(kt(407));a=a()}else{if(a=i(),Li===null)throw Error(kt(349));gd&30||yS(f,i,a)}x.memoizedState=a;var T={value:a,getSnapshot:i};return x.queue=T,Kw(xS.bind(null,f,T,n),[n]),f.flags|=2048,tg(9,vS.bind(null,f,T,a,i),void 0,null),a},useId:function(){var n=kl(),i=Li.identifierPrefix;if(Dr){var a=Mu,f=Eu;a=(f&~(1<<32-Ya(f)-1)).toString(32)+a,i=":"+i+"R"+a,a=Qm++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=_E++,i=":"+i+"r"+a.toString(32)+":";return n.memoizedState=i},unstable_isNewReconciler:!1},bE={readContext:ha,useCallback:MS,useContext:ha,useEffect:N1,useImperativeHandle:ES,useInsertionEffect:TS,useLayoutEffect:CS,useMemo:IS,useReducer:Nv,useRef:SS,useState:function(){return Nv(eg)},useDebugValue:j1,useDeferredValue:function(n){var i=da();return kS(i,xi.memoizedState,n)},useTransition:function(){var n=Nv(eg)[0],i=da().memoizedState;return[n,i]},useMutableSource:gS,useSyncExternalStore:_S,useId:AS,unstable_isNewReconciler:!1},SE={readContext:ha,useCallback:MS,useContext:ha,useEffect:N1,useImperativeHandle:ES,useInsertionEffect:TS,useLayoutEffect:CS,useMemo:IS,useReducer:jv,useRef:SS,useState:function(){return jv(eg)},useDebugValue:j1,useDeferredValue:function(n){var i=da();return xi===null?i.memoizedState=n:kS(i,xi.memoizedState,n)},useTransition:function(){var n=jv(eg)[0],i=da().memoizedState;return[n,i]},useMutableSource:gS,useSyncExternalStore:_S,useId:AS,unstable_isNewReconciler:!1};function Za(n,i){if(n&&n.defaultProps){i=Xr({},i),n=n.defaultProps;for(var a in n)i[a]===void 0&&(i[a]=n[a]);return i}return i}function kx(n,i,a,f){i=n.memoizedState,a=a(f,i),a=a==null?i:Xr({},i,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var e0={isMounted:function(n){return(n=n._reactInternals)?Sd(n)===n:!1},enqueueSetState:function(n,i,a){n=n._reactInternals;var f=Do(),x=oh(n),T=Iu(f,x);T.payload=i,a!=null&&(T.callback=a),i=rh(n,T,x),i!==null&&(Xa(i,n,x,f),ny(i,n,x))},enqueueReplaceState:function(n,i,a){n=n._reactInternals;var f=Do(),x=oh(n),T=Iu(f,x);T.tag=1,T.payload=i,a!=null&&(T.callback=a),i=rh(n,T,x),i!==null&&(Xa(i,n,x,f),ny(i,n,x))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var a=Do(),f=oh(n),x=Iu(a,f);x.tag=2,i!=null&&(x.callback=i),i=rh(n,x,f),i!==null&&(Xa(i,n,f,a),ny(i,n,f))}};function Jw(n,i,a,f,x,T,b){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,T,b):i.prototype&&i.prototype.isPureReactComponent?!Wm(a,f)||!Wm(x,T):!0}function DS(n,i,a){var f=!1,x=lh,T=i.contextType;return typeof T=="object"&&T!==null?T=ha(T):(x=ss(i)?fd:wo.current,f=i.contextTypes,T=(f=f!=null)?Jp(n,x):lh),i=new i(a,T),n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=e0,n.stateNode=i,i._reactInternals=n,f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=x,n.__reactInternalMemoizedMaskedChildContext=T),i}function Qw(n,i,a,f){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,f),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,f),i.state!==n&&e0.enqueueReplaceState(i,i.state,null)}function Ax(n,i,a,f){var x=n.stateNode;x.props=a,x.state=n.memoizedState,x.refs={},z1(n);var T=i.contextType;typeof T=="object"&&T!==null?x.context=ha(T):(T=ss(i)?fd:wo.current,x.context=Jp(n,T)),x.state=n.memoizedState,T=i.getDerivedStateFromProps,typeof T=="function"&&(kx(n,i,T,a),x.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(i=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),i!==x.state&&e0.enqueueReplaceState(x,x.state,null),Py(n,a,x,f),x.state=n.memoizedState),typeof x.componentDidMount=="function"&&(n.flags|=4194308)}function nf(n,i){try{var a="",f=i;do a+=KC(f),f=f.return;while(f);var x=a}catch(T){x=`
Error generating stack: `+T.message+`
`+T.stack}return{value:n,source:i,stack:x,digest:null}}function Uv(n,i,a){return{value:n,source:null,stack:a??null,digest:i??null}}function zx(n,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var TE=typeof WeakMap=="function"?WeakMap:Map;function FS(n,i,a){a=Iu(-1,a),a.tag=3,a.payload={element:null};var f=i.value;return a.callback=function(){Ay||(Ay=!0,Vx=f),zx(n,i)},a}function BS(n,i,a){a=Iu(-1,a),a.tag=3;var f=n.type.getDerivedStateFromError;if(typeof f=="function"){var x=i.value;a.payload=function(){return f(x)},a.callback=function(){zx(n,i)}}var T=n.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(a.callback=function(){zx(n,i),typeof f!="function"&&(ih===null?ih=new Set([this]):ih.add(this));var b=i.stack;this.componentDidCatch(i.value,{componentStack:b!==null?b:""})}),a}function eb(n,i,a){var f=n.pingCache;if(f===null){f=n.pingCache=new TE;var x=new Set;f.set(i,x)}else x=f.get(i),x===void 0&&(x=new Set,f.set(i,x));x.has(a)||(x.add(a),n=OE.bind(null,n,i,a),i.then(n,n))}function tb(n){do{var i;if((i=n.tag===13)&&(i=n.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return n;n=n.return}while(n!==null);return null}function nb(n,i,a,f,x){return n.mode&1?(n.flags|=65536,n.lanes=x,n):(n===i?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=Iu(-1,1),i.tag=2,rh(a,i,1))),a.lanes|=1),n)}var CE=Fu.ReactCurrentOwner,is=!1;function Lo(n,i,a,f){i.child=n===null?dS(i,null,a,f):ef(i,n.child,a,f)}function rb(n,i,a,f,x){a=a.render;var T=i.ref;return Hp(i,x),f=B1(n,i,a,f,T,x),a=O1(),n!==null&&!is?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~x,Ru(n,i,x)):(Dr&&a&&C1(i),i.flags|=1,Lo(n,i,f,x),i.child)}function ib(n,i,a,f,x){if(n===null){var T=a.type;return typeof T=="function"&&!H1(T)&&T.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=T,OS(n,i,T,f,x)):(n=ly(a.type,null,f,i,i.mode,x),n.ref=i.ref,n.return=i,i.child=n)}if(T=n.child,!(n.lanes&x)){var b=T.memoizedProps;if(a=a.compare,a=a!==null?a:Wm,a(b,f)&&n.ref===i.ref)return Ru(n,i,x)}return i.flags|=1,n=sh(T,f),n.ref=i.ref,n.return=i,i.child=n}function OS(n,i,a,f,x){if(n!==null){var T=n.memoizedProps;if(Wm(T,f)&&n.ref===i.ref)if(is=!1,i.pendingProps=f=T,(n.lanes&x)!==0)n.flags&131072&&(is=!0);else return i.lanes=n.lanes,Ru(n,i,x)}return Rx(n,i,a,f,x)}function NS(n,i,a){var f=i.pendingProps,x=f.children,T=n!==null?n.memoizedState:null;if(f.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},br(Gp,Es),Es|=a;else{if(!(a&1073741824))return n=T!==null?T.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:n,cachePool:null,transitions:null},i.updateQueue=null,br(Gp,Es),Es|=n,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=T!==null?T.baseLanes:a,br(Gp,Es),Es|=f}else T!==null?(f=T.baseLanes|a,i.memoizedState=null):f=a,br(Gp,Es),Es|=f;return Lo(n,i,x,a),i.child}function jS(n,i){var a=i.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function Rx(n,i,a,f,x){var T=ss(a)?fd:wo.current;return T=Jp(i,T),Hp(i,x),a=B1(n,i,a,f,T,x),f=O1(),n!==null&&!is?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~x,Ru(n,i,x)):(Dr&&f&&C1(i),i.flags|=1,Lo(n,i,a,x),i.child)}function ob(n,i,a,f,x){if(ss(a)){var T=!0;wy(i)}else T=!1;if(Hp(i,x),i.stateNode===null)oy(n,i),DS(i,a,f),Ax(i,a,f,x),f=!0;else if(n===null){var b=i.stateNode,u=i.memoizedProps;b.props=u;var j=b.context,Z=a.contextType;typeof Z=="object"&&Z!==null?Z=ha(Z):(Z=ss(a)?fd:wo.current,Z=Jp(i,Z));var me=a.getDerivedStateFromProps,ge=typeof me=="function"||typeof b.getSnapshotBeforeUpdate=="function";ge||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(u!==f||j!==Z)&&Qw(i,b,f,Z),Hc=!1;var fe=i.memoizedState;b.state=fe,Py(i,f,b,x),j=i.memoizedState,u!==f||fe!==j||os.current||Hc?(typeof me=="function"&&(kx(i,a,me,f),j=i.memoizedState),(u=Hc||Jw(i,a,u,f,fe,j,Z))?(ge||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=f,i.memoizedState=j),b.props=f,b.state=j,b.context=Z,f=u):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),f=!1)}else{b=i.stateNode,fS(n,i),u=i.memoizedProps,Z=i.type===i.elementType?u:Za(i.type,u),b.props=Z,ge=i.pendingProps,fe=b.context,j=a.contextType,typeof j=="object"&&j!==null?j=ha(j):(j=ss(a)?fd:wo.current,j=Jp(i,j));var oe=a.getDerivedStateFromProps;(me=typeof oe=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(u!==ge||fe!==j)&&Qw(i,b,f,j),Hc=!1,fe=i.memoizedState,b.state=fe,Py(i,f,b,x);var Be=i.memoizedState;u!==ge||fe!==Be||os.current||Hc?(typeof oe=="function"&&(kx(i,a,oe,f),Be=i.memoizedState),(Z=Hc||Jw(i,a,Z,f,fe,Be,j)||!1)?(me||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(f,Be,j),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(f,Be,j)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||u===n.memoizedProps&&fe===n.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&fe===n.memoizedState||(i.flags|=1024),i.memoizedProps=f,i.memoizedState=Be),b.props=f,b.state=Be,b.context=j,f=Z):(typeof b.componentDidUpdate!="function"||u===n.memoizedProps&&fe===n.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&fe===n.memoizedState||(i.flags|=1024),f=!1)}return Lx(n,i,a,f,T,x)}function Lx(n,i,a,f,x,T){jS(n,i);var b=(i.flags&128)!==0;if(!f&&!b)return x&&$w(i,a,!1),Ru(n,i,T);f=i.stateNode,CE.current=i;var u=b&&typeof a.getDerivedStateFromError!="function"?null:f.render();return i.flags|=1,n!==null&&b?(i.child=ef(i,n.child,null,T),i.child=ef(i,null,u,T)):Lo(n,i,u,T),i.memoizedState=f.state,x&&$w(i,a,!0),i.child}function US(n){var i=n.stateNode;i.pendingContext?Gw(n,i.pendingContext,i.pendingContext!==i.context):i.context&&Gw(n,i.context,!1),R1(n,i.containerInfo)}function sb(n,i,a,f,x){return Qp(),E1(x),i.flags|=256,Lo(n,i,a,f),i.child}var Dx={dehydrated:null,treeContext:null,retryLane:0};function Fx(n){return{baseLanes:n,cachePool:null,transitions:null}}function VS(n,i,a){var f=i.pendingProps,x=Hr.current,T=!1,b=(i.flags&128)!==0,u;if((u=b)||(u=n!==null&&n.memoizedState===null?!1:(x&2)!==0),u?(T=!0,i.flags&=-129):(n===null||n.memoizedState!==null)&&(x|=1),br(Hr,x&1),n===null)return Mx(i),n=i.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(i.mode&1?n.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(b=f.children,n=f.fallback,T?(f=i.mode,T=i.child,b={mode:"hidden",children:b},!(f&1)&&T!==null?(T.childLanes=0,T.pendingProps=b):T=r0(b,f,0,null),n=pd(n,f,a,null),T.return=i,n.return=i,T.sibling=n,i.child=T,i.child.memoizedState=Fx(a),i.memoizedState=Dx,n):U1(i,b));if(x=n.memoizedState,x!==null&&(u=x.dehydrated,u!==null))return PE(n,i,b,f,u,x,a);if(T){T=f.fallback,b=i.mode,x=n.child,u=x.sibling;var j={mode:"hidden",children:f.children};return!(b&1)&&i.child!==x?(f=i.child,f.childLanes=0,f.pendingProps=j,i.deletions=null):(f=sh(x,j),f.subtreeFlags=x.subtreeFlags&14680064),u!==null?T=sh(u,T):(T=pd(T,b,a,null),T.flags|=2),T.return=i,f.return=i,f.sibling=T,i.child=f,f=T,T=i.child,b=n.child.memoizedState,b=b===null?Fx(a):{baseLanes:b.baseLanes|a,cachePool:null,transitions:b.transitions},T.memoizedState=b,T.childLanes=n.childLanes&~a,i.memoizedState=Dx,f}return T=n.child,n=T.sibling,f=sh(T,{mode:"visible",children:f.children}),!(i.mode&1)&&(f.lanes=a),f.return=i,f.sibling=null,n!==null&&(a=i.deletions,a===null?(i.deletions=[n],i.flags|=16):a.push(n)),i.child=f,i.memoizedState=null,f}function U1(n,i){return i=r0({mode:"visible",children:i},n.mode,0,null),i.return=n,n.child=i}function G_(n,i,a,f){return f!==null&&E1(f),ef(i,n.child,null,a),n=U1(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function PE(n,i,a,f,x,T,b){if(a)return i.flags&256?(i.flags&=-257,f=Uv(Error(kt(422))),G_(n,i,b,f)):i.memoizedState!==null?(i.child=n.child,i.flags|=128,null):(T=f.fallback,x=i.mode,f=r0({mode:"visible",children:f.children},x,0,null),T=pd(T,x,b,null),T.flags|=2,f.return=i,T.return=i,f.sibling=T,i.child=f,i.mode&1&&ef(i,n.child,null,b),i.child.memoizedState=Fx(b),i.memoizedState=Dx,T);if(!(i.mode&1))return G_(n,i,b,null);if(x.data==="$!"){if(f=x.nextSibling&&x.nextSibling.dataset,f)var u=f.dgst;return f=u,T=Error(kt(419)),f=Uv(T,f,void 0),G_(n,i,b,f)}if(u=(b&n.childLanes)!==0,is||u){if(f=Li,f!==null){switch(b&-b){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=x&(f.suspendedLanes|b)?0:x,x!==0&&x!==T.retryLane&&(T.retryLane=x,zu(n,x),Xa(f,n,x,-1))}return W1(),f=Uv(Error(kt(421))),G_(n,i,b,f)}return x.data==="$?"?(i.flags|=128,i.child=n.child,i=NE.bind(null,n),x._reactRetry=i,null):(n=T.treeContext,Ms=nh(x.nextSibling),ks=i,Dr=!0,Wa=null,n!==null&&(aa[la++]=Eu,aa[la++]=Mu,aa[la++]=md,Eu=n.id,Mu=n.overflow,md=i),i=U1(i,f.children),i.flags|=4096,i)}function ab(n,i,a){n.lanes|=i;var f=n.alternate;f!==null&&(f.lanes|=i),Ix(n.return,i,a)}function Vv(n,i,a,f,x){var T=n.memoizedState;T===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:f,tail:a,tailMode:x}:(T.isBackwards=i,T.rendering=null,T.renderingStartTime=0,T.last=f,T.tail=a,T.tailMode=x)}function GS(n,i,a){var f=i.pendingProps,x=f.revealOrder,T=f.tail;if(Lo(n,i,f.children,a),f=Hr.current,f&2)f=f&1|2,i.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&ab(n,a,i);else if(n.tag===19)ab(n,a,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}f&=1}if(br(Hr,f),!(i.mode&1))i.memoizedState=null;else switch(x){case"forwards":for(a=i.child,x=null;a!==null;)n=a.alternate,n!==null&&Ey(n)===null&&(x=a),a=a.sibling;a=x,a===null?(x=i.child,i.child=null):(x=a.sibling,a.sibling=null),Vv(i,!1,x,a,T);break;case"backwards":for(a=null,x=i.child,i.child=null;x!==null;){if(n=x.alternate,n!==null&&Ey(n)===null){i.child=x;break}n=x.sibling,x.sibling=a,a=x,x=n}Vv(i,!0,a,null,T);break;case"together":Vv(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function oy(n,i){!(i.mode&1)&&n!==null&&(n.alternate=null,i.alternate=null,i.flags|=2)}function Ru(n,i,a){if(n!==null&&(i.dependencies=n.dependencies),_d|=i.lanes,!(a&i.childLanes))return null;if(n!==null&&i.child!==n.child)throw Error(kt(153));if(i.child!==null){for(n=i.child,a=sh(n,n.pendingProps),i.child=a,a.return=i;n.sibling!==null;)n=n.sibling,a=a.sibling=sh(n,n.pendingProps),a.return=i;a.sibling=null}return i.child}function EE(n,i,a){switch(i.tag){case 3:US(i),Qp();break;case 5:mS(i);break;case 1:ss(i.type)&&wy(i);break;case 4:R1(i,i.stateNode.containerInfo);break;case 10:var f=i.type._context,x=i.memoizedProps.value;br(Ty,f._currentValue),f._currentValue=x;break;case 13:if(f=i.memoizedState,f!==null)return f.dehydrated!==null?(br(Hr,Hr.current&1),i.flags|=128,null):a&i.child.childLanes?VS(n,i,a):(br(Hr,Hr.current&1),n=Ru(n,i,a),n!==null?n.sibling:null);br(Hr,Hr.current&1);break;case 19:if(f=(a&i.childLanes)!==0,n.flags&128){if(f)return GS(n,i,a);i.flags|=128}if(x=i.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),br(Hr,Hr.current),f)break;return null;case 22:case 23:return i.lanes=0,NS(n,i,a)}return Ru(n,i,a)}var $S,Bx,ZS,qS;$S=function(n,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Bx=function(){};ZS=function(n,i,a,f){var x=n.memoizedProps;if(x!==f){n=i.stateNode,hd(Dl.current);var T=null;switch(a){case"input":x=ox(n,x),f=ox(n,f),T=[];break;case"select":x=Xr({},x,{value:void 0}),f=Xr({},f,{value:void 0}),T=[];break;case"textarea":x=lx(n,x),f=lx(n,f),T=[];break;default:typeof x.onClick!="function"&&typeof f.onClick=="function"&&(n.onclick=vy)}cx(a,f);var b;a=null;for(Z in x)if(!f.hasOwnProperty(Z)&&x.hasOwnProperty(Z)&&x[Z]!=null)if(Z==="style"){var u=x[Z];for(b in u)u.hasOwnProperty(b)&&(a||(a={}),a[b]="")}else Z!=="dangerouslySetInnerHTML"&&Z!=="children"&&Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(jm.hasOwnProperty(Z)?T||(T=[]):(T=T||[]).push(Z,null));for(Z in f){var j=f[Z];if(u=x!=null?x[Z]:void 0,f.hasOwnProperty(Z)&&j!==u&&(j!=null||u!=null))if(Z==="style")if(u){for(b in u)!u.hasOwnProperty(b)||j&&j.hasOwnProperty(b)||(a||(a={}),a[b]="");for(b in j)j.hasOwnProperty(b)&&u[b]!==j[b]&&(a||(a={}),a[b]=j[b])}else a||(T||(T=[]),T.push(Z,a)),a=j;else Z==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,u=u?u.__html:void 0,j!=null&&u!==j&&(T=T||[]).push(Z,j)):Z==="children"?typeof j!="string"&&typeof j!="number"||(T=T||[]).push(Z,""+j):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&(jm.hasOwnProperty(Z)?(j!=null&&Z==="onScroll"&&kr("scroll",n),T||u===j||(T=[])):(T=T||[]).push(Z,j))}a&&(T=T||[]).push("style",a);var Z=T;(i.updateQueue=Z)&&(i.flags|=4)}};qS=function(n,i,a,f){a!==f&&(i.flags|=4)};function xm(n,i){if(!Dr)switch(n.tailMode){case"hidden":i=n.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var f=null;a!==null;)a.alternate!==null&&(f=a),a=a.sibling;f===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function vo(n){var i=n.alternate!==null&&n.alternate.child===n.child,a=0,f=0;if(i)for(var x=n.child;x!==null;)a|=x.lanes|x.childLanes,f|=x.subtreeFlags&14680064,f|=x.flags&14680064,x.return=n,x=x.sibling;else for(x=n.child;x!==null;)a|=x.lanes|x.childLanes,f|=x.subtreeFlags,f|=x.flags,x.return=n,x=x.sibling;return n.subtreeFlags|=f,n.childLanes=a,i}function ME(n,i,a){var f=i.pendingProps;switch(P1(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vo(i),null;case 1:return ss(i.type)&&xy(),vo(i),null;case 3:return f=i.stateNode,tf(),Ar(os),Ar(wo),D1(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(n===null||n.child===null)&&(U_(i)?i.flags|=4:n===null||n.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Wa!==null&&(Zx(Wa),Wa=null))),Bx(n,i),vo(i),null;case 5:L1(i);var x=hd(Jm.current);if(a=i.type,n!==null&&i.stateNode!=null)ZS(n,i,a,f,x),n.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!f){if(i.stateNode===null)throw Error(kt(166));return vo(i),null}if(n=hd(Dl.current),U_(i)){f=i.stateNode,a=i.type;var T=i.memoizedProps;switch(f[zl]=i,f[Xm]=T,n=(i.mode&1)!==0,a){case"dialog":kr("cancel",f),kr("close",f);break;case"iframe":case"object":case"embed":kr("load",f);break;case"video":case"audio":for(x=0;x<Em.length;x++)kr(Em[x],f);break;case"source":kr("error",f);break;case"img":case"image":case"link":kr("error",f),kr("load",f);break;case"details":kr("toggle",f);break;case"input":gw(f,T),kr("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!T.multiple},kr("invalid",f);break;case"textarea":yw(f,T),kr("invalid",f)}cx(a,T),x=null;for(var b in T)if(T.hasOwnProperty(b)){var u=T[b];b==="children"?typeof u=="string"?f.textContent!==u&&(T.suppressHydrationWarning!==!0&&j_(f.textContent,u,n),x=["children",u]):typeof u=="number"&&f.textContent!==""+u&&(T.suppressHydrationWarning!==!0&&j_(f.textContent,u,n),x=["children",""+u]):jm.hasOwnProperty(b)&&u!=null&&b==="onScroll"&&kr("scroll",f)}switch(a){case"input":z_(f),_w(f,T,!0);break;case"textarea":z_(f),vw(f);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(f.onclick=vy)}f=x,i.updateQueue=f,f!==null&&(i.flags|=4)}else{b=x.nodeType===9?x:x.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=x2(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=b.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof f.is=="string"?n=b.createElement(a,{is:f.is}):(n=b.createElement(a),a==="select"&&(b=n,f.multiple?b.multiple=!0:f.size&&(b.size=f.size))):n=b.createElementNS(n,a),n[zl]=i,n[Xm]=f,$S(n,i,!1,!1),i.stateNode=n;e:{switch(b=hx(a,f),a){case"dialog":kr("cancel",n),kr("close",n),x=f;break;case"iframe":case"object":case"embed":kr("load",n),x=f;break;case"video":case"audio":for(x=0;x<Em.length;x++)kr(Em[x],n);x=f;break;case"source":kr("error",n),x=f;break;case"img":case"image":case"link":kr("error",n),kr("load",n),x=f;break;case"details":kr("toggle",n),x=f;break;case"input":gw(n,f),x=ox(n,f),kr("invalid",n);break;case"option":x=f;break;case"select":n._wrapperState={wasMultiple:!!f.multiple},x=Xr({},f,{value:void 0}),kr("invalid",n);break;case"textarea":yw(n,f),x=lx(n,f),kr("invalid",n);break;default:x=f}cx(a,x),u=x;for(T in u)if(u.hasOwnProperty(T)){var j=u[T];T==="style"?S2(n,j):T==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&w2(n,j)):T==="children"?typeof j=="string"?(a!=="textarea"||j!=="")&&Um(n,j):typeof j=="number"&&Um(n,""+j):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(jm.hasOwnProperty(T)?j!=null&&T==="onScroll"&&kr("scroll",n):j!=null&&h1(n,T,j,b))}switch(a){case"input":z_(n),_w(n,f,!1);break;case"textarea":z_(n),vw(n);break;case"option":f.value!=null&&n.setAttribute("value",""+ah(f.value));break;case"select":n.multiple=!!f.multiple,T=f.value,T!=null?$p(n,!!f.multiple,T,!1):f.defaultValue!=null&&$p(n,!!f.multiple,f.defaultValue,!0);break;default:typeof x.onClick=="function"&&(n.onclick=vy)}switch(a){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return vo(i),null;case 6:if(n&&i.stateNode!=null)qS(n,i,n.memoizedProps,f);else{if(typeof f!="string"&&i.stateNode===null)throw Error(kt(166));if(a=hd(Jm.current),hd(Dl.current),U_(i)){if(f=i.stateNode,a=i.memoizedProps,f[zl]=i,(T=f.nodeValue!==a)&&(n=ks,n!==null))switch(n.tag){case 3:j_(f.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&j_(f.nodeValue,a,(n.mode&1)!==0)}T&&(i.flags|=4)}else f=(a.nodeType===9?a:a.ownerDocument).createTextNode(f),f[zl]=i,i.stateNode=f}return vo(i),null;case 13:if(Ar(Hr),f=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Dr&&Ms!==null&&i.mode&1&&!(i.flags&128))cS(),Qp(),i.flags|=98560,T=!1;else if(T=U_(i),f!==null&&f.dehydrated!==null){if(n===null){if(!T)throw Error(kt(318));if(T=i.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(kt(317));T[zl]=i}else Qp(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;vo(i),T=!1}else Wa!==null&&(Zx(Wa),Wa=null),T=!0;if(!T)return i.flags&65536?i:null}return i.flags&128?(i.lanes=a,i):(f=f!==null,f!==(n!==null&&n.memoizedState!==null)&&f&&(i.child.flags|=8192,i.mode&1&&(n===null||Hr.current&1?wi===0&&(wi=3):W1())),i.updateQueue!==null&&(i.flags|=4),vo(i),null);case 4:return tf(),Bx(n,i),n===null&&Hm(i.stateNode.containerInfo),vo(i),null;case 10:return k1(i.type._context),vo(i),null;case 17:return ss(i.type)&&xy(),vo(i),null;case 19:if(Ar(Hr),T=i.memoizedState,T===null)return vo(i),null;if(f=(i.flags&128)!==0,b=T.rendering,b===null)if(f)xm(T,!1);else{if(wi!==0||n!==null&&n.flags&128)for(n=i.child;n!==null;){if(b=Ey(n),b!==null){for(i.flags|=128,xm(T,!1),f=b.updateQueue,f!==null&&(i.updateQueue=f,i.flags|=4),i.subtreeFlags=0,f=a,a=i.child;a!==null;)T=a,n=f,T.flags&=14680066,b=T.alternate,b===null?(T.childLanes=0,T.lanes=n,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=b.childLanes,T.lanes=b.lanes,T.child=b.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=b.memoizedProps,T.memoizedState=b.memoizedState,T.updateQueue=b.updateQueue,T.type=b.type,n=b.dependencies,T.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return br(Hr,Hr.current&1|2),i.child}n=n.sibling}T.tail!==null&&ci()>rf&&(i.flags|=128,f=!0,xm(T,!1),i.lanes=4194304)}else{if(!f)if(n=Ey(b),n!==null){if(i.flags|=128,f=!0,a=n.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),xm(T,!0),T.tail===null&&T.tailMode==="hidden"&&!b.alternate&&!Dr)return vo(i),null}else 2*ci()-T.renderingStartTime>rf&&a!==1073741824&&(i.flags|=128,f=!0,xm(T,!1),i.lanes=4194304);T.isBackwards?(b.sibling=i.child,i.child=b):(a=T.last,a!==null?a.sibling=b:i.child=b,T.last=b)}return T.tail!==null?(i=T.tail,T.rendering=i,T.tail=i.sibling,T.renderingStartTime=ci(),i.sibling=null,a=Hr.current,br(Hr,f?a&1|2:a&1),i):(vo(i),null);case 22:case 23:return q1(),f=i.memoizedState!==null,n!==null&&n.memoizedState!==null!==f&&(i.flags|=8192),f&&i.mode&1?Es&1073741824&&(vo(i),i.subtreeFlags&6&&(i.flags|=8192)):vo(i),null;case 24:return null;case 25:return null}throw Error(kt(156,i.tag))}function IE(n,i){switch(P1(i),i.tag){case 1:return ss(i.type)&&xy(),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return tf(),Ar(os),Ar(wo),D1(),n=i.flags,n&65536&&!(n&128)?(i.flags=n&-65537|128,i):null;case 5:return L1(i),null;case 13:if(Ar(Hr),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(kt(340));Qp()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return Ar(Hr),null;case 4:return tf(),null;case 10:return k1(i.type._context),null;case 22:case 23:return q1(),null;case 24:return null;default:return null}}var $_=!1,xo=!1,kE=typeof WeakSet=="function"?WeakSet:Set,$t=null;function Vp(n,i){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(f){ni(n,i,f)}else a.current=null}function Ox(n,i,a){try{a()}catch(f){ni(n,i,f)}}var lb=!1;function AE(n,i){if(wx=gy,n=K2(),T1(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var f=a.getSelection&&a.getSelection();if(f&&f.rangeCount!==0){a=f.anchorNode;var x=f.anchorOffset,T=f.focusNode;f=f.focusOffset;try{a.nodeType,T.nodeType}catch{a=null;break e}var b=0,u=-1,j=-1,Z=0,me=0,ge=n,fe=null;t:for(;;){for(var oe;ge!==a||x!==0&&ge.nodeType!==3||(u=b+x),ge!==T||f!==0&&ge.nodeType!==3||(j=b+f),ge.nodeType===3&&(b+=ge.nodeValue.length),(oe=ge.firstChild)!==null;)fe=ge,ge=oe;for(;;){if(ge===n)break t;if(fe===a&&++Z===x&&(u=b),fe===T&&++me===f&&(j=b),(oe=ge.nextSibling)!==null)break;ge=fe,fe=ge.parentNode}ge=oe}a=u===-1||j===-1?null:{start:u,end:j}}else a=null}a=a||{start:0,end:0}}else a=null;for(bx={focusedElem:n,selectionRange:a},gy=!1,$t=i;$t!==null;)if(i=$t,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,$t=n;else for(;$t!==null;){i=$t;try{var Be=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Be!==null){var _t=Be.memoizedProps,xt=Be.memoizedState,Ie=i.stateNode,ne=Ie.getSnapshotBeforeUpdate(i.elementType===i.type?_t:Za(i.type,_t),xt);Ie.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var Te=i.stateNode.containerInfo;Te.nodeType===1?Te.textContent="":Te.nodeType===9&&Te.documentElement&&Te.removeChild(Te.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(kt(163))}}catch(Ne){ni(i,i.return,Ne)}if(n=i.sibling,n!==null){n.return=i.return,$t=n;break}$t=i.return}return Be=lb,lb=!1,Be}function Bm(n,i,a){var f=i.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var x=f=f.next;do{if((x.tag&n)===n){var T=x.destroy;x.destroy=void 0,T!==void 0&&Ox(i,a,T)}x=x.next}while(x!==f)}}function t0(n,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&n)===n){var f=a.create;a.destroy=f()}a=a.next}while(a!==i)}}function Nx(n){var i=n.ref;if(i!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof i=="function"?i(n):i.current=n}}function WS(n){var i=n.alternate;i!==null&&(n.alternate=null,WS(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&(delete i[zl],delete i[Xm],delete i[Cx],delete i[pE],delete i[fE])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function HS(n){return n.tag===5||n.tag===3||n.tag===4}function ub(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||HS(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function jx(n,i,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(n,i):a.insertBefore(n,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(n,a)):(i=a,i.appendChild(n)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=vy));else if(f!==4&&(n=n.child,n!==null))for(jx(n,i,a),n=n.sibling;n!==null;)jx(n,i,a),n=n.sibling}function Ux(n,i,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,i?a.insertBefore(n,i):a.appendChild(n);else if(f!==4&&(n=n.child,n!==null))for(Ux(n,i,a),n=n.sibling;n!==null;)Ux(n,i,a),n=n.sibling}var Ki=null,qa=!1;function $c(n,i,a){for(a=a.child;a!==null;)YS(n,i,a),a=a.sibling}function YS(n,i,a){if(Ll&&typeof Ll.onCommitFiberUnmount=="function")try{Ll.onCommitFiberUnmount(Wy,a)}catch{}switch(a.tag){case 5:xo||Vp(a,i);case 6:var f=Ki,x=qa;Ki=null,$c(n,i,a),Ki=f,qa=x,Ki!==null&&(qa?(n=Ki,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):Ki.removeChild(a.stateNode));break;case 18:Ki!==null&&(qa?(n=Ki,a=a.stateNode,n.nodeType===8?Dv(n.parentNode,a):n.nodeType===1&&Dv(n,a),Zm(n)):Dv(Ki,a.stateNode));break;case 4:f=Ki,x=qa,Ki=a.stateNode.containerInfo,qa=!0,$c(n,i,a),Ki=f,qa=x;break;case 0:case 11:case 14:case 15:if(!xo&&(f=a.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){x=f=f.next;do{var T=x,b=T.destroy;T=T.tag,b!==void 0&&(T&2||T&4)&&Ox(a,i,b),x=x.next}while(x!==f)}$c(n,i,a);break;case 1:if(!xo&&(Vp(a,i),f=a.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=a.memoizedProps,f.state=a.memoizedState,f.componentWillUnmount()}catch(u){ni(a,i,u)}$c(n,i,a);break;case 21:$c(n,i,a);break;case 22:a.mode&1?(xo=(f=xo)||a.memoizedState!==null,$c(n,i,a),xo=f):$c(n,i,a);break;default:$c(n,i,a)}}function cb(n){var i=n.updateQueue;if(i!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new kE),i.forEach(function(f){var x=jE.bind(null,n,f);a.has(f)||(a.add(f),f.then(x,x))})}}function Ga(n,i){var a=i.deletions;if(a!==null)for(var f=0;f<a.length;f++){var x=a[f];try{var T=n,b=i,u=b;e:for(;u!==null;){switch(u.tag){case 5:Ki=u.stateNode,qa=!1;break e;case 3:Ki=u.stateNode.containerInfo,qa=!0;break e;case 4:Ki=u.stateNode.containerInfo,qa=!0;break e}u=u.return}if(Ki===null)throw Error(kt(160));YS(T,b,x),Ki=null,qa=!1;var j=x.alternate;j!==null&&(j.return=null),x.return=null}catch(Z){ni(x,i,Z)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)XS(i,n),i=i.sibling}function XS(n,i){var a=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ga(i,n),Il(n),f&4){try{Bm(3,n,n.return),t0(3,n)}catch(_t){ni(n,n.return,_t)}try{Bm(5,n,n.return)}catch(_t){ni(n,n.return,_t)}}break;case 1:Ga(i,n),Il(n),f&512&&a!==null&&Vp(a,a.return);break;case 5:if(Ga(i,n),Il(n),f&512&&a!==null&&Vp(a,a.return),n.flags&32){var x=n.stateNode;try{Um(x,"")}catch(_t){ni(n,n.return,_t)}}if(f&4&&(x=n.stateNode,x!=null)){var T=n.memoizedProps,b=a!==null?a.memoizedProps:T,u=n.type,j=n.updateQueue;if(n.updateQueue=null,j!==null)try{u==="input"&&T.type==="radio"&&T.name!=null&&y2(x,T),hx(u,b);var Z=hx(u,T);for(b=0;b<j.length;b+=2){var me=j[b],ge=j[b+1];me==="style"?S2(x,ge):me==="dangerouslySetInnerHTML"?w2(x,ge):me==="children"?Um(x,ge):h1(x,me,ge,Z)}switch(u){case"input":sx(x,T);break;case"textarea":v2(x,T);break;case"select":var fe=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!T.multiple;var oe=T.value;oe!=null?$p(x,!!T.multiple,oe,!1):fe!==!!T.multiple&&(T.defaultValue!=null?$p(x,!!T.multiple,T.defaultValue,!0):$p(x,!!T.multiple,T.multiple?[]:"",!1))}x[Xm]=T}catch(_t){ni(n,n.return,_t)}}break;case 6:if(Ga(i,n),Il(n),f&4){if(n.stateNode===null)throw Error(kt(162));x=n.stateNode,T=n.memoizedProps;try{x.nodeValue=T}catch(_t){ni(n,n.return,_t)}}break;case 3:if(Ga(i,n),Il(n),f&4&&a!==null&&a.memoizedState.isDehydrated)try{Zm(i.containerInfo)}catch(_t){ni(n,n.return,_t)}break;case 4:Ga(i,n),Il(n);break;case 13:Ga(i,n),Il(n),x=n.child,x.flags&8192&&(T=x.memoizedState!==null,x.stateNode.isHidden=T,!T||x.alternate!==null&&x.alternate.memoizedState!==null||($1=ci())),f&4&&cb(n);break;case 22:if(me=a!==null&&a.memoizedState!==null,n.mode&1?(xo=(Z=xo)||me,Ga(i,n),xo=Z):Ga(i,n),Il(n),f&8192){if(Z=n.memoizedState!==null,(n.stateNode.isHidden=Z)&&!me&&n.mode&1)for($t=n,me=n.child;me!==null;){for(ge=$t=me;$t!==null;){switch(fe=$t,oe=fe.child,fe.tag){case 0:case 11:case 14:case 15:Bm(4,fe,fe.return);break;case 1:Vp(fe,fe.return);var Be=fe.stateNode;if(typeof Be.componentWillUnmount=="function"){f=fe,a=fe.return;try{i=f,Be.props=i.memoizedProps,Be.state=i.memoizedState,Be.componentWillUnmount()}catch(_t){ni(f,a,_t)}}break;case 5:Vp(fe,fe.return);break;case 22:if(fe.memoizedState!==null){db(ge);continue}}oe!==null?(oe.return=fe,$t=oe):db(ge)}me=me.sibling}e:for(me=null,ge=n;;){if(ge.tag===5){if(me===null){me=ge;try{x=ge.stateNode,Z?(T=x.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(u=ge.stateNode,j=ge.memoizedProps.style,b=j!=null&&j.hasOwnProperty("display")?j.display:null,u.style.display=b2("display",b))}catch(_t){ni(n,n.return,_t)}}}else if(ge.tag===6){if(me===null)try{ge.stateNode.nodeValue=Z?"":ge.memoizedProps}catch(_t){ni(n,n.return,_t)}}else if((ge.tag!==22&&ge.tag!==23||ge.memoizedState===null||ge===n)&&ge.child!==null){ge.child.return=ge,ge=ge.child;continue}if(ge===n)break e;for(;ge.sibling===null;){if(ge.return===null||ge.return===n)break e;me===ge&&(me=null),ge=ge.return}me===ge&&(me=null),ge.sibling.return=ge.return,ge=ge.sibling}}break;case 19:Ga(i,n),Il(n),f&4&&cb(n);break;case 21:break;default:Ga(i,n),Il(n)}}function Il(n){var i=n.flags;if(i&2){try{e:{for(var a=n.return;a!==null;){if(HS(a)){var f=a;break e}a=a.return}throw Error(kt(160))}switch(f.tag){case 5:var x=f.stateNode;f.flags&32&&(Um(x,""),f.flags&=-33);var T=ub(n);Ux(n,T,x);break;case 3:case 4:var b=f.stateNode.containerInfo,u=ub(n);jx(n,u,b);break;default:throw Error(kt(161))}}catch(j){ni(n,n.return,j)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function zE(n,i,a){$t=n,KS(n)}function KS(n,i,a){for(var f=(n.mode&1)!==0;$t!==null;){var x=$t,T=x.child;if(x.tag===22&&f){var b=x.memoizedState!==null||$_;if(!b){var u=x.alternate,j=u!==null&&u.memoizedState!==null||xo;u=$_;var Z=xo;if($_=b,(xo=j)&&!Z)for($t=x;$t!==null;)b=$t,j=b.child,b.tag===22&&b.memoizedState!==null?pb(x):j!==null?(j.return=b,$t=j):pb(x);for(;T!==null;)$t=T,KS(T),T=T.sibling;$t=x,$_=u,xo=Z}hb(n)}else x.subtreeFlags&8772&&T!==null?(T.return=x,$t=T):hb(n)}}function hb(n){for(;$t!==null;){var i=$t;if(i.flags&8772){var a=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:xo||t0(5,i);break;case 1:var f=i.stateNode;if(i.flags&4&&!xo)if(a===null)f.componentDidMount();else{var x=i.elementType===i.type?a.memoizedProps:Za(i.type,a.memoizedProps);f.componentDidUpdate(x,a.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var T=i.updateQueue;T!==null&&Yw(i,T,f);break;case 3:var b=i.updateQueue;if(b!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}Yw(i,b,a)}break;case 5:var u=i.stateNode;if(a===null&&i.flags&4){a=u;var j=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&a.focus();break;case"img":j.src&&(a.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var Z=i.alternate;if(Z!==null){var me=Z.memoizedState;if(me!==null){var ge=me.dehydrated;ge!==null&&Zm(ge)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(kt(163))}xo||i.flags&512&&Nx(i)}catch(fe){ni(i,i.return,fe)}}if(i===n){$t=null;break}if(a=i.sibling,a!==null){a.return=i.return,$t=a;break}$t=i.return}}function db(n){for(;$t!==null;){var i=$t;if(i===n){$t=null;break}var a=i.sibling;if(a!==null){a.return=i.return,$t=a;break}$t=i.return}}function pb(n){for(;$t!==null;){var i=$t;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{t0(4,i)}catch(j){ni(i,a,j)}break;case 1:var f=i.stateNode;if(typeof f.componentDidMount=="function"){var x=i.return;try{f.componentDidMount()}catch(j){ni(i,x,j)}}var T=i.return;try{Nx(i)}catch(j){ni(i,T,j)}break;case 5:var b=i.return;try{Nx(i)}catch(j){ni(i,b,j)}}}catch(j){ni(i,i.return,j)}if(i===n){$t=null;break}var u=i.sibling;if(u!==null){u.return=i.return,$t=u;break}$t=i.return}}var RE=Math.ceil,ky=Fu.ReactCurrentDispatcher,V1=Fu.ReactCurrentOwner,ca=Fu.ReactCurrentBatchConfig,Xn=0,Li=null,gi=null,Ji=0,Es=0,Gp=hh(0),wi=0,ng=null,_d=0,n0=0,G1=0,Om=null,rs=null,$1=0,rf=1/0,Cu=null,Ay=!1,Vx=null,ih=null,Z_=!1,Jc=null,zy=0,Nm=0,Gx=null,sy=-1,ay=0;function Do(){return Xn&6?ci():sy!==-1?sy:sy=ci()}function oh(n){return n.mode&1?Xn&2&&Ji!==0?Ji&-Ji:gE.transition!==null?(ay===0&&(ay=D2()),ay):(n=cr,n!==0||(n=window.event,n=n===void 0?16:V2(n.type)),n):1}function Xa(n,i,a,f){if(50<Nm)throw Nm=0,Gx=null,Error(kt(185));ag(n,a,f),(!(Xn&2)||n!==Li)&&(n===Li&&(!(Xn&2)&&(n0|=a),wi===4&&Xc(n,Ji)),as(n,f),a===1&&Xn===0&&!(i.mode&1)&&(rf=ci()+500,Jy&&dh()))}function as(n,i){var a=n.callbackNode;gP(n,i);var f=my(n,n===Li?Ji:0);if(f===0)a!==null&&bw(a),n.callbackNode=null,n.callbackPriority=0;else if(i=f&-f,n.callbackPriority!==i){if(a!=null&&bw(a),i===1)n.tag===0?mE(fb.bind(null,n)):aS(fb.bind(null,n)),hE(function(){!(Xn&6)&&dh()}),a=null;else{switch(F2(f)){case 1:a=g1;break;case 4:a=R2;break;case 16:a=fy;break;case 536870912:a=L2;break;default:a=fy}a=oT(a,JS.bind(null,n))}n.callbackPriority=i,n.callbackNode=a}}function JS(n,i){if(sy=-1,ay=0,Xn&6)throw Error(kt(327));var a=n.callbackNode;if(Yp()&&n.callbackNode!==a)return null;var f=my(n,n===Li?Ji:0);if(f===0)return null;if(f&30||f&n.expiredLanes||i)i=Ry(n,f);else{i=f;var x=Xn;Xn|=2;var T=eT();(Li!==n||Ji!==i)&&(Cu=null,rf=ci()+500,dd(n,i));do try{FE();break}catch(u){QS(n,u)}while(!0);I1(),ky.current=T,Xn=x,gi!==null?i=0:(Li=null,Ji=0,i=wi)}if(i!==0){if(i===2&&(x=gx(n),x!==0&&(f=x,i=$x(n,x))),i===1)throw a=ng,dd(n,0),Xc(n,f),as(n,ci()),a;if(i===6)Xc(n,f);else{if(x=n.current.alternate,!(f&30)&&!LE(x)&&(i=Ry(n,f),i===2&&(T=gx(n),T!==0&&(f=T,i=$x(n,T))),i===1))throw a=ng,dd(n,0),Xc(n,f),as(n,ci()),a;switch(n.finishedWork=x,n.finishedLanes=f,i){case 0:case 1:throw Error(kt(345));case 2:ad(n,rs,Cu);break;case 3:if(Xc(n,f),(f&130023424)===f&&(i=$1+500-ci(),10<i)){if(my(n,0)!==0)break;if(x=n.suspendedLanes,(x&f)!==f){Do(),n.pingedLanes|=n.suspendedLanes&x;break}n.timeoutHandle=Tx(ad.bind(null,n,rs,Cu),i);break}ad(n,rs,Cu);break;case 4:if(Xc(n,f),(f&4194240)===f)break;for(i=n.eventTimes,x=-1;0<f;){var b=31-Ya(f);T=1<<b,b=i[b],b>x&&(x=b),f&=~T}if(f=x,f=ci()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*RE(f/1960))-f,10<f){n.timeoutHandle=Tx(ad.bind(null,n,rs,Cu),f);break}ad(n,rs,Cu);break;case 5:ad(n,rs,Cu);break;default:throw Error(kt(329))}}}return as(n,ci()),n.callbackNode===a?JS.bind(null,n):null}function $x(n,i){var a=Om;return n.current.memoizedState.isDehydrated&&(dd(n,i).flags|=256),n=Ry(n,i),n!==2&&(i=rs,rs=a,i!==null&&Zx(i)),n}function Zx(n){rs===null?rs=n:rs.push.apply(rs,n)}function LE(n){for(var i=n;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var f=0;f<a.length;f++){var x=a[f],T=x.getSnapshot;x=x.value;try{if(!Ka(T(),x))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Xc(n,i){for(i&=~G1,i&=~n0,n.suspendedLanes|=i,n.pingedLanes&=~i,n=n.expirationTimes;0<i;){var a=31-Ya(i),f=1<<a;n[a]=-1,i&=~f}}function fb(n){if(Xn&6)throw Error(kt(327));Yp();var i=my(n,0);if(!(i&1))return as(n,ci()),null;var a=Ry(n,i);if(n.tag!==0&&a===2){var f=gx(n);f!==0&&(i=f,a=$x(n,f))}if(a===1)throw a=ng,dd(n,0),Xc(n,i),as(n,ci()),a;if(a===6)throw Error(kt(345));return n.finishedWork=n.current.alternate,n.finishedLanes=i,ad(n,rs,Cu),as(n,ci()),null}function Z1(n,i){var a=Xn;Xn|=1;try{return n(i)}finally{Xn=a,Xn===0&&(rf=ci()+500,Jy&&dh())}}function yd(n){Jc!==null&&Jc.tag===0&&!(Xn&6)&&Yp();var i=Xn;Xn|=1;var a=ca.transition,f=cr;try{if(ca.transition=null,cr=1,n)return n()}finally{cr=f,ca.transition=a,Xn=i,!(Xn&6)&&dh()}}function q1(){Es=Gp.current,Ar(Gp)}function dd(n,i){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,cE(a)),gi!==null)for(a=gi.return;a!==null;){var f=a;switch(P1(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&xy();break;case 3:tf(),Ar(os),Ar(wo),D1();break;case 5:L1(f);break;case 4:tf();break;case 13:Ar(Hr);break;case 19:Ar(Hr);break;case 10:k1(f.type._context);break;case 22:case 23:q1()}a=a.return}if(Li=n,gi=n=sh(n.current,null),Ji=Es=i,wi=0,ng=null,G1=n0=_d=0,rs=Om=null,cd!==null){for(i=0;i<cd.length;i++)if(a=cd[i],f=a.interleaved,f!==null){a.interleaved=null;var x=f.next,T=a.pending;if(T!==null){var b=T.next;T.next=x,f.next=b}a.pending=f}cd=null}return n}function QS(n,i){do{var a=gi;try{if(I1(),ry.current=Iy,My){for(var f=Yr.memoizedState;f!==null;){var x=f.queue;x!==null&&(x.pending=null),f=f.next}My=!1}if(gd=0,zi=xi=Yr=null,Fm=!1,Qm=0,V1.current=null,a===null||a.return===null){wi=1,ng=i,gi=null;break}e:{var T=n,b=a.return,u=a,j=i;if(i=Ji,u.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var Z=j,me=u,ge=me.tag;if(!(me.mode&1)&&(ge===0||ge===11||ge===15)){var fe=me.alternate;fe?(me.updateQueue=fe.updateQueue,me.memoizedState=fe.memoizedState,me.lanes=fe.lanes):(me.updateQueue=null,me.memoizedState=null)}var oe=tb(b);if(oe!==null){oe.flags&=-257,nb(oe,b,u,T,i),oe.mode&1&&eb(T,Z,i),i=oe,j=Z;var Be=i.updateQueue;if(Be===null){var _t=new Set;_t.add(j),i.updateQueue=_t}else Be.add(j);break e}else{if(!(i&1)){eb(T,Z,i),W1();break e}j=Error(kt(426))}}else if(Dr&&u.mode&1){var xt=tb(b);if(xt!==null){!(xt.flags&65536)&&(xt.flags|=256),nb(xt,b,u,T,i),E1(nf(j,u));break e}}T=j=nf(j,u),wi!==4&&(wi=2),Om===null?Om=[T]:Om.push(T),T=b;do{switch(T.tag){case 3:T.flags|=65536,i&=-i,T.lanes|=i;var Ie=FS(T,j,i);Hw(T,Ie);break e;case 1:u=j;var ne=T.type,Te=T.stateNode;if(!(T.flags&128)&&(typeof ne.getDerivedStateFromError=="function"||Te!==null&&typeof Te.componentDidCatch=="function"&&(ih===null||!ih.has(Te)))){T.flags|=65536,i&=-i,T.lanes|=i;var Ne=BS(T,u,i);Hw(T,Ne);break e}}T=T.return}while(T!==null)}nT(a)}catch(ut){i=ut,gi===a&&a!==null&&(gi=a=a.return);continue}break}while(!0)}function eT(){var n=ky.current;return ky.current=Iy,n===null?Iy:n}function W1(){(wi===0||wi===3||wi===2)&&(wi=4),Li===null||!(_d&268435455)&&!(n0&268435455)||Xc(Li,Ji)}function Ry(n,i){var a=Xn;Xn|=2;var f=eT();(Li!==n||Ji!==i)&&(Cu=null,dd(n,i));do try{DE();break}catch(x){QS(n,x)}while(!0);if(I1(),Xn=a,ky.current=f,gi!==null)throw Error(kt(261));return Li=null,Ji=0,wi}function DE(){for(;gi!==null;)tT(gi)}function FE(){for(;gi!==null&&!aP();)tT(gi)}function tT(n){var i=iT(n.alternate,n,Es);n.memoizedProps=n.pendingProps,i===null?nT(n):gi=i,V1.current=null}function nT(n){var i=n;do{var a=i.alternate;if(n=i.return,i.flags&32768){if(a=IE(a,i),a!==null){a.flags&=32767,gi=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{wi=6,gi=null;return}}else if(a=ME(a,i,Es),a!==null){gi=a;return}if(i=i.sibling,i!==null){gi=i;return}gi=i=n}while(i!==null);wi===0&&(wi=5)}function ad(n,i,a){var f=cr,x=ca.transition;try{ca.transition=null,cr=1,BE(n,i,a,f)}finally{ca.transition=x,cr=f}return null}function BE(n,i,a,f){do Yp();while(Jc!==null);if(Xn&6)throw Error(kt(327));a=n.finishedWork;var x=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(kt(177));n.callbackNode=null,n.callbackPriority=0;var T=a.lanes|a.childLanes;if(_P(n,T),n===Li&&(gi=Li=null,Ji=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Z_||(Z_=!0,oT(fy,function(){return Yp(),null})),T=(a.flags&15990)!==0,a.subtreeFlags&15990||T){T=ca.transition,ca.transition=null;var b=cr;cr=1;var u=Xn;Xn|=4,V1.current=null,AE(n,a),XS(a,n),rE(bx),gy=!!wx,bx=wx=null,n.current=a,zE(a),lP(),Xn=u,cr=b,ca.transition=T}else n.current=a;if(Z_&&(Z_=!1,Jc=n,zy=x),T=n.pendingLanes,T===0&&(ih=null),hP(a.stateNode),as(n,ci()),i!==null)for(f=n.onRecoverableError,a=0;a<i.length;a++)x=i[a],f(x.value,{componentStack:x.stack,digest:x.digest});if(Ay)throw Ay=!1,n=Vx,Vx=null,n;return zy&1&&n.tag!==0&&Yp(),T=n.pendingLanes,T&1?n===Gx?Nm++:(Nm=0,Gx=n):Nm=0,dh(),null}function Yp(){if(Jc!==null){var n=F2(zy),i=ca.transition,a=cr;try{if(ca.transition=null,cr=16>n?16:n,Jc===null)var f=!1;else{if(n=Jc,Jc=null,zy=0,Xn&6)throw Error(kt(331));var x=Xn;for(Xn|=4,$t=n.current;$t!==null;){var T=$t,b=T.child;if($t.flags&16){var u=T.deletions;if(u!==null){for(var j=0;j<u.length;j++){var Z=u[j];for($t=Z;$t!==null;){var me=$t;switch(me.tag){case 0:case 11:case 15:Bm(8,me,T)}var ge=me.child;if(ge!==null)ge.return=me,$t=ge;else for(;$t!==null;){me=$t;var fe=me.sibling,oe=me.return;if(WS(me),me===Z){$t=null;break}if(fe!==null){fe.return=oe,$t=fe;break}$t=oe}}}var Be=T.alternate;if(Be!==null){var _t=Be.child;if(_t!==null){Be.child=null;do{var xt=_t.sibling;_t.sibling=null,_t=xt}while(_t!==null)}}$t=T}}if(T.subtreeFlags&2064&&b!==null)b.return=T,$t=b;else e:for(;$t!==null;){if(T=$t,T.flags&2048)switch(T.tag){case 0:case 11:case 15:Bm(9,T,T.return)}var Ie=T.sibling;if(Ie!==null){Ie.return=T.return,$t=Ie;break e}$t=T.return}}var ne=n.current;for($t=ne;$t!==null;){b=$t;var Te=b.child;if(b.subtreeFlags&2064&&Te!==null)Te.return=b,$t=Te;else e:for(b=ne;$t!==null;){if(u=$t,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:t0(9,u)}}catch(ut){ni(u,u.return,ut)}if(u===b){$t=null;break e}var Ne=u.sibling;if(Ne!==null){Ne.return=u.return,$t=Ne;break e}$t=u.return}}if(Xn=x,dh(),Ll&&typeof Ll.onPostCommitFiberRoot=="function")try{Ll.onPostCommitFiberRoot(Wy,n)}catch{}f=!0}return f}finally{cr=a,ca.transition=i}}return!1}function mb(n,i,a){i=nf(a,i),i=FS(n,i,1),n=rh(n,i,1),i=Do(),n!==null&&(ag(n,1,i),as(n,i))}function ni(n,i,a){if(n.tag===3)mb(n,n,a);else for(;i!==null;){if(i.tag===3){mb(i,n,a);break}else if(i.tag===1){var f=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(ih===null||!ih.has(f))){n=nf(a,n),n=BS(i,n,1),i=rh(i,n,1),n=Do(),i!==null&&(ag(i,1,n),as(i,n));break}}i=i.return}}function OE(n,i,a){var f=n.pingCache;f!==null&&f.delete(i),i=Do(),n.pingedLanes|=n.suspendedLanes&a,Li===n&&(Ji&a)===a&&(wi===4||wi===3&&(Ji&130023424)===Ji&&500>ci()-$1?dd(n,0):G1|=a),as(n,i)}function rT(n,i){i===0&&(n.mode&1?(i=D_,D_<<=1,!(D_&130023424)&&(D_=4194304)):i=1);var a=Do();n=zu(n,i),n!==null&&(ag(n,i,a),as(n,a))}function NE(n){var i=n.memoizedState,a=0;i!==null&&(a=i.retryLane),rT(n,a)}function jE(n,i){var a=0;switch(n.tag){case 13:var f=n.stateNode,x=n.memoizedState;x!==null&&(a=x.retryLane);break;case 19:f=n.stateNode;break;default:throw Error(kt(314))}f!==null&&f.delete(i),rT(n,a)}var iT;iT=function(n,i,a){if(n!==null)if(n.memoizedProps!==i.pendingProps||os.current)is=!0;else{if(!(n.lanes&a)&&!(i.flags&128))return is=!1,EE(n,i,a);is=!!(n.flags&131072)}else is=!1,Dr&&i.flags&1048576&&lS(i,Sy,i.index);switch(i.lanes=0,i.tag){case 2:var f=i.type;oy(n,i),n=i.pendingProps;var x=Jp(i,wo.current);Hp(i,a),x=B1(null,i,f,n,x,a);var T=O1();return i.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,ss(f)?(T=!0,wy(i)):T=!1,i.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,z1(i),x.updater=e0,i.stateNode=x,x._reactInternals=i,Ax(i,f,n,a),i=Lx(null,i,f,!0,T,a)):(i.tag=0,Dr&&T&&C1(i),Lo(null,i,x,a),i=i.child),i;case 16:f=i.elementType;e:{switch(oy(n,i),n=i.pendingProps,x=f._init,f=x(f._payload),i.type=f,x=i.tag=VE(f),n=Za(f,n),x){case 0:i=Rx(null,i,f,n,a);break e;case 1:i=ob(null,i,f,n,a);break e;case 11:i=rb(null,i,f,n,a);break e;case 14:i=ib(null,i,f,Za(f.type,n),a);break e}throw Error(kt(306,f,""))}return i;case 0:return f=i.type,x=i.pendingProps,x=i.elementType===f?x:Za(f,x),Rx(n,i,f,x,a);case 1:return f=i.type,x=i.pendingProps,x=i.elementType===f?x:Za(f,x),ob(n,i,f,x,a);case 3:e:{if(US(i),n===null)throw Error(kt(387));f=i.pendingProps,T=i.memoizedState,x=T.element,fS(n,i),Py(i,f,null,a);var b=i.memoizedState;if(f=b.element,T.isDehydrated)if(T={element:f,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},i.updateQueue.baseState=T,i.memoizedState=T,i.flags&256){x=nf(Error(kt(423)),i),i=sb(n,i,f,a,x);break e}else if(f!==x){x=nf(Error(kt(424)),i),i=sb(n,i,f,a,x);break e}else for(Ms=nh(i.stateNode.containerInfo.firstChild),ks=i,Dr=!0,Wa=null,a=dS(i,null,f,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Qp(),f===x){i=Ru(n,i,a);break e}Lo(n,i,f,a)}i=i.child}return i;case 5:return mS(i),n===null&&Mx(i),f=i.type,x=i.pendingProps,T=n!==null?n.memoizedProps:null,b=x.children,Sx(f,x)?b=null:T!==null&&Sx(f,T)&&(i.flags|=32),jS(n,i),Lo(n,i,b,a),i.child;case 6:return n===null&&Mx(i),null;case 13:return VS(n,i,a);case 4:return R1(i,i.stateNode.containerInfo),f=i.pendingProps,n===null?i.child=ef(i,null,f,a):Lo(n,i,f,a),i.child;case 11:return f=i.type,x=i.pendingProps,x=i.elementType===f?x:Za(f,x),rb(n,i,f,x,a);case 7:return Lo(n,i,i.pendingProps,a),i.child;case 8:return Lo(n,i,i.pendingProps.children,a),i.child;case 12:return Lo(n,i,i.pendingProps.children,a),i.child;case 10:e:{if(f=i.type._context,x=i.pendingProps,T=i.memoizedProps,b=x.value,br(Ty,f._currentValue),f._currentValue=b,T!==null)if(Ka(T.value,b)){if(T.children===x.children&&!os.current){i=Ru(n,i,a);break e}}else for(T=i.child,T!==null&&(T.return=i);T!==null;){var u=T.dependencies;if(u!==null){b=T.child;for(var j=u.firstContext;j!==null;){if(j.context===f){if(T.tag===1){j=Iu(-1,a&-a),j.tag=2;var Z=T.updateQueue;if(Z!==null){Z=Z.shared;var me=Z.pending;me===null?j.next=j:(j.next=me.next,me.next=j),Z.pending=j}}T.lanes|=a,j=T.alternate,j!==null&&(j.lanes|=a),Ix(T.return,a,i),u.lanes|=a;break}j=j.next}}else if(T.tag===10)b=T.type===i.type?null:T.child;else if(T.tag===18){if(b=T.return,b===null)throw Error(kt(341));b.lanes|=a,u=b.alternate,u!==null&&(u.lanes|=a),Ix(b,a,i),b=T.sibling}else b=T.child;if(b!==null)b.return=T;else for(b=T;b!==null;){if(b===i){b=null;break}if(T=b.sibling,T!==null){T.return=b.return,b=T;break}b=b.return}T=b}Lo(n,i,x.children,a),i=i.child}return i;case 9:return x=i.type,f=i.pendingProps.children,Hp(i,a),x=ha(x),f=f(x),i.flags|=1,Lo(n,i,f,a),i.child;case 14:return f=i.type,x=Za(f,i.pendingProps),x=Za(f.type,x),ib(n,i,f,x,a);case 15:return OS(n,i,i.type,i.pendingProps,a);case 17:return f=i.type,x=i.pendingProps,x=i.elementType===f?x:Za(f,x),oy(n,i),i.tag=1,ss(f)?(n=!0,wy(i)):n=!1,Hp(i,a),DS(i,f,x),Ax(i,f,x,a),Lx(null,i,f,!0,n,a);case 19:return GS(n,i,a);case 22:return NS(n,i,a)}throw Error(kt(156,i.tag))};function oT(n,i){return z2(n,i)}function UE(n,i,a,f){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ua(n,i,a,f){return new UE(n,i,a,f)}function H1(n){return n=n.prototype,!(!n||!n.isReactComponent)}function VE(n){if(typeof n=="function")return H1(n)?1:0;if(n!=null){if(n=n.$$typeof,n===p1)return 11;if(n===f1)return 14}return 2}function sh(n,i){var a=n.alternate;return a===null?(a=ua(n.tag,i,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=i,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,i=n.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function ly(n,i,a,f,x,T){var b=2;if(f=n,typeof n=="function")H1(n)&&(b=1);else if(typeof n=="string")b=5;else e:switch(n){case Rp:return pd(a.children,x,T,i);case d1:b=8,x|=8;break;case tx:return n=ua(12,a,i,x|2),n.elementType=tx,n.lanes=T,n;case nx:return n=ua(13,a,i,x),n.elementType=nx,n.lanes=T,n;case rx:return n=ua(19,a,i,x),n.elementType=rx,n.lanes=T,n;case m2:return r0(a,x,T,i);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case p2:b=10;break e;case f2:b=9;break e;case p1:b=11;break e;case f1:b=14;break e;case Wc:b=16,f=null;break e}throw Error(kt(130,n==null?n:typeof n,""))}return i=ua(b,a,i,x),i.elementType=n,i.type=f,i.lanes=T,i}function pd(n,i,a,f){return n=ua(7,n,f,i),n.lanes=a,n}function r0(n,i,a,f){return n=ua(22,n,f,i),n.elementType=m2,n.lanes=a,n.stateNode={isHidden:!1},n}function Gv(n,i,a){return n=ua(6,n,null,i),n.lanes=a,n}function $v(n,i,a){return i=ua(4,n.children!==null?n.children:[],n.key,i),i.lanes=a,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}function GE(n,i,a,f,x){this.tag=i,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Tv(0),this.expirationTimes=Tv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tv(0),this.identifierPrefix=f,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function Y1(n,i,a,f,x,T,b,u,j){return n=new GE(n,i,a,u,j),i===1?(i=1,T===!0&&(i|=8)):i=0,T=ua(3,null,null,i),n.current=T,T.stateNode=n,T.memoizedState={element:f,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},z1(T),n}function $E(n,i,a){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zp,key:f==null?null:""+f,children:n,containerInfo:i,implementation:a}}function sT(n){if(!n)return lh;n=n._reactInternals;e:{if(Sd(n)!==n||n.tag!==1)throw Error(kt(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(ss(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(kt(171))}if(n.tag===1){var a=n.type;if(ss(a))return sS(n,a,i)}return i}function aT(n,i,a,f,x,T,b,u,j){return n=Y1(a,f,!0,n,x,T,b,u,j),n.context=sT(null),a=n.current,f=Do(),x=oh(a),T=Iu(f,x),T.callback=i??null,rh(a,T,x),n.current.lanes=x,ag(n,x,f),as(n,f),n}function i0(n,i,a,f){var x=i.current,T=Do(),b=oh(x);return a=sT(a),i.context===null?i.context=a:i.pendingContext=a,i=Iu(T,b),i.payload={element:n},f=f===void 0?null:f,f!==null&&(i.callback=f),n=rh(x,i,b),n!==null&&(Xa(n,x,b,T),ny(n,x,b)),b}function Ly(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function gb(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<i?a:i}}function X1(n,i){gb(n,i),(n=n.alternate)&&gb(n,i)}function ZE(){return null}var lT=typeof reportError=="function"?reportError:function(n){console.error(n)};function K1(n){this._internalRoot=n}o0.prototype.render=K1.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(kt(409));i0(n,i,null,null)};o0.prototype.unmount=K1.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;yd(function(){i0(null,n,null,null)}),i[Au]=null}};function o0(n){this._internalRoot=n}o0.prototype.unstable_scheduleHydration=function(n){if(n){var i=N2();n={blockedOn:null,target:n,priority:i};for(var a=0;a<Yc.length&&i!==0&&i<Yc[a].priority;a++);Yc.splice(a,0,n),a===0&&U2(n)}};function J1(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function s0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function _b(){}function qE(n,i,a,f,x){if(x){if(typeof f=="function"){var T=f;f=function(){var Z=Ly(b);T.call(Z)}}var b=aT(i,f,n,0,null,!1,!1,"",_b);return n._reactRootContainer=b,n[Au]=b.current,Hm(n.nodeType===8?n.parentNode:n),yd(),b}for(;x=n.lastChild;)n.removeChild(x);if(typeof f=="function"){var u=f;f=function(){var Z=Ly(j);u.call(Z)}}var j=Y1(n,0,!1,null,null,!1,!1,"",_b);return n._reactRootContainer=j,n[Au]=j.current,Hm(n.nodeType===8?n.parentNode:n),yd(function(){i0(i,j,a,f)}),j}function a0(n,i,a,f,x){var T=a._reactRootContainer;if(T){var b=T;if(typeof x=="function"){var u=x;x=function(){var j=Ly(b);u.call(j)}}i0(i,b,n,x)}else b=qE(a,i,n,x,f);return Ly(b)}B2=function(n){switch(n.tag){case 3:var i=n.stateNode;if(i.current.memoizedState.isDehydrated){var a=Pm(i.pendingLanes);a!==0&&(_1(i,a|1),as(i,ci()),!(Xn&6)&&(rf=ci()+500,dh()))}break;case 13:yd(function(){var f=zu(n,1);if(f!==null){var x=Do();Xa(f,n,1,x)}}),X1(n,1)}};y1=function(n){if(n.tag===13){var i=zu(n,134217728);if(i!==null){var a=Do();Xa(i,n,134217728,a)}X1(n,134217728)}};O2=function(n){if(n.tag===13){var i=oh(n),a=zu(n,i);if(a!==null){var f=Do();Xa(a,n,i,f)}X1(n,i)}};N2=function(){return cr};j2=function(n,i){var a=cr;try{return cr=n,i()}finally{cr=a}};px=function(n,i,a){switch(i){case"input":if(sx(n,a),i=a.name,a.type==="radio"&&i!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var f=a[i];if(f!==n&&f.form===n.form){var x=Ky(f);if(!x)throw Error(kt(90));_2(f),sx(f,x)}}}break;case"textarea":v2(n,a);break;case"select":i=a.value,i!=null&&$p(n,!!a.multiple,i,!1)}};P2=Z1;E2=yd;var WE={usingClientEntryPoint:!1,Events:[ug,Bp,Ky,T2,C2,Z1]},wm={findFiberByHostInstance:ud,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},HE={bundleType:wm.bundleType,version:wm.version,rendererPackageName:wm.rendererPackageName,rendererConfig:wm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fu.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=k2(n),n===null?null:n.stateNode},findFiberByHostInstance:wm.findFiberByHostInstance||ZE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var q_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!q_.isDisabled&&q_.supportsFiber)try{Wy=q_.inject(HE),Ll=q_}catch{}}Ls.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WE;Ls.createPortal=function(n,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!J1(i))throw Error(kt(200));return $E(n,i,null,a)};Ls.createRoot=function(n,i){if(!J1(n))throw Error(kt(299));var a=!1,f="",x=lT;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(f=i.identifierPrefix),i.onRecoverableError!==void 0&&(x=i.onRecoverableError)),i=Y1(n,1,!1,null,null,a,!1,f,x),n[Au]=i.current,Hm(n.nodeType===8?n.parentNode:n),new K1(i)};Ls.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(kt(188)):(n=Object.keys(n).join(","),Error(kt(268,n)));return n=k2(i),n=n===null?null:n.stateNode,n};Ls.flushSync=function(n){return yd(n)};Ls.hydrate=function(n,i,a){if(!s0(i))throw Error(kt(200));return a0(null,n,i,!0,a)};Ls.hydrateRoot=function(n,i,a){if(!J1(n))throw Error(kt(405));var f=a!=null&&a.hydratedSources||null,x=!1,T="",b=lT;if(a!=null&&(a.unstable_strictMode===!0&&(x=!0),a.identifierPrefix!==void 0&&(T=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),i=aT(i,null,n,1,a??null,x,!1,T,b),n[Au]=i.current,Hm(n),f)for(n=0;n<f.length;n++)a=f[n],x=a._getVersion,x=x(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,x]:i.mutableSourceEagerHydrationData.push(a,x);return new o0(i)};Ls.render=function(n,i,a){if(!s0(i))throw Error(kt(200));return a0(null,n,i,!1,a)};Ls.unmountComponentAtNode=function(n){if(!s0(n))throw Error(kt(40));return n._reactRootContainer?(yd(function(){a0(null,null,n,!1,function(){n._reactRootContainer=null,n[Au]=null})}),!0):!1};Ls.unstable_batchedUpdates=Z1;Ls.unstable_renderSubtreeIntoContainer=function(n,i,a,f){if(!s0(a))throw Error(kt(200));if(n==null||n._reactInternals===void 0)throw Error(kt(38));return a0(n,i,a,!1,f)};Ls.version="18.3.1-next-f1338f8080-20240426";function uT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(uT)}catch(n){console.error(n)}}uT(),u2.exports=Ls;var YE=u2.exports,yb=YE;Qv.createRoot=yb.createRoot,Qv.hydrateRoot=yb.hydrateRoot;var cT={exports:{}},hT={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hg=en;function XE(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var KE=typeof Object.is=="function"?Object.is:XE,JE=hg.useSyncExternalStore,QE=hg.useRef,eM=hg.useEffect,tM=hg.useMemo,nM=hg.useDebugValue;hT.useSyncExternalStoreWithSelector=function(n,i,a,f,x){var T=QE(null);if(T.current===null){var b={hasValue:!1,value:null};T.current=b}else b=T.current;T=tM(function(){function j(oe){if(!Z){if(Z=!0,me=oe,oe=f(oe),x!==void 0&&b.hasValue){var Be=b.value;if(x(Be,oe))return ge=Be}return ge=oe}if(Be=ge,KE(me,oe))return Be;var _t=f(oe);return x!==void 0&&x(Be,_t)?Be:(me=oe,ge=_t)}var Z=!1,me,ge,fe=a===void 0?null:a;return[function(){return j(i())},fe===null?void 0:function(){return j(fe())}]},[i,a,f,x]);var u=JE(n,T[0],T[1]);return eM(function(){b.hasValue=!0,b.value=u},[u]),nM(u),u};cT.exports=hT;var rM=cT.exports,Is="default"in dw?l1:dw,vb=Symbol.for("react-redux-context"),xb=typeof globalThis<"u"?globalThis:{};function iM(){if(!Is.createContext)return{};const n=xb[vb]??(xb[vb]=new Map);let i=n.get(Is.createContext);return i||(i=Is.createContext(null),n.set(Is.createContext,i)),i}var uh=iM(),oM=()=>{throw new Error("uSES not initialized!")};function Q1(n=uh){return function(){return Is.useContext(n)}}var dT=Q1(),pT=oM,sM=n=>{pT=n},aM=(n,i)=>n===i;function lM(n=uh){const i=n===uh?dT:Q1(n),a=(f,x={})=>{const{equalityFn:T=aM,devModeChecks:b={}}=typeof x=="function"?{equalityFn:x}:x,{store:u,subscription:j,getServerState:Z,stabilityCheck:me,identityFunctionCheck:ge}=i();Is.useRef(!0);const fe=Is.useCallback({[f.name](Be){return f(Be)}}[f.name],[f,me,b.stabilityCheck]),oe=pT(j.addNestedSub,u.getState,Z||u.getState,fe,T);return Is.useDebugValue(oe),oe};return Object.assign(a,{withTypes:()=>a}),a}var dg=lM();function uM(n){n()}function cM(){let n=null,i=null;return{clear(){n=null,i=null},notify(){uM(()=>{let a=n;for(;a;)a.callback(),a=a.next})},get(){const a=[];let f=n;for(;f;)a.push(f),f=f.next;return a},subscribe(a){let f=!0;const x=i={callback:a,next:null,prev:i};return x.prev?x.prev.next=x:n=x,function(){!f||n===null||(f=!1,x.next?x.next.prev=x.prev:i=x.prev,x.prev?x.prev.next=x.next:n=x.next)}}}}var wb={notify(){},get:()=>[]};function hM(n,i){let a,f=wb,x=0,T=!1;function b(_t){me();const xt=f.subscribe(_t);let Ie=!1;return()=>{Ie||(Ie=!0,xt(),ge())}}function u(){f.notify()}function j(){Be.onStateChange&&Be.onStateChange()}function Z(){return T}function me(){x++,a||(a=n.subscribe(j),f=cM())}function ge(){x--,a&&x===0&&(a(),a=void 0,f.clear(),f=wb)}function fe(){T||(T=!0,me())}function oe(){T&&(T=!1,ge())}const Be={addNestedSub:b,notifyNestedSubs:u,handleChangeWrapper:j,isSubscribed:Z,trySubscribe:fe,tryUnsubscribe:oe,getListeners:()=>f};return Be}var dM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",pM=typeof navigator<"u"&&navigator.product==="ReactNative",fM=dM||pM?Is.useLayoutEffect:Is.useEffect;function mM({store:n,context:i,children:a,serverState:f,stabilityCheck:x="once",identityFunctionCheck:T="once"}){const b=Is.useMemo(()=>{const Z=hM(n);return{store:n,subscription:Z,getServerState:f?()=>f:void 0,stabilityCheck:x,identityFunctionCheck:T}},[n,f,x,T]),u=Is.useMemo(()=>n.getState(),[n]);fM(()=>{const{subscription:Z}=b;return Z.onStateChange=Z.notifyNestedSubs,Z.trySubscribe(),u!==n.getState()&&Z.notifyNestedSubs(),()=>{Z.tryUnsubscribe(),Z.onStateChange=void 0}},[b,u]);const j=i||uh;return Is.createElement(j.Provider,{value:b},a)}var gM=mM;function fT(n=uh){const i=n===uh?dT:Q1(n),a=()=>{const{store:f}=i();return f};return Object.assign(a,{withTypes:()=>a}),a}var _M=fT();function yM(n=uh){const i=n===uh?_M:fT(n),a=()=>i().dispatch;return Object.assign(a,{withTypes:()=>a}),a}var ew=yM();sM(rM.useSyncExternalStoreWithSelector);const mT="map",Dy="country-labels",vM="modulepreload",xM=function(n){return"/"+n},bb={},wM=function(i,a,f){let x=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const b=document.querySelector("meta[property=csp-nonce]"),u=(b==null?void 0:b.nonce)||(b==null?void 0:b.getAttribute("nonce"));x=Promise.allSettled(a.map(j=>{if(j=xM(j),j in bb)return;bb[j]=!0;const Z=j.endsWith(".css"),me=Z?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${j}"]${me}`))return;const ge=document.createElement("link");if(ge.rel=Z?"stylesheet":vM,Z||(ge.as="script"),ge.crossOrigin="",ge.href=j,u&&ge.setAttribute("nonce",u),document.head.appendChild(ge),Z)return new Promise((fe,oe)=>{ge.addEventListener("load",fe),ge.addEventListener("error",()=>oe(new Error(`Unable to preload CSS for ${j}`)))})}))}function T(b){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=b,window.dispatchEvent(u),!u.defaultPrevented)throw b}return x.then(b=>{for(const u of b||[])u.status==="rejected"&&T(u.reason);return i().catch(T)})};function gT(n,i,a={}){const f={type:"Feature"};return(a.id===0||a.id)&&(f.id=a.id),a.bbox&&(f.bbox=a.bbox),f.properties=i||{},f.geometry=n,f}function bM(n,i,a={}){for(const x of n){if(x.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(x[x.length-1].length!==x[0].length)throw new Error("First and last Position are not equivalent.");for(let T=0;T<x[x.length-1].length;T++)if(x[x.length-1][T]!==x[0][T])throw new Error("First and last Position are not equivalent.")}return gT({type:"Polygon",coordinates:n},i,a)}function SM(n,i={}){const a={type:"FeatureCollection"};return i.id&&(a.id=i.id),i.bbox&&(a.bbox=i.bbox),a.features=n,a}function _T(n,i,a={}){return gT({type:"MultiPolygon",coordinates:n},i,a)}function yT(n,i,a){if(n!==null)for(var f,x,T,b,u,j,Z,me=0,ge=0,fe,oe=n.type,Be=oe==="FeatureCollection",_t=oe==="Feature",xt=Be?n.features.length:1,Ie=0;Ie<xt;Ie++){Z=Be?n.features[Ie].geometry:_t?n.geometry:n,fe=Z?Z.type==="GeometryCollection":!1,u=fe?Z.geometries.length:1;for(var ne=0;ne<u;ne++){var Te=0,Ne=0;if(b=fe?Z.geometries[ne]:Z,b!==null){j=b.coordinates;var ut=b.type;switch(me=0,ut){case null:break;case"Point":if(i(j,ge,Ie,Te,Ne)===!1)return!1;ge++,Te++;break;case"LineString":case"MultiPoint":for(f=0;f<j.length;f++){if(i(j[f],ge,Ie,Te,Ne)===!1)return!1;ge++,ut==="MultiPoint"&&Te++}ut==="LineString"&&Te++;break;case"Polygon":case"MultiLineString":for(f=0;f<j.length;f++){for(x=0;x<j[f].length-me;x++){if(i(j[f][x],ge,Ie,Te,Ne)===!1)return!1;ge++}ut==="MultiLineString"&&Te++,ut==="Polygon"&&Ne++}ut==="Polygon"&&Te++;break;case"MultiPolygon":for(f=0;f<j.length;f++){for(Ne=0,x=0;x<j[f].length;x++){for(T=0;T<j[f][x].length-me;T++){if(i(j[f][x][T],ge,Ie,Te,Ne)===!1)return!1;ge++}Ne++}Te++}break;case"GeometryCollection":for(f=0;f<b.geometries.length;f++)if(yT(b.geometries[f],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function TM(n,i){var a,f,x,T,b,u,j,Z,me,ge,fe=0,oe=n.type==="FeatureCollection",Be=n.type==="Feature",_t=oe?n.features.length:1;for(a=0;a<_t;a++){for(u=oe?n.features[a].geometry:Be?n.geometry:n,Z=oe?n.features[a].properties:Be?n.properties:{},me=oe?n.features[a].bbox:Be?n.bbox:void 0,ge=oe?n.features[a].id:Be?n.id:void 0,j=u?u.type==="GeometryCollection":!1,b=j?u.geometries.length:1,x=0;x<b;x++){if(T=j?u.geometries[x]:u,T===null){if(i(null,fe,Z,me,ge)===!1)return!1;continue}switch(T.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(T,fe,Z,me,ge)===!1)return!1;break}case"GeometryCollection":{for(f=0;f<T.geometries.length;f++)if(i(T.geometries[f],fe,Z,me,ge)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}fe++}}function CM(n,i={}){if(n.bbox!=null&&i.recompute!==!0)return n.bbox;const a=[1/0,1/0,-1/0,-1/0];return yT(n,f=>{a[0]>f[0]&&(a[0]=f[0]),a[1]>f[1]&&(a[1]=f[1]),a[2]<f[0]&&(a[2]=f[0]),a[3]<f[1]&&(a[3]=f[1])}),a}var PM=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Zv=Math.ceil,oa=Math.floor,ns="[BigNumber Error] ",Sb=ns+"Number primitive has more than 15 significant digits: ",$a=1e14,Sn=14,qv=9007199254740991,Wv=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Zc=1e7,Ai=1e9;function vT(n){var i,a,f,x=ne.prototype={constructor:ne,toString:null,valueOf:null},T=new ne(1),b=20,u=4,j=-7,Z=21,me=-1e7,ge=1e7,fe=!1,oe=1,Be=0,_t={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},xt="0123456789abcdefghijklmnopqrstuvwxyz",Ie=!0;function ne($,le){var pe,Ve,Fe,je,Ye,Le,ze,We,be=this;if(!(be instanceof ne))return new ne($,le);if(le==null){if($&&$._isBigNumber===!0){be.s=$.s,!$.c||$.e>ge?be.c=be.e=null:$.e<me?be.c=[be.e=0]:(be.e=$.e,be.c=$.c.slice());return}if((Le=typeof $=="number")&&$*0==0){if(be.s=1/$<0?($=-$,-1):1,$===~~$){for(je=0,Ye=$;Ye>=10;Ye/=10,je++);je>ge?be.c=be.e=null:(be.e=je,be.c=[$]);return}We=String($)}else{if(!PM.test(We=String($)))return f(be,We,Le);be.s=We.charCodeAt(0)==45?(We=We.slice(1),-1):1}(je=We.indexOf("."))>-1&&(We=We.replace(".","")),(Ye=We.search(/e/i))>0?(je<0&&(je=Ye),je+=+We.slice(Ye+1),We=We.substring(0,Ye)):je<0&&(je=We.length)}else{if(Wr(le,2,xt.length,"Base"),le==10&&Ie)return be=new ne($),ct(be,b+be.e+1,u);if(We=String($),Le=typeof $=="number"){if($*0!=0)return f(be,We,Le,le);if(be.s=1/$<0?(We=We.slice(1),-1):1,ne.DEBUG&&We.replace(/^0\.0*|\./,"").length>15)throw Error(Sb+$)}else be.s=We.charCodeAt(0)===45?(We=We.slice(1),-1):1;for(pe=xt.slice(0,le),je=Ye=0,ze=We.length;Ye<ze;Ye++)if(pe.indexOf(Ve=We.charAt(Ye))<0){if(Ve=="."){if(Ye>je){je=ze;continue}}else if(!Fe&&(We==We.toUpperCase()&&(We=We.toLowerCase())||We==We.toLowerCase()&&(We=We.toUpperCase()))){Fe=!0,Ye=-1,je=0;continue}return f(be,String($),Le,le)}Le=!1,We=a(We,le,10,be.s),(je=We.indexOf("."))>-1?We=We.replace(".",""):je=We.length}for(Ye=0;We.charCodeAt(Ye)===48;Ye++);for(ze=We.length;We.charCodeAt(--ze)===48;);if(We=We.slice(Ye,++ze)){if(ze-=Ye,Le&&ne.DEBUG&&ze>15&&($>qv||$!==oa($)))throw Error(Sb+be.s*$);if((je=je-Ye-1)>ge)be.c=be.e=null;else if(je<me)be.c=[be.e=0];else{if(be.e=je,be.c=[],Ye=(je+1)%Sn,je<0&&(Ye+=Sn),Ye<ze){for(Ye&&be.c.push(+We.slice(0,Ye)),ze-=Sn;Ye<ze;)be.c.push(+We.slice(Ye,Ye+=Sn));Ye=Sn-(We=We.slice(Ye)).length}else Ye-=ze;for(;Ye--;We+="0");be.c.push(+We)}}else be.c=[be.e=0]}ne.clone=vT,ne.ROUND_UP=0,ne.ROUND_DOWN=1,ne.ROUND_CEIL=2,ne.ROUND_FLOOR=3,ne.ROUND_HALF_UP=4,ne.ROUND_HALF_DOWN=5,ne.ROUND_HALF_EVEN=6,ne.ROUND_HALF_CEIL=7,ne.ROUND_HALF_FLOOR=8,ne.EUCLID=9,ne.config=ne.set=function($){var le,pe;if($!=null)if(typeof $=="object"){if($.hasOwnProperty(le="DECIMAL_PLACES")&&(pe=$[le],Wr(pe,0,Ai,le),b=pe),$.hasOwnProperty(le="ROUNDING_MODE")&&(pe=$[le],Wr(pe,0,8,le),u=pe),$.hasOwnProperty(le="EXPONENTIAL_AT")&&(pe=$[le],pe&&pe.pop?(Wr(pe[0],-Ai,0,le),Wr(pe[1],0,Ai,le),j=pe[0],Z=pe[1]):(Wr(pe,-Ai,Ai,le),j=-(Z=pe<0?-pe:pe))),$.hasOwnProperty(le="RANGE"))if(pe=$[le],pe&&pe.pop)Wr(pe[0],-Ai,-1,le),Wr(pe[1],1,Ai,le),me=pe[0],ge=pe[1];else if(Wr(pe,-Ai,Ai,le),pe)me=-(ge=pe<0?-pe:pe);else throw Error(ns+le+" cannot be zero: "+pe);if($.hasOwnProperty(le="CRYPTO"))if(pe=$[le],pe===!!pe)if(pe)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))fe=pe;else throw fe=!pe,Error(ns+"crypto unavailable");else fe=pe;else throw Error(ns+le+" not true or false: "+pe);if($.hasOwnProperty(le="MODULO_MODE")&&(pe=$[le],Wr(pe,0,9,le),oe=pe),$.hasOwnProperty(le="POW_PRECISION")&&(pe=$[le],Wr(pe,0,Ai,le),Be=pe),$.hasOwnProperty(le="FORMAT"))if(pe=$[le],typeof pe=="object")_t=pe;else throw Error(ns+le+" not an object: "+pe);if($.hasOwnProperty(le="ALPHABET"))if(pe=$[le],typeof pe=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(pe))Ie=pe.slice(0,10)=="0123456789",xt=pe;else throw Error(ns+le+" invalid: "+pe)}else throw Error(ns+"Object expected: "+$);return{DECIMAL_PLACES:b,ROUNDING_MODE:u,EXPONENTIAL_AT:[j,Z],RANGE:[me,ge],CRYPTO:fe,MODULO_MODE:oe,POW_PRECISION:Be,FORMAT:_t,ALPHABET:xt}},ne.isBigNumber=function($){if(!$||$._isBigNumber!==!0)return!1;if(!ne.DEBUG)return!0;var le,pe,Ve=$.c,Fe=$.e,je=$.s;e:if({}.toString.call(Ve)=="[object Array]"){if((je===1||je===-1)&&Fe>=-Ai&&Fe<=Ai&&Fe===oa(Fe)){if(Ve[0]===0){if(Fe===0&&Ve.length===1)return!0;break e}if(le=(Fe+1)%Sn,le<1&&(le+=Sn),String(Ve[0]).length==le){for(le=0;le<Ve.length;le++)if(pe=Ve[le],pe<0||pe>=$a||pe!==oa(pe))break e;if(pe!==0)return!0}}}else if(Ve===null&&Fe===null&&(je===null||je===1||je===-1))return!0;throw Error(ns+"Invalid BigNumber: "+$)},ne.maximum=ne.max=function(){return Ne(arguments,-1)},ne.minimum=ne.min=function(){return Ne(arguments,1)},ne.random=function(){var $=9007199254740992,le=Math.random()*$&2097151?function(){return oa(Math.random()*$)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(pe){var Ve,Fe,je,Ye,Le,ze=0,We=[],be=new ne(T);if(pe==null?pe=b:Wr(pe,0,Ai),Ye=Zv(pe/Sn),fe)if(crypto.getRandomValues){for(Ve=crypto.getRandomValues(new Uint32Array(Ye*=2));ze<Ye;)Le=Ve[ze]*131072+(Ve[ze+1]>>>11),Le>=9e15?(Fe=crypto.getRandomValues(new Uint32Array(2)),Ve[ze]=Fe[0],Ve[ze+1]=Fe[1]):(We.push(Le%1e14),ze+=2);ze=Ye/2}else if(crypto.randomBytes){for(Ve=crypto.randomBytes(Ye*=7);ze<Ye;)Le=(Ve[ze]&31)*281474976710656+Ve[ze+1]*1099511627776+Ve[ze+2]*4294967296+Ve[ze+3]*16777216+(Ve[ze+4]<<16)+(Ve[ze+5]<<8)+Ve[ze+6],Le>=9e15?crypto.randomBytes(7).copy(Ve,ze):(We.push(Le%1e14),ze+=7);ze=Ye/7}else throw fe=!1,Error(ns+"crypto unavailable");if(!fe)for(;ze<Ye;)Le=le(),Le<9e15&&(We[ze++]=Le%1e14);for(Ye=We[--ze],pe%=Sn,Ye&&pe&&(Le=Wv[Sn-pe],We[ze]=oa(Ye/Le)*Le);We[ze]===0;We.pop(),ze--);if(ze<0)We=[je=0];else{for(je=-1;We[0]===0;We.splice(0,1),je-=Sn);for(ze=1,Le=We[0];Le>=10;Le/=10,ze++);ze<Sn&&(je-=Sn-ze)}return be.e=je,be.c=We,be}}(),ne.sum=function(){for(var $=1,le=arguments,pe=new ne(le[0]);$<le.length;)pe=pe.plus(le[$++]);return pe},a=function(){var $="0123456789";function le(pe,Ve,Fe,je){for(var Ye,Le=[0],ze,We=0,be=pe.length;We<be;){for(ze=Le.length;ze--;Le[ze]*=Ve);for(Le[0]+=je.indexOf(pe.charAt(We++)),Ye=0;Ye<Le.length;Ye++)Le[Ye]>Fe-1&&(Le[Ye+1]==null&&(Le[Ye+1]=0),Le[Ye+1]+=Le[Ye]/Fe|0,Le[Ye]%=Fe)}return Le.reverse()}return function(pe,Ve,Fe,je,Ye){var Le,ze,We,be,Ke,ye,ue,gt,At=pe.indexOf("."),Lt=b,bt=u;for(At>=0&&(be=Be,Be=0,pe=pe.replace(".",""),gt=new ne(Ve),ye=gt.pow(pe.length-At),Be=be,gt.c=le(Tu(ra(ye.c),ye.e,"0"),10,Fe,$),gt.e=gt.c.length),ue=le(pe,Ve,Fe,Ye?(Le=xt,$):(Le=$,xt)),We=be=ue.length;ue[--be]==0;ue.pop());if(!ue[0])return Le.charAt(0);if(At<0?--We:(ye.c=ue,ye.e=We,ye.s=je,ye=i(ye,gt,Lt,bt,Fe),ue=ye.c,Ke=ye.r,We=ye.e),ze=We+Lt+1,At=ue[ze],be=Fe/2,Ke=Ke||ze<0||ue[ze+1]!=null,Ke=bt<4?(At!=null||Ke)&&(bt==0||bt==(ye.s<0?3:2)):At>be||At==be&&(bt==4||Ke||bt==6&&ue[ze-1]&1||bt==(ye.s<0?8:7)),ze<1||!ue[0])pe=Ke?Tu(Le.charAt(1),-Lt,Le.charAt(0)):Le.charAt(0);else{if(ue.length=ze,Ke)for(--Fe;++ue[--ze]>Fe;)ue[ze]=0,ze||(++We,ue=[1].concat(ue));for(be=ue.length;!ue[--be];);for(At=0,pe="";At<=be;pe+=Le.charAt(ue[At++]));pe=Tu(pe,We,Le.charAt(0))}return pe}}(),i=function(){function $(Ve,Fe,je){var Ye,Le,ze,We,be=0,Ke=Ve.length,ye=Fe%Zc,ue=Fe/Zc|0;for(Ve=Ve.slice();Ke--;)ze=Ve[Ke]%Zc,We=Ve[Ke]/Zc|0,Ye=ue*ze+We*ye,Le=ye*ze+Ye%Zc*Zc+be,be=(Le/je|0)+(Ye/Zc|0)+ue*We,Ve[Ke]=Le%je;return be&&(Ve=[be].concat(Ve)),Ve}function le(Ve,Fe,je,Ye){var Le,ze;if(je!=Ye)ze=je>Ye?1:-1;else for(Le=ze=0;Le<je;Le++)if(Ve[Le]!=Fe[Le]){ze=Ve[Le]>Fe[Le]?1:-1;break}return ze}function pe(Ve,Fe,je,Ye){for(var Le=0;je--;)Ve[je]-=Le,Le=Ve[je]<Fe[je]?1:0,Ve[je]=Le*Ye+Ve[je]-Fe[je];for(;!Ve[0]&&Ve.length>1;Ve.splice(0,1));}return function(Ve,Fe,je,Ye,Le){var ze,We,be,Ke,ye,ue,gt,At,Lt,bt,zt,Ft,Kt,on,Dn,Ht,tn,gn=Ve.s==Fe.s?1:-1,Rt=Ve.c,rn=Fe.c;if(!Rt||!Rt[0]||!rn||!rn[0])return new ne(!Ve.s||!Fe.s||(Rt?rn&&Rt[0]==rn[0]:!rn)?NaN:Rt&&Rt[0]==0||!rn?gn*0:gn/0);for(At=new ne(gn),Lt=At.c=[],We=Ve.e-Fe.e,gn=je+We+1,Le||(Le=$a,We=sa(Ve.e/Sn)-sa(Fe.e/Sn),gn=gn/Sn|0),be=0;rn[be]==(Rt[be]||0);be++);if(rn[be]>(Rt[be]||0)&&We--,gn<0)Lt.push(1),Ke=!0;else{for(on=Rt.length,Ht=rn.length,be=0,gn+=2,ye=oa(Le/(rn[0]+1)),ye>1&&(rn=$(rn,ye,Le),Rt=$(Rt,ye,Le),Ht=rn.length,on=Rt.length),Kt=Ht,bt=Rt.slice(0,Ht),zt=bt.length;zt<Ht;bt[zt++]=0);tn=rn.slice(),tn=[0].concat(tn),Dn=rn[0],rn[1]>=Le/2&&Dn++;do{if(ye=0,ze=le(rn,bt,Ht,zt),ze<0){if(Ft=bt[0],Ht!=zt&&(Ft=Ft*Le+(bt[1]||0)),ye=oa(Ft/Dn),ye>1)for(ye>=Le&&(ye=Le-1),ue=$(rn,ye,Le),gt=ue.length,zt=bt.length;le(ue,bt,gt,zt)==1;)ye--,pe(ue,Ht<gt?tn:rn,gt,Le),gt=ue.length,ze=1;else ye==0&&(ze=ye=1),ue=rn.slice(),gt=ue.length;if(gt<zt&&(ue=[0].concat(ue)),pe(bt,ue,zt,Le),zt=bt.length,ze==-1)for(;le(rn,bt,Ht,zt)<1;)ye++,pe(bt,Ht<zt?tn:rn,zt,Le),zt=bt.length}else ze===0&&(ye++,bt=[0]);Lt[be++]=ye,bt[0]?bt[zt++]=Rt[Kt]||0:(bt=[Rt[Kt]],zt=1)}while((Kt++<on||bt[0]!=null)&&gn--);Ke=bt[0]!=null,Lt[0]||Lt.splice(0,1)}if(Le==$a){for(be=1,gn=Lt[0];gn>=10;gn/=10,be++);ct(At,je+(At.e=be+We*Sn-1)+1,Ye,Ke)}else At.e=We,At.r=+Ke;return At}}();function Te($,le,pe,Ve){var Fe,je,Ye,Le,ze;if(pe==null?pe=u:Wr(pe,0,8),!$.c)return $.toString();if(Fe=$.c[0],Ye=$.e,le==null)ze=ra($.c),ze=Ve==1||Ve==2&&(Ye<=j||Ye>=Z)?H_(ze,Ye):Tu(ze,Ye,"0");else if($=ct(new ne($),le,pe),je=$.e,ze=ra($.c),Le=ze.length,Ve==1||Ve==2&&(le<=je||je<=j)){for(;Le<le;ze+="0",Le++);ze=H_(ze,je)}else if(le-=Ye,ze=Tu(ze,je,"0"),je+1>Le){if(--le>0)for(ze+=".";le--;ze+="0");}else if(le+=je-Le,le>0)for(je+1==Le&&(ze+=".");le--;ze+="0");return $.s<0&&Fe?"-"+ze:ze}function Ne($,le){for(var pe,Ve,Fe=1,je=new ne($[0]);Fe<$.length;Fe++)Ve=new ne($[Fe]),(!Ve.s||(pe=od(je,Ve))===le||pe===0&&je.s===le)&&(je=Ve);return je}function ut($,le,pe){for(var Ve=1,Fe=le.length;!le[--Fe];le.pop());for(Fe=le[0];Fe>=10;Fe/=10,Ve++);return(pe=Ve+pe*Sn-1)>ge?$.c=$.e=null:pe<me?$.c=[$.e=0]:($.e=pe,$.c=le),$}f=function(){var $=/^(-?)0([xbo])(?=\w[\w.]*$)/i,le=/^([^.]+)\.$/,pe=/^\.([^.]+)$/,Ve=/^-?(Infinity|NaN)$/,Fe=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(je,Ye,Le,ze){var We,be=Le?Ye:Ye.replace(Fe,"");if(Ve.test(be))je.s=isNaN(be)?null:be<0?-1:1;else{if(!Le&&(be=be.replace($,function(Ke,ye,ue){return We=(ue=ue.toLowerCase())=="x"?16:ue=="b"?2:8,!ze||ze==We?ye:Ke}),ze&&(We=ze,be=be.replace(le,"$1").replace(pe,"0.$1")),Ye!=be))return new ne(be,We);if(ne.DEBUG)throw Error(ns+"Not a"+(ze?" base "+ze:"")+" number: "+Ye);je.s=null}je.c=je.e=null}}();function ct($,le,pe,Ve){var Fe,je,Ye,Le,ze,We,be,Ke=$.c,ye=Wv;if(Ke){e:{for(Fe=1,Le=Ke[0];Le>=10;Le/=10,Fe++);if(je=le-Fe,je<0)je+=Sn,Ye=le,ze=Ke[We=0],be=oa(ze/ye[Fe-Ye-1]%10);else if(We=Zv((je+1)/Sn),We>=Ke.length)if(Ve){for(;Ke.length<=We;Ke.push(0));ze=be=0,Fe=1,je%=Sn,Ye=je-Sn+1}else break e;else{for(ze=Le=Ke[We],Fe=1;Le>=10;Le/=10,Fe++);je%=Sn,Ye=je-Sn+Fe,be=Ye<0?0:oa(ze/ye[Fe-Ye-1]%10)}if(Ve=Ve||le<0||Ke[We+1]!=null||(Ye<0?ze:ze%ye[Fe-Ye-1]),Ve=pe<4?(be||Ve)&&(pe==0||pe==($.s<0?3:2)):be>5||be==5&&(pe==4||Ve||pe==6&&(je>0?Ye>0?ze/ye[Fe-Ye]:0:Ke[We-1])%10&1||pe==($.s<0?8:7)),le<1||!Ke[0])return Ke.length=0,Ve?(le-=$.e+1,Ke[0]=ye[(Sn-le%Sn)%Sn],$.e=-le||0):Ke[0]=$.e=0,$;if(je==0?(Ke.length=We,Le=1,We--):(Ke.length=We+1,Le=ye[Sn-je],Ke[We]=Ye>0?oa(ze/ye[Fe-Ye]%ye[Ye])*Le:0),Ve)for(;;)if(We==0){for(je=1,Ye=Ke[0];Ye>=10;Ye/=10,je++);for(Ye=Ke[0]+=Le,Le=1;Ye>=10;Ye/=10,Le++);je!=Le&&($.e++,Ke[0]==$a&&(Ke[0]=1));break}else{if(Ke[We]+=Le,Ke[We]!=$a)break;Ke[We--]=0,Le=1}for(je=Ke.length;Ke[--je]===0;Ke.pop());}$.e>ge?$.c=$.e=null:$.e<me&&($.c=[$.e=0])}return $}function ht($){var le,pe=$.e;return pe===null?$.toString():(le=ra($.c),le=pe<=j||pe>=Z?H_(le,pe):Tu(le,pe,"0"),$.s<0?"-"+le:le)}return x.absoluteValue=x.abs=function(){var $=new ne(this);return $.s<0&&($.s=1),$},x.comparedTo=function($,le){return od(this,new ne($,le))},x.decimalPlaces=x.dp=function($,le){var pe,Ve,Fe,je=this;if($!=null)return Wr($,0,Ai),le==null?le=u:Wr(le,0,8),ct(new ne(je),$+je.e+1,le);if(!(pe=je.c))return null;if(Ve=((Fe=pe.length-1)-sa(this.e/Sn))*Sn,Fe=pe[Fe])for(;Fe%10==0;Fe/=10,Ve--);return Ve<0&&(Ve=0),Ve},x.dividedBy=x.div=function($,le){return i(this,new ne($,le),b,u)},x.dividedToIntegerBy=x.idiv=function($,le){return i(this,new ne($,le),0,1)},x.exponentiatedBy=x.pow=function($,le){var pe,Ve,Fe,je,Ye,Le,ze,We,be,Ke=this;if($=new ne($),$.c&&!$.isInteger())throw Error(ns+"Exponent not an integer: "+ht($));if(le!=null&&(le=new ne(le)),Le=$.e>14,!Ke.c||!Ke.c[0]||Ke.c[0]==1&&!Ke.e&&Ke.c.length==1||!$.c||!$.c[0])return be=new ne(Math.pow(+ht(Ke),Le?$.s*(2-W_($)):+ht($))),le?be.mod(le):be;if(ze=$.s<0,le){if(le.c?!le.c[0]:!le.s)return new ne(NaN);Ve=!ze&&Ke.isInteger()&&le.isInteger(),Ve&&(Ke=Ke.mod(le))}else{if($.e>9&&(Ke.e>0||Ke.e<-1||(Ke.e==0?Ke.c[0]>1||Le&&Ke.c[1]>=24e7:Ke.c[0]<8e13||Le&&Ke.c[0]<=9999975e7)))return je=Ke.s<0&&W_($)?-0:0,Ke.e>-1&&(je=1/je),new ne(ze?1/je:je);Be&&(je=Zv(Be/Sn+2))}for(Le?(pe=new ne(.5),ze&&($.s=1),We=W_($)):(Fe=Math.abs(+ht($)),We=Fe%2),be=new ne(T);;){if(We){if(be=be.times(Ke),!be.c)break;je?be.c.length>je&&(be.c.length=je):Ve&&(be=be.mod(le))}if(Fe){if(Fe=oa(Fe/2),Fe===0)break;We=Fe%2}else if($=$.times(pe),ct($,$.e+1,1),$.e>14)We=W_($);else{if(Fe=+ht($),Fe===0)break;We=Fe%2}Ke=Ke.times(Ke),je?Ke.c&&Ke.c.length>je&&(Ke.c.length=je):Ve&&(Ke=Ke.mod(le))}return Ve?be:(ze&&(be=T.div(be)),le?be.mod(le):je?ct(be,Be,u,Ye):be)},x.integerValue=function($){var le=new ne(this);return $==null?$=u:Wr($,0,8),ct(le,le.e+1,$)},x.isEqualTo=x.eq=function($,le){return od(this,new ne($,le))===0},x.isFinite=function(){return!!this.c},x.isGreaterThan=x.gt=function($,le){return od(this,new ne($,le))>0},x.isGreaterThanOrEqualTo=x.gte=function($,le){return(le=od(this,new ne($,le)))===1||le===0},x.isInteger=function(){return!!this.c&&sa(this.e/Sn)>this.c.length-2},x.isLessThan=x.lt=function($,le){return od(this,new ne($,le))<0},x.isLessThanOrEqualTo=x.lte=function($,le){return(le=od(this,new ne($,le)))===-1||le===0},x.isNaN=function(){return!this.s},x.isNegative=function(){return this.s<0},x.isPositive=function(){return this.s>0},x.isZero=function(){return!!this.c&&this.c[0]==0},x.minus=function($,le){var pe,Ve,Fe,je,Ye=this,Le=Ye.s;if($=new ne($,le),le=$.s,!Le||!le)return new ne(NaN);if(Le!=le)return $.s=-le,Ye.plus($);var ze=Ye.e/Sn,We=$.e/Sn,be=Ye.c,Ke=$.c;if(!ze||!We){if(!be||!Ke)return be?($.s=-le,$):new ne(Ke?Ye:NaN);if(!be[0]||!Ke[0])return Ke[0]?($.s=-le,$):new ne(be[0]?Ye:u==3?-0:0)}if(ze=sa(ze),We=sa(We),be=be.slice(),Le=ze-We){for((je=Le<0)?(Le=-Le,Fe=be):(We=ze,Fe=Ke),Fe.reverse(),le=Le;le--;Fe.push(0));Fe.reverse()}else for(Ve=(je=(Le=be.length)<(le=Ke.length))?Le:le,Le=le=0;le<Ve;le++)if(be[le]!=Ke[le]){je=be[le]<Ke[le];break}if(je&&(Fe=be,be=Ke,Ke=Fe,$.s=-$.s),le=(Ve=Ke.length)-(pe=be.length),le>0)for(;le--;be[pe++]=0);for(le=$a-1;Ve>Le;){if(be[--Ve]<Ke[Ve]){for(pe=Ve;pe&&!be[--pe];be[pe]=le);--be[pe],be[Ve]+=$a}be[Ve]-=Ke[Ve]}for(;be[0]==0;be.splice(0,1),--We);return be[0]?ut($,be,We):($.s=u==3?-1:1,$.c=[$.e=0],$)},x.modulo=x.mod=function($,le){var pe,Ve,Fe=this;return $=new ne($,le),!Fe.c||!$.s||$.c&&!$.c[0]?new ne(NaN):!$.c||Fe.c&&!Fe.c[0]?new ne(Fe):(oe==9?(Ve=$.s,$.s=1,pe=i(Fe,$,0,3),$.s=Ve,pe.s*=Ve):pe=i(Fe,$,0,oe),$=Fe.minus(pe.times($)),!$.c[0]&&oe==1&&($.s=Fe.s),$)},x.multipliedBy=x.times=function($,le){var pe,Ve,Fe,je,Ye,Le,ze,We,be,Ke,ye,ue,gt,At,Lt,bt=this,zt=bt.c,Ft=($=new ne($,le)).c;if(!zt||!Ft||!zt[0]||!Ft[0])return!bt.s||!$.s||zt&&!zt[0]&&!Ft||Ft&&!Ft[0]&&!zt?$.c=$.e=$.s=null:($.s*=bt.s,!zt||!Ft?$.c=$.e=null:($.c=[0],$.e=0)),$;for(Ve=sa(bt.e/Sn)+sa($.e/Sn),$.s*=bt.s,ze=zt.length,Ke=Ft.length,ze<Ke&&(gt=zt,zt=Ft,Ft=gt,Fe=ze,ze=Ke,Ke=Fe),Fe=ze+Ke,gt=[];Fe--;gt.push(0));for(At=$a,Lt=Zc,Fe=Ke;--Fe>=0;){for(pe=0,ye=Ft[Fe]%Lt,ue=Ft[Fe]/Lt|0,Ye=ze,je=Fe+Ye;je>Fe;)We=zt[--Ye]%Lt,be=zt[Ye]/Lt|0,Le=ue*We+be*ye,We=ye*We+Le%Lt*Lt+gt[je]+pe,pe=(We/At|0)+(Le/Lt|0)+ue*be,gt[je--]=We%At;gt[je]=pe}return pe?++Ve:gt.splice(0,1),ut($,gt,Ve)},x.negated=function(){var $=new ne(this);return $.s=-$.s||null,$},x.plus=function($,le){var pe,Ve=this,Fe=Ve.s;if($=new ne($,le),le=$.s,!Fe||!le)return new ne(NaN);if(Fe!=le)return $.s=-le,Ve.minus($);var je=Ve.e/Sn,Ye=$.e/Sn,Le=Ve.c,ze=$.c;if(!je||!Ye){if(!Le||!ze)return new ne(Fe/0);if(!Le[0]||!ze[0])return ze[0]?$:new ne(Le[0]?Ve:Fe*0)}if(je=sa(je),Ye=sa(Ye),Le=Le.slice(),Fe=je-Ye){for(Fe>0?(Ye=je,pe=ze):(Fe=-Fe,pe=Le),pe.reverse();Fe--;pe.push(0));pe.reverse()}for(Fe=Le.length,le=ze.length,Fe-le<0&&(pe=ze,ze=Le,Le=pe,le=Fe),Fe=0;le;)Fe=(Le[--le]=Le[le]+ze[le]+Fe)/$a|0,Le[le]=$a===Le[le]?0:Le[le]%$a;return Fe&&(Le=[Fe].concat(Le),++Ye),ut($,Le,Ye)},x.precision=x.sd=function($,le){var pe,Ve,Fe,je=this;if($!=null&&$!==!!$)return Wr($,1,Ai),le==null?le=u:Wr(le,0,8),ct(new ne(je),$,le);if(!(pe=je.c))return null;if(Fe=pe.length-1,Ve=Fe*Sn+1,Fe=pe[Fe]){for(;Fe%10==0;Fe/=10,Ve--);for(Fe=pe[0];Fe>=10;Fe/=10,Ve++);}return $&&je.e+1>Ve&&(Ve=je.e+1),Ve},x.shiftedBy=function($){return Wr($,-qv,qv),this.times("1e"+$)},x.squareRoot=x.sqrt=function(){var $,le,pe,Ve,Fe,je=this,Ye=je.c,Le=je.s,ze=je.e,We=b+4,be=new ne("0.5");if(Le!==1||!Ye||!Ye[0])return new ne(!Le||Le<0&&(!Ye||Ye[0])?NaN:Ye?je:1/0);if(Le=Math.sqrt(+ht(je)),Le==0||Le==1/0?(le=ra(Ye),(le.length+ze)%2==0&&(le+="0"),Le=Math.sqrt(+le),ze=sa((ze+1)/2)-(ze<0||ze%2),Le==1/0?le="5e"+ze:(le=Le.toExponential(),le=le.slice(0,le.indexOf("e")+1)+ze),pe=new ne(le)):pe=new ne(Le+""),pe.c[0]){for(ze=pe.e,Le=ze+We,Le<3&&(Le=0);;)if(Fe=pe,pe=be.times(Fe.plus(i(je,Fe,We,1))),ra(Fe.c).slice(0,Le)===(le=ra(pe.c)).slice(0,Le))if(pe.e<ze&&--Le,le=le.slice(Le-3,Le+1),le=="9999"||!Ve&&le=="4999"){if(!Ve&&(ct(Fe,Fe.e+b+2,0),Fe.times(Fe).eq(je))){pe=Fe;break}We+=4,Le+=4,Ve=1}else{(!+le||!+le.slice(1)&&le.charAt(0)=="5")&&(ct(pe,pe.e+b+2,1),$=!pe.times(pe).eq(je));break}}return ct(pe,pe.e+b+1,u,$)},x.toExponential=function($,le){return $!=null&&(Wr($,0,Ai),$++),Te(this,$,le,1)},x.toFixed=function($,le){return $!=null&&(Wr($,0,Ai),$=$+this.e+1),Te(this,$,le)},x.toFormat=function($,le,pe){var Ve,Fe=this;if(pe==null)$!=null&&le&&typeof le=="object"?(pe=le,le=null):$&&typeof $=="object"?(pe=$,$=le=null):pe=_t;else if(typeof pe!="object")throw Error(ns+"Argument not an object: "+pe);if(Ve=Fe.toFixed($,le),Fe.c){var je,Ye=Ve.split("."),Le=+pe.groupSize,ze=+pe.secondaryGroupSize,We=pe.groupSeparator||"",be=Ye[0],Ke=Ye[1],ye=Fe.s<0,ue=ye?be.slice(1):be,gt=ue.length;if(ze&&(je=Le,Le=ze,ze=je,gt-=je),Le>0&&gt>0){for(je=gt%Le||Le,be=ue.substr(0,je);je<gt;je+=Le)be+=We+ue.substr(je,Le);ze>0&&(be+=We+ue.slice(je)),ye&&(be="-"+be)}Ve=Ke?be+(pe.decimalSeparator||"")+((ze=+pe.fractionGroupSize)?Ke.replace(new RegExp("\\d{"+ze+"}\\B","g"),"$&"+(pe.fractionGroupSeparator||"")):Ke):be}return(pe.prefix||"")+Ve+(pe.suffix||"")},x.toFraction=function($){var le,pe,Ve,Fe,je,Ye,Le,ze,We,be,Ke,ye,ue=this,gt=ue.c;if($!=null&&(Le=new ne($),!Le.isInteger()&&(Le.c||Le.s!==1)||Le.lt(T)))throw Error(ns+"Argument "+(Le.isInteger()?"out of range: ":"not an integer: ")+ht(Le));if(!gt)return new ne(ue);for(le=new ne(T),We=pe=new ne(T),Ve=ze=new ne(T),ye=ra(gt),je=le.e=ye.length-ue.e-1,le.c[0]=Wv[(Ye=je%Sn)<0?Sn+Ye:Ye],$=!$||Le.comparedTo(le)>0?je>0?le:We:Le,Ye=ge,ge=1/0,Le=new ne(ye),ze.c[0]=0;be=i(Le,le,0,1),Fe=pe.plus(be.times(Ve)),Fe.comparedTo($)!=1;)pe=Ve,Ve=Fe,We=ze.plus(be.times(Fe=We)),ze=Fe,le=Le.minus(be.times(Fe=le)),Le=Fe;return Fe=i($.minus(pe),Ve,0,1),ze=ze.plus(Fe.times(We)),pe=pe.plus(Fe.times(Ve)),ze.s=We.s=ue.s,je=je*2,Ke=i(We,Ve,je,u).minus(ue).abs().comparedTo(i(ze,pe,je,u).minus(ue).abs())<1?[We,Ve]:[ze,pe],ge=Ye,Ke},x.toNumber=function(){return+ht(this)},x.toPrecision=function($,le){return $!=null&&Wr($,1,Ai),Te(this,$,le,2)},x.toString=function($){var le,pe=this,Ve=pe.s,Fe=pe.e;return Fe===null?Ve?(le="Infinity",Ve<0&&(le="-"+le)):le="NaN":($==null?le=Fe<=j||Fe>=Z?H_(ra(pe.c),Fe):Tu(ra(pe.c),Fe,"0"):$===10&&Ie?(pe=ct(new ne(pe),b+Fe+1,u),le=Tu(ra(pe.c),pe.e,"0")):(Wr($,2,xt.length,"Base"),le=a(Tu(ra(pe.c),Fe,"0"),10,$,Ve,!0)),Ve<0&&pe.c[0]&&(le="-"+le)),le},x.valueOf=x.toJSON=function(){return ht(this)},x._isBigNumber=!0,x[Symbol.toStringTag]="BigNumber",x[Symbol.for("nodejs.util.inspect.custom")]=x.valueOf,n!=null&&ne.set(n),ne}function sa(n){var i=n|0;return n>0||n===i?i:i-1}function ra(n){for(var i,a,f=1,x=n.length,T=n[0]+"";f<x;){for(i=n[f++]+"",a=Sn-i.length;a--;i="0"+i);T+=i}for(x=T.length;T.charCodeAt(--x)===48;);return T.slice(0,x+1||1)}function od(n,i){var a,f,x=n.c,T=i.c,b=n.s,u=i.s,j=n.e,Z=i.e;if(!b||!u)return null;if(a=x&&!x[0],f=T&&!T[0],a||f)return a?f?0:-u:b;if(b!=u)return b;if(a=b<0,f=j==Z,!x||!T)return f?0:!x^a?1:-1;if(!f)return j>Z^a?1:-1;for(u=(j=x.length)<(Z=T.length)?j:Z,b=0;b<u;b++)if(x[b]!=T[b])return x[b]>T[b]^a?1:-1;return j==Z?0:j>Z^a?1:-1}function Wr(n,i,a,f){if(n<i||n>a||n!==oa(n))throw Error(ns+(f||"Argument")+(typeof n=="number"?n<i||n>a?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function W_(n){var i=n.c.length-1;return sa(n.e/Sn)==i&&n.c[i]%2!=0}function H_(n,i){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(i<0?"e":"e+")+i}function Tu(n,i,a){var f,x;if(i<0){for(x=a+".";++i;x+=a);n=x+n}else if(f=n.length,++i>f){for(x=a,i-=f;--i;x+=a);n+=x}else i<f&&(n=n.slice(0,i)+"."+n.slice(i));return n}var Rl=vT(),EM=class{constructor(n){Qt(this,"key");Qt(this,"left",null);Qt(this,"right",null);this.key=n}},bm=class extends EM{constructor(n){super(n)}},MM=class{constructor(){Qt(this,"size",0);Qt(this,"modificationCount",0);Qt(this,"splayCount",0)}splay(n){const i=this.root;if(i==null)return this.compare(n,n),-1;let a=null,f=null,x=null,T=null,b=i;const u=this.compare;let j;for(;;)if(j=u(b.key,n),j>0){let Z=b.left;if(Z==null||(j=u(Z.key,n),j>0&&(b.left=Z.right,Z.right=b,b=Z,Z=b.left,Z==null)))break;a==null?f=b:a.left=b,a=b,b=Z}else if(j<0){let Z=b.right;if(Z==null||(j=u(Z.key,n),j<0&&(b.right=Z.left,Z.left=b,b=Z,Z=b.right,Z==null)))break;x==null?T=b:x.right=b,x=b,b=Z}else break;return x!=null&&(x.right=b.left,b.left=T),a!=null&&(a.left=b.right,b.right=f),this.root!==b&&(this.root=b,this.splayCount++),j}splayMin(n){let i=n,a=i.left;for(;a!=null;){const f=a;i.left=f.right,f.right=i,i=f,a=i.left}return i}splayMax(n){let i=n,a=i.right;for(;a!=null;){const f=a;i.right=f.left,f.left=i,i=f,a=i.right}return i}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let a=this.root;const f=a,x=a.left;if(this.size--,x==null)this.root=a.right;else{const T=a.right;a=this.splayMax(x),a.right=T,this.root=a}return this.modificationCount++,f}addNewRoot(n,i){this.size++,this.modificationCount++;const a=this.root;if(a==null){this.root=n;return}i<0?(n.left=a,n.right=a.right,a.right=null):(n.right=a,n.left=a.left,a.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,i)=>n<i?-1:n>i?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},Xb,Kb,Fy=class Mm extends MM{constructor(a,f){super();Qt(this,"root",null);Qt(this,"compare");Qt(this,"validKey");Qt(this,Xb,"[object Set]");this.compare=a??this.defaultCompare(),this.validKey=f??(x=>x!=null&&x!=null)}delete(a){return this.validKey(a)?this._delete(a)!=null:!1}deleteAll(a){for(const f of a)this.delete(f)}forEach(a){const f=this[Symbol.iterator]();let x;for(;x=f.next(),!x.done;)a(x.value,x.value,this)}add(a){const f=this.splay(a);return f!=0&&this.addNewRoot(new bm(a),f),this}addAndReturn(a){const f=this.splay(a);return f!=0&&this.addNewRoot(new bm(a),f),this.root.key}addAll(a){for(const f of a)this.add(f)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(a){if(a==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(a)<0)return this.root.key;let x=this.root.left;if(x==null)return null;let T=x.right;for(;T!=null;)x=T,T=x.right;return x.key}firstAfter(a){if(a==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(a)>0)return this.root.key;let x=this.root.right;if(x==null)return null;let T=x.left;for(;T!=null;)x=T,T=x.left;return x.key}retainAll(a){const f=new Mm(this.compare,this.validKey),x=this.modificationCount;for(const T of a){if(x!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(T)&&this.splay(T)==0&&f.add(this.root.key)}f.size!=this.size&&(this.root=f.root,this.size=f.size,this.modificationCount++)}lookup(a){return!this.validKey(a)||this.splay(a)!=0?null:this.root.key}intersection(a){const f=new Mm(this.compare,this.validKey);for(const x of this)a.has(x)&&f.add(x);return f}difference(a){const f=new Mm(this.compare,this.validKey);for(const x of this)a.has(x)||f.add(x);return f}union(a){const f=this.clone();return f.addAll(a),f}clone(){const a=new Mm(this.compare,this.validKey);return a.size=this.size,a.root=this.copyNode(this.root),a}copyNode(a){if(a==null)return null;function f(T,b){let u,j;do{if(u=T.left,j=T.right,u!=null){const Z=new bm(u.key);b.left=Z,f(u,Z)}if(j!=null){const Z=new bm(j.key);b.right=Z,T=j,b=Z}}while(j!=null)}const x=new bm(a.key);return f(a,x),x}toSet(){return this.clone()}entries(){return new kM(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Kb=Symbol.iterator,Xb=Symbol.toStringTag,Kb)](){return new IM(this.wrap())}},xT=class{constructor(n){Qt(this,"tree");Qt(this,"path",new Array);Qt(this,"modificationCount",null);Qt(this,"splayCount");this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let a=this.tree.getRoot();for(;a!=null;)this.path.push(a),a=a.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],i=n.right;if(i!=null){for(;i!=null;)this.path.push(i),i=i.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},IM=class extends xT{getValue(n){return n.key}},kM=class extends xT{getValue(n){return[n.key,n.key]}},wT=n=>()=>n,qx=n=>{const i=n?(a,f)=>f.minus(a).abs().isLessThanOrEqualTo(n):wT(!1);return(a,f)=>i(a,f)?0:a.comparedTo(f)};function AM(n){const i=n?(a,f,x,T,b)=>a.exponentiatedBy(2).isLessThanOrEqualTo(T.minus(f).exponentiatedBy(2).plus(b.minus(x).exponentiatedBy(2)).times(n)):wT(!1);return(a,f,x)=>{const T=a.x,b=a.y,u=x.x,j=x.y,Z=b.minus(j).times(f.x.minus(u)).minus(T.minus(u).times(f.y.minus(j)));return i(Z,T,b,u,j)?0:Z.comparedTo(0)}}var zM=n=>n,RM=n=>{if(n){const i=new Fy(qx(n)),a=new Fy(qx(n)),f=(T,b)=>b.addAndReturn(T),x=T=>({x:f(T.x,i),y:f(T.y,a)});return x({x:new Rl(0),y:new Rl(0)}),x}return zM},Wx=n=>({set:i=>{Lu=Wx(i)},reset:()=>Wx(n),compare:qx(n),snap:RM(n),orient:AM(n)}),Lu=Wx(),Sm=(n,i)=>n.ll.x.isLessThanOrEqualTo(i.x)&&i.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(i.y)&&i.y.isLessThanOrEqualTo(n.ur.y),Hx=(n,i)=>{if(i.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(i.ll.x)||i.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(i.ll.y))return null;const a=n.ll.x.isLessThan(i.ll.x)?i.ll.x:n.ll.x,f=n.ur.x.isLessThan(i.ur.x)?n.ur.x:i.ur.x,x=n.ll.y.isLessThan(i.ll.y)?i.ll.y:n.ll.y,T=n.ur.y.isLessThan(i.ur.y)?n.ur.y:i.ur.y;return{ll:{x:a,y:x},ur:{x:f,y:T}}},uy=(n,i)=>n.x.times(i.y).minus(n.y.times(i.x)),bT=(n,i)=>n.x.times(i.x).plus(n.y.times(i.y)),By=n=>bT(n,n).sqrt(),LM=(n,i,a)=>{const f={x:i.x.minus(n.x),y:i.y.minus(n.y)},x={x:a.x.minus(n.x),y:a.y.minus(n.y)};return uy(x,f).div(By(x)).div(By(f))},DM=(n,i,a)=>{const f={x:i.x.minus(n.x),y:i.y.minus(n.y)},x={x:a.x.minus(n.x),y:a.y.minus(n.y)};return bT(x,f).div(By(x)).div(By(f))},Tb=(n,i,a)=>i.y.isZero()?null:{x:n.x.plus(i.x.div(i.y).times(a.minus(n.y))),y:a},Cb=(n,i,a)=>i.x.isZero()?null:{x:a,y:n.y.plus(i.y.div(i.x).times(a.minus(n.x)))},FM=(n,i,a,f)=>{if(i.x.isZero())return Cb(a,f,n.x);if(f.x.isZero())return Cb(n,i,a.x);if(i.y.isZero())return Tb(a,f,n.y);if(f.y.isZero())return Tb(n,i,a.y);const x=uy(i,f);if(x.isZero())return null;const T={x:a.x.minus(n.x),y:a.y.minus(n.y)},b=uy(T,i).div(x),u=uy(T,f).div(x),j=n.x.plus(u.times(i.x)),Z=a.x.plus(b.times(f.x)),me=n.y.plus(u.times(i.y)),ge=a.y.plus(b.times(f.y)),fe=j.plus(Z).div(2),oe=me.plus(ge).div(2);return{x:fe,y:oe}},Al=class ST{constructor(i,a){Qt(this,"point");Qt(this,"isLeft");Qt(this,"segment");Qt(this,"otherSE");Qt(this,"consumedBy");i.events===void 0?i.events=[this]:i.events.push(this),this.point=i,this.isLeft=a}static compare(i,a){const f=ST.comparePoints(i.point,a.point);return f!==0?f:(i.point!==a.point&&i.link(a),i.isLeft!==a.isLeft?i.isLeft?1:-1:Oy.compare(i.segment,a.segment))}static comparePoints(i,a){return i.x.isLessThan(a.x)?-1:i.x.isGreaterThan(a.x)?1:i.y.isLessThan(a.y)?-1:i.y.isGreaterThan(a.y)?1:0}link(i){if(i.point===this.point)throw new Error("Tried to link already linked events");const a=i.point.events;for(let f=0,x=a.length;f<x;f++){const T=a[f];this.point.events.push(T),T.point=this.point}this.checkForConsuming()}checkForConsuming(){const i=this.point.events.length;for(let a=0;a<i;a++){const f=this.point.events[a];if(f.segment.consumedBy===void 0)for(let x=a+1;x<i;x++){const T=this.point.events[x];T.consumedBy===void 0&&f.otherSE.point.events===T.otherSE.point.events&&f.segment.consume(T.segment)}}}getAvailableLinkedEvents(){const i=[];for(let a=0,f=this.point.events.length;a<f;a++){const x=this.point.events[a];x!==this&&!x.segment.ringOut&&x.segment.isInResult()&&i.push(x)}return i}getLeftmostComparator(i){const a=new Map,f=x=>{const T=x.otherSE;a.set(x,{sine:LM(this.point,i.point,T.point),cosine:DM(this.point,i.point,T.point)})};return(x,T)=>{a.has(x)||f(x),a.has(T)||f(T);const{sine:b,cosine:u}=a.get(x),{sine:j,cosine:Z}=a.get(T);return b.isGreaterThanOrEqualTo(0)&&j.isGreaterThanOrEqualTo(0)?u.isLessThan(Z)?1:u.isGreaterThan(Z)?-1:0:b.isLessThan(0)&&j.isLessThan(0)?u.isLessThan(Z)?-1:u.isGreaterThan(Z)?1:0:j.isLessThan(b)?-1:j.isGreaterThan(b)?1:0}}},BM=class Yx{constructor(i){Qt(this,"events");Qt(this,"poly");Qt(this,"_isExteriorRing");Qt(this,"_enclosingRing");this.events=i;for(let a=0,f=i.length;a<f;a++)i[a].segment.ringOut=this;this.poly=null}static factory(i){const a=[];for(let f=0,x=i.length;f<x;f++){const T=i[f];if(!T.isInResult()||T.ringOut)continue;let b=null,u=T.leftSE,j=T.rightSE;const Z=[u],me=u.point,ge=[];for(;b=u,u=j,Z.push(u),u.point!==me;)for(;;){const fe=u.getAvailableLinkedEvents();if(fe.length===0){const _t=Z[0].point,xt=Z[Z.length-1].point;throw new Error(`Unable to complete output ring starting at [${_t.x}, ${_t.y}]. Last matching segment found ends at [${xt.x}, ${xt.y}].`)}if(fe.length===1){j=fe[0].otherSE;break}let oe=null;for(let _t=0,xt=ge.length;_t<xt;_t++)if(ge[_t].point===u.point){oe=_t;break}if(oe!==null){const _t=ge.splice(oe)[0],xt=Z.splice(_t.index);xt.unshift(xt[0].otherSE),a.push(new Yx(xt.reverse()));continue}ge.push({index:Z.length,point:u.point});const Be=u.getLeftmostComparator(b);j=fe.sort(Be)[0].otherSE;break}a.push(new Yx(Z))}return a}getGeom(){let i=this.events[0].point;const a=[i];for(let Z=1,me=this.events.length-1;Z<me;Z++){const ge=this.events[Z].point,fe=this.events[Z+1].point;Lu.orient(ge,i,fe)!==0&&(a.push(ge),i=ge)}if(a.length===1)return null;const f=a[0],x=a[1];Lu.orient(f,i,x)===0&&a.shift(),a.push(a[0]);const T=this.isExteriorRing()?1:-1,b=this.isExteriorRing()?0:a.length-1,u=this.isExteriorRing()?a.length:-1,j=[];for(let Z=b;Z!=u;Z+=T)j.push([a[Z].x.toNumber(),a[Z].y.toNumber()]);return j}isExteriorRing(){if(this._isExteriorRing===void 0){const i=this.enclosingRing();this._isExteriorRing=i?!i.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var x,T;let i=this.events[0];for(let b=1,u=this.events.length;b<u;b++){const j=this.events[b];Al.compare(i,j)>0&&(i=j)}let a=i.segment.prevInResult(),f=a?a.prevInResult():null;for(;;){if(!a)return null;if(!f)return a.ringOut;if(f.ringOut!==a.ringOut)return((x=f.ringOut)==null?void 0:x.enclosingRing())!==a.ringOut?a.ringOut:(T=a.ringOut)==null?void 0:T.enclosingRing();a=f.prevInResult(),f=a?a.prevInResult():null}}},Pb=class{constructor(n){Qt(this,"exteriorRing");Qt(this,"interiorRings");this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const i=[n];for(let a=0,f=this.interiorRings.length;a<f;a++){const x=this.interiorRings[a].getGeom();x!==null&&i.push(x)}return i}},OM=class{constructor(n){Qt(this,"rings");Qt(this,"polys");this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let i=0,a=this.polys.length;i<a;i++){const f=this.polys[i].getGeom();f!==null&&n.push(f)}return n}_composePolys(n){var a;const i=[];for(let f=0,x=n.length;f<x;f++){const T=n[f];if(!T.poly)if(T.isExteriorRing())i.push(new Pb(T));else{const b=T.enclosingRing();b!=null&&b.poly||i.push(new Pb(b)),(a=b==null?void 0:b.poly)==null||a.addInterior(T)}}return i}},NM=class{constructor(n,i=Oy.compare){Qt(this,"queue");Qt(this,"tree");Qt(this,"segments");this.queue=n,this.tree=new Fy(i),this.segments=[]}process(n){const i=n.segment,a=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(i),a;n.isLeft&&this.tree.add(i);let f=i,x=i;do f=this.tree.lastBefore(f);while(f!=null&&f.consumedBy!=null);do x=this.tree.firstAfter(x);while(x!=null&&x.consumedBy!=null);if(n.isLeft){let T=null;if(f){const u=f.getIntersection(i);if(u!==null&&(i.isAnEndpoint(u)||(T=u),!f.isAnEndpoint(u))){const j=this._splitSafely(f,u);for(let Z=0,me=j.length;Z<me;Z++)a.push(j[Z])}}let b=null;if(x){const u=x.getIntersection(i);if(u!==null&&(i.isAnEndpoint(u)||(b=u),!x.isAnEndpoint(u))){const j=this._splitSafely(x,u);for(let Z=0,me=j.length;Z<me;Z++)a.push(j[Z])}}if(T!==null||b!==null){let u=null;T===null?u=b:b===null?u=T:u=Al.comparePoints(T,b)<=0?T:b,this.queue.delete(i.rightSE),a.push(i.rightSE);const j=i.split(u);for(let Z=0,me=j.length;Z<me;Z++)a.push(j[Z])}a.length>0?(this.tree.delete(i),a.push(n)):(this.segments.push(i),i.prev=f)}else{if(f&&x){const T=f.getIntersection(x);if(T!==null){if(!f.isAnEndpoint(T)){const b=this._splitSafely(f,T);for(let u=0,j=b.length;u<j;u++)a.push(b[u])}if(!x.isAnEndpoint(T)){const b=this._splitSafely(x,T);for(let u=0,j=b.length;u<j;u++)a.push(b[u])}}}this.tree.delete(i)}return a}_splitSafely(n,i){this.tree.delete(n);const a=n.rightSE;this.queue.delete(a);const f=n.split(i);return f.push(a),n.consumedBy===void 0&&this.tree.add(n),f}},jM=class{constructor(){Qt(this,"type");Qt(this,"numMultiPolys")}run(n,i,a){Im.type=n;const f=[new Mb(i,!0)];for(let Z=0,me=a.length;Z<me;Z++)f.push(new Mb(a[Z],!1));if(Im.numMultiPolys=f.length,Im.type==="difference"){const Z=f[0];let me=1;for(;me<f.length;)Hx(f[me].bbox,Z.bbox)!==null?me++:f.splice(me,1)}if(Im.type==="intersection")for(let Z=0,me=f.length;Z<me;Z++){const ge=f[Z];for(let fe=Z+1,oe=f.length;fe<oe;fe++)if(Hx(ge.bbox,f[fe].bbox)===null)return[]}const x=new Fy(Al.compare);for(let Z=0,me=f.length;Z<me;Z++){const ge=f[Z].getSweepEvents();for(let fe=0,oe=ge.length;fe<oe;fe++)x.add(ge[fe])}const T=new NM(x);let b=null;for(x.size!=0&&(b=x.first(),x.delete(b));b;){const Z=T.process(b);for(let me=0,ge=Z.length;me<ge;me++){const fe=Z[me];fe.consumedBy===void 0&&x.add(fe)}x.size!=0?(b=x.first(),x.delete(b)):b=null}Lu.reset();const u=BM.factory(T.segments);return new OM(u).getGeom()}},Im=new jM,Xx=Im,UM=0,Oy=class cy{constructor(i,a,f,x){Qt(this,"id");Qt(this,"leftSE");Qt(this,"rightSE");Qt(this,"rings");Qt(this,"windings");Qt(this,"ringOut");Qt(this,"consumedBy");Qt(this,"prev");Qt(this,"_prevInResult");Qt(this,"_beforeState");Qt(this,"_afterState");Qt(this,"_isInResult");this.id=++UM,this.leftSE=i,i.segment=this,i.otherSE=a,this.rightSE=a,a.segment=this,a.otherSE=i,this.rings=f,this.windings=x}static compare(i,a){const f=i.leftSE.point.x,x=a.leftSE.point.x,T=i.rightSE.point.x,b=a.rightSE.point.x;if(b.isLessThan(f))return 1;if(T.isLessThan(x))return-1;const u=i.leftSE.point.y,j=a.leftSE.point.y,Z=i.rightSE.point.y,me=a.rightSE.point.y;if(f.isLessThan(x)){if(j.isLessThan(u)&&j.isLessThan(Z))return 1;if(j.isGreaterThan(u)&&j.isGreaterThan(Z))return-1;const ge=i.comparePoint(a.leftSE.point);if(ge<0)return 1;if(ge>0)return-1;const fe=a.comparePoint(i.rightSE.point);return fe!==0?fe:-1}if(f.isGreaterThan(x)){if(u.isLessThan(j)&&u.isLessThan(me))return-1;if(u.isGreaterThan(j)&&u.isGreaterThan(me))return 1;const ge=a.comparePoint(i.leftSE.point);if(ge!==0)return ge;const fe=i.comparePoint(a.rightSE.point);return fe<0?1:fe>0?-1:1}if(u.isLessThan(j))return-1;if(u.isGreaterThan(j))return 1;if(T.isLessThan(b)){const ge=a.comparePoint(i.rightSE.point);if(ge!==0)return ge}if(T.isGreaterThan(b)){const ge=i.comparePoint(a.rightSE.point);if(ge<0)return 1;if(ge>0)return-1}if(!T.eq(b)){const ge=Z.minus(u),fe=T.minus(f),oe=me.minus(j),Be=b.minus(x);if(ge.isGreaterThan(fe)&&oe.isLessThan(Be))return 1;if(ge.isLessThan(fe)&&oe.isGreaterThan(Be))return-1}return T.isGreaterThan(b)?1:T.isLessThan(b)||Z.isLessThan(me)?-1:Z.isGreaterThan(me)?1:i.id<a.id?-1:i.id>a.id?1:0}static fromRing(i,a,f){let x,T,b;const u=Al.comparePoints(i,a);if(u<0)x=i,T=a,b=1;else if(u>0)x=a,T=i,b=-1;else throw new Error(`Tried to create degenerate segment at [${i.x}, ${i.y}]`);const j=new Al(x,!0),Z=new Al(T,!1);return new cy(j,Z,[f],[b])}replaceRightSE(i){this.rightSE=i,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const i=this.leftSE.point.y,a=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:i.isLessThan(a)?i:a},ur:{x:this.rightSE.point.x,y:i.isGreaterThan(a)?i:a}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(i){return i.x.eq(this.leftSE.point.x)&&i.y.eq(this.leftSE.point.y)||i.x.eq(this.rightSE.point.x)&&i.y.eq(this.rightSE.point.y)}comparePoint(i){return Lu.orient(this.leftSE.point,i,this.rightSE.point)}getIntersection(i){const a=this.bbox(),f=i.bbox(),x=Hx(a,f);if(x===null)return null;const T=this.leftSE.point,b=this.rightSE.point,u=i.leftSE.point,j=i.rightSE.point,Z=Sm(a,u)&&this.comparePoint(u)===0,me=Sm(f,T)&&i.comparePoint(T)===0,ge=Sm(a,j)&&this.comparePoint(j)===0,fe=Sm(f,b)&&i.comparePoint(b)===0;if(me&&Z)return fe&&!ge?b:!fe&&ge?j:null;if(me)return ge&&T.x.eq(j.x)&&T.y.eq(j.y)?null:T;if(Z)return fe&&b.x.eq(u.x)&&b.y.eq(u.y)?null:u;if(fe&&ge)return null;if(fe)return b;if(ge)return j;const oe=FM(T,this.vector(),u,i.vector());return oe===null||!Sm(x,oe)?null:Lu.snap(oe)}split(i){const a=[],f=i.events!==void 0,x=new Al(i,!0),T=new Al(i,!1),b=this.rightSE;this.replaceRightSE(T),a.push(T),a.push(x);const u=new cy(x,b,this.rings.slice(),this.windings.slice());return Al.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Al.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),f&&(x.checkForConsuming(),T.checkForConsuming()),a}swapEvents(){const i=this.rightSE;this.rightSE=this.leftSE,this.leftSE=i,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let a=0,f=this.windings.length;a<f;a++)this.windings[a]*=-1}consume(i){let a=this,f=i;for(;a.consumedBy;)a=a.consumedBy;for(;f.consumedBy;)f=f.consumedBy;const x=cy.compare(a,f);if(x!==0){if(x>0){const T=a;a=f,f=T}if(a.prev===f){const T=a;a=f,f=T}for(let T=0,b=f.rings.length;T<b;T++){const u=f.rings[T],j=f.windings[T],Z=a.rings.indexOf(u);Z===-1?(a.rings.push(u),a.windings.push(j)):a.windings[Z]+=j}f.rings=null,f.windings=null,f.consumedBy=a,f.leftSE.consumedBy=a.leftSE,f.rightSE.consumedBy=a.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const i=this.prev.consumedBy||this.prev;this._beforeState=i.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const i=this.beforeState();this._afterState={rings:i.rings.slice(0),windings:i.windings.slice(0),multiPolys:[]};const a=this._afterState.rings,f=this._afterState.windings,x=this._afterState.multiPolys;for(let u=0,j=this.rings.length;u<j;u++){const Z=this.rings[u],me=this.windings[u],ge=a.indexOf(Z);ge===-1?(a.push(Z),f.push(me)):f[ge]+=me}const T=[],b=[];for(let u=0,j=a.length;u<j;u++){if(f[u]===0)continue;const Z=a[u],me=Z.poly;if(b.indexOf(me)===-1)if(Z.isExterior)T.push(me);else{b.indexOf(me)===-1&&b.push(me);const ge=T.indexOf(Z.poly);ge!==-1&&T.splice(ge,1)}}for(let u=0,j=T.length;u<j;u++){const Z=T[u].multiPoly;x.indexOf(Z)===-1&&x.push(Z)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const i=this.beforeState().multiPolys,a=this.afterState().multiPolys;switch(Xx.type){case"union":{const f=i.length===0,x=a.length===0;this._isInResult=f!==x;break}case"intersection":{let f,x;i.length<a.length?(f=i.length,x=a.length):(f=a.length,x=i.length),this._isInResult=x===Xx.numMultiPolys&&f<x;break}case"xor":{const f=Math.abs(i.length-a.length);this._isInResult=f%2===1;break}case"difference":{const f=x=>x.length===1&&x[0].isSubject;this._isInResult=f(i)!==f(a);break}}return this._isInResult}},Eb=class{constructor(n,i,a){Qt(this,"poly");Qt(this,"isExterior");Qt(this,"segments");Qt(this,"bbox");if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=a,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const f=Lu.snap({x:new Rl(n[0][0]),y:new Rl(n[0][1])});this.bbox={ll:{x:f.x,y:f.y},ur:{x:f.x,y:f.y}};let x=f;for(let T=1,b=n.length;T<b;T++){if(typeof n[T][0]!="number"||typeof n[T][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const u=Lu.snap({x:new Rl(n[T][0]),y:new Rl(n[T][1])});u.x.eq(x.x)&&u.y.eq(x.y)||(this.segments.push(Oy.fromRing(x,u,this)),u.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.x),u.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.y),u.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.x),u.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.y),x=u)}(!f.x.eq(x.x)||!f.y.eq(x.y))&&this.segments.push(Oy.fromRing(x,f,this))}getSweepEvents(){const n=[];for(let i=0,a=this.segments.length;i<a;i++){const f=this.segments[i];n.push(f.leftSE),n.push(f.rightSE)}return n}},VM=class{constructor(n,i){Qt(this,"multiPoly");Qt(this,"exteriorRing");Qt(this,"interiorRings");Qt(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Eb(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let a=1,f=n.length;a<f;a++){const x=new Eb(n[a],this,!1);x.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=x.bbox.ll.x),x.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=x.bbox.ll.y),x.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=x.bbox.ur.x),x.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=x.bbox.ur.y),this.interiorRings.push(x)}this.multiPoly=i}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let i=0,a=this.interiorRings.length;i<a;i++){const f=this.interiorRings[i].getSweepEvents();for(let x=0,T=f.length;x<T;x++)n.push(f[x])}return n}},Mb=class{constructor(n,i){Qt(this,"isSubject");Qt(this,"polys");Qt(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Rl(Number.POSITIVE_INFINITY),y:new Rl(Number.POSITIVE_INFINITY)},ur:{x:new Rl(Number.NEGATIVE_INFINITY),y:new Rl(Number.NEGATIVE_INFINITY)}};for(let a=0,f=n.length;a<f;a++){const x=new VM(n[a],this);x.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=x.bbox.ll.x),x.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=x.bbox.ll.y),x.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=x.bbox.ur.x),x.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=x.bbox.ur.y),this.polys.push(x)}this.isSubject=i}getSweepEvents(){const n=[];for(let i=0,a=this.polys.length;i<a;i++){const f=this.polys[i].getSweepEvents();for(let x=0,T=f.length;x<T;x++)n.push(f[x])}return n}},GM=(n,...i)=>Xx.run("union",n,i);Lu.set;function $M(n,i={}){const a=[];if(TM(n,x=>{a.push(x.coordinates)}),a.length<2)throw new Error("Must have at least 2 geometries");const f=GM(a[0],...a.slice(1));return f.length===0?null:f.length===1?bM(f[0],i.properties):_T(f,i.properties)}var Ny={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Ny.exports;(function(n,i){(function(){var a,f="4.17.21",x=200,T="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",b="Expected a function",u="Invalid `variable` option passed into `_.template`",j="__lodash_hash_undefined__",Z=500,me="__lodash_placeholder__",ge=1,fe=2,oe=4,Be=1,_t=2,xt=1,Ie=2,ne=4,Te=8,Ne=16,ut=32,ct=64,ht=128,$=256,le=512,pe=30,Ve="...",Fe=800,je=16,Ye=1,Le=2,ze=3,We=1/0,be=9007199254740991,Ke=17976931348623157e292,ye=NaN,ue=4294967295,gt=ue-1,At=ue>>>1,Lt=[["ary",ht],["bind",xt],["bindKey",Ie],["curry",Te],["curryRight",Ne],["flip",le],["partial",ut],["partialRight",ct],["rearg",$]],bt="[object Arguments]",zt="[object Array]",Ft="[object AsyncFunction]",Kt="[object Boolean]",on="[object Date]",Dn="[object DOMException]",Ht="[object Error]",tn="[object Function]",gn="[object GeneratorFunction]",Rt="[object Map]",rn="[object Number]",Fr="[object Null]",Un="[object Object]",Br="[object Promise]",hi="[object Proxy]",Kn="[object RegExp]",Or="[object Set]",Di="[object String]",Fi="[object Symbol]",Fs="[object Undefined]",Bi="[object WeakMap]",eo="[object WeakSet]",Oi="[object ArrayBuffer]",di="[object DataView]",to="[object Float32Array]",Ni="[object Float64Array]",no="[object Int8Array]",Oo="[object Int16Array]",ls="[object Int32Array]",No="[object Uint8Array]",te="[object Uint8ClampedArray]",W="[object Uint16Array]",Y="[object Uint32Array]",K=/\b__p \+= '';/g,he=/\b(__p \+=) '' \+/g,Pe=/(__e\(.*?\)|\b__t\)) \+\n'';/g,De=/&(?:amp|lt|gt|quot|#39);/g,He=/[&<>"']/g,Re=RegExp(De.source),rt=RegExp(He.source),et=/<%-([\s\S]+?)%>/g,Ue=/<%([\s\S]+?)%>/g,ke=/<%=([\s\S]+?)%>/g,Pt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ct=/^\w*$/,Wt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jt=/[\\^$.*+?()[\]{}|]/g,ot=RegExp(Jt.source),Mt=/^\s+/,Ot=/\s/,fn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,En=/\{\n\/\* \[wrapped with (.+)\] \*/,Yt=/,? & /,Dt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,_r=/[()=,{}\[\]\/\s]/,Bs=/\\(\\)?/g,Nr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Sr=/\w*$/,ir=/^[-+]0x[0-9a-f]+$/i,ji=/^0b[01]+$/i,or=/^\[object .+?Constructor\]$/,Bl=/^0o[0-7]+$/i,Ja=/^(?:0|[1-9]\d*)$/,ph=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,jo=/($^)/,pa=/['\n\r\u2028\u2029\\]/g,Ol="\\ud800-\\udfff",fh="\\u0300-\\u036f",Td="\\ufe20-\\ufe2f",Qa="\\u20d0-\\u20ff",mh=fh+Td+Qa,Cd="\\u2700-\\u27bf",Pd="a-z\\xdf-\\xf6\\xf8-\\xff",df="\\xac\\xb1\\xd7\\xf7",Ed="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",gh="\\u2000-\\u206f",fa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Bu="A-Z\\xc0-\\xd6\\xd8-\\xde",_h="\\ufe0e\\ufe0f",Os=df+Ed+gh+fa,Nl="[']",Ou="["+Ol+"]",yh="["+Os+"]",Uo="["+mh+"]",Nu="\\d+",Vo="["+Cd+"]",hn="["+Pd+"]",bo="[^"+Ol+Os+Nu+Cd+Pd+Bu+"]",dn="\\ud83c[\\udffb-\\udfff]",ju="(?:"+Uo+"|"+dn+")",vh="[^"+Ol+"]",ma="(?:\\ud83c[\\udde6-\\uddff]){2}",hr="[\\ud800-\\udbff][\\udc00-\\udfff]",dr="["+Bu+"]",sr="\\u200d",Uu="(?:"+hn+"|"+bo+")",pi="(?:"+dr+"|"+bo+")",ri="(?:"+Nl+"(?:d|ll|m|re|s|t|ve))?",ii="(?:"+Nl+"(?:D|LL|M|RE|S|T|VE))?",Vu=ju+"?",Ns="["+_h+"]?",tr="(?:"+sr+"(?:"+[vh,ma,hr].join("|")+")"+Ns+Vu+")*",jl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Go="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",$o=Ns+Vu+tr,ro="(?:"+[Vo,ma,hr].join("|")+")"+$o,xh="(?:"+[vh+Uo+"?",Uo,ma,hr,Ou].join("|")+")",us=RegExp(Nl,"g"),Gu=RegExp(Uo,"g"),Jn=RegExp(dn+"(?="+dn+")|"+xh+$o,"g"),el=RegExp([dr+"?"+hn+"+"+ri+"(?="+[yh,dr,"$"].join("|")+")",pi+"+"+ii+"(?="+[yh,dr+Uu,"$"].join("|")+")",dr+"?"+Uu+"+"+ri,dr+"+"+ii,Go,jl,Nu,ro].join("|"),"g"),Cn=RegExp("["+sr+Ol+mh+_h+"]"),cn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ul=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Mn=-1,Gn={};Gn[to]=Gn[Ni]=Gn[no]=Gn[Oo]=Gn[ls]=Gn[No]=Gn[te]=Gn[W]=Gn[Y]=!0,Gn[bt]=Gn[zt]=Gn[Oi]=Gn[Kt]=Gn[di]=Gn[on]=Gn[Ht]=Gn[tn]=Gn[Rt]=Gn[rn]=Gn[Un]=Gn[Kn]=Gn[Or]=Gn[Di]=Gn[Bi]=!1;var In={};In[bt]=In[zt]=In[Oi]=In[di]=In[Kt]=In[on]=In[to]=In[Ni]=In[no]=In[Oo]=In[ls]=In[Rt]=In[rn]=In[Un]=In[Kn]=In[Or]=In[Di]=In[Fi]=In[No]=In[te]=In[W]=In[Y]=!0,In[Ht]=In[tn]=In[Bi]=!1;var Vl={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Gl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$l={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ga={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Md=parseFloat,wh=parseInt,$u=typeof Ap=="object"&&Ap&&Ap.Object===Object&&Ap,Id=typeof self=="object"&&self&&self.Object===Object&&self,Tr=$u||Id||Function("return this")(),$n=i&&!i.nodeType&&i,io=$n&&!0&&n&&!n.nodeType&&n,oo=io&&io.exports===$n,cs=oo&&$u.process,Zn=function(){try{var Oe=io&&io.require&&io.require("util").types;return Oe||cs&&cs.binding&&cs.binding("util")}catch{}}(),Zu=Zn&&Zn.isArrayBuffer,hs=Zn&&Zn.isDate,bh=Zn&&Zn.isMap,kd=Zn&&Zn.isRegExp,Zl=Zn&&Zn.isSet,qu=Zn&&Zn.isTypedArray;function Ui(Oe,st,tt){switch(tt.length){case 0:return Oe.call(st);case 1:return Oe.call(st,tt[0]);case 2:return Oe.call(st,tt[0],tt[1]);case 3:return Oe.call(st,tt[0],tt[1],tt[2])}return Oe.apply(st,tt)}function Wu(Oe,st,tt,Ut){for(var sn=-1,Pn=Oe==null?0:Oe.length;++sn<Pn;){var vr=Oe[sn];st(Ut,vr,tt(vr),Oe)}return Ut}function Kr(Oe,st){for(var tt=-1,Ut=Oe==null?0:Oe.length;++tt<Ut&&st(Oe[tt],tt,Oe)!==!1;);return Oe}function Vi(Oe,st){for(var tt=Oe==null?0:Oe.length;tt--&&st(Oe[tt],tt,Oe)!==!1;);return Oe}function tl(Oe,st){for(var tt=-1,Ut=Oe==null?0:Oe.length;++tt<Ut;)if(!st(Oe[tt],tt,Oe))return!1;return!0}function Gi(Oe,st){for(var tt=-1,Ut=Oe==null?0:Oe.length,sn=0,Pn=[];++tt<Ut;){var vr=Oe[tt];st(vr,tt,Oe)&&(Pn[sn++]=vr)}return Pn}function nl(Oe,st){var tt=Oe==null?0:Oe.length;return!!tt&&ol(Oe,st,0)>-1}function bi(Oe,st,tt){for(var Ut=-1,sn=Oe==null?0:Oe.length;++Ut<sn;)if(tt(st,Oe[Ut]))return!0;return!1}function pr(Oe,st){for(var tt=-1,Ut=Oe==null?0:Oe.length,sn=Array(Ut);++tt<Ut;)sn[tt]=st(Oe[tt],tt,Oe);return sn}function Zo(Oe,st){for(var tt=-1,Ut=st.length,sn=Oe.length;++tt<Ut;)Oe[sn+tt]=st[tt];return Oe}function _a(Oe,st,tt,Ut){var sn=-1,Pn=Oe==null?0:Oe.length;for(Ut&&Pn&&(tt=Oe[++sn]);++sn<Pn;)tt=st(tt,Oe[sn],sn,Oe);return tt}function ql(Oe,st,tt,Ut){var sn=Oe==null?0:Oe.length;for(Ut&&sn&&(tt=Oe[--sn]);sn--;)tt=st(tt,Oe[sn],sn,Oe);return tt}function rl(Oe,st){for(var tt=-1,Ut=Oe==null?0:Oe.length;++tt<Ut;)if(st(Oe[tt],tt,Oe))return!0;return!1}var Hu=Xu("length");function Ad(Oe){return Oe.split("")}function ya(Oe){return Oe.match(Dt)||[]}function zd(Oe,st,tt){var Ut;return tt(Oe,function(sn,Pn,vr){if(st(sn,Pn,vr))return Ut=Pn,!1}),Ut}function il(Oe,st,tt,Ut){for(var sn=Oe.length,Pn=tt+(Ut?1:-1);Ut?Pn--:++Pn<sn;)if(st(Oe[Pn],Pn,Oe))return Pn;return-1}function ol(Oe,st,tt){return st===st?pf(Oe,st,tt):il(Oe,Yu,tt)}function Rd(Oe,st,tt,Ut){for(var sn=tt-1,Pn=Oe.length;++sn<Pn;)if(Ut(Oe[sn],st))return sn;return-1}function Yu(Oe){return Oe!==Oe}function Sh(Oe,st){var tt=Oe==null?0:Oe.length;return tt?Ju(Oe,st)/tt:ye}function Xu(Oe){return function(st){return st==null?a:st[Oe]}}function Wl(Oe){return function(st){return Oe==null?a:Oe[st]}}function Ku(Oe,st,tt,Ut,sn){return sn(Oe,function(Pn,vr,qn){tt=Ut?(Ut=!1,Pn):st(tt,Pn,vr,qn)}),tt}function js(Oe,st){var tt=Oe.length;for(Oe.sort(st);tt--;)Oe[tt]=Oe[tt].value;return Oe}function Ju(Oe,st){for(var tt,Ut=-1,sn=Oe.length;++Ut<sn;){var Pn=st(Oe[Ut]);Pn!==a&&(tt=tt===a?Pn:tt+Pn)}return tt}function Qu(Oe,st){for(var tt=-1,Ut=Array(Oe);++tt<Oe;)Ut[tt]=st(tt);return Ut}function Hl(Oe,st){return pr(st,function(tt){return[tt,Oe[tt]]})}function ec(Oe){return Oe&&Oe.slice(0,Dd(Oe)+1).replace(Mt,"")}function fi(Oe){return function(st){return Oe(st)}}function Th(Oe,st){return pr(st,function(tt){return Oe[tt]})}function Yl(Oe,st){return Oe.has(st)}function tc(Oe,st){for(var tt=-1,Ut=Oe.length;++tt<Ut&&ol(st,Oe[tt],0)>-1;);return tt}function nc(Oe,st){for(var tt=Oe.length;tt--&&ol(st,Oe[tt],0)>-1;);return tt}function Ld(Oe,st){for(var tt=Oe.length,Ut=0;tt--;)Oe[tt]===st&&++Ut;return Ut}var Ch=Wl(Vl),Ph=Wl(Gl);function Xl(Oe){return"\\"+ga[Oe]}function ds(Oe,st){return Oe==null?a:Oe[st]}function Us(Oe){return Cn.test(Oe)}function Eh(Oe){return cn.test(Oe)}function rc(Oe){for(var st,tt=[];!(st=Oe.next()).done;)tt.push(st.value);return tt}function ic(Oe){var st=-1,tt=Array(Oe.size);return Oe.forEach(function(Ut,sn){tt[++st]=[sn,Ut]}),tt}function oc(Oe,st){return function(tt){return Oe(st(tt))}}function Si(Oe,st){for(var tt=-1,Ut=Oe.length,sn=0,Pn=[];++tt<Ut;){var vr=Oe[tt];(vr===st||vr===me)&&(Oe[tt]=me,Pn[sn++]=tt)}return Pn}function sl(Oe){var st=-1,tt=Array(Oe.size);return Oe.forEach(function(Ut){tt[++st]=Ut}),tt}function Fn(Oe){var st=-1,tt=Array(Oe.size);return Oe.forEach(function(Ut){tt[++st]=[Ut,Ut]}),tt}function pf(Oe,st,tt){for(var Ut=tt-1,sn=Oe.length;++Ut<sn;)if(Oe[Ut]===st)return Ut;return-1}function ff(Oe,st,tt){for(var Ut=tt+1;Ut--;)if(Oe[Ut]===st)return Ut;return Ut}function al(Oe){return Us(Oe)?sc(Oe):Hu(Oe)}function so(Oe){return Us(Oe)?ac(Oe):Ad(Oe)}function Dd(Oe){for(var st=Oe.length;st--&&Ot.test(Oe.charAt(st)););return st}var Fd=Wl($l);function sc(Oe){for(var st=Jn.lastIndex=0;Jn.test(Oe);)++st;return st}function ac(Oe){return Oe.match(Jn)||[]}function lc(Oe){return Oe.match(el)||[]}var Mh=function Oe(st){st=st==null?Tr:ao.defaults(Tr.Object(),st,ao.pick(Tr,Ul));var tt=st.Array,Ut=st.Date,sn=st.Error,Pn=st.Function,vr=st.Math,qn=st.Object,va=st.RegExp,uc=st.String,$i=st.TypeError,ps=tt.prototype,ll=Pn.prototype,xa=qn.prototype,ul=st["__core-js_shared__"],Tn=ll.toString,Bn=xa.hasOwnProperty,mf=0,Ih=function(){var h=/[^.]+$/.exec(ul&&ul.keys&&ul.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),Vs=xa.toString,kh=Tn.call(qn),gf=Tr._,Bd=va("^"+Tn.call(Bn).replace(Jt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cc=oo?st.Buffer:a,So=st.Symbol,wa=st.Uint8Array,Kl=cc?cc.allocUnsafe:a,fs=oc(qn.getPrototypeOf,qn),Jl=qn.create,Ah=xa.propertyIsEnumerable,ba=ps.splice,Ql=So?So.isConcatSpreadable:a,Sa=So?So.iterator:a,Ta=So?So.toStringTag:a,Ca=function(){try{var h=fu(qn,"defineProperty");return h({},"",{}),h}catch{}}(),Od=st.clearTimeout!==Tr.clearTimeout&&st.clearTimeout,Nd=Ut&&Ut.now!==Tr.Date.now&&Ut.now,hc=st.setTimeout!==Tr.setTimeout&&st.setTimeout,Pa=vr.ceil,cl=vr.floor,eu=qn.getOwnPropertySymbols,tu=cc?cc.isBuffer:a,hl=st.isFinite,zh=ps.join,dc=oc(qn.keys,qn),pn=vr.max,xr=vr.min,lo=Ut.now,Rh=st.parseInt,pc=vr.random,jd=ps.reverse,Gs=fu(st,"DataView"),qo=fu(st,"Map"),dl=fu(st,"Promise"),Wo=fu(st,"Set"),pl=fu(st,"WeakMap"),Ea=fu(qn,"create"),fl=pl&&new pl,Ma={},$s=yu(Gs),Lh=yu(qo),ml=yu(dl),Ud=yu(Wo),Vd=yu(pl),nu=So?So.prototype:a,gl=nu?nu.valueOf:a,Dh=nu?nu.toString:a;function X(h){if(ur(h)&&!mn(h)&&!(h instanceof _n)){if(h instanceof zn)return h;if(Bn.call(h,"__wrapped__"))return zf(h)}return new zn(h)}var To=function(){function h(){}return function(m){if(!Ir(m))return{};if(Jl)return Jl(m);h.prototype=m;var C=new h;return h.prototype=a,C}}();function Jr(){}function zn(h,m){this.__wrapped__=h,this.__actions__=[],this.__chain__=!!m,this.__index__=0,this.__values__=a}X.templateSettings={escape:et,evaluate:Ue,interpolate:ke,variable:"",imports:{_:X}},X.prototype=Jr.prototype,X.prototype.constructor=X,zn.prototype=To(Jr.prototype),zn.prototype.constructor=zn;function _n(h){this.__wrapped__=h,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ue,this.__views__=[]}function Co(){var h=new _n(this.__wrapped__);return h.__actions__=Er(this.__actions__),h.__dir__=this.__dir__,h.__filtered__=this.__filtered__,h.__iteratees__=Er(this.__iteratees__),h.__takeCount__=this.__takeCount__,h.__views__=Er(this.__views__),h}function _l(){if(this.__filtered__){var h=new _n(this);h.__dir__=-1,h.__filtered__=!0}else h=this.clone(),h.__dir__*=-1;return h}function _f(){var h=this.__wrapped__.value(),m=this.__dir__,C=mn(h),z=m<0,V=C?h.length:0,ee=y0(0,V,this.__views__),we=ee.start,Ae=ee.end,Ge=Ae-we,yt=z?Ae:we-1,vt=this.__iteratees__,St=vt.length,Nt=0,Xt=xr(Ge,this.__takeCount__);if(!C||!z&&V==Ge&&Xt==Ge)return Ci(h,this.__actions__);var ln=[];e:for(;Ge--&&Nt<Xt;){yt+=m;for(var An=-1,un=h[yt];++An<St;){var Rn=vt[An],Vn=Rn.iteratee,Cs=Rn.type,Ro=Vn(un);if(Cs==Le)un=Ro;else if(!Ro){if(Cs==Ye)continue e;break e}}ln[Nt++]=un}return ln}_n.prototype=To(Jr.prototype),_n.prototype.constructor=_n;function Po(h){var m=-1,C=h==null?0:h.length;for(this.clear();++m<C;){var z=h[m];this.set(z[0],z[1])}}function Gd(){this.__data__=Ea?Ea(null):{},this.size=0}function Fh(h){var m=this.has(h)&&delete this.__data__[h];return this.size-=m?1:0,m}function $d(h){var m=this.__data__;if(Ea){var C=m[h];return C===j?a:C}return Bn.call(m,h)?m[h]:a}function Ia(h){var m=this.__data__;return Ea?m[h]!==a:Bn.call(m,h)}function ms(h,m){var C=this.__data__;return this.size+=this.has(h)?0:1,C[h]=Ea&&m===a?j:m,this}Po.prototype.clear=Gd,Po.prototype.delete=Fh,Po.prototype.get=$d,Po.prototype.has=Ia,Po.prototype.set=ms;function It(h){var m=-1,C=h==null?0:h.length;for(this.clear();++m<C;){var z=h[m];this.set(z[0],z[1])}}function Zd(){this.__data__=[],this.size=0}function ka(h){var m=this.__data__,C=za(m,h);if(C<0)return!1;var z=m.length-1;return C==z?m.pop():ba.call(m,C,1),--this.size,!0}function qd(h){var m=this.__data__,C=za(m,h);return C<0?a:m[C][1]}function ru(h){return za(this.__data__,h)>-1}function Zs(h,m){var C=this.__data__,z=za(C,h);return z<0?(++this.size,C.push([h,m])):C[z][1]=m,this}It.prototype.clear=Zd,It.prototype.delete=ka,It.prototype.get=qd,It.prototype.has=ru,It.prototype.set=Zs;function Ho(h){var m=-1,C=h==null?0:h.length;for(this.clear();++m<C;){var z=h[m];this.set(z[0],z[1])}}function yn(){this.size=0,this.__data__={hash:new Po,map:new(qo||It),string:new Po}}function yl(h){var m=Js(this,h).delete(h);return this.size-=m?1:0,m}function Wd(h){return Js(this,h).get(h)}function fc(h){return Js(this,h).has(h)}function Hd(h,m){var C=Js(this,h),z=C.size;return C.set(h,m),this.size+=C.size==z?0:1,this}Ho.prototype.clear=yn,Ho.prototype.delete=yl,Ho.prototype.get=Wd,Ho.prototype.has=fc,Ho.prototype.set=Hd;function qs(h){var m=-1,C=h==null?0:h.length;for(this.__data__=new Ho;++m<C;)this.add(h[m])}function mc(h){return this.__data__.set(h,j),this}function gc(h){return this.__data__.has(h)}qs.prototype.add=qs.prototype.push=mc,qs.prototype.has=gc;function uo(h){var m=this.__data__=new It(h);this.size=m.size}function Yd(){this.__data__=new It,this.size=0}function Xd(h){var m=this.__data__,C=m.delete(h);return this.size=m.size,C}function Kd(h){return this.__data__.get(h)}function Jd(h){return this.__data__.has(h)}function gs(h,m){var C=this.__data__;if(C instanceof It){var z=C.__data__;if(!qo||z.length<x-1)return z.push([h,m]),this.size=++C.size,this;C=this.__data__=new Ho(z)}return C.set(h,m),this.size=C.size,this}uo.prototype.clear=Yd,uo.prototype.delete=Xd,uo.prototype.get=Kd,uo.prototype.has=Jd,uo.prototype.set=gs;function nr(h,m){var C=mn(h),z=!C&&mo(h),V=!C&&!z&&El(h),ee=!C&&!z&&!V&&ta(h),we=C||z||V||ee,Ae=we?Qu(h.length,uc):[],Ge=Ae.length;for(var yt in h)(m||Bn.call(h,yt))&&!(we&&(yt=="length"||V&&(yt=="offset"||yt=="parent")||ee&&(yt=="buffer"||yt=="byteLength"||yt=="byteOffset")||fo(yt,Ge)))&&Ae.push(yt);return Ae}function iu(h){var m=h.length;return m?h[nt(0,m-1)]:a}function _c(h,m){return hp(Er(h),Xo(m,0,h.length))}function Bh(h){return hp(Er(h))}function ou(h,m,C){(C!==a&&!es(h[m],C)||C===a&&!(m in h))&&Gt(h,m,C)}function Aa(h,m,C){var z=h[m];(!(Bn.call(h,m)&&es(z,C))||C===a&&!(m in h))&&Gt(h,m,C)}function za(h,m){for(var C=h.length;C--;)if(es(h[C][0],m))return C;return-1}function Yo(h,m,C,z){return co(h,function(V,ee,we){m(z,V,C(V),we)}),z}function Ra(h,m){return h&&ko(m,Xe(m),h)}function Vt(h,m){return h&&ko(m,pt(m),h)}function Gt(h,m,C){m=="__proto__"&&Ca?Ca(h,m,{configurable:!0,enumerable:!0,value:C,writable:!0}):h[m]=C}function La(h,m){for(var C=-1,z=m.length,V=tt(z),ee=h==null;++C<z;)V[C]=ee?a:O(h,m[C]);return V}function Xo(h,m,C){return h===h&&(C!==a&&(h=h<=C?h:C),m!==a&&(h=h>=m?h:m)),h}function _i(h,m,C,z,V,ee){var we,Ae=m&ge,Ge=m&fe,yt=m&oe;if(C&&(we=V?C(h,z,V,ee):C(h)),we!==a)return we;if(!Ir(h))return h;var vt=mn(h);if(vt){if(we=x0(h),!Ae)return Er(h,we)}else{var St=Ei(h),Nt=St==tn||St==gn;if(El(h))return Hn(h,Ae);if(St==Un||St==bt||Nt&&!V){if(we=Ge||Nt?{}:Mf(h),!Ae)return Ge?Vh(h,Vt(we,h)):bc(h,Ra(we,h))}else{if(!In[St])return V?h:{};we=qh(h,St,Ae)}}ee||(ee=new uo);var Xt=ee.get(h);if(Xt)return Xt;ee.set(h,we),Cp(h)?h.forEach(function(un){we.add(_i(un,m,C,un,h,ee))}):si(h)&&h.forEach(function(un,Rn){we.set(Rn,_i(un,m,C,Rn,h,ee))});var ln=yt?Ge?Cf:Tf:Ge?pt:Xe,An=vt?a:ln(h);return Kr(An||h,function(un,Rn){An&&(Rn=un,un=h[Rn]),Aa(we,Rn,_i(un,m,C,Rn,h,ee))}),we}function Ti(h){var m=Xe(h);return function(C){return Oh(C,h,m)}}function Oh(h,m,C){var z=C.length;if(h==null)return!z;for(h=qn(h);z--;){var V=C[z],ee=m[V],we=h[V];if(we===a&&!(V in h)||!ee(we))return!1}return!0}function Eo(h,m,C){if(typeof h!="function")throw new $i(b);return _u(function(){h.apply(a,C)},m)}function su(h,m,C,z){var V=-1,ee=nl,we=!0,Ae=h.length,Ge=[],yt=m.length;if(!Ae)return Ge;C&&(m=pr(m,fi(C))),z?(ee=bi,we=!1):m.length>=x&&(ee=Yl,we=!1,m=new qs(m));e:for(;++V<Ae;){var vt=h[V],St=C==null?vt:C(vt);if(vt=z||vt!==0?vt:0,we&&St===St){for(var Nt=yt;Nt--;)if(m[Nt]===St)continue e;Ge.push(vt)}else ee(m,St,z)||Ge.push(vt)}return Ge}var co=Sc(yi),Yn=Sc(Da,!0);function Cr(h,m){var C=!0;return co(h,function(z,V,ee){return C=!!m(z,V,ee),C}),C}function au(h,m,C){for(var z=-1,V=h.length;++z<V;){var ee=h[z],we=m(ee);if(we!=null&&(Ae===a?we===we&&!go(we):C(we,Ae)))var Ae=we,Ge=ee}return Ge}function lu(h,m,C,z){var V=h.length;for(C=vn(C),C<0&&(C=-C>V?0:V+C),z=z===a||z>V?V:vn(z),z<0&&(z+=V),z=C>z?0:v_(z);C<z;)h[C++]=m;return h}function vl(h,m){var C=[];return co(h,function(z,V,ee){m(z,V,ee)&&C.push(z)}),C}function jr(h,m,C,z,V){var ee=-1,we=h.length;for(C||(C=Mr),V||(V=[]);++ee<we;){var Ae=h[ee];m>0&&C(Ae)?m>1?jr(Ae,m-1,C,z,V):Zo(V,Ae):z||(V[V.length]=Ae)}return V}var uu=ep(),Ko=ep(!0);function yi(h,m){return h&&uu(h,m,Xe)}function Da(h,m){return h&&Ko(h,m,Xe)}function Fa(h,m){return Gi(m,function(C){return ts(h[C])})}function Mo(h,m){m=Pr(m,h);for(var C=0,z=m.length;h!=null&&C<z;)h=h[Qs(m[C++])];return C&&C==z?h:a}function yc(h,m,C){var z=m(h);return mn(h)?z:Zo(z,C(h))}function zr(h){return h==null?h===a?Fs:Fr:Ta&&Ta in qn(h)?_0(h):b0(h)}function _s(h,m){return h>m}function Nh(h,m){return h!=null&&Bn.call(h,m)}function vc(h,m){return h!=null&&m in qn(h)}function Ws(h,m,C){return h>=xr(m,C)&&h<pn(m,C)}function cu(h,m,C){for(var z=C?bi:nl,V=h[0].length,ee=h.length,we=ee,Ae=tt(ee),Ge=1/0,yt=[];we--;){var vt=h[we];we&&m&&(vt=pr(vt,fi(m))),Ge=xr(vt.length,Ge),Ae[we]=!C&&(m||V>=120&&vt.length>=120)?new qs(we&&vt):a}vt=h[0];var St=-1,Nt=Ae[0];e:for(;++St<V&&yt.length<Ge;){var Xt=vt[St],ln=m?m(Xt):Xt;if(Xt=C||Xt!==0?Xt:0,!(Nt?Yl(Nt,ln):z(yt,ln,C))){for(we=ee;--we;){var An=Ae[we];if(!(An?Yl(An,ln):z(h[we],ln,C)))continue e}Nt&&Nt.push(ln),yt.push(Xt)}}return yt}function jh(h,m,C,z){return yi(h,function(V,ee,we){m(z,C(V),ee,we)}),z}function ys(h,m,C){m=Pr(m,h),h=Sl(h,m);var z=h==null?h:h[Qs(Qo(m))];return z==null?a:Ui(z,h,C)}function xc(h){return ur(h)&&zr(h)==bt}function g(h){return ur(h)&&zr(h)==Oi}function e(h){return ur(h)&&zr(h)==on}function r(h,m,C,z,V){return h===m?!0:h==null||m==null||!ur(h)&&!ur(m)?h!==h&&m!==m:c(h,m,C,z,r,V)}function c(h,m,C,z,V,ee){var we=mn(h),Ae=mn(m),Ge=we?zt:Ei(h),yt=Ae?zt:Ei(m);Ge=Ge==bt?Un:Ge,yt=yt==bt?Un:yt;var vt=Ge==Un,St=yt==Un,Nt=Ge==yt;if(Nt&&El(h)){if(!El(m))return!1;we=!0,vt=!1}if(Nt&&!vt)return ee||(ee=new uo),we||ta(h)?ip(h,m,C,z,V,ee):g0(h,m,Ge,C,z,V,ee);if(!(C&Be)){var Xt=vt&&Bn.call(h,"__wrapped__"),ln=St&&Bn.call(m,"__wrapped__");if(Xt||ln){var An=Xt?h.value():h,un=ln?m.value():m;return ee||(ee=new uo),V(An,un,C,z,ee)}}return Nt?(ee||(ee=new uo),gg(h,m,C,z,V,ee)):!1}function d(h){return ur(h)&&Ei(h)==Rt}function _(h,m,C,z){var V=C.length,ee=V,we=!z;if(h==null)return!ee;for(h=qn(h);V--;){var Ae=C[V];if(we&&Ae[2]?Ae[1]!==h[Ae[0]]:!(Ae[0]in h))return!1}for(;++V<ee;){Ae=C[V];var Ge=Ae[0],yt=h[Ge],vt=Ae[1];if(we&&Ae[2]){if(yt===a&&!(Ge in h))return!1}else{var St=new uo;if(z)var Nt=z(yt,vt,Ge,h,m,St);if(!(Nt===a?r(vt,yt,Be|_t,z,St):Nt))return!1}}return!0}function w(h){if(!Ir(h)||yg(h))return!1;var m=ts(h)?Bd:or;return m.test(yu(h))}function P(h){return ur(h)&&zr(h)==Kn}function M(h){return ur(h)&&Ei(h)==Or}function k(h){return ur(h)&&Tp(h.length)&&!!Gn[zr(h)]}function L(h){return typeof h=="function"?h:h==null?gr:typeof h=="object"?mn(h)?re(h[0],h[1]):ie(h):ow(h)}function D(h){if(!Na(h))return dc(h);var m=[];for(var C in qn(h))Bn.call(h,C)&&C!="constructor"&&m.push(C);return m}function F(h){if(!Ir(h))return Wh(h);var m=Na(h),C=[];for(var z in h)z=="constructor"&&(m||!Bn.call(h,z))||C.push(z);return C}function G(h,m){return h<m}function H(h,m){var C=-1,z=Hi(h)?tt(h.length):[];return co(h,function(V,ee,we){z[++C]=m(V,ee,we)}),z}function ie(h){var m=pu(h);return m.length==1&&m[0][2]?gu(m[0][0],m[0][1]):function(C){return C===h||_(C,h,m)}}function re(h,m){return Ic(h)&&ap(m)?gu(Qs(h),m):function(C){var z=O(C,h);return z===a&&z===m?_e(C,h):r(m,z,Be|_t)}}function se(h,m,C,z,V){h!==m&&uu(m,function(ee,we){if(V||(V=new uo),Ir(ee))ce(h,m,we,C,se,z,V);else{var Ae=z?z(up(h,we),ee,we+"",h,m,V):a;Ae===a&&(Ae=ee),ou(h,we,Ae)}},pt)}function ce(h,m,C,z,V,ee,we){var Ae=up(h,C),Ge=up(m,C),yt=we.get(Ge);if(yt){ou(h,C,yt);return}var vt=ee?ee(Ae,Ge,C+"",h,m,we):a,St=vt===a;if(St){var Nt=mn(Ge),Xt=!Nt&&El(Ge),ln=!Nt&&!Xt&&ta(Ge);vt=Ge,Nt||Xt||ln?mn(Ae)?vt=Ae:Rr(Ae)?vt=Er(Ae):Xt?(St=!1,vt=Hn(Ge,!0)):ln?(St=!1,vt=Uh(Ge,!0)):vt=[]:Bc(Ge)||mo(Ge)?(vt=Ae,mo(Ae)?vt=t(Ae):(!Ir(Ae)||ts(Ae))&&(vt=Mf(Ge))):St=!1}St&&(we.set(Ge,vt),V(vt,Ge,z,ee,we),we.delete(Ge)),ou(h,C,vt)}function ve(h,m){var C=h.length;if(C)return m+=m<0?C:0,fo(m,C)?h[m]:a}function xe(h,m,C){m.length?m=pr(m,function(ee){return mn(ee)?function(we){return Mo(we,ee.length===1?ee[0]:ee)}:ee}):m=[gr];var z=-1;m=pr(m,fi(nn()));var V=H(h,function(ee,we,Ae){var Ge=pr(m,function(yt){return yt(ee)});return{criteria:Ge,index:++z,value:ee}});return js(V,function(ee,we){return Qd(ee,we,C)})}function Se(h,m){return Ce(h,m,function(C,z){return _e(h,z)})}function Ce(h,m,C){for(var z=-1,V=m.length,ee={};++z<V;){var we=m[z],Ae=Mo(h,we);C(Ae,we)&&Et(ee,Pr(we,h),Ae)}return ee}function Ee(h){return function(m){return Mo(m,h)}}function $e(h,m,C,z){var V=z?Rd:ol,ee=-1,we=m.length,Ae=h;for(h===m&&(m=Er(m)),C&&(Ae=pr(h,fi(C)));++ee<we;)for(var Ge=0,yt=m[ee],vt=C?C(yt):yt;(Ge=V(Ae,vt,Ge,z))>-1;)Ae!==h&&ba.call(Ae,Ge,1),ba.call(h,Ge,1);return h}function qe(h,m){for(var C=h?m.length:0,z=C-1;C--;){var V=m[C];if(C==z||V!==ee){var ee=V;fo(V)?ba.call(h,V,1):oi(h,V)}}return h}function nt(h,m){return h+cl(pc()*(m-h+1))}function at(h,m,C,z){for(var V=-1,ee=pn(Pa((m-h)/(C||1)),0),we=tt(ee);ee--;)we[z?ee:++V]=h,h+=C;return we}function Qe(h,m){var C="";if(!h||m<1||m>be)return C;do m%2&&(C+=h),m=cl(m/2),m&&(h+=h);while(m);return C}function lt(h,m){return cp(If(h,m,gr),h+"")}function Tt(h){return iu(wr(h))}function ft(h,m){var C=wr(h);return hp(C,Xo(m,0,C.length))}function Et(h,m,C,z){if(!Ir(h))return h;m=Pr(m,h);for(var V=-1,ee=m.length,we=ee-1,Ae=h;Ae!=null&&++V<ee;){var Ge=Qs(m[V]),yt=C;if(Ge==="__proto__"||Ge==="constructor"||Ge==="prototype")return h;if(V!=we){var vt=Ae[Ge];yt=z?z(vt,Ge,Ae):a,yt===a&&(yt=Ir(vt)?vt:fo(m[V+1])?[]:{})}Aa(Ae,Ge,yt),Ae=Ae[Ge]}return h}var an=fl?function(h,m){return fl.set(h,m),h}:gr,kn=Ca?function(h,m){return Ca(h,"toString",{configurable:!0,enumerable:!1,value:pm(m),writable:!0})}:gr;function ar(h){return hp(wr(h))}function xn(h,m,C){var z=-1,V=h.length;m<0&&(m=-m>V?0:V+m),C=C>V?V:C,C<0&&(C+=V),V=m>C?0:C-m>>>0,m>>>=0;for(var ee=tt(V);++z<V;)ee[z]=h[z+m];return ee}function lr(h,m){var C;return co(h,function(z,V,ee){return C=m(z,V,ee),!C}),!!C}function On(h,m,C){var z=0,V=h==null?z:h.length;if(typeof m=="number"&&m===m&&V<=At){for(;z<V;){var ee=z+V>>>1,we=h[ee];we!==null&&!go(we)&&(C?we<=m:we<m)?z=ee+1:V=ee}return V}return Nn(h,m,gr,C)}function Nn(h,m,C,z){var V=0,ee=h==null?0:h.length;if(ee===0)return 0;m=C(m);for(var we=m!==m,Ae=m===null,Ge=go(m),yt=m===a;V<ee;){var vt=cl((V+ee)/2),St=C(h[vt]),Nt=St!==a,Xt=St===null,ln=St===St,An=go(St);if(we)var un=z||ln;else yt?un=ln&&(z||Nt):Ae?un=ln&&Nt&&(z||!Xt):Ge?un=ln&&Nt&&!Xt&&(z||!An):Xt||An?un=!1:un=z?St<=m:St<m;un?V=vt+1:ee=vt}return xr(ee,gt)}function Wn(h,m){for(var C=-1,z=h.length,V=0,ee=[];++C<z;){var we=h[C],Ae=m?m(we):we;if(!C||!es(Ae,Ge)){var Ge=Ae;ee[V++]=we===0?0:we}}return ee}function Qr(h){return typeof h=="number"?h:go(h)?ye:+h}function jn(h){if(typeof h=="string")return h;if(mn(h))return pr(h,jn)+"";if(go(h))return Dh?Dh.call(h):"";var m=h+"";return m=="0"&&1/h==-We?"-0":m}function Qn(h,m,C){var z=-1,V=nl,ee=h.length,we=!0,Ae=[],Ge=Ae;if(C)we=!1,V=bi;else if(ee>=x){var yt=m?null:bf(h);if(yt)return sl(yt);we=!1,V=Yl,Ge=new qs}else Ge=m?[]:Ae;e:for(;++z<ee;){var vt=h[z],St=m?m(vt):vt;if(vt=C||vt!==0?vt:0,we&&St===St){for(var Nt=Ge.length;Nt--;)if(Ge[Nt]===St)continue e;m&&Ge.push(St),Ae.push(vt)}else V(Ge,St,C)||(Ge!==Ae&&Ge.push(St),Ae.push(vt))}return Ae}function oi(h,m){return m=Pr(m,h),h=Sl(h,m),h==null||delete h[Qs(Qo(m))]}function Jo(h,m,C,z){return Et(h,m,C(Mo(h,m)),z)}function Zi(h,m,C,z){for(var V=h.length,ee=z?V:-1;(z?ee--:++ee<V)&&m(h[ee],ee,h););return C?xn(h,z?0:ee,z?ee+1:V):xn(h,z?ee+1:0,z?V:ee)}function Ci(h,m){var C=h;return C instanceof _n&&(C=C.value()),_a(m,function(z,V){return V.func.apply(V.thisArg,Zo([z],V.args))},C)}function Io(h,m,C){var z=h.length;if(z<2)return z?Qn(h[0]):[];for(var V=-1,ee=tt(z);++V<z;)for(var we=h[V],Ae=-1;++Ae<z;)Ae!=V&&(ee[V]=su(ee[V]||we,h[Ae],m,C));return Qn(jr(ee,1),m,C)}function xl(h,m,C){for(var z=-1,V=h.length,ee=m.length,we={};++z<V;){var Ae=z<ee?m[z]:a;C(we,h[z],Ae)}return we}function Ba(h){return Rr(h)?h:[]}function Hs(h){return typeof h=="function"?h:gr}function Pr(h,m){return mn(h)?h:Ic(h,m)?[h]:wg(l(h))}var ho=lt;function Ur(h,m,C){var z=h.length;return C=C===a?z:C,!m&&C>=z?h:xn(h,m,C)}var Pi=Od||function(h){return Tr.clearTimeout(h)};function Hn(h,m){if(m)return h.slice();var C=h.length,z=Kl?Kl(C):new h.constructor(C);return h.copy(z),z}function er(h){var m=new h.constructor(h.byteLength);return new wa(m).set(new wa(h)),m}function qi(h,m){var C=m?er(h.buffer):h.buffer;return new h.constructor(C,h.byteOffset,h.byteLength)}function fr(h){var m=new h.constructor(h.source,Sr.exec(h));return m.lastIndex=h.lastIndex,m}function yf(h){return gl?qn(gl.call(h)):{}}function Uh(h,m){var C=m?er(h.buffer):h.buffer;return new h.constructor(C,h.byteOffset,h.length)}function wc(h,m){if(h!==m){var C=h!==a,z=h===null,V=h===h,ee=go(h),we=m!==a,Ae=m===null,Ge=m===m,yt=go(m);if(!Ae&&!yt&&!ee&&h>m||ee&&we&&Ge&&!Ae&&!yt||z&&we&&Ge||!C&&Ge||!V)return 1;if(!z&&!ee&&!yt&&h<m||yt&&C&&V&&!z&&!ee||Ae&&C&&V||!we&&V||!Ge)return-1}return 0}function Qd(h,m,C){for(var z=-1,V=h.criteria,ee=m.criteria,we=V.length,Ae=C.length;++z<we;){var Ge=wc(V[z],ee[z]);if(Ge){if(z>=Ae)return Ge;var yt=C[z];return Ge*(yt=="desc"?-1:1)}}return h.index-m.index}function Ys(h,m,C,z){for(var V=-1,ee=h.length,we=C.length,Ae=-1,Ge=m.length,yt=pn(ee-we,0),vt=tt(Ge+yt),St=!z;++Ae<Ge;)vt[Ae]=m[Ae];for(;++V<we;)(St||V<ee)&&(vt[C[V]]=h[V]);for(;yt--;)vt[Ae++]=h[V++];return vt}function Xs(h,m,C,z){for(var V=-1,ee=h.length,we=-1,Ae=C.length,Ge=-1,yt=m.length,vt=pn(ee-Ae,0),St=tt(vt+yt),Nt=!z;++V<vt;)St[V]=h[V];for(var Xt=V;++Ge<yt;)St[Xt+Ge]=m[Ge];for(;++we<Ae;)(Nt||V<ee)&&(St[Xt+C[we]]=h[V++]);return St}function Er(h,m){var C=-1,z=h.length;for(m||(m=tt(z));++C<z;)m[C]=h[C];return m}function ko(h,m,C,z){var V=!C;C||(C={});for(var ee=-1,we=m.length;++ee<we;){var Ae=m[ee],Ge=z?z(C[Ae],h[Ae],Ae,C,h):a;Ge===a&&(Ge=h[Ae]),V?Gt(C,Ae,Ge):Aa(C,Ae,Ge)}return C}function bc(h,m){return ko(h,Ef(h),m)}function Vh(h,m){return ko(h,_g(h),m)}function wl(h,m){return function(C,z){var V=mn(C)?Wu:Yo,ee=m?m():{};return V(C,h,nn(z,2),ee)}}function Ks(h){return lt(function(m,C){var z=-1,V=C.length,ee=V>1?C[V-1]:a,we=V>2?C[2]:a;for(ee=h.length>3&&typeof ee=="function"?(V--,ee):a,we&&Mi(C[0],C[1],we)&&(ee=V<3?a:ee,V=1),m=qn(m);++z<V;){var Ae=C[z];Ae&&h(m,Ae,z,ee)}return m})}function Sc(h,m){return function(C,z){if(C==null)return C;if(!Hi(C))return h(C,z);for(var V=C.length,ee=m?V:-1,we=qn(C);(m?ee--:++ee<V)&&z(we[ee],ee,we)!==!1;);return C}}function ep(h){return function(m,C,z){for(var V=-1,ee=qn(m),we=z(m),Ae=we.length;Ae--;){var Ge=we[h?Ae:++V];if(C(ee[Ge],Ge,ee)===!1)break}return m}}function f0(h,m,C){var z=m&xt,V=Tc(h);function ee(){var we=this&&this!==Tr&&this instanceof ee?V:h;return we.apply(z?C:this,arguments)}return ee}function tp(h){return function(m){m=l(m);var C=Us(m)?so(m):a,z=C?C[0]:m.charAt(0),V=C?Ur(C,1).join(""):m.slice(1);return z[h]()+V}}function hu(h){return function(m){return _a(P_(qr(m).replace(us,"")),h,"")}}function Tc(h){return function(){var m=arguments;switch(m.length){case 0:return new h;case 1:return new h(m[0]);case 2:return new h(m[0],m[1]);case 3:return new h(m[0],m[1],m[2]);case 4:return new h(m[0],m[1],m[2],m[3]);case 5:return new h(m[0],m[1],m[2],m[3],m[4]);case 6:return new h(m[0],m[1],m[2],m[3],m[4],m[5]);case 7:return new h(m[0],m[1],m[2],m[3],m[4],m[5],m[6])}var C=To(h.prototype),z=h.apply(C,m);return Ir(z)?z:C}}function Cc(h,m,C){var z=Tc(h);function V(){for(var ee=arguments.length,we=tt(ee),Ae=ee,Ge=bl(V);Ae--;)we[Ae]=arguments[Ae];var yt=ee<3&&we[0]!==Ge&&we[ee-1]!==Ge?[]:Si(we,Ge);if(ee-=yt.length,ee<C)return xf(h,m,du,V.placeholder,a,we,yt,a,a,C-ee);var vt=this&&this!==Tr&&this instanceof V?z:h;return Ui(vt,this,we)}return V}function fg(h){return function(m,C,z){var V=qn(m);if(!Hi(m)){var ee=nn(C,3);m=Xe(m),C=function(Ae){return ee(V[Ae],Ae,V)}}var we=h(m,C,z);return we>-1?V[ee?m[we]:we]:a}}function Pc(h){return Oa(function(m){var C=m.length,z=C,V=zn.prototype.thru;for(h&&m.reverse();z--;){var ee=m[z];if(typeof ee!="function")throw new $i(b);if(V&&!we&&Mc(ee)=="wrapper")var we=new zn([],!0)}for(z=we?z:C;++z<C;){ee=m[z];var Ae=Mc(ee),Ge=Ae=="wrapper"?Pf(ee):a;Ge&&mu(Ge[0])&&Ge[1]==(ht|Te|ut|$)&&!Ge[4].length&&Ge[9]==1?we=we[Mc(Ge[0])].apply(we,Ge[3]):we=ee.length==1&&mu(ee)?we[Ae]():we.thru(ee)}return function(){var yt=arguments,vt=yt[0];if(we&&yt.length==1&&mn(vt))return we.plant(vt).value();for(var St=0,Nt=C?m[St].apply(this,yt):vt;++St<C;)Nt=m[St].call(this,Nt);return Nt}})}function du(h,m,C,z,V,ee,we,Ae,Ge,yt){var vt=m&ht,St=m&xt,Nt=m&Ie,Xt=m&(Te|Ne),ln=m&le,An=Nt?a:Tc(h);function un(){for(var Rn=arguments.length,Vn=tt(Rn),Cs=Rn;Cs--;)Vn[Cs]=arguments[Cs];if(Xt)var Ro=bl(un),Ps=Ld(Vn,Ro);if(z&&(Vn=Ys(Vn,z,V,Xt)),ee&&(Vn=Xs(Vn,ee,we,Xt)),Rn-=Ps,Xt&&Rn<yt){var ui=Si(Vn,Ro);return xf(h,m,du,un.placeholder,C,Vn,ui,Ae,Ge,yt-Rn)}var Va=St?C:this,Su=Nt?Va[h]:h;return Rn=Vn.length,Ae?Vn=S0(Vn,Ae):ln&&Rn>1&&Vn.reverse(),vt&&Ge<Rn&&(Vn.length=Ge),this&&this!==Tr&&this instanceof un&&(Su=An||Tc(Su)),Su.apply(Va,Vn)}return un}function Gh(h,m){return function(C,z){return jh(C,h,m(z),{})}}function $h(h,m){return function(C,z){var V;if(C===a&&z===a)return m;if(C!==a&&(V=C),z!==a){if(V===a)return z;typeof C=="string"||typeof z=="string"?(C=jn(C),z=jn(z)):(C=Qr(C),z=Qr(z)),V=h(C,z)}return V}}function np(h){return Oa(function(m){return m=pr(m,fi(nn())),lt(function(C){var z=this;return h(m,function(V){return Ui(V,z,C)})})})}function rp(h,m){m=m===a?" ":jn(m);var C=m.length;if(C<2)return C?Qe(m,h):m;var z=Qe(m,Pa(h/al(m)));return Us(m)?Ur(so(z),0,h).join(""):z.slice(0,h)}function m0(h,m,C,z){var V=m&xt,ee=Tc(h);function we(){for(var Ae=-1,Ge=arguments.length,yt=-1,vt=z.length,St=tt(vt+Ge),Nt=this&&this!==Tr&&this instanceof we?ee:h;++yt<vt;)St[yt]=z[yt];for(;Ge--;)St[yt++]=arguments[++Ae];return Ui(Nt,V?C:this,St)}return we}function vf(h){return function(m,C,z){return z&&typeof z!="number"&&Mi(m,C,z)&&(C=z=a),m=xs(m),C===a?(C=m,m=0):C=xs(C),z=z===a?m<C?1:-1:xs(z),at(m,C,z,h)}}function Zh(h){return function(m,C){return typeof m=="string"&&typeof C=="string"||(m=o(m),C=o(C)),h(m,C)}}function xf(h,m,C,z,V,ee,we,Ae,Ge,yt){var vt=m&Te,St=vt?we:a,Nt=vt?a:we,Xt=vt?ee:a,ln=vt?a:ee;m|=vt?ut:ct,m&=~(vt?ct:ut),m&ne||(m&=~(xt|Ie));var An=[h,m,V,Xt,St,ln,Nt,Ae,Ge,yt],un=C.apply(a,An);return mu(h)&&Ac(un,An),un.placeholder=z,kf(un,h,m)}function wf(h){var m=vr[h];return function(C,z){if(C=o(C),z=z==null?0:xr(vn(z),292),z&&hl(C)){var V=(l(C)+"e").split("e"),ee=m(V[0]+"e"+(+V[1]+z));return V=(l(ee)+"e").split("e"),+(V[0]+"e"+(+V[1]-z))}return m(C)}}var bf=Wo&&1/sl(new Wo([,-0]))[1]==We?function(h){return new Wo(h)}:fv;function Sf(h){return function(m){var C=Ei(m);return C==Rt?ic(m):C==Or?Fn(m):Hl(m,h(m))}}function vs(h,m,C,z,V,ee,we,Ae){var Ge=m&Ie;if(!Ge&&typeof h!="function")throw new $i(b);var yt=z?z.length:0;if(yt||(m&=~(ut|ct),z=V=a),we=we===a?we:pn(vn(we),0),Ae=Ae===a?Ae:vn(Ae),yt-=V?V.length:0,m&ct){var vt=z,St=V;z=V=a}var Nt=Ge?a:Pf(h),Xt=[h,m,C,z,V,vt,St,ee,we,Ae];if(Nt&&kc(Xt,Nt),h=Xt[0],m=Xt[1],C=Xt[2],z=Xt[3],V=Xt[4],Ae=Xt[9]=Xt[9]===a?Ge?0:h.length:pn(Xt[9]-yt,0),!Ae&&m&(Te|Ne)&&(m&=~(Te|Ne)),!m||m==xt)var ln=f0(h,m,C);else m==Te||m==Ne?ln=Cc(h,m,Ae):(m==ut||m==(xt|ut))&&!V.length?ln=m0(h,m,C,z):ln=du.apply(a,Xt);var An=Nt?an:Ac;return kf(An(ln,Xt),h,m)}function Ec(h,m,C,z){return h===a||es(h,xa[C])&&!Bn.call(z,C)?m:h}function po(h,m,C,z,V,ee){return Ir(h)&&Ir(m)&&(ee.set(m,h),se(h,m,a,po,ee),ee.delete(m)),h}function mg(h){return Bc(h)?a:h}function ip(h,m,C,z,V,ee){var we=C&Be,Ae=h.length,Ge=m.length;if(Ae!=Ge&&!(we&&Ge>Ae))return!1;var yt=ee.get(h),vt=ee.get(m);if(yt&&vt)return yt==m&&vt==h;var St=-1,Nt=!0,Xt=C&_t?new qs:a;for(ee.set(h,m),ee.set(m,h);++St<Ae;){var ln=h[St],An=m[St];if(z)var un=we?z(An,ln,St,m,h,ee):z(ln,An,St,h,m,ee);if(un!==a){if(un)continue;Nt=!1;break}if(Xt){if(!rl(m,function(Rn,Vn){if(!Yl(Xt,Vn)&&(ln===Rn||V(ln,Rn,C,z,ee)))return Xt.push(Vn)})){Nt=!1;break}}else if(!(ln===An||V(ln,An,C,z,ee))){Nt=!1;break}}return ee.delete(h),ee.delete(m),Nt}function g0(h,m,C,z,V,ee,we){switch(C){case di:if(h.byteLength!=m.byteLength||h.byteOffset!=m.byteOffset)return!1;h=h.buffer,m=m.buffer;case Oi:return!(h.byteLength!=m.byteLength||!ee(new wa(h),new wa(m)));case Kt:case on:case rn:return es(+h,+m);case Ht:return h.name==m.name&&h.message==m.message;case Kn:case Di:return h==m+"";case Rt:var Ae=ic;case Or:var Ge=z&Be;if(Ae||(Ae=sl),h.size!=m.size&&!Ge)return!1;var yt=we.get(h);if(yt)return yt==m;z|=_t,we.set(h,m);var vt=ip(Ae(h),Ae(m),z,V,ee,we);return we.delete(h),vt;case Fi:if(gl)return gl.call(h)==gl.call(m)}return!1}function gg(h,m,C,z,V,ee){var we=C&Be,Ae=Tf(h),Ge=Ae.length,yt=Tf(m),vt=yt.length;if(Ge!=vt&&!we)return!1;for(var St=Ge;St--;){var Nt=Ae[St];if(!(we?Nt in m:Bn.call(m,Nt)))return!1}var Xt=ee.get(h),ln=ee.get(m);if(Xt&&ln)return Xt==m&&ln==h;var An=!0;ee.set(h,m),ee.set(m,h);for(var un=we;++St<Ge;){Nt=Ae[St];var Rn=h[Nt],Vn=m[Nt];if(z)var Cs=we?z(Vn,Rn,Nt,m,h,ee):z(Rn,Vn,Nt,h,m,ee);if(!(Cs===a?Rn===Vn||V(Rn,Vn,C,z,ee):Cs)){An=!1;break}un||(un=Nt=="constructor")}if(An&&!un){var Ro=h.constructor,Ps=m.constructor;Ro!=Ps&&"constructor"in h&&"constructor"in m&&!(typeof Ro=="function"&&Ro instanceof Ro&&typeof Ps=="function"&&Ps instanceof Ps)&&(An=!1)}return ee.delete(h),ee.delete(m),An}function Oa(h){return cp(If(h,a,fp),h+"")}function Tf(h){return yc(h,Xe,Ef)}function Cf(h){return yc(h,pt,_g)}var Pf=fl?function(h){return fl.get(h)}:fv;function Mc(h){for(var m=h.name+"",C=Ma[m],z=Bn.call(Ma,m)?C.length:0;z--;){var V=C[z],ee=V.func;if(ee==null||ee==h)return V.name}return m}function bl(h){var m=Bn.call(X,"placeholder")?X:h;return m.placeholder}function nn(){var h=X.iteratee||Ua;return h=h===Ua?L:h,arguments.length?h(arguments[0],arguments[1]):h}function Js(h,m){var C=h.__data__;return sp(m)?C[typeof m=="string"?"string":"hash"]:C.map}function pu(h){for(var m=Xe(h),C=m.length;C--;){var z=m[C],V=h[z];m[C]=[z,V,ap(V)]}return m}function fu(h,m){var C=ds(h,m);return w(C)?C:a}function _0(h){var m=Bn.call(h,Ta),C=h[Ta];try{h[Ta]=a;var z=!0}catch{}var V=Vs.call(h);return z&&(m?h[Ta]=C:delete h[Ta]),V}var Ef=eu?function(h){return h==null?[]:(h=qn(h),Gi(eu(h),function(m){return Ah.call(h,m)}))}:mv,_g=eu?function(h){for(var m=[];h;)Zo(m,Ef(h)),h=fs(h);return m}:mv,Ei=zr;(Gs&&Ei(new Gs(new ArrayBuffer(1)))!=di||qo&&Ei(new qo)!=Rt||dl&&Ei(dl.resolve())!=Br||Wo&&Ei(new Wo)!=Or||pl&&Ei(new pl)!=Bi)&&(Ei=function(h){var m=zr(h),C=m==Un?h.constructor:a,z=C?yu(C):"";if(z)switch(z){case $s:return di;case Lh:return Rt;case ml:return Br;case Ud:return Or;case Vd:return Bi}return m});function y0(h,m,C){for(var z=-1,V=C.length;++z<V;){var ee=C[z],we=ee.size;switch(ee.type){case"drop":h+=we;break;case"dropRight":m-=we;break;case"take":m=xr(m,h+we);break;case"takeRight":h=pn(h,m-we);break}}return{start:h,end:m}}function v0(h){var m=h.match(En);return m?m[1].split(Yt):[]}function op(h,m,C){m=Pr(m,h);for(var z=-1,V=m.length,ee=!1;++z<V;){var we=Qs(m[z]);if(!(ee=h!=null&&C(h,we)))break;h=h[we]}return ee||++z!=V?ee:(V=h==null?0:h.length,!!V&&Tp(V)&&fo(we,V)&&(mn(h)||mo(h)))}function x0(h){var m=h.length,C=new h.constructor(m);return m&&typeof h[0]=="string"&&Bn.call(h,"index")&&(C.index=h.index,C.input=h.input),C}function Mf(h){return typeof h.constructor=="function"&&!Na(h)?To(fs(h)):{}}function qh(h,m,C){var z=h.constructor;switch(m){case Oi:return er(h);case Kt:case on:return new z(+h);case di:return qi(h,C);case to:case Ni:case no:case Oo:case ls:case No:case te:case W:case Y:return Uh(h,C);case Rt:return new z;case rn:case Di:return new z(h);case Kn:return fr(h);case Or:return new z;case Fi:return yf(h)}}function w0(h,m){var C=m.length;if(!C)return h;var z=C-1;return m[z]=(C>1?"& ":"")+m[z],m=m.join(C>2?", ":" "),h.replace(fn,`{
/* [wrapped with `+m+`] */
`)}function Mr(h){return mn(h)||mo(h)||!!(Ql&&h&&h[Ql])}function fo(h,m){var C=typeof h;return m=m??be,!!m&&(C=="number"||C!="symbol"&&Ja.test(h))&&h>-1&&h%1==0&&h<m}function Mi(h,m,C){if(!Ir(C))return!1;var z=typeof m;return(z=="number"?Hi(C)&&fo(m,C.length):z=="string"&&m in C)?es(C[m],h):!1}function Ic(h,m){if(mn(h))return!1;var C=typeof h;return C=="number"||C=="symbol"||C=="boolean"||h==null||go(h)?!0:Ct.test(h)||!Pt.test(h)||m!=null&&h in qn(m)}function sp(h){var m=typeof h;return m=="string"||m=="number"||m=="symbol"||m=="boolean"?h!=="__proto__":h===null}function mu(h){var m=Mc(h),C=X[m];if(typeof C!="function"||!(m in _n.prototype))return!1;if(h===C)return!0;var z=Pf(C);return!!z&&h===z[0]}function yg(h){return!!Ih&&Ih in h}var vg=ul?ts:gv;function Na(h){var m=h&&h.constructor,C=typeof m=="function"&&m.prototype||xa;return h===C}function ap(h){return h===h&&!Ir(h)}function gu(h,m){return function(C){return C==null?!1:C[h]===m&&(m!==a||h in qn(C))}}function lp(h){var m=ed(h,function(z){return C.size===Z&&C.clear(),z}),C=m.cache;return m}function kc(h,m){var C=h[1],z=m[1],V=C|z,ee=V<(xt|Ie|ht),we=z==ht&&C==Te||z==ht&&C==$&&h[7].length<=m[8]||z==(ht|$)&&m[7].length<=m[8]&&C==Te;if(!(ee||we))return h;z&xt&&(h[2]=m[2],V|=C&xt?0:ne);var Ae=m[3];if(Ae){var Ge=h[3];h[3]=Ge?Ys(Ge,Ae,m[4]):Ae,h[4]=Ge?Si(h[3],me):m[4]}return Ae=m[5],Ae&&(Ge=h[5],h[5]=Ge?Xs(Ge,Ae,m[6]):Ae,h[6]=Ge?Si(h[5],me):m[6]),Ae=m[7],Ae&&(h[7]=Ae),z&ht&&(h[8]=h[8]==null?m[8]:xr(h[8],m[8])),h[9]==null&&(h[9]=m[9]),h[0]=m[0],h[1]=V,h}function Wh(h){var m=[];if(h!=null)for(var C in qn(h))m.push(C);return m}function b0(h){return Vs.call(h)}function If(h,m,C){return m=pn(m===a?h.length-1:m,0),function(){for(var z=arguments,V=-1,ee=pn(z.length-m,0),we=tt(ee);++V<ee;)we[V]=z[m+V];V=-1;for(var Ae=tt(m+1);++V<m;)Ae[V]=z[V];return Ae[m]=C(we),Ui(h,this,Ae)}}function Sl(h,m){return m.length<2?h:Mo(h,xn(m,0,-1))}function S0(h,m){for(var C=h.length,z=xr(m.length,C),V=Er(h);z--;){var ee=m[z];h[z]=fo(ee,C)?V[ee]:a}return h}function up(h,m){if(!(m==="constructor"&&typeof h[m]=="function")&&m!="__proto__")return h[m]}var Ac=xg(an),_u=hc||function(h,m){return Tr.setTimeout(h,m)},cp=xg(kn);function kf(h,m,C){var z=m+"";return cp(h,w0(z,Af(v0(z),C)))}function xg(h){var m=0,C=0;return function(){var z=lo(),V=je-(z-C);if(C=z,V>0){if(++m>=Fe)return arguments[0]}else m=0;return h.apply(a,arguments)}}function hp(h,m){var C=-1,z=h.length,V=z-1;for(m=m===a?z:m;++C<m;){var ee=nt(C,V),we=h[ee];h[ee]=h[C],h[C]=we}return h.length=m,h}var wg=lp(function(h){var m=[];return h.charCodeAt(0)===46&&m.push(""),h.replace(Wt,function(C,z,V,ee){m.push(V?ee.replace(Bs,"$1"):z||C)}),m});function Qs(h){if(typeof h=="string"||go(h))return h;var m=h+"";return m=="0"&&1/h==-We?"-0":m}function yu(h){if(h!=null){try{return Tn.call(h)}catch{}try{return h+""}catch{}}return""}function Af(h,m){return Kr(Lt,function(C){var z="_."+C[0];m&C[1]&&!nl(h,z)&&h.push(z)}),h.sort()}function zf(h){if(h instanceof _n)return h.clone();var m=new zn(h.__wrapped__,h.__chain__);return m.__actions__=Er(h.__actions__),m.__index__=h.__index__,m.__values__=h.__values__,m}function Rf(h,m,C){(C?Mi(h,m,C):m===a)?m=1:m=pn(vn(m),0);var z=h==null?0:h.length;if(!z||m<1)return[];for(var V=0,ee=0,we=tt(Pa(z/m));V<z;)we[ee++]=xn(h,V,V+=m);return we}function bg(h){for(var m=-1,C=h==null?0:h.length,z=0,V=[];++m<C;){var ee=h[m];ee&&(V[z++]=ee)}return V}function Lf(){var h=arguments.length;if(!h)return[];for(var m=tt(h-1),C=arguments[0],z=h;z--;)m[z-1]=arguments[z];return Zo(mn(C)?Er(C):[C],jr(m,1))}var Sg=lt(function(h,m){return Rr(h)?su(h,jr(m,1,Rr,!0)):[]}),Tg=lt(function(h,m){var C=Qo(m);return Rr(C)&&(C=a),Rr(h)?su(h,jr(m,1,Rr,!0),nn(C,2)):[]}),dp=lt(function(h,m){var C=Qo(m);return Rr(C)&&(C=a),Rr(h)?su(h,jr(m,1,Rr,!0),a,C):[]});function Cg(h,m,C){var z=h==null?0:h.length;return z?(m=C||m===a?1:vn(m),xn(h,m<0?0:m,z)):[]}function Pg(h,m,C){var z=h==null?0:h.length;return z?(m=C||m===a?1:vn(m),m=z-m,xn(h,0,m<0?0:m)):[]}function Eg(h,m){return h&&h.length?Zi(h,nn(m,3),!0,!0):[]}function Hh(h,m){return h&&h.length?Zi(h,nn(m,3),!0):[]}function T0(h,m,C,z){var V=h==null?0:h.length;return V?(C&&typeof C!="number"&&Mi(h,m,C)&&(C=0,z=V),lu(h,m,C,z)):[]}function pp(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var V=C==null?0:vn(C);return V<0&&(V=pn(z+V,0)),il(h,nn(m,3),V)}function zc(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var V=z-1;return C!==a&&(V=vn(C),V=C<0?pn(z+V,0):xr(V,z-1)),il(h,nn(m,3),V,!0)}function fp(h){var m=h==null?0:h.length;return m?jr(h,1):[]}function C0(h){var m=h==null?0:h.length;return m?jr(h,We):[]}function P0(h,m){var C=h==null?0:h.length;return C?(m=m===a?1:vn(m),jr(h,m)):[]}function Mg(h){for(var m=-1,C=h==null?0:h.length,z={};++m<C;){var V=h[m];z[V[0]]=V[1]}return z}function Df(h){return h&&h.length?h[0]:a}function E0(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var V=C==null?0:vn(C);return V<0&&(V=pn(z+V,0)),ol(h,m,V)}function M0(h){var m=h==null?0:h.length;return m?xn(h,0,-1):[]}var Yh=lt(function(h){var m=pr(h,Ba);return m.length&&m[0]===h[0]?cu(m):[]}),Ig=lt(function(h){var m=Qo(h),C=pr(h,Ba);return m===Qo(C)?m=a:C.pop(),C.length&&C[0]===h[0]?cu(C,nn(m,2)):[]}),I0=lt(function(h){var m=Qo(h),C=pr(h,Ba);return m=typeof m=="function"?m:a,m&&C.pop(),C.length&&C[0]===h[0]?cu(C,a,m):[]});function k0(h,m){return h==null?"":zh.call(h,m)}function Qo(h){var m=h==null?0:h.length;return m?h[m-1]:a}function A0(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var V=z;return C!==a&&(V=vn(C),V=V<0?pn(z+V,0):xr(V,z-1)),m===m?ff(h,m,V):il(h,Yu,V,!0)}function z0(h,m){return h&&h.length?ve(h,vn(m)):a}var R0=lt(Ff);function Ff(h,m){return h&&h.length&&m&&m.length?$e(h,m):h}function Bf(h,m,C){return h&&h.length&&m&&m.length?$e(h,m,nn(C,2)):h}function kg(h,m,C){return h&&h.length&&m&&m.length?$e(h,m,a,C):h}var Ag=Oa(function(h,m){var C=h==null?0:h.length,z=La(h,m);return qe(h,pr(m,function(V){return fo(V,C)?+V:V}).sort(wc)),z});function zg(h,m){var C=[];if(!(h&&h.length))return C;var z=-1,V=[],ee=h.length;for(m=nn(m,3);++z<ee;){var we=h[z];m(we,z,h)&&(C.push(we),V.push(z))}return qe(h,V),C}function Of(h){return h==null?h:jd.call(h)}function mp(h,m,C){var z=h==null?0:h.length;return z?(C&&typeof C!="number"&&Mi(h,m,C)?(m=0,C=z):(m=m==null?0:vn(m),C=C===a?z:vn(C)),xn(h,m,C)):[]}function L0(h,m){return On(h,m)}function Rg(h,m,C){return Nn(h,m,nn(C,2))}function D0(h,m){var C=h==null?0:h.length;if(C){var z=On(h,m);if(z<C&&es(h[z],m))return z}return-1}function F0(h,m){return On(h,m,!0)}function B0(h,m,C){return Nn(h,m,nn(C,2),!0)}function Lg(h,m){var C=h==null?0:h.length;if(C){var z=On(h,m,!0)-1;if(es(h[z],m))return z}return-1}function O0(h){return h&&h.length?Wn(h):[]}function N0(h,m){return h&&h.length?Wn(h,nn(m,2)):[]}function Xh(h){var m=h==null?0:h.length;return m?xn(h,1,m):[]}function Dg(h,m,C){return h&&h.length?(m=C||m===a?1:vn(m),xn(h,0,m<0?0:m)):[]}function Nf(h,m,C){var z=h==null?0:h.length;return z?(m=C||m===a?1:vn(m),m=z-m,xn(h,m<0?0:m,z)):[]}function Fg(h,m){return h&&h.length?Zi(h,nn(m,3),!1,!0):[]}function Vr(h,m){return h&&h.length?Zi(h,nn(m,3)):[]}var jf=lt(function(h){return Qn(jr(h,1,Rr,!0))}),j0=lt(function(h){var m=Qo(h);return Rr(m)&&(m=a),Qn(jr(h,1,Rr,!0),nn(m,2))}),Bg=lt(function(h){var m=Qo(h);return m=typeof m=="function"?m:a,Qn(jr(h,1,Rr,!0),a,m)});function Uf(h){return h&&h.length?Qn(h):[]}function Vf(h,m){return h&&h.length?Qn(h,nn(m,2)):[]}function U0(h,m){return m=typeof m=="function"?m:a,h&&h.length?Qn(h,a,m):[]}function Gf(h){if(!(h&&h.length))return[];var m=0;return h=Gi(h,function(C){if(Rr(C))return m=pn(C.length,m),!0}),Qu(m,function(C){return pr(h,Xu(C))})}function Og(h,m){if(!(h&&h.length))return[];var C=Gf(h);return m==null?C:pr(C,function(z){return Ui(m,a,z)})}var V0=lt(function(h,m){return Rr(h)?su(h,m):[]}),Ng=lt(function(h){return Io(Gi(h,Rr))}),Wi=lt(function(h){var m=Qo(h);return Rr(m)&&(m=a),Io(Gi(h,Rr),nn(m,2))}),$f=lt(function(h){var m=Qo(h);return m=typeof m=="function"?m:a,Io(Gi(h,Rr),a,m)}),jg=lt(Gf);function Tl(h,m){return xl(h||[],m||[],Aa)}function gp(h,m){return xl(h||[],m||[],Et)}var Kh=lt(function(h){var m=h.length,C=m>1?h[m-1]:a;return C=typeof C=="function"?(h.pop(),C):a,Og(h,C)});function vu(h){var m=X(h);return m.__chain__=!0,m}function _p(h,m){return m(h),h}function xu(h,m){return m(h)}var G0=Oa(function(h){var m=h.length,C=m?h[0]:0,z=this.__wrapped__,V=function(ee){return La(ee,h)};return m>1||this.__actions__.length||!(z instanceof _n)||!fo(C)?this.thru(V):(z=z.slice(C,+C+(m?1:0)),z.__actions__.push({func:xu,args:[V],thisArg:a}),new zn(z,this.__chain__).thru(function(ee){return m&&!ee.length&&ee.push(a),ee}))});function $0(){return vu(this)}function Ug(){return new zn(this.value(),this.__chain__)}function Vg(){this.__values__===a&&(this.__values__=Ep(this.value()));var h=this.__index__>=this.__values__.length,m=h?a:this.__values__[this.__index__++];return{done:h,value:m}}function Z0(){return this}function Gg(h){for(var m,C=this;C instanceof Jr;){var z=zf(C);z.__index__=0,z.__values__=a,m?V.__wrapped__=z:m=z;var V=z;C=C.__wrapped__}return V.__wrapped__=h,m}function $g(){var h=this.__wrapped__;if(h instanceof _n){var m=h;return this.__actions__.length&&(m=new _n(this)),m=m.reverse(),m.__actions__.push({func:xu,args:[Of],thisArg:a}),new zn(m,this.__chain__)}return this.thru(Of)}function Zf(){return Ci(this.__wrapped__,this.__actions__)}var qf=wl(function(h,m,C){Bn.call(h,C)?++h[C]:Gt(h,C,1)});function q0(h,m,C){var z=mn(h)?tl:Cr;return C&&Mi(h,m,C)&&(m=a),z(h,nn(m,3))}function Zg(h,m){var C=mn(h)?Gi:vl;return C(h,nn(m,3))}var W0=fg(pp),H0=fg(zc);function Y0(h,m){return jr(Rc(h,m),1)}function X0(h,m){return jr(Rc(h,m),We)}function K0(h,m,C){return C=C===a?1:vn(C),jr(Rc(h,m),C)}function Wf(h,m){var C=mn(h)?Kr:co;return C(h,nn(m,3))}function Hf(h,m){var C=mn(h)?Vi:Yn;return C(h,nn(m,3))}var Jh=wl(function(h,m,C){Bn.call(h,C)?h[C].push(m):Gt(h,C,[m])});function ea(h,m,C,z){h=Hi(h)?h:wr(h),C=C&&!z?vn(C):0;var V=h.length;return C<0&&(C=pn(V+C,0)),Oc(h)?C<=V&&h.indexOf(m,C)>-1:!!V&&ol(h,m,C)>-1}var Cl=lt(function(h,m,C){var z=-1,V=typeof m=="function",ee=Hi(h)?tt(h.length):[];return co(h,function(we){ee[++z]=V?Ui(m,we,C):ys(we,m,C)}),ee}),qg=wl(function(h,m,C){Gt(h,C,m)});function Rc(h,m){var C=mn(h)?pr:H;return C(h,nn(m,3))}function J0(h,m,C,z){return h==null?[]:(mn(m)||(m=m==null?[]:[m]),C=z?a:C,mn(C)||(C=C==null?[]:[C]),xe(h,m,C))}var Q0=wl(function(h,m,C){h[C?0:1].push(m)},function(){return[[],[]]});function yp(h,m,C){var z=mn(h)?_a:Ku,V=arguments.length<3;return z(h,nn(m,4),C,V,co)}function Yf(h,m,C){var z=mn(h)?ql:Ku,V=arguments.length<3;return z(h,nn(m,4),C,V,Yn)}function ev(h,m){var C=mn(h)?Gi:vl;return C(h,td(nn(m,3)))}function Xf(h){var m=mn(h)?iu:Tt;return m(h)}function Kf(h,m,C){(C?Mi(h,m,C):m===a)?m=1:m=vn(m);var z=mn(h)?_c:ft;return z(h,m)}function Lc(h){var m=mn(h)?Bh:ar;return m(h)}function Wg(h){if(h==null)return 0;if(Hi(h))return Oc(h)?al(h):h.length;var m=Ei(h);return m==Rt||m==Or?h.size:D(h).length}function Hg(h,m,C){var z=mn(h)?rl:lr;return C&&Mi(h,m,C)&&(m=a),z(h,nn(m,3))}var Jf=lt(function(h,m){if(h==null)return[];var C=m.length;return C>1&&Mi(h,m[0],m[1])?m=[]:C>2&&Mi(m[0],m[1],m[2])&&(m=[m[0]]),xe(h,jr(m,1),[])}),Qh=Nd||function(){return Tr.Date.now()};function vp(h,m){if(typeof m!="function")throw new $i(b);return h=vn(h),function(){if(--h<1)return m.apply(this,arguments)}}function Qf(h,m,C){return m=C?a:m,m=h&&m==null?h.length:m,vs(h,ht,a,a,a,a,m)}function Yg(h,m){var C;if(typeof m!="function")throw new $i(b);return h=vn(h),function(){return--h>0&&(C=m.apply(this,arguments)),h<=1&&(m=a),C}}var em=lt(function(h,m,C){var z=xt;if(C.length){var V=Si(C,bl(em));z|=ut}return vs(h,z,m,C,V)}),tm=lt(function(h,m,C){var z=xt|Ie;if(C.length){var V=Si(C,bl(tm));z|=ut}return vs(m,z,h,C,V)});function Xg(h,m,C){m=C?a:m;var z=vs(h,Te,a,a,a,a,a,m);return z.placeholder=Xg.placeholder,z}function Kg(h,m,C){m=C?a:m;var z=vs(h,Ne,a,a,a,a,a,m);return z.placeholder=Kg.placeholder,z}function Jg(h,m,C){var z,V,ee,we,Ae,Ge,yt=0,vt=!1,St=!1,Nt=!0;if(typeof h!="function")throw new $i(b);m=o(m)||0,Ir(C)&&(vt=!!C.leading,St="maxWait"in C,ee=St?pn(o(C.maxWait)||0,m):ee,Nt="trailing"in C?!!C.trailing:Nt);function Xt(ui){var Va=z,Su=V;return z=V=a,yt=ui,we=h.apply(Su,Va),we}function ln(ui){return yt=ui,Ae=_u(Rn,m),vt?Xt(ui):we}function An(ui){var Va=ui-Ge,Su=ui-yt,sw=m-Va;return St?xr(sw,ee-Su):sw}function un(ui){var Va=ui-Ge,Su=ui-yt;return Ge===a||Va>=m||Va<0||St&&Su>=ee}function Rn(){var ui=Qh();if(un(ui))return Vn(ui);Ae=_u(Rn,An(ui))}function Vn(ui){return Ae=a,Nt&&z?Xt(ui):(z=V=a,we)}function Cs(){Ae!==a&&Pi(Ae),yt=0,z=Ge=V=Ae=a}function Ro(){return Ae===a?we:Vn(Qh())}function Ps(){var ui=Qh(),Va=un(ui);if(z=arguments,V=this,Ge=ui,Va){if(Ae===a)return ln(Ge);if(St)return Pi(Ae),Ae=_u(Rn,m),Xt(Ge)}return Ae===a&&(Ae=_u(Rn,m)),we}return Ps.cancel=Cs,Ps.flush=Ro,Ps}var tv=lt(function(h,m){return Eo(h,1,m)}),nm=lt(function(h,m,C){return Eo(h,o(m)||0,C)});function Pl(h){return vs(h,le)}function ed(h,m){if(typeof h!="function"||m!=null&&typeof m!="function")throw new $i(b);var C=function(){var z=arguments,V=m?m.apply(this,z):z[0],ee=C.cache;if(ee.has(V))return ee.get(V);var we=h.apply(this,z);return C.cache=ee.set(V,we)||ee,we};return C.cache=new(ed.Cache||Ho),C}ed.Cache=Ho;function td(h){if(typeof h!="function")throw new $i(b);return function(){var m=arguments;switch(m.length){case 0:return!h.call(this);case 1:return!h.call(this,m[0]);case 2:return!h.call(this,m[0],m[1]);case 3:return!h.call(this,m[0],m[1],m[2])}return!h.apply(this,m)}}function Qg(h){return Yg(2,h)}var e_=ho(function(h,m){m=m.length==1&&mn(m[0])?pr(m[0],fi(nn())):pr(jr(m,1),fi(nn()));var C=m.length;return lt(function(z){for(var V=-1,ee=xr(z.length,C);++V<ee;)z[V]=m[V].call(this,z[V]);return Ui(h,this,z)})}),xp=lt(function(h,m){var C=Si(m,bl(xp));return vs(h,ut,a,m,C)}),wp=lt(function(h,m){var C=Si(m,bl(wp));return vs(h,ct,a,m,C)}),t_=Oa(function(h,m){return vs(h,$,a,a,a,m)});function nd(h,m){if(typeof h!="function")throw new $i(b);return m=m===a?m:vn(m),lt(h,m)}function n_(h,m){if(typeof h!="function")throw new $i(b);return m=m==null?0:pn(vn(m),0),lt(function(C){var z=C[m],V=Ur(C,0,m);return z&&Zo(V,z),Ui(h,this,V)})}function rm(h,m,C){var z=!0,V=!0;if(typeof h!="function")throw new $i(b);return Ir(C)&&(z="leading"in C?!!C.leading:z,V="trailing"in C?!!C.trailing:V),Jg(h,m,{leading:z,maxWait:m,trailing:V})}function r_(h){return Qf(h,1)}function Ao(h,m){return xp(Hs(m),h)}function Dc(){if(!arguments.length)return[];var h=arguments[0];return mn(h)?h:[h]}function i_(h){return _i(h,oe)}function o_(h,m){return m=typeof m=="function"?m:a,_i(h,oe,m)}function s_(h){return _i(h,ge|oe)}function a_(h,m){return m=typeof m=="function"?m:a,_i(h,ge|oe,m)}function l_(h,m){return m==null||Oh(h,m,Xe(m))}function es(h,m){return h===m||h!==h&&m!==m}var nv=Zh(_s),u_=Zh(function(h,m){return h>=m}),mo=xc(function(){return arguments}())?xc:function(h){return ur(h)&&Bn.call(h,"callee")&&!Ah.call(h,"callee")},mn=tt.isArray,c_=Zu?fi(Zu):g;function Hi(h){return h!=null&&Tp(h.length)&&!ts(h)}function Rr(h){return ur(h)&&Hi(h)}function rv(h){return h===!0||h===!1||ur(h)&&zr(h)==Kt}var El=tu||gv,h_=hs?fi(hs):e;function rd(h){return ur(h)&&h.nodeType===1&&!Bc(h)}function d_(h){if(h==null)return!0;if(Hi(h)&&(mn(h)||typeof h=="string"||typeof h.splice=="function"||El(h)||ta(h)||mo(h)))return!h.length;var m=Ei(h);if(m==Rt||m==Or)return!h.size;if(Na(h))return!D(h).length;for(var C in h)if(Bn.call(h,C))return!1;return!0}function bp(h,m){return r(h,m)}function p_(h,m,C){C=typeof C=="function"?C:a;var z=C?C(h,m):a;return z===a?r(h,m,a,C):!!z}function Fc(h){if(!ur(h))return!1;var m=zr(h);return m==Ht||m==Dn||typeof h.message=="string"&&typeof h.name=="string"&&!Bc(h)}function Sp(h){return typeof h=="number"&&hl(h)}function ts(h){if(!Ir(h))return!1;var m=zr(h);return m==tn||m==gn||m==Ft||m==hi}function f_(h){return typeof h=="number"&&h==vn(h)}function Tp(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=be}function Ir(h){var m=typeof h;return h!=null&&(m=="object"||m=="function")}function ur(h){return h!=null&&typeof h=="object"}var si=bh?fi(bh):d;function Ml(h,m){return h===m||_(h,m,pu(m))}function im(h,m,C){return C=typeof C=="function"?C:a,_(h,m,pu(m),C)}function m_(h){return sm(h)&&h!=+h}function g_(h){if(vg(h))throw new sn(T);return w(h)}function om(h){return h===null}function iv(h){return h==null}function sm(h){return typeof h=="number"||ur(h)&&zr(h)==rn}function Bc(h){if(!ur(h)||zr(h)!=Un)return!1;var m=fs(h);if(m===null)return!0;var C=Bn.call(m,"constructor")&&m.constructor;return typeof C=="function"&&C instanceof C&&Tn.call(C)==kh}var am=kd?fi(kd):P;function __(h){return f_(h)&&h>=-be&&h<=be}var Cp=Zl?fi(Zl):M;function Oc(h){return typeof h=="string"||!mn(h)&&ur(h)&&zr(h)==Di}function go(h){return typeof h=="symbol"||ur(h)&&zr(h)==Fi}var ta=qu?fi(qu):k;function lm(h){return h===a}function y_(h){return ur(h)&&Ei(h)==Bi}function um(h){return ur(h)&&zr(h)==eo}var Pp=Zh(G),id=Zh(function(h,m){return h<=m});function Ep(h){if(!h)return[];if(Hi(h))return Oc(h)?so(h):Er(h);if(Sa&&h[Sa])return rc(h[Sa]());var m=Ei(h),C=m==Rt?ic:m==Or?sl:wr;return C(h)}function xs(h){if(!h)return h===0?h:0;if(h=o(h),h===We||h===-We){var m=h<0?-1:1;return m*Ke}return h===h?h:0}function vn(h){var m=xs(h),C=m%1;return m===m?C?m-C:m:0}function v_(h){return h?Xo(vn(h),0,ue):0}function o(h){if(typeof h=="number")return h;if(go(h))return ye;if(Ir(h)){var m=typeof h.valueOf=="function"?h.valueOf():h;h=Ir(m)?m+"":m}if(typeof h!="string")return h===0?h:+h;h=ec(h);var C=ji.test(h);return C||Bl.test(h)?wh(h.slice(2),C?2:8):ir.test(h)?ye:+h}function t(h){return ko(h,pt(h))}function s(h){return h?Xo(vn(h),-be,be):h===0?h:0}function l(h){return h==null?"":jn(h)}var p=Ks(function(h,m){if(Na(m)||Hi(m)){ko(m,Xe(m),h);return}for(var C in m)Bn.call(m,C)&&Aa(h,C,m[C])}),y=Ks(function(h,m){ko(m,pt(m),h)}),v=Ks(function(h,m,C,z){ko(m,pt(m),h,z)}),S=Ks(function(h,m,C,z){ko(m,Xe(m),h,z)}),E=Oa(La);function I(h,m){var C=To(h);return m==null?C:Ra(C,m)}var A=lt(function(h,m){h=qn(h);var C=-1,z=m.length,V=z>2?m[2]:a;for(V&&Mi(m[0],m[1],V)&&(z=1);++C<z;)for(var ee=m[C],we=pt(ee),Ae=-1,Ge=we.length;++Ae<Ge;){var yt=we[Ae],vt=h[yt];(vt===a||es(vt,xa[yt])&&!Bn.call(h,yt))&&(h[yt]=ee[yt])}return h}),R=lt(function(h){return h.push(a,po),Ui(Bt,a,h)});function B(h,m){return zd(h,nn(m,3),yi)}function N(h,m){return zd(h,nn(m,3),Da)}function U(h,m){return h==null?h:uu(h,nn(m,3),pt)}function q(h,m){return h==null?h:Ko(h,nn(m,3),pt)}function Q(h,m){return h&&yi(h,nn(m,3))}function ae(h,m){return h&&Da(h,nn(m,3))}function Me(h){return h==null?[]:Fa(h,Xe(h))}function de(h){return h==null?[]:Fa(h,pt(h))}function O(h,m,C){var z=h==null?a:Mo(h,m);return z===a?C:z}function J(h,m){return h!=null&&op(h,m,Nh)}function _e(h,m){return h!=null&&op(h,m,vc)}var Ze=Gh(function(h,m,C){m!=null&&typeof m.toString!="function"&&(m=Vs.call(m)),h[m]=C},pm(gr)),dt=Gh(function(h,m,C){m!=null&&typeof m.toString!="function"&&(m=Vs.call(m)),Bn.call(h,m)?h[m].push(C):h[m]=[C]},nn),Je=lt(ys);function Xe(h){return Hi(h)?nr(h):D(h)}function pt(h){return Hi(h)?nr(h,!0):F(h)}function mt(h,m){var C={};return m=nn(m,3),yi(h,function(z,V,ee){Gt(C,m(z,V,ee),z)}),C}function wt(h,m){var C={};return m=nn(m,3),yi(h,function(z,V,ee){Gt(C,V,m(z,V,ee))}),C}var it=Ks(function(h,m,C){se(h,m,C)}),Bt=Ks(function(h,m,C,z){se(h,m,C,z)}),qt=Oa(function(h,m){var C={};if(h==null)return C;var z=!1;m=pr(m,function(ee){return ee=Pr(ee,h),z||(z=ee.length>1),ee}),ko(h,Cf(h),C),z&&(C=_i(C,ge|fe|oe,mg));for(var V=m.length;V--;)oi(C,m[V]);return C});function Zt(h,m){return wn(h,td(nn(m)))}var jt=Oa(function(h,m){return h==null?{}:Se(h,m)});function wn(h,m){if(h==null)return{};var C=pr(Cf(h),function(z){return[z]});return m=nn(m),Ce(h,C,function(z,V){return m(z,V[0])})}function yr(h,m,C){m=Pr(m,h);var z=-1,V=m.length;for(V||(V=1,h=a);++z<V;){var ee=h==null?a:h[Qs(m[z])];ee===a&&(z=V,ee=C),h=ts(ee)?ee.call(h):ee}return h}function Gr(h,m,C){return h==null?h:Et(h,m,C)}function mi(h,m,C,z){return z=typeof z=="function"?z:a,h==null?h:Et(h,m,C,z)}var _o=Sf(Xe),Ii=Sf(pt);function ai(h,m,C){var z=mn(h),V=z||El(h)||ta(h);if(m=nn(m,4),C==null){var ee=h&&h.constructor;V?C=z?new ee:[]:Ir(h)?C=ts(ee)?To(fs(h)):{}:C={}}return(V?Kr:yi)(h,function(we,Ae,Ge){return m(C,we,Ae,Ge)}),C}function mr(h,m){return h==null?!0:oi(h,m)}function ei(h,m,C){return h==null?h:Jo(h,m,Hs(C))}function li(h,m,C,z){return z=typeof z=="function"?z:a,h==null?h:Jo(h,m,Hs(C),z)}function wr(h){return h==null?[]:Th(h,Xe(h))}function ki(h){return h==null?[]:Th(h,pt(h))}function zo(h,m,C){return C===a&&(C=m,m=a),C!==a&&(C=o(C),C=C===C?C:0),m!==a&&(m=o(m),m=m===m?m:0),Xo(o(h),m,C)}function ti(h,m,C){return m=xs(m),C===a?(C=m,m=0):C=xs(C),h=o(h),Ws(h,m,C)}function Yi(h,m,C){if(C&&typeof C!="boolean"&&Mi(h,m,C)&&(m=C=a),C===a&&(typeof m=="boolean"?(C=m,m=a):typeof h=="boolean"&&(C=h,h=a)),h===a&&m===a?(h=0,m=1):(h=xs(h),m===a?(m=h,h=0):m=xs(m)),h>m){var z=h;h=m,m=z}if(C||h%1||m%1){var V=pc();return xr(h+V*(m-h+Md("1e-"+((V+"").length-1))),m)}return nt(h,m)}var $r=hu(function(h,m,C){return m=m.toLowerCase(),h+(C?Zr(m):m)});function Zr(h){return dm(l(h).toLowerCase())}function qr(h){return h=l(h),h&&h.replace(ph,Ch).replace(Gu,"")}function Lr(h,m,C){h=l(h),m=jn(m);var z=h.length;C=C===a?z:Xo(vn(C),0,z);var V=C;return C-=m.length,C>=0&&h.slice(C,V)==m}function rr(h){return h=l(h),h&&rt.test(h)?h.replace(He,Ph):h}function ws(h){return h=l(h),h&&ot.test(h)?h.replace(Jt,"\\$&"):h}var Nc=hu(function(h,m,C){return h+(C?"-":"")+m.toLowerCase()}),bs=hu(function(h,m,C){return h+(C?" ":"")+m.toLowerCase()}),ov=tp("toLowerCase");function jc(h,m,C){h=l(h),m=vn(m);var z=m?al(h):0;if(!m||z>=m)return h;var V=(m-z)/2;return rp(cl(V),C)+h+rp(Pa(V),C)}function wu(h,m,C){h=l(h),m=vn(m);var z=m?al(h):0;return m&&z<m?h+rp(m-z,C):h}function Uc(h,m,C){h=l(h),m=vn(m);var z=m?al(h):0;return m&&z<m?rp(m-z,C)+h:h}function Vc(h,m,C){return C||m==null?m=0:m&&(m=+m),Rh(l(h).replace(Mt,""),m||0)}function Gc(h,m,C){return(C?Mi(h,m,C):m===a)?m=1:m=vn(m),Qe(l(h),m)}function x_(){var h=arguments,m=l(h[0]);return h.length<3?m:m.replace(h[1],h[2])}var w_=hu(function(h,m,C){return h+(C?"_":"")+m.toLowerCase()});function b_(h,m,C){return C&&typeof C!="number"&&Mi(h,m,C)&&(m=C=a),C=C===a?ue:C>>>0,C?(h=l(h),h&&(typeof m=="string"||m!=null&&!am(m))&&(m=jn(m),!m&&Us(h))?Ur(so(h),0,C):h.split(m,C)):[]}var S_=hu(function(h,m,C){return h+(C?" ":"")+dm(m)});function cm(h,m,C){return h=l(h),C=C==null?0:Xo(vn(C),0,h.length),m=jn(m),h.slice(C,C+m.length)==m}function hm(h,m,C){var z=X.templateSettings;C&&Mi(h,m,C)&&(m=a),h=l(h),m=v({},m,z,Ec);var V=v({},m.imports,z.imports,Ec),ee=Xe(V),we=Th(V,ee),Ae,Ge,yt=0,vt=m.interpolate||jo,St="__p += '",Nt=va((m.escape||jo).source+"|"+vt.source+"|"+(vt===ke?Nr:jo).source+"|"+(m.evaluate||jo).source+"|$","g"),Xt="//# sourceURL="+(Bn.call(m,"sourceURL")?(m.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Mn+"]")+`
`;h.replace(Nt,function(un,Rn,Vn,Cs,Ro,Ps){return Vn||(Vn=Cs),St+=h.slice(yt,Ps).replace(pa,Xl),Rn&&(Ae=!0,St+=`' +
__e(`+Rn+`) +
'`),Ro&&(Ge=!0,St+=`';
`+Ro+`;
__p += '`),Vn&&(St+=`' +
((__t = (`+Vn+`)) == null ? '' : __t) +
'`),yt=Ps+un.length,un}),St+=`';
`;var ln=Bn.call(m,"variable")&&m.variable;if(!ln)St=`with (obj) {
`+St+`
}
`;else if(_r.test(ln))throw new sn(u);St=(Ge?St.replace(K,""):St).replace(he,"$1").replace(Pe,"$1;"),St="function("+(ln||"obj")+`) {
`+(ln?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ae?", __e = _.escape":"")+(Ge?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+St+`return __p
}`;var An=E_(function(){return Pn(ee,Xt+"return "+St).apply(a,we)});if(An.source=St,Fc(An))throw An;return An}function ja(h){return l(h).toLowerCase()}function T_(h){return l(h).toUpperCase()}function C_(h,m,C){if(h=l(h),h&&(C||m===a))return ec(h);if(!h||!(m=jn(m)))return h;var z=so(h),V=so(m),ee=tc(z,V),we=nc(z,V)+1;return Ur(z,ee,we).join("")}function sv(h,m,C){if(h=l(h),h&&(C||m===a))return h.slice(0,Dd(h)+1);if(!h||!(m=jn(m)))return h;var z=so(h),V=nc(z,so(m))+1;return Ur(z,0,V).join("")}function av(h,m,C){if(h=l(h),h&&(C||m===a))return h.replace(Mt,"");if(!h||!(m=jn(m)))return h;var z=so(h),V=tc(z,so(m));return Ur(z,V).join("")}function lv(h,m){var C=pe,z=Ve;if(Ir(m)){var V="separator"in m?m.separator:V;C="length"in m?vn(m.length):C,z="omission"in m?jn(m.omission):z}h=l(h);var ee=h.length;if(Us(h)){var we=so(h);ee=we.length}if(C>=ee)return h;var Ae=C-al(z);if(Ae<1)return z;var Ge=we?Ur(we,0,Ae).join(""):h.slice(0,Ae);if(V===a)return Ge+z;if(we&&(Ae+=Ge.length-Ae),am(V)){if(h.slice(Ae).search(V)){var yt,vt=Ge;for(V.global||(V=va(V.source,l(Sr.exec(V))+"g")),V.lastIndex=0;yt=V.exec(vt);)var St=yt.index;Ge=Ge.slice(0,St===a?Ae:St)}}else if(h.indexOf(jn(V),Ae)!=Ae){var Nt=Ge.lastIndexOf(V);Nt>-1&&(Ge=Ge.slice(0,Nt))}return Ge+z}function uv(h){return h=l(h),h&&Re.test(h)?h.replace(De,Fd):h}var cv=hu(function(h,m,C){return h+(C?" ":"")+m.toUpperCase()}),dm=tp("toUpperCase");function P_(h,m,C){return h=l(h),m=C?a:m,m===a?Eh(h)?lc(h):ya(h):h.match(m)||[]}var E_=lt(function(h,m){try{return Ui(h,a,m)}catch(C){return Fc(C)?C:new sn(C)}}),Ss=Oa(function(h,m){return Kr(m,function(C){C=Qs(C),Gt(h,C,em(h[C],h))}),h});function Mp(h){var m=h==null?0:h.length,C=nn();return h=m?pr(h,function(z){if(typeof z[1]!="function")throw new $i(b);return[C(z[0]),z[1]]}):[],lt(function(z){for(var V=-1;++V<m;){var ee=h[V];if(Ui(ee[0],this,z))return Ui(ee[1],this,z)}})}function M_(h){return Ti(_i(h,ge))}function pm(h){return function(){return h}}function hv(h,m){return h==null||h!==h?m:h}var dv=Pc(),vi=Pc(!0);function gr(h){return h}function Ua(h){return L(typeof h=="function"?h:_i(h,ge))}function Ts(h){return ie(_i(h,ge))}function bu(h,m){return re(h,_i(m,ge))}var na=lt(function(h,m){return function(C){return ys(C,h,m)}}),$T=lt(function(h,m){return function(C){return ys(h,C,m)}});function pv(h,m,C){var z=Xe(m),V=Fa(m,z);C==null&&!(Ir(m)&&(V.length||!z.length))&&(C=m,m=h,h=this,V=Fa(m,Xe(m)));var ee=!(Ir(C)&&"chain"in C)||!!C.chain,we=ts(h);return Kr(V,function(Ae){var Ge=m[Ae];h[Ae]=Ge,we&&(h.prototype[Ae]=function(){var yt=this.__chain__;if(ee||yt){var vt=h(this.__wrapped__),St=vt.__actions__=Er(this.__actions__);return St.push({func:Ge,args:arguments,thisArg:h}),vt.__chain__=yt,vt}return Ge.apply(h,Zo([this.value()],arguments))})}),h}function ZT(){return Tr._===this&&(Tr._=gf),this}function fv(){}function qT(h){return h=vn(h),lt(function(m){return ve(m,h)})}var WT=np(pr),HT=np(tl),YT=np(rl);function ow(h){return Ic(h)?Xu(Qs(h)):Ee(h)}function XT(h){return function(m){return h==null?a:Mo(h,m)}}var KT=vf(),JT=vf(!0);function mv(){return[]}function gv(){return!1}function QT(){return{}}function eC(){return""}function tC(){return!0}function nC(h,m){if(h=vn(h),h<1||h>be)return[];var C=ue,z=xr(h,ue);m=nn(m),h-=ue;for(var V=Qu(z,m);++C<h;)m(C);return V}function rC(h){return mn(h)?pr(h,Qs):go(h)?[h]:Er(wg(l(h)))}function iC(h){var m=++mf;return l(h)+m}var oC=$h(function(h,m){return h+m},0),sC=wf("ceil"),aC=$h(function(h,m){return h/m},1),lC=wf("floor");function uC(h){return h&&h.length?au(h,gr,_s):a}function cC(h,m){return h&&h.length?au(h,nn(m,2),_s):a}function hC(h){return Sh(h,gr)}function dC(h,m){return Sh(h,nn(m,2))}function pC(h){return h&&h.length?au(h,gr,G):a}function fC(h,m){return h&&h.length?au(h,nn(m,2),G):a}var mC=$h(function(h,m){return h*m},1),gC=wf("round"),_C=$h(function(h,m){return h-m},0);function yC(h){return h&&h.length?Ju(h,gr):0}function vC(h,m){return h&&h.length?Ju(h,nn(m,2)):0}return X.after=vp,X.ary=Qf,X.assign=p,X.assignIn=y,X.assignInWith=v,X.assignWith=S,X.at=E,X.before=Yg,X.bind=em,X.bindAll=Ss,X.bindKey=tm,X.castArray=Dc,X.chain=vu,X.chunk=Rf,X.compact=bg,X.concat=Lf,X.cond=Mp,X.conforms=M_,X.constant=pm,X.countBy=qf,X.create=I,X.curry=Xg,X.curryRight=Kg,X.debounce=Jg,X.defaults=A,X.defaultsDeep=R,X.defer=tv,X.delay=nm,X.difference=Sg,X.differenceBy=Tg,X.differenceWith=dp,X.drop=Cg,X.dropRight=Pg,X.dropRightWhile=Eg,X.dropWhile=Hh,X.fill=T0,X.filter=Zg,X.flatMap=Y0,X.flatMapDeep=X0,X.flatMapDepth=K0,X.flatten=fp,X.flattenDeep=C0,X.flattenDepth=P0,X.flip=Pl,X.flow=dv,X.flowRight=vi,X.fromPairs=Mg,X.functions=Me,X.functionsIn=de,X.groupBy=Jh,X.initial=M0,X.intersection=Yh,X.intersectionBy=Ig,X.intersectionWith=I0,X.invert=Ze,X.invertBy=dt,X.invokeMap=Cl,X.iteratee=Ua,X.keyBy=qg,X.keys=Xe,X.keysIn=pt,X.map=Rc,X.mapKeys=mt,X.mapValues=wt,X.matches=Ts,X.matchesProperty=bu,X.memoize=ed,X.merge=it,X.mergeWith=Bt,X.method=na,X.methodOf=$T,X.mixin=pv,X.negate=td,X.nthArg=qT,X.omit=qt,X.omitBy=Zt,X.once=Qg,X.orderBy=J0,X.over=WT,X.overArgs=e_,X.overEvery=HT,X.overSome=YT,X.partial=xp,X.partialRight=wp,X.partition=Q0,X.pick=jt,X.pickBy=wn,X.property=ow,X.propertyOf=XT,X.pull=R0,X.pullAll=Ff,X.pullAllBy=Bf,X.pullAllWith=kg,X.pullAt=Ag,X.range=KT,X.rangeRight=JT,X.rearg=t_,X.reject=ev,X.remove=zg,X.rest=nd,X.reverse=Of,X.sampleSize=Kf,X.set=Gr,X.setWith=mi,X.shuffle=Lc,X.slice=mp,X.sortBy=Jf,X.sortedUniq=O0,X.sortedUniqBy=N0,X.split=b_,X.spread=n_,X.tail=Xh,X.take=Dg,X.takeRight=Nf,X.takeRightWhile=Fg,X.takeWhile=Vr,X.tap=_p,X.throttle=rm,X.thru=xu,X.toArray=Ep,X.toPairs=_o,X.toPairsIn=Ii,X.toPath=rC,X.toPlainObject=t,X.transform=ai,X.unary=r_,X.union=jf,X.unionBy=j0,X.unionWith=Bg,X.uniq=Uf,X.uniqBy=Vf,X.uniqWith=U0,X.unset=mr,X.unzip=Gf,X.unzipWith=Og,X.update=ei,X.updateWith=li,X.values=wr,X.valuesIn=ki,X.without=V0,X.words=P_,X.wrap=Ao,X.xor=Ng,X.xorBy=Wi,X.xorWith=$f,X.zip=jg,X.zipObject=Tl,X.zipObjectDeep=gp,X.zipWith=Kh,X.entries=_o,X.entriesIn=Ii,X.extend=y,X.extendWith=v,pv(X,X),X.add=oC,X.attempt=E_,X.camelCase=$r,X.capitalize=Zr,X.ceil=sC,X.clamp=zo,X.clone=i_,X.cloneDeep=s_,X.cloneDeepWith=a_,X.cloneWith=o_,X.conformsTo=l_,X.deburr=qr,X.defaultTo=hv,X.divide=aC,X.endsWith=Lr,X.eq=es,X.escape=rr,X.escapeRegExp=ws,X.every=q0,X.find=W0,X.findIndex=pp,X.findKey=B,X.findLast=H0,X.findLastIndex=zc,X.findLastKey=N,X.floor=lC,X.forEach=Wf,X.forEachRight=Hf,X.forIn=U,X.forInRight=q,X.forOwn=Q,X.forOwnRight=ae,X.get=O,X.gt=nv,X.gte=u_,X.has=J,X.hasIn=_e,X.head=Df,X.identity=gr,X.includes=ea,X.indexOf=E0,X.inRange=ti,X.invoke=Je,X.isArguments=mo,X.isArray=mn,X.isArrayBuffer=c_,X.isArrayLike=Hi,X.isArrayLikeObject=Rr,X.isBoolean=rv,X.isBuffer=El,X.isDate=h_,X.isElement=rd,X.isEmpty=d_,X.isEqual=bp,X.isEqualWith=p_,X.isError=Fc,X.isFinite=Sp,X.isFunction=ts,X.isInteger=f_,X.isLength=Tp,X.isMap=si,X.isMatch=Ml,X.isMatchWith=im,X.isNaN=m_,X.isNative=g_,X.isNil=iv,X.isNull=om,X.isNumber=sm,X.isObject=Ir,X.isObjectLike=ur,X.isPlainObject=Bc,X.isRegExp=am,X.isSafeInteger=__,X.isSet=Cp,X.isString=Oc,X.isSymbol=go,X.isTypedArray=ta,X.isUndefined=lm,X.isWeakMap=y_,X.isWeakSet=um,X.join=k0,X.kebabCase=Nc,X.last=Qo,X.lastIndexOf=A0,X.lowerCase=bs,X.lowerFirst=ov,X.lt=Pp,X.lte=id,X.max=uC,X.maxBy=cC,X.mean=hC,X.meanBy=dC,X.min=pC,X.minBy=fC,X.stubArray=mv,X.stubFalse=gv,X.stubObject=QT,X.stubString=eC,X.stubTrue=tC,X.multiply=mC,X.nth=z0,X.noConflict=ZT,X.noop=fv,X.now=Qh,X.pad=jc,X.padEnd=wu,X.padStart=Uc,X.parseInt=Vc,X.random=Yi,X.reduce=yp,X.reduceRight=Yf,X.repeat=Gc,X.replace=x_,X.result=yr,X.round=gC,X.runInContext=Oe,X.sample=Xf,X.size=Wg,X.snakeCase=w_,X.some=Hg,X.sortedIndex=L0,X.sortedIndexBy=Rg,X.sortedIndexOf=D0,X.sortedLastIndex=F0,X.sortedLastIndexBy=B0,X.sortedLastIndexOf=Lg,X.startCase=S_,X.startsWith=cm,X.subtract=_C,X.sum=yC,X.sumBy=vC,X.template=hm,X.times=nC,X.toFinite=xs,X.toInteger=vn,X.toLength=v_,X.toLower=ja,X.toNumber=o,X.toSafeInteger=s,X.toString=l,X.toUpper=T_,X.trim=C_,X.trimEnd=sv,X.trimStart=av,X.truncate=lv,X.unescape=uv,X.uniqueId=iC,X.upperCase=cv,X.upperFirst=dm,X.each=Wf,X.eachRight=Hf,X.first=Df,pv(X,function(){var h={};return yi(X,function(m,C){Bn.call(X.prototype,C)||(h[C]=m)}),h}(),{chain:!1}),X.VERSION=f,Kr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(h){X[h].placeholder=X}),Kr(["drop","take"],function(h,m){_n.prototype[h]=function(C){C=C===a?1:pn(vn(C),0);var z=this.__filtered__&&!m?new _n(this):this.clone();return z.__filtered__?z.__takeCount__=xr(C,z.__takeCount__):z.__views__.push({size:xr(C,ue),type:h+(z.__dir__<0?"Right":"")}),z},_n.prototype[h+"Right"]=function(C){return this.reverse()[h](C).reverse()}}),Kr(["filter","map","takeWhile"],function(h,m){var C=m+1,z=C==Ye||C==ze;_n.prototype[h]=function(V){var ee=this.clone();return ee.__iteratees__.push({iteratee:nn(V,3),type:C}),ee.__filtered__=ee.__filtered__||z,ee}}),Kr(["head","last"],function(h,m){var C="take"+(m?"Right":"");_n.prototype[h]=function(){return this[C](1).value()[0]}}),Kr(["initial","tail"],function(h,m){var C="drop"+(m?"":"Right");_n.prototype[h]=function(){return this.__filtered__?new _n(this):this[C](1)}}),_n.prototype.compact=function(){return this.filter(gr)},_n.prototype.find=function(h){return this.filter(h).head()},_n.prototype.findLast=function(h){return this.reverse().find(h)},_n.prototype.invokeMap=lt(function(h,m){return typeof h=="function"?new _n(this):this.map(function(C){return ys(C,h,m)})}),_n.prototype.reject=function(h){return this.filter(td(nn(h)))},_n.prototype.slice=function(h,m){h=vn(h);var C=this;return C.__filtered__&&(h>0||m<0)?new _n(C):(h<0?C=C.takeRight(-h):h&&(C=C.drop(h)),m!==a&&(m=vn(m),C=m<0?C.dropRight(-m):C.take(m-h)),C)},_n.prototype.takeRightWhile=function(h){return this.reverse().takeWhile(h).reverse()},_n.prototype.toArray=function(){return this.take(ue)},yi(_n.prototype,function(h,m){var C=/^(?:filter|find|map|reject)|While$/.test(m),z=/^(?:head|last)$/.test(m),V=X[z?"take"+(m=="last"?"Right":""):m],ee=z||/^find/.test(m);V&&(X.prototype[m]=function(){var we=this.__wrapped__,Ae=z?[1]:arguments,Ge=we instanceof _n,yt=Ae[0],vt=Ge||mn(we),St=function(Rn){var Vn=V.apply(X,Zo([Rn],Ae));return z&&Nt?Vn[0]:Vn};vt&&C&&typeof yt=="function"&&yt.length!=1&&(Ge=vt=!1);var Nt=this.__chain__,Xt=!!this.__actions__.length,ln=ee&&!Nt,An=Ge&&!Xt;if(!ee&&vt){we=An?we:new _n(this);var un=h.apply(we,Ae);return un.__actions__.push({func:xu,args:[St],thisArg:a}),new zn(un,Nt)}return ln&&An?h.apply(this,Ae):(un=this.thru(St),ln?z?un.value()[0]:un.value():un)})}),Kr(["pop","push","shift","sort","splice","unshift"],function(h){var m=ps[h],C=/^(?:push|sort|unshift)$/.test(h)?"tap":"thru",z=/^(?:pop|shift)$/.test(h);X.prototype[h]=function(){var V=arguments;if(z&&!this.__chain__){var ee=this.value();return m.apply(mn(ee)?ee:[],V)}return this[C](function(we){return m.apply(mn(we)?we:[],V)})}}),yi(_n.prototype,function(h,m){var C=X[m];if(C){var z=C.name+"";Bn.call(Ma,z)||(Ma[z]=[]),Ma[z].push({name:m,func:C})}}),Ma[du(a,Ie).name]=[{name:"wrapper",func:a}],_n.prototype.clone=Co,_n.prototype.reverse=_l,_n.prototype.value=_f,X.prototype.at=G0,X.prototype.chain=$0,X.prototype.commit=Ug,X.prototype.next=Vg,X.prototype.plant=Gg,X.prototype.reverse=$g,X.prototype.toJSON=X.prototype.valueOf=X.prototype.value=Zf,X.prototype.first=X.prototype.head,Sa&&(X.prototype[Sa]=Z0),X},ao=Mh();io?((io.exports=ao)._=ao,$n._=ao):Tr._=ao}).call(Ap)})(Ny,Ny.exports);var ZM=Ny.exports;const vd=Zy(ZM),qM={Afghanistan:["   "],Albania:["Republika e Shqipris"],Algeria:["   "],"American Samoa":["Amerika Smoa"],Andorra:["Principat d'Andorra"],Angola:["Repblica de Angola"],Anguilla:[],"Antigua and Barbuda":[],Argentina:["Repblica Argentina"],Armenia:[" "],Aruba:[],Australia:[],Austria:["Republik sterreich"],land:["Ahvenanmaa"],Azerbaijan:["Azrbaycan Respublikas"],"The Bahamas":["The Bahamas"],Bahrain:[" "],Bangladesh:[" "],Barbados:[],Belarus:[" "],Belgium:["Koninkrijk Belgi"],Belize:["Bileez"],Benin:["Rpublique du Bnin"],Bermuda:[],Bhutan:[""],Bolivia:["Estado Plurinacional de Bolivia"],Bonaire:["Boneiru"],"Bosnia and Herzegovina":["Bosna i Hercegovina"],Botswana:["Lefatshe la Botswana"],Brazil:["Repblica Federativa do Brasil"],"British Virgin Islands":["British Virgin Islands"],Brunei:["Negara Brunei Darussalam"],Bulgaria:[" "],"Burkina Faso":["Burkna Faso"],Burundi:["Repuburika yUburundi"],Cambodia:[""],Cameroon:["Rpublique du Cameroun"],Canada:[],"Cape Verde":["Repblica de Cabo Verde"],"Cayman Islands":[],"Central African Republic":["Kdrsse t Bafrka"],Chad:[" "],Chile:["Repblica de Chile"],China:[""],"Christmas Island and Cocos Islands":["Wilayah Pulau Krismas & Wilayah Kepulauan Cocos"],Colombia:["Repblica de Colombia"],Comoros:["Udzima wa Komori"],"Republic of the Congo":["Rpublique du Congo"],"Democratic Republic of the Congo":["Rpublique dmocratique du Congo"],"Cook Islands":["Kki 'Airani"],"Costa Rica":["Repblica de Costa Rica"],"Cte d'Ivoire":["Kdiwari Jamana"],Croatia:["Republika Hrvatska"],Cuba:["Repblica de Cuba"],Curaao:["Krsou"],Cyprus:[" "],"Czech Republic":["esk republika"],Denmark:["Danmark"],Djibouti:[" "],Dominica:["Waitukubuli"],"Dominican Republic":["Repblica Dominicana"],"Timor-Leste":["Repblica Democrtica de Timor-Leste"],Ecuador:["Repblica del Ecuador"],Egypt:["  "],"El Salvador":["Repblica de El Salvador"],"Equatorial Guinea":["Repblica de Guinea Ecuatorial"],Eritrea:[" "],Estonia:["Eesti"],Ethiopia:["   "],"Falkland Islands":[],"Faroe Islands":["Froyar"],Fiji:["Matanitu Tugalala o Viti"],Finland:["Suomen tasavalta"],France:[],"French Polynesia":["Polynsie franaise"],Gabon:["Rpublique gabonaise"],"The Gambia":[],Georgia:[""],Germany:["Deutschland"],Ghana:[],Gibraltar:[],Greece:[" "],Greenland:["Kalaallit Nunaat"],Grenada:["Gwenad"],Guadeloupe:["Gwadloup"],Guam:[],Guatemala:["Repblica de Guatemala"],Guernsey:["Guernsi"],Guinea:["Rpublique de Guine"],"Guinea-Bissau":["Repblica da Guin-Bissau"],Guyana:[],Haiti:["Rpublique d'Hati"],Honduras:["Repblica de Honduras"],"Hong Kong":[""],Hungary:["Magyarorszg"],Iceland:["sland"],India:["Bhrat Gaarjya"],Indonesia:["Republik Indonesia"],Iran:["  "],Iraq:[" "],Ireland:["ire"],"Isle of Man":["Mannin, Ellan Vannin"],Israel:[" "],Italy:["Repubblica Italiana"],Jamaica:["Jumieka"],Japan:[""],Jersey:["Jrri"],Jordan:["  "],Kazakhstan:[" "],Kenya:["Jamhuri ya Kenya"],Kiribati:["Ribaberiki Kiribati"],"North Korea":[""],"South Korea":[""],Kosovo:["Republika e Kosovs"],Kuwait:[" "],Kyrgyzstan:[" "],Laos:["  "],Latvia:["Latvijas Republika"],Lebanon:[" "],Lesotho:["Naha ea Lesotho"],Liberia:[],Libya:[" "],Liechtenstein:["Frstentum Liechtenstein"],Lithuania:["Lietuvos Respublika"],Luxembourg:["Groussherzogtum Ltzebuerg"],Macau:[""],Madagascar:["Repoblikan'i Madagasikara"],Malawi:["Dziko la Malai"],Malaysia:[],Maldives:[" "],Mali:[],Malta:["Repubblika ta' Malta"],"Marshall Islands":["Aolepn Aorkin aje"],Martinique:["Matinik"],Mauritania:["  "],Mauritius:["Rpublique de Maurice"],Mayotte:[],Mexico:["Estados Unidos Mexicanos"],"Federated States of Micronesia":[],Moldova:["Republica Moldova"],Monaco:["Principaut de Monaco"],Mongolia:[" "],Montenegro:[" "],Montserrat:[],Morocco:[" "],Mozambique:["Repblica de Moambique"],Myanmar:["  "],Namibia:[],Nauru:["Repubrikin Naoero"],Nepal:["   "],Netherlands:["Nederland","Nederln"],"New Caledonia":["Nouvelle-Caldonie"],"New Zealand":["Aotearoa"],Nicaragua:["Repblica de Nicaragua"],Niger:["Rpublique du Niger"],Nigeria:["Jamhuriyar Tarayyar Najeriya"],Niue:["Niu"],"Norfolk Island":[],"North Macedonia":["  "],"Northern Mariana Islands":[],Norway:["Kongeriket Norge"],Oman:[" "],Pakistan:["  "],Palau:["Beluu er a Belau"],Palestine:[" "],Panama:["Repblica de Panam"],"Papua New Guinea":["Independen Stet bilong Papua Niugini"],Paraguay:["Repblica del Paraguay"],Peru:["Repblica del Per"],Philippines:["Republika ng Pilipinas"],"Pitcairn Islands":["Pitkern Ailen"],Poland:["Rzeczpospolita Polska"],Portugal:["Repblica Portuguesa"],"Puerto Rico":[],Qatar:[" "],Runion:["La Runion"],Romania:["Romnia"],Russia:[" "],Rwanda:["Repubulika y'u Rwanda"],Saba:[],"Sahrawi Arab Democratic Republic":["   "],"Saint Barthlemy":["Saint-Barthlemy"],"Saint Kitts and Nevis":[],"Saint Martin":["Saint-Martin"],"Saint Lucia":["Sent Lisi"],"Saint Pierre and Miquelon":[],"Saint Vincent and the Grenadines":[],Samoa:["Malo Saoloto Tutoatasi o Smoa"],"San Marino":["Repubblica di San Marino"],"So Tom and Prncipe":["Repblica Democrtica de So Tom e Prncipe"],"Saudi Arabia":["  "],Senegal:["Rpublique du Sngal"],Serbia:[" "],Seychelles:["Rpublique des Seychelles"],"Sierra Leone":["Ripblik f Siera Lin"],Singapore:["Republik Singapura"],"Sint Maarten":[],Slovakia:["Slovensk republika"],Slovenia:["Republika Slovenija"],"Solomon Islands":["Solomon Aelan"],Somalia:["Jamhuuriyadda Federaalka Soomaaliya"],"South Africa":["iRiphabhuliki yaseNingizimu Afrika"],"South Sudan":[],Spain:["Reino de Espaa"],"Sri Lanka":["    "],"Sint Eustatius":[],Sudan:[" "],Suriname:["Republiek Suriname"],Svalbard:[],Sweden:["Konungariket Sverige"],Switzerland:["Schweizerische Eidgenossenschaft"],Syria:["  "],Taiwan:[""],Tajikistan:[" "],Tanzania:["Jamhuri ya Muungano wa Tanzania"],Thailand:[""],Togo:["Rpublique togolaise"],Tokelau:[],Tonga:["Puleanga Fakatui o Tonga"],"Trinidad and Tobago":[],Tunisia:[" "],Turkey:["Trkiye Cumhuriyeti"],Turkmenistan:["Trkmenistan"],"Turks and Caicos Islands":[],Tuvalu:[],Uganda:["Jamhuri ya Uganda"],Ukraine:[""],"United Arab Emirates":["  "],"United Kingdom":[],"United States of America":[],"United States Virgin Islands":[],Uruguay:["Repblica Oriental del Uruguay"],Uzbekistan:[" "],Vanuatu:["Ripablik blong Vanuatu"],"Vatican City":["Stato della Citt del Vaticano"],Venezuela:["Repblica Bolivariana de Venezuela"],Vietnam:["Cng ha X hi ch ngha Vit Nam"],"Wallis and Futuna":["Uvea mo Futuna"],Yemen:[" "],Zambia:["Icitungu ca Zambia"],Zimbabwe:["Nyika yeZimbabwe"],"Western Sahara":[" "],Eswatini:["Umbuso weSwatini"],Antarctica:[],"Saint Helena":[]},WM=1e3,HM=[{parentCountryName:"Cyprus",countryNames:["Cyprus","Turkish Republic of Northern Cyprus","United Nations Buffer Zone in Cyprus"]},{parentCountryName:"Somalia",countryNames:["Somalia","Somaliland"]}],YM=["Dhekelia Cantonment","Guantanamo Bay Naval Base","Siachen Glacier","Akrotiri Sovereign Base Area","Baikonur","British Indian Ocean Territory"],Ib={"Ivory Coast":"Cte d'Ivoire","People's Republic of China":"China","Australian Indian Ocean Territories":"Christmas Island and Cocos Islands","East Timor":"Timor-Leste"},TT=(async()=>{const n=(await wM(async()=>{const{default:f}=await import("./ne_10m_admin_0_countries-Bd4ewiaF.js");return{default:f}},[])).default,i=[],a=HM.map(({parentCountryName:f,countryNames:x})=>{i.push(...x);const T=n.features.find(j=>j.properties.NAME_EN===f),b=x.map(j=>{const Z=n.features.find(me=>me.properties.NAME_EN===j);if(!Z)throw Error(`Could not find ${j}`);return _T(Z.geometry.coordinates)}),u=$M(SM(b));return u.properties=T.properties,u});return n.features=n.features.filter(f=>!i.includes(f.properties.NAME_EN)),n.features.push(...a),n})(),CT=(async()=>(await TT).features.filter(i=>{const a=i.properties.POP_EST;return!YM.includes(i.properties.NAME_EN)&&a>WM}).map(i=>{const a=CM(i),{properties:f}=i;let x=f.NAME_EN;Ib[x]&&(x=Ib[x]);let T=qM[x];T||(T=[],console.warn(`Could not find endonyms for ${x}`)),T=T.filter(u=>u!==x);const b={name:x,endonyms:T,codeIso3:f.ISO_A3,geojson:i,bbox:a,coordLonLat:[f.LABEL_X,f.LABEL_Y],nameLon:f.LABEL_X,nameLat:f.LABEL_Y,type:f.TYPE,regionUn:f.REGION_UN,regionWb:f.REGION_WB,subRegion:f.SUBREGION,continent:f.CONTINENT};for(const u in b)if(!b[u])throw Error(`Missing key ${u} from ${f}`);return b}))();(async()=>{const n=await CT;console.info("Countries",vd.groupBy(n,"type"))})();let XM=Math.random();const KM=async()=>{const n=await l0(),i=Math.floor(XM*n.length);return n[i]},l0=async()=>await CT,PT=async()=>await TT,JM=async n=>(await l0()).find(a=>a.name===n),ET=()=>{const[n,i]=en.useState([]),a=dg(f=>f.main.guessedCountryNames);return en.useEffect(()=>{(async()=>{const f=await Promise.all(a.map(async x=>JM(x)));i(f)})()},[a]),n},u0=()=>{const[n,i]=en.useState(null);return en.useEffect(()=>{(async()=>{try{const a=await KM();i(a)}catch(a){console.error(a)}})()},[]),n};var MT={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(n){(function(){var i={}.hasOwnProperty;function a(){for(var T="",b=0;b<arguments.length;b++){var u=arguments[b];u&&(T=x(T,f(u)))}return T}function f(T){if(typeof T=="string"||typeof T=="number")return T;if(typeof T!="object")return"";if(Array.isArray(T))return a.apply(null,T);if(T.toString!==Object.prototype.toString&&!T.toString.toString().includes("[native code]"))return T.toString();var b="";for(var u in T)i.call(T,u)&&T[u]&&(b=x(b,u));return b}function x(T,b){return b?T?T+" "+b:T+b:T}n.exports?(a.default=a,n.exports=a):window.classNames=a})()})(MT);var QM=MT.exports;const of=Zy(QM);function Xi(n){return`Minified Redux error #${n}; visit https://redux.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var eI=typeof Symbol=="function"&&Symbol.observable||"@@observable",kb=eI,Hv=()=>Math.random().toString(36).substring(7).split("").join("."),tI={INIT:`@@redux/INIT${Hv()}`,REPLACE:`@@redux/REPLACE${Hv()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Hv()}`},jy=tI;function tw(n){if(typeof n!="object"||n===null)return!1;let i=n;for(;Object.getPrototypeOf(i)!==null;)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(n)===i||Object.getPrototypeOf(n)===null}function IT(n,i,a){if(typeof n!="function")throw new Error(Xi(2));if(typeof i=="function"&&typeof a=="function"||typeof a=="function"&&typeof arguments[3]=="function")throw new Error(Xi(0));if(typeof i=="function"&&typeof a>"u"&&(a=i,i=void 0),typeof a<"u"){if(typeof a!="function")throw new Error(Xi(1));return a(IT)(n,i)}let f=n,x=i,T=new Map,b=T,u=0,j=!1;function Z(){b===T&&(b=new Map,T.forEach((xt,Ie)=>{b.set(Ie,xt)}))}function me(){if(j)throw new Error(Xi(3));return x}function ge(xt){if(typeof xt!="function")throw new Error(Xi(4));if(j)throw new Error(Xi(5));let Ie=!0;Z();const ne=u++;return b.set(ne,xt),function(){if(Ie){if(j)throw new Error(Xi(6));Ie=!1,Z(),b.delete(ne),T=null}}}function fe(xt){if(!tw(xt))throw new Error(Xi(7));if(typeof xt.type>"u")throw new Error(Xi(8));if(typeof xt.type!="string")throw new Error(Xi(17));if(j)throw new Error(Xi(9));try{j=!0,x=f(x,xt)}finally{j=!1}return(T=b).forEach(ne=>{ne()}),xt}function oe(xt){if(typeof xt!="function")throw new Error(Xi(10));f=xt,fe({type:jy.REPLACE})}function Be(){const xt=ge;return{subscribe(Ie){if(typeof Ie!="object"||Ie===null)throw new Error(Xi(11));function ne(){const Ne=Ie;Ne.next&&Ne.next(me())}return ne(),{unsubscribe:xt(ne)}},[kb](){return this}}}return fe({type:jy.INIT}),{dispatch:fe,subscribe:ge,getState:me,replaceReducer:oe,[kb]:Be}}function nI(n){Object.keys(n).forEach(i=>{const a=n[i];if(typeof a(void 0,{type:jy.INIT})>"u")throw new Error(Xi(12));if(typeof a(void 0,{type:jy.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Xi(13))})}function rI(n){const i=Object.keys(n),a={};for(let T=0;T<i.length;T++){const b=i[T];typeof n[b]=="function"&&(a[b]=n[b])}const f=Object.keys(a);let x;try{nI(a)}catch(T){x=T}return function(b={},u){if(x)throw x;let j=!1;const Z={};for(let me=0;me<f.length;me++){const ge=f[me],fe=a[ge],oe=b[ge],Be=fe(oe,u);if(typeof Be>"u")throw u&&u.type,new Error(Xi(14));Z[ge]=Be,j=j||Be!==oe}return j=j||f.length!==Object.keys(b).length,j?Z:b}}function Uy(...n){return n.length===0?i=>i:n.length===1?n[0]:n.reduce((i,a)=>(...f)=>i(a(...f)))}function iI(...n){return i=>(a,f)=>{const x=i(a,f);let T=()=>{throw new Error(Xi(15))};const b={getState:x.getState,dispatch:(j,...Z)=>T(j,...Z)},u=n.map(j=>j(b));return T=Uy(...u)(x.dispatch),{...x,dispatch:T}}}function oI(n){return tw(n)&&"type"in n&&typeof n.type=="string"}var kT=Symbol.for("immer-nothing"),Ab=Symbol.for("immer-draftable"),zs=Symbol.for("immer-state");function Ha(n,...i){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var sf=Object.getPrototypeOf;function xd(n){return!!n&&!!n[zs]}function Du(n){var i;return n?AT(n)||Array.isArray(n)||!!n[Ab]||!!((i=n.constructor)!=null&&i[Ab])||h0(n)||d0(n):!1}var sI=Object.prototype.constructor.toString();function AT(n){if(!n||typeof n!="object")return!1;const i=sf(n);if(i===null)return!0;const a=Object.hasOwnProperty.call(i,"constructor")&&i.constructor;return a===Object?!0:typeof a=="function"&&Function.toString.call(a)===sI}function Vy(n,i){c0(n)===0?Reflect.ownKeys(n).forEach(a=>{i(a,n[a],n)}):n.forEach((a,f)=>i(f,a,n))}function c0(n){const i=n[zs];return i?i.type_:Array.isArray(n)?1:h0(n)?2:d0(n)?3:0}function Kx(n,i){return c0(n)===2?n.has(i):Object.prototype.hasOwnProperty.call(n,i)}function zT(n,i,a){const f=c0(n);f===2?n.set(i,a):f===3?n.add(a):n[i]=a}function aI(n,i){return n===i?n!==0||1/n===1/i:n!==n&&i!==i}function h0(n){return n instanceof Map}function d0(n){return n instanceof Set}function ld(n){return n.copy_||n.base_}function Jx(n,i){if(h0(n))return new Map(n);if(d0(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const a=AT(n);if(i===!0||i==="class_only"&&!a){const f=Object.getOwnPropertyDescriptors(n);delete f[zs];let x=Reflect.ownKeys(f);for(let T=0;T<x.length;T++){const b=x[T],u=f[b];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(f[b]={configurable:!0,writable:!0,enumerable:u.enumerable,value:n[b]})}return Object.create(sf(n),f)}else{const f=sf(n);if(f!==null&&a)return{...n};const x=Object.create(f);return Object.assign(x,n)}}function nw(n,i=!1){return p0(n)||xd(n)||!Du(n)||(c0(n)>1&&(n.set=n.add=n.clear=n.delete=lI),Object.freeze(n),i&&Object.entries(n).forEach(([a,f])=>nw(f,!0))),n}function lI(){Ha(2)}function p0(n){return Object.isFrozen(n)}var uI={};function wd(n){const i=uI[n];return i||Ha(0,n),i}var rg;function RT(){return rg}function cI(n,i){return{drafts_:[],parent_:n,immer_:i,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function zb(n,i){i&&(wd("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=i)}function Qx(n){e1(n),n.drafts_.forEach(hI),n.drafts_=null}function e1(n){n===rg&&(rg=n.parent_)}function Rb(n){return rg=cI(rg,n)}function hI(n){const i=n[zs];i.type_===0||i.type_===1?i.revoke_():i.revoked_=!0}function Lb(n,i){i.unfinalizedDrafts_=i.drafts_.length;const a=i.drafts_[0];return n!==void 0&&n!==a?(a[zs].modified_&&(Qx(i),Ha(4)),Du(n)&&(n=Gy(i,n),i.parent_||$y(i,n)),i.patches_&&wd("Patches").generateReplacementPatches_(a[zs].base_,n,i.patches_,i.inversePatches_)):n=Gy(i,a,[]),Qx(i),i.patches_&&i.patchListener_(i.patches_,i.inversePatches_),n!==kT?n:void 0}function Gy(n,i,a){if(p0(i))return i;const f=i[zs];if(!f)return Vy(i,(x,T)=>Db(n,f,i,x,T,a)),i;if(f.scope_!==n)return i;if(!f.modified_)return $y(n,f.base_,!0),f.base_;if(!f.finalized_){f.finalized_=!0,f.scope_.unfinalizedDrafts_--;const x=f.copy_;let T=x,b=!1;f.type_===3&&(T=new Set(x),x.clear(),b=!0),Vy(T,(u,j)=>Db(n,f,x,u,j,a,b)),$y(n,x,!1),a&&n.patches_&&wd("Patches").generatePatches_(f,a,n.patches_,n.inversePatches_)}return f.copy_}function Db(n,i,a,f,x,T,b){if(xd(x)){const u=T&&i&&i.type_!==3&&!Kx(i.assigned_,f)?T.concat(f):void 0,j=Gy(n,x,u);if(zT(a,f,j),xd(j))n.canAutoFreeze_=!1;else return}else b&&a.add(x);if(Du(x)&&!p0(x)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;Gy(n,x),(!i||!i.scope_.parent_)&&typeof f!="symbol"&&Object.prototype.propertyIsEnumerable.call(a,f)&&$y(n,x)}}function $y(n,i,a=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&nw(i,a)}function dI(n,i){const a=Array.isArray(n),f={type_:a?1:0,scope_:i?i.scope_:RT(),modified_:!1,finalized_:!1,assigned_:{},parent_:i,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let x=f,T=rw;a&&(x=[f],T=ig);const{revoke:b,proxy:u}=Proxy.revocable(x,T);return f.draft_=u,f.revoke_=b,u}var rw={get(n,i){if(i===zs)return n;const a=ld(n);if(!Kx(a,i))return pI(n,a,i);const f=a[i];return n.finalized_||!Du(f)?f:f===Yv(n.base_,i)?(Xv(n),n.copy_[i]=n1(f,n)):f},has(n,i){return i in ld(n)},ownKeys(n){return Reflect.ownKeys(ld(n))},set(n,i,a){const f=LT(ld(n),i);if(f!=null&&f.set)return f.set.call(n.draft_,a),!0;if(!n.modified_){const x=Yv(ld(n),i),T=x==null?void 0:x[zs];if(T&&T.base_===a)return n.copy_[i]=a,n.assigned_[i]=!1,!0;if(aI(a,x)&&(a!==void 0||Kx(n.base_,i)))return!0;Xv(n),t1(n)}return n.copy_[i]===a&&(a!==void 0||i in n.copy_)||Number.isNaN(a)&&Number.isNaN(n.copy_[i])||(n.copy_[i]=a,n.assigned_[i]=!0),!0},deleteProperty(n,i){return Yv(n.base_,i)!==void 0||i in n.base_?(n.assigned_[i]=!1,Xv(n),t1(n)):delete n.assigned_[i],n.copy_&&delete n.copy_[i],!0},getOwnPropertyDescriptor(n,i){const a=ld(n),f=Reflect.getOwnPropertyDescriptor(a,i);return f&&{writable:!0,configurable:n.type_!==1||i!=="length",enumerable:f.enumerable,value:a[i]}},defineProperty(){Ha(11)},getPrototypeOf(n){return sf(n.base_)},setPrototypeOf(){Ha(12)}},ig={};Vy(rw,(n,i)=>{ig[n]=function(){return arguments[0]=arguments[0][0],i.apply(this,arguments)}});ig.deleteProperty=function(n,i){return ig.set.call(this,n,i,void 0)};ig.set=function(n,i,a){return rw.set.call(this,n[0],i,a,n[0])};function Yv(n,i){const a=n[zs];return(a?ld(a):n)[i]}function pI(n,i,a){var x;const f=LT(i,a);return f?"value"in f?f.value:(x=f.get)==null?void 0:x.call(n.draft_):void 0}function LT(n,i){if(!(i in n))return;let a=sf(n);for(;a;){const f=Object.getOwnPropertyDescriptor(a,i);if(f)return f;a=sf(a)}}function t1(n){n.modified_||(n.modified_=!0,n.parent_&&t1(n.parent_))}function Xv(n){n.copy_||(n.copy_=Jx(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var fI=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(i,a,f)=>{if(typeof i=="function"&&typeof a!="function"){const T=a;a=i;const b=this;return function(j=T,...Z){return b.produce(j,me=>a.call(this,me,...Z))}}typeof a!="function"&&Ha(6),f!==void 0&&typeof f!="function"&&Ha(7);let x;if(Du(i)){const T=Rb(this),b=n1(i,void 0);let u=!0;try{x=a(b),u=!1}finally{u?Qx(T):e1(T)}return zb(T,f),Lb(x,T)}else if(!i||typeof i!="object"){if(x=a(i),x===void 0&&(x=i),x===kT&&(x=void 0),this.autoFreeze_&&nw(x,!0),f){const T=[],b=[];wd("Patches").generateReplacementPatches_(i,x,T,b),f(T,b)}return x}else Ha(1,i)},this.produceWithPatches=(i,a)=>{if(typeof i=="function")return(b,...u)=>this.produceWithPatches(b,j=>i(j,...u));let f,x;return[this.produce(i,a,(b,u)=>{f=b,x=u}),f,x]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){Du(n)||Ha(8),xd(n)&&(n=mI(n));const i=Rb(this),a=n1(n,void 0);return a[zs].isManual_=!0,e1(i),a}finishDraft(n,i){const a=n&&n[zs];(!a||!a.isManual_)&&Ha(9);const{scope_:f}=a;return zb(f,i),Lb(void 0,f)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,i){let a;for(a=i.length-1;a>=0;a--){const x=i[a];if(x.path.length===0&&x.op==="replace"){n=x.value;break}}a>-1&&(i=i.slice(a+1));const f=wd("Patches").applyPatches_;return xd(n)?f(n,i):this.produce(n,x=>f(x,i))}};function n1(n,i){const a=h0(n)?wd("MapSet").proxyMap_(n,i):d0(n)?wd("MapSet").proxySet_(n,i):dI(n,i);return(i?i.scope_:RT()).drafts_.push(a),a}function mI(n){return xd(n)||Ha(10,n),DT(n)}function DT(n){if(!Du(n)||p0(n))return n;const i=n[zs];let a;if(i){if(!i.modified_)return i.base_;i.finalized_=!0,a=Jx(n,i.scope_.immer_.useStrictShallowCopy_)}else a=Jx(n,!0);return Vy(a,(f,x)=>{zT(a,f,DT(x))}),i&&(i.finalized_=!1),a}var Rs=new fI,FT=Rs.produce;Rs.produceWithPatches.bind(Rs);Rs.setAutoFreeze.bind(Rs);Rs.setUseStrictShallowCopy.bind(Rs);Rs.applyPatches.bind(Rs);Rs.createDraft.bind(Rs);Rs.finishDraft.bind(Rs);function BT(n){return({dispatch:a,getState:f})=>x=>T=>typeof T=="function"?T(a,f,n):x(T)}var gI=BT(),_I=BT,yI=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Uy:Uy.apply(null,arguments)};function Fb(n,i){function a(...f){if(i){let x=i(...f);if(!x)throw new Error(Fl(0));return{type:n,payload:x.payload,..."meta"in x&&{meta:x.meta},..."error"in x&&{error:x.error}}}return{type:n,payload:f[0]}}return a.toString=()=>`${n}`,a.type=n,a.match=f=>oI(f)&&f.type===n,a}var OT=class km extends Array{constructor(...i){super(...i),Object.setPrototypeOf(this,km.prototype)}static get[Symbol.species](){return km}concat(...i){return super.concat.apply(this,i)}prepend(...i){return i.length===1&&Array.isArray(i[0])?new km(...i[0].concat(this)):new km(...i.concat(this))}};function Bb(n){return Du(n)?FT(n,()=>{}):n}function Ob(n,i,a){if(n.has(i)){let x=n.get(i);return a.update&&(x=a.update(x,i,n),n.set(i,x)),x}if(!a.insert)throw new Error(Fl(10));const f=a.insert(i,n);return n.set(i,f),f}function vI(n){return typeof n=="boolean"}var xI=()=>function(i){const{thunk:a=!0,immutableCheck:f=!0,serializableCheck:x=!0,actionCreatorCheck:T=!0}=i??{};let b=new OT;return a&&(vI(a)?b.push(gI):b.push(_I(a.extraArgument))),b},wI="RTK_autoBatch",NT=n=>i=>{setTimeout(i,n)},bI=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:NT(10),SI=(n={type:"raf"})=>i=>(...a)=>{const f=i(...a);let x=!0,T=!1,b=!1;const u=new Set,j=n.type==="tick"?queueMicrotask:n.type==="raf"?bI:n.type==="callback"?n.queueNotification:NT(n.timeout),Z=()=>{b=!1,T&&(T=!1,u.forEach(me=>me()))};return Object.assign({},f,{subscribe(me){const ge=()=>x&&me(),fe=f.subscribe(ge);return u.add(me),()=>{fe(),u.delete(me)}},dispatch(me){var ge;try{return x=!((ge=me==null?void 0:me.meta)!=null&&ge[wI]),T=!x,T&&(b||(b=!0,j(Z))),f.dispatch(me)}finally{x=!0}}})},TI=n=>function(a){const{autoBatch:f=!0}=a??{};let x=new OT(n);return f&&x.push(SI(typeof f=="object"?f:void 0)),x};function CI(n){const i=xI(),{reducer:a=void 0,middleware:f,devTools:x=!0,preloadedState:T=void 0,enhancers:b=void 0}=n||{};let u;if(typeof a=="function")u=a;else if(tw(a))u=rI(a);else throw new Error(Fl(1));let j;typeof f=="function"?j=f(i):j=i();let Z=Uy;x&&(Z=yI({trace:!1,...typeof x=="object"&&x}));const me=iI(...j),ge=TI(me);let fe=typeof b=="function"?b(ge):ge();const oe=Z(...fe);return IT(u,T,oe)}function jT(n){const i={},a=[];let f;const x={addCase(T,b){const u=typeof T=="string"?T:T.type;if(!u)throw new Error(Fl(28));if(u in i)throw new Error(Fl(29));return i[u]=b,x},addMatcher(T,b){return a.push({matcher:T,reducer:b}),x},addDefaultCase(T){return f=T,x}};return n(x),[i,a,f]}function PI(n){return typeof n=="function"}function EI(n,i){let[a,f,x]=jT(i),T;if(PI(n))T=()=>Bb(n());else{const u=Bb(n);T=()=>u}function b(u=T(),j){let Z=[a[j.type],...f.filter(({matcher:me})=>me(j)).map(({reducer:me})=>me)];return Z.filter(me=>!!me).length===0&&(Z=[x]),Z.reduce((me,ge)=>{if(ge)if(xd(me)){const oe=ge(me,j);return oe===void 0?me:oe}else{if(Du(me))return FT(me,fe=>ge(fe,j));{const fe=ge(me,j);if(fe===void 0){if(me===null)return me;throw Error("A case reducer on a non-draftable value must not return undefined")}return fe}}return me},u)}return b.getInitialState=T,b}var MI=Symbol.for("rtk-slice-createasyncthunk");function II(n,i){return`${n}/${i}`}function kI({creators:n}={}){var a;const i=(a=n==null?void 0:n.asyncThunk)==null?void 0:a[MI];return function(x){const{name:T,reducerPath:b=T}=x;if(!T)throw new Error(Fl(11));typeof process<"u";const u=(typeof x.reducers=="function"?x.reducers(RI()):x.reducers)||{},j=Object.keys(u),Z={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},me={addCase(Te,Ne){const ut=typeof Te=="string"?Te:Te.type;if(!ut)throw new Error(Fl(12));if(ut in Z.sliceCaseReducersByType)throw new Error(Fl(13));return Z.sliceCaseReducersByType[ut]=Ne,me},addMatcher(Te,Ne){return Z.sliceMatchers.push({matcher:Te,reducer:Ne}),me},exposeAction(Te,Ne){return Z.actionCreators[Te]=Ne,me},exposeCaseReducer(Te,Ne){return Z.sliceCaseReducersByName[Te]=Ne,me}};j.forEach(Te=>{const Ne=u[Te],ut={reducerName:Te,type:II(T,Te),createNotation:typeof x.reducers=="function"};DI(Ne)?BI(ut,Ne,me,i):LI(ut,Ne,me)});function ge(){const[Te={},Ne=[],ut=void 0]=typeof x.extraReducers=="function"?jT(x.extraReducers):[x.extraReducers],ct={...Te,...Z.sliceCaseReducersByType};return EI(x.initialState,ht=>{for(let $ in ct)ht.addCase($,ct[$]);for(let $ of Z.sliceMatchers)ht.addMatcher($.matcher,$.reducer);for(let $ of Ne)ht.addMatcher($.matcher,$.reducer);ut&&ht.addDefaultCase(ut)})}const fe=Te=>Te,oe=new Map;let Be;function _t(Te,Ne){return Be||(Be=ge()),Be(Te,Ne)}function xt(){return Be||(Be=ge()),Be.getInitialState()}function Ie(Te,Ne=!1){function ut(ht){let $=ht[Te];return typeof $>"u"&&Ne&&($=xt()),$}function ct(ht=fe){const $=Ob(oe,Ne,{insert:()=>new WeakMap});return Ob($,ht,{insert:()=>{const le={};for(const[pe,Ve]of Object.entries(x.selectors??{}))le[pe]=AI(Ve,ht,xt,Ne);return le}})}return{reducerPath:Te,getSelectors:ct,get selectors(){return ct(ut)},selectSlice:ut}}const ne={name:T,reducer:_t,actions:Z.actionCreators,caseReducers:Z.sliceCaseReducersByName,getInitialState:xt,...Ie(b),injectInto(Te,{reducerPath:Ne,...ut}={}){const ct=Ne??b;return Te.inject({reducerPath:ct,reducer:_t},ut),{...ne,...Ie(ct,!0)}}};return ne}}function AI(n,i,a,f){function x(T,...b){let u=i(T);return typeof u>"u"&&f&&(u=a()),n(u,...b)}return x.unwrapped=n,x}var zI=kI();function RI(){function n(i,a){return{_reducerDefinitionType:"asyncThunk",payloadCreator:i,...a}}return n.withTypes=()=>n,{reducer(i){return Object.assign({[i.name](...a){return i(...a)}}[i.name],{_reducerDefinitionType:"reducer"})},preparedReducer(i,a){return{_reducerDefinitionType:"reducerWithPrepare",prepare:i,reducer:a}},asyncThunk:n}}function LI({type:n,reducerName:i,createNotation:a},f,x){let T,b;if("reducer"in f){if(a&&!FI(f))throw new Error(Fl(17));T=f.reducer,b=f.prepare}else T=f;x.addCase(n,T).exposeCaseReducer(i,T).exposeAction(i,b?Fb(n,b):Fb(n))}function DI(n){return n._reducerDefinitionType==="asyncThunk"}function FI(n){return n._reducerDefinitionType==="reducerWithPrepare"}function BI({type:n,reducerName:i},a,f,x){if(!x)throw new Error(Fl(18));const{payloadCreator:T,fulfilled:b,pending:u,rejected:j,settled:Z,options:me}=a,ge=x(n,T,me);f.exposeAction(i,ge),b&&f.addCase(ge.fulfilled,b),u&&f.addCase(ge.pending,u),j&&f.addCase(ge.rejected,j),Z&&f.addMatcher(ge.settled,Z),f.exposeCaseReducer(i,{fulfilled:b||Y_,pending:u||Y_,rejected:j||Y_,settled:Z||Y_})}function Y_(){}function Fl(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}const af=zI({name:"main",initialState:{isMapInitialized:!1,guessedCountryNames:[],isWinModalVisible:!1},reducers:{setIsMapInitialized:(n,i)=>{n.isMapInitialized=i.payload},addGuessedCountryName:(n,i)=>{n.guessedCountryNames.unshift(i.payload)},setIsWinModalVisible:(n,i)=>{n.isWinModalVisible=i.payload}}});var UT={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.1.1/LICENSE.txt
 */(function(n,i){(function(a,f){n.exports=f()})(Ap,function(){var a={},f={};function x(b,u,j){if(f[b]=j,b==="index"){var Z="var sharedModule = {}; ("+f.shared+")(sharedModule); ("+f.worker+")(sharedModule);",me={};return f.shared(me),f.index(a,me),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"}))),a}}x("shared",["exports"],function(b){function u(o,t,s,l){return new(s||(s=Promise))(function(p,y){function v(I){try{E(l.next(I))}catch(A){y(A)}}function S(I){try{E(l.throw(I))}catch(A){y(A)}}function E(I){var A;I.done?p(I.value):(A=I.value,A instanceof s?A:new s(function(R){R(A)})).then(v,S)}E((l=l.apply(o,t||[])).next())})}function j(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Z,me;function ge(){if(me)return Z;function o(t,s){this.x=t,this.y=s}return me=1,Z=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,s){return this.clone()._rotateAround(t,s)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var s=t.x-this.x,l=t.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,s){return Math.atan2(this.x*s-this.y*t,this.x*t+this.y*s)},_matMult:function(t){var s=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var s=Math.cos(t),l=Math.sin(t),p=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=p,this},_rotateAround:function(t,s){var l=Math.cos(t),p=Math.sin(t),y=s.y+p*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-p*(this.y-s.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t},Z}typeof SuppressedError=="function"&&SuppressedError;var fe,oe,Be=j(ge()),_t=function(){if(oe)return fe;function o(t,s,l,p){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=l,this.p2y=p}return oe=1,fe=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,p=0;p<8;p++){var y=this.sampleCurveX(l)-t;if(Math.abs(y)<s)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=y/v}var S=0,E=1;for(l=t,p=0;p<20&&(y=this.sampleCurveX(l),!(Math.abs(y-t)<s));p++)t>y?S=l:E=l,l=.5*(E-S)+S;return l},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},fe}(),xt=j(_t);let Ie,ne;function Te(){return Ie==null&&(Ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ie}function Ne(){if(ne==null&&(ne=!1,Te())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const p=4*l;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&s[l]!==l){ne=!0;break}}}return ne||!1}var ut,ct=1e-6,ht=typeof Float32Array<"u"?Float32Array:Array;function $(){var o=new ht(9);return ht!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function le(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function pe(){var o=new ht(3);return ht!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Ve(o,t,s){var l=new ht(3);return l[0]=o,l[1]=t,l[2]=s,l}function Fe(o,t,s){var l=t[0],p=t[1],y=t[2],v=t[3];return o[0]=s[0]*l+s[4]*p+s[8]*y+s[12]*v,o[1]=s[1]*l+s[5]*p+s[9]*y+s[13]*v,o[2]=s[2]*l+s[6]*p+s[10]*y+s[14]*v,o[3]=s[3]*l+s[7]*p+s[11]*y+s[15]*v,o}function je(){var o=new ht(4);return ht!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Ye(){var o=new ht(2);return ht!=Float32Array&&(o[0]=0,o[1]=0),o}function Le(o,t){var s=new ht(2);return s[0]=o,s[1]=t,s}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)}),pe(),ut=new ht(4),ht!=Float32Array&&(ut[0]=0,ut[1]=0,ut[2]=0,ut[3]=0),pe(),Ve(1,0,0),Ve(0,1,0),je(),je(),$(),Ye();const ze=8192;function We(o,t,s){return t*(ze/(o.tileSize*Math.pow(2,s-o.tileID.overscaledZ)))}function be(o,t){return(o%t+t)%t}function Ke(o,t,s){return o*(1-s)+t*s}function ye(o){if(o<=0)return 0;if(o>=1)return 1;const t=o*o,s=t*o;return 4*(o<.5?s:3*(o-t)+s-.75)}function ue(o,t,s,l){const p=new xt(o,t,s,l);return y=>p.solve(y)}const gt=ue(.25,.1,.25,1);function At(o,t,s){return Math.min(s,Math.max(t,o))}function Lt(o,t,s){const l=s-t,p=((o-t)%l+l)%l+t;return p===t?s:p}function bt(o,...t){for(const s of t)for(const l in s)o[l]=s[l];return o}let zt=1;function Ft(o,t,s){const l={};for(const p in o)l[p]=t.call(this,o[p],p,o);return l}function Kt(o,t,s){const l={};for(const p in o)t.call(this,o[p],p,o)&&(l[p]=o[p]);return l}function on(o){return Array.isArray(o)?o.map(on):typeof o=="object"&&o?Ft(o,on):o}const Dn={};function Ht(o){Dn[o]||(typeof console<"u"&&console.warn(o),Dn[o]=!0)}function tn(o,t,s){return(s.y-o.y)*(t.x-o.x)>(t.y-o.y)*(s.x-o.x)}function gn(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let Rt=null;function rn(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const Fr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Un(o,t,s,l,p){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(o,{timestamp:0});try{const v=y==null?void 0:y.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const S=v.startsWith("BGR"),E=new Uint8ClampedArray(l*p*4);if(yield y.copyTo(E,function(I,A,R,B,N){const U=4*Math.max(1,0),q=(Math.max(0,R)-R)*B*4+U,Q=4*B,ae=Math.max(0,A),Me=Math.max(0,R);return{rect:{x:ae,y:Me,width:Math.min(I.width,A+B)-ae,height:Math.min(I.height,R+N)-Me},layout:[{offset:q,stride:Q}]}}(o,t,s,l,p)),S)for(let I=0;I<E.length;I+=4){const A=E[I];E[I]=E[I+2],E[I+2]=A}return E}finally{y.close()}})}let Br,hi;function Kn(o){return o/Math.PI*180}const Or="AbortError";function Di(){return new Error(Or)}const Fi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Fs(o){return Fi.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const Bi="global-dispatcher";class eo extends Error{constructor(t,s,l,p){super(`AJAXError: ${s} (${t}): ${l}`),this.status=t,this.statusText=s,this.url=l,this.body=p}}const Oi=()=>gn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,di=function(o,t){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const l=Fs(o.url);if(l)return l(o,t);if(gn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:Bi},t)}if(!(/^file:/.test(s=o.url)||/^file:/.test(Oi())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,p){return u(this,void 0,void 0,function*(){const y=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Oi(),signal:p.signal});let v,S;l.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{v=yield fetch(y)}catch(I){throw new eo(0,I.message,l.url,new Blob)}if(!v.ok){const I=yield v.blob();throw new eo(v.status,v.statusText,l.url,I)}S=l.type==="arrayBuffer"||l.type==="image"?v.arrayBuffer():l.type==="json"?v.json():v.text();const E=yield S;if(p.signal.aborted)throw Di();return{data:E,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(o,t);if(gn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:Bi},t)}var s;return function(l,p){return new Promise((y,v)=>{var S;const E=new XMLHttpRequest;E.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(E.responseType="arraybuffer");for(const I in l.headers)E.setRequestHeader(I,l.headers[I]);l.type==="json"&&(E.responseType="text",!((S=l.headers)===null||S===void 0)&&S.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=l.credentials==="include",E.onerror=()=>{v(new Error(E.statusText))},E.onload=()=>{if(!p.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let I=E.response;if(l.type==="json")try{I=JSON.parse(E.response)}catch(A){return void v(A)}y({data:I,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const I=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});v(new eo(E.status,E.statusText,l.url,I))}},p.signal.addEventListener("abort",()=>{E.abort(),v(Di())}),E.send(l.body)})}(o,t)};function to(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const t=new URL(o),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function Ni(o,t,s){s[o]&&s[o].indexOf(t)!==-1||(s[o]=s[o]||[],s[o].push(t))}function no(o,t,s){if(s&&s[o]){const l=s[o].indexOf(t);l!==-1&&s[o].splice(l,1)}}class Oo{constructor(t,s={}){bt(this,s),this.type=t}}class ls extends Oo{constructor(t,s={}){super("error",bt({error:t},s))}}class No{on(t,s){return this._listeners=this._listeners||{},Ni(t,s,this._listeners),{unsubscribe:()=>{this.off(t,s)}}}off(t,s){return no(t,s,this._listeners),no(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Ni(t,s,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,s){typeof t=="string"&&(t=new Oo(t,s||{}));const l=t.type;if(this.listens(l)){t.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const S of p)S.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const S of y)no(l,S,this._oneTimeListeners),S.call(this,t);const v=this._eventedParent;v&&(bt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof ls&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const W=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Y(o,t){const s={};for(const l in o)l!=="ref"&&(s[l]=o[l]);return W.forEach(l=>{l in t&&(s[l]=t[l])}),s}function K(o,t){if(Array.isArray(o)){if(!Array.isArray(t)||o.length!==t.length)return!1;for(let s=0;s<o.length;s++)if(!K(o[s],t[s]))return!1;return!0}if(typeof o=="object"&&o!==null&&t!==null){if(typeof t!="object"||Object.keys(o).length!==Object.keys(t).length)return!1;for(const s in o)if(!K(o[s],t[s]))return!1;return!0}return o===t}function he(o,t){o.push(t)}function Pe(o,t,s){he(s,{command:"addSource",args:[o,t[o]]})}function De(o,t,s){he(t,{command:"removeSource",args:[o]}),s[o]=!0}function He(o,t,s,l){De(o,s,l),Pe(o,t,s)}function Re(o,t,s){let l;for(l in o[s])if(Object.prototype.hasOwnProperty.call(o[s],l)&&l!=="data"&&!K(o[s][l],t[s][l]))return!1;for(l in t[s])if(Object.prototype.hasOwnProperty.call(t[s],l)&&l!=="data"&&!K(o[s][l],t[s][l]))return!1;return!0}function rt(o,t,s,l,p,y){o=o||{},t=t||{};for(const v in o)Object.prototype.hasOwnProperty.call(o,v)&&(K(o[v],t[v])||s.push({command:y,args:[l,v,t[v],p]}));for(const v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(o,v)&&(K(o[v],t[v])||s.push({command:y,args:[l,v,t[v],p]}))}function et(o){return o.id}function Ue(o,t){return o[t.id]=t,o}class ke{constructor(t,s,l,p){this.message=(t?`${t}: `:"")+l,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function Pt(o,...t){for(const s of t)for(const l in s)o[l]=s[l];return o}class Ct extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Wt{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[l,p]of s)this.bindings[l]=p}concat(t){return new Wt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Jt={kind:"null"},ot={kind:"number"},Mt={kind:"string"},Ot={kind:"boolean"},fn={kind:"color"},En={kind:"projectionDefinition"},Yt={kind:"object"},Dt={kind:"value"},_r={kind:"collator"},Bs={kind:"formatted"},Nr={kind:"padding"},Sr={kind:"resolvedImage"},ir={kind:"variableAnchorOffsetCollection"};function ji(o,t){return{kind:"array",itemType:o,N:t}}function or(o){if(o.kind==="array"){const t=or(o.itemType);return typeof o.N=="number"?`array<${t}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${t}>`}return o.kind}const Bl=[Jt,ot,Mt,Ot,fn,En,Bs,Yt,ji(Dt),Nr,Sr,ir];function Ja(o,t){if(t.kind==="error")return null;if(o.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Ja(o.itemType,t.itemType))&&(typeof o.N!="number"||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if(o.kind==="value"){for(const s of Bl)if(!Ja(s,t))return null}}return`Expected ${or(o)} but found ${or(t)} instead.`}function ph(o,t){return t.some(s=>s.kind===o.kind)}function jo(o,t){return t.some(s=>s==="null"?o===null:s==="array"?Array.isArray(o):s==="object"?o&&!Array.isArray(o)&&typeof o=="object":s===typeof o)}function pa(o,t){return o.kind==="array"&&t.kind==="array"?o.itemType.kind===t.itemType.kind&&typeof o.N=="number":o.kind===t.kind}const Ol=.96422,fh=.82521,Td=4/29,Qa=6/29,mh=3*Qa*Qa,Cd=Qa*Qa*Qa,Pd=Math.PI/180,df=180/Math.PI;function Ed(o){return(o%=360)<0&&(o+=360),o}function gh([o,t,s,l]){let p,y;const v=Bu((.2225045*(o=fa(o))+.7168786*(t=fa(t))+.0606169*(s=fa(s)))/1);o===t&&t===s?p=y=v:(p=Bu((.4360747*o+.3850649*t+.1430804*s)/Ol),y=Bu((.0139322*o+.0971045*t+.7141733*s)/fh));const S=116*v-16;return[S<0?0:S,500*(p-v),200*(v-y),l]}function fa(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Bu(o){return o>Cd?Math.pow(o,1/3):o/mh+Td}function _h([o,t,s,l]){let p=(o+16)/116,y=isNaN(t)?p:p+t/500,v=isNaN(s)?p:p-s/200;return p=1*Nl(p),y=Ol*Nl(y),v=fh*Nl(v),[Os(3.1338561*y-1.6168667*p-.4906146*v),Os(-.9787684*y+1.9161415*p+.033454*v),Os(.0719453*y-.2289914*p+1.4052427*v),l]}function Os(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Nl(o){return o>Qa?o*o*o:mh*(o-Td)}function Ou(o){return parseInt(o.padEnd(2,o),16)/255}function yh(o,t){return Uo(t?o/100:o,0,1)}function Uo(o,t,s){return Math.min(Math.max(t,o),s)}function Nu(o){return!o.some(Number.isNaN)}const Vo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function hn(o,t,s){return o+s*(t-o)}function bo(o,t,s){return o.map((l,p)=>hn(l,t[p],s))}class dn{constructor(t,s,l,p=1,y=!0){this.r=t,this.g=s,this.b=l,this.a=p,y||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,s,l,p]))}static parse(t){if(t instanceof dn)return t;if(typeof t!="string")return;const s=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Vo[l];if(p){const[v,S,E]=p;return[v/255,S/255,E/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const v=l.length<6?1:2;let S=1;return[Ou(l.slice(S,S+=v)),Ou(l.slice(S,S+=v)),Ou(l.slice(S,S+=v)),Ou(l.slice(S,S+v)||"ff")]}if(l.startsWith("rgb")){const v=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[S,E,I,A,R,B,N,U,q,Q,ae,Me]=v,de=[A||" ",N||" ",Q].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const O=[I,B,q].join(""),J=O==="%%%"?100:O===""?255:0;if(J){const _e=[Uo(+E/J,0,1),Uo(+R/J,0,1),Uo(+U/J,0,1),ae?yh(+ae,Me):1];if(Nu(_e))return _e}}return}}const y=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,S,E,I,A,R,B,N,U]=y,q=[E||" ",A||" ",B].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const Q=[+S,Uo(+I,0,100),Uo(+R,0,100),N?yh(+N,U):1];if(Nu(Q))return function([ae,Me,de,O]){function J(_e){const Ze=(_e+ae/30)%12,dt=Me*Math.min(de,1-de);return de-dt*Math.max(-1,Math.min(Ze-3,9-Ze,1))}return ae=Ed(ae),Me/=100,de/=100,[J(0),J(8),J(4),O]}(Q)}}}(t);return s?new dn(...s,!1):void 0}get rgb(){const{r:t,g:s,b:l,a:p}=this,y=p||1/0;return this.overwriteGetter("rgb",[t/y,s/y,l/y,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,l,p,y]=gh(t),v=Math.sqrt(l*l+p*p);return[Math.round(1e4*v)?Ed(Math.atan2(p,l)*df):NaN,v,s,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",gh(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,l,p]=this.rgb;return`rgba(${[t,s,l].map(y=>Math.round(255*y)).join(",")},${p})`}static interpolate(t,s,l,p="rgb"){switch(p){case"rgb":{const[y,v,S,E]=bo(t.rgb,s.rgb,l);return new dn(y,v,S,E,!1)}case"hcl":{const[y,v,S,E]=t.hcl,[I,A,R,B]=s.hcl;let N,U;if(isNaN(y)||isNaN(I))isNaN(y)?isNaN(I)?N=NaN:(N=I,S!==1&&S!==0||(U=A)):(N=y,R!==1&&R!==0||(U=v));else{let de=I-y;I>y&&de>180?de-=360:I<y&&y-I>180&&(de+=360),N=y+l*de}const[q,Q,ae,Me]=function([de,O,J,_e]){return de=isNaN(de)?0:de*Pd,_h([J,Math.cos(de)*O,Math.sin(de)*O,_e])}([N,U??hn(v,A,l),hn(S,R,l),hn(E,B,l)]);return new dn(q,Q,ae,Me,!1)}case"lab":{const[y,v,S,E]=_h(bo(t.lab,s.lab,l));return new dn(y,v,S,E,!1)}}}}dn.black=new dn(0,0,0,1),dn.white=new dn(1,1,1,1),dn.transparent=new dn(0,0,0,0),dn.red=new dn(1,0,0,1);class ju{constructor(t,s,l){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const vh=["bottom","center","top"];class ma{constructor(t,s,l,p,y,v){this.text=t,this.image=s,this.scale=l,this.fontStack=p,this.textColor=y,this.verticalAlign=v}}class hr{constructor(t){this.sections=t}static fromString(t){return new hr([new ma(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof hr?t:hr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class dr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof dr)return t;if(typeof t=="number")return new dr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new dr(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,s,l){return new dr(bo(t.values,s.values,l))}}class sr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Uu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class pi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof pi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const l=t[s],p=t[s+1];if(typeof l!="string"||!Uu.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new pi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,s,l){const p=t.values,y=s.values;if(p.length!==y.length)throw new sr(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${s.toString()}`);const v=[];for(let S=0;S<p.length;S+=2){if(p[S]!==y[S])throw new sr(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${p[S]}, to[${S}]: ${y[S]}`);v.push(p[S]);const[E,I]=p[S+1],[A,R]=y[S+1];v.push([hn(E,A,l),hn(I,R,l)])}return new pi(v)}}class ri{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ri({name:t,available:!1}):null}}class ii{constructor(t,s,l){this.from=t,this.to=s,this.transition=l}static interpolate(t,s,l){return new ii(t,s,l)}static parse(t){return t instanceof ii?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new ii(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new ii(t.from,t.to,t.transition):typeof t=="string"?new ii(t,t,1):void 0}}function Vu(o,t,s,l){return typeof o=="number"&&o>=0&&o<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[o,t,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[o,t,s,l]:[o,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ns(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof ii||o instanceof dn||o instanceof ju||o instanceof hr||o instanceof dr||o instanceof pi||o instanceof ri)return!0;if(Array.isArray(o)){for(const t of o)if(!Ns(t))return!1;return!0}if(typeof o=="object"){for(const t in o)if(!Ns(o[t]))return!1;return!0}return!1}function tr(o){if(o===null)return Jt;if(typeof o=="string")return Mt;if(typeof o=="boolean")return Ot;if(typeof o=="number")return ot;if(o instanceof dn)return fn;if(o instanceof ii)return En;if(o instanceof ju)return _r;if(o instanceof hr)return Bs;if(o instanceof dr)return Nr;if(o instanceof pi)return ir;if(o instanceof ri)return Sr;if(Array.isArray(o)){const t=o.length;let s;for(const l of o){const p=tr(l);if(s){if(s===p)continue;s=Dt;break}s=p}return ji(s||Dt,t)}return Yt}function jl(o){const t=typeof o;return o===null?"":t==="string"||t==="number"||t==="boolean"?String(o):o instanceof dn||o instanceof ii||o instanceof hr||o instanceof dr||o instanceof pi||o instanceof ri?o.toString():JSON.stringify(o)}class Go{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ns(t[1]))return s.error("invalid value");const l=t[1];let p=tr(l);const y=s.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Go(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const $o={string:Mt,number:ot,boolean:Ot,object:Yt};class ro{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l,p=1;const y=t[0];if(y==="array"){let S,E;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in $o)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=$o[I],p++}else S=Dt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=t[2],p++}l=ji(S,E)}else{if(!$o[y])throw new Error(`Types doesn't contain name = ${y}`);l=$o[y]}const v=[];for(;p<t.length;p++){const S=s.parse(t[p],p,Dt);if(!S)return null;v.push(S)}return new ro(l,v)}evaluate(t){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(t);if(!Ja(this.type,tr(l)))return l;if(s===this.args.length-1)throw new sr(`Expected value to be of type ${or(this.type)}, but found ${or(tr(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const xh={"to-boolean":Ot,"to-color":fn,"to-number":ot,"to-string":Mt};class us{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[0];if(!xh[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return s.error("Expected one argument.");const p=xh[l],y=[];for(let v=1;v<t.length;v++){const S=s.parse(t[v],v,Dt);if(!S)return null;y.push(S)}return new us(p,y)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,l;for(const p of this.args){if(s=p.evaluate(t),l=null,s instanceof dn)return s;if(typeof s=="string"){const y=t.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Vu(s[0],s[1],s[2],s[3]),!l))return new dn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new sr(l||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const l of this.args){s=l.evaluate(t);const p=dr.parse(s);if(p)return p}throw new sr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const l of this.args){s=l.evaluate(t);const p=pi.parse(s);if(p)return p}throw new sr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const l of this.args){if(s=l.evaluate(t),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new sr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return hr.fromString(jl(this.args[0].evaluate(t)));case"resolvedImage":return ri.fromString(jl(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return jl(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Gu=["Unknown","Point","LineString","Polygon"];class Jn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=dn.parse(t)),s}}class el{constructor(t,s,l=[],p,y=new Wt,v=[]){this.registry=t,this.path=l,this.key=l.map(S=>`[${S}]`).join(""),this.scope=y,this.errors=v,this.expectedType=p,this._isConstant=s}parse(t,s,l,p,y={}){return s?this.concat(s,l,p)._parse(t,y):this._parse(t,y)}_parse(t,s){function l(p,y,v){return v==="assert"?new ro(y,[p]):v==="coerce"?new us(y,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let v=y.parse(t,this);if(!v)return null;if(this.expectedType){const S=this.expectedType,E=v.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||E.kind!=="value")if(S.kind!=="projectionDefinition"||E.kind!=="string"&&E.kind!=="array")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string")if(S.kind!=="padding"||E.kind!=="value"&&E.kind!=="number"&&E.kind!=="array")if(S.kind!=="variableAnchorOffsetCollection"||E.kind!=="value"&&E.kind!=="array"){if(this.checkSubtype(S,E))return null}else v=l(v,S,s.typeAnnotation||"coerce");else v=l(v,S,s.typeAnnotation||"coerce");else v=l(v,S,s.typeAnnotation||"coerce");else v=l(v,S,s.typeAnnotation||"coerce");else v=l(v,S,s.typeAnnotation||"assert")}if(!(v instanceof Go)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const S=new Jn;try{v=new Go(v.type,v.evaluate(S))}catch(E){return this.error(E.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,l){const p=typeof t=="number"?this.path.concat(t):this.path,y=l?this.scope.concat(l):this.scope;return new el(this.registry,this._isConstant,p,s||null,y,this.errors)}error(t,...s){const l=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ct(l,t))}checkSubtype(t,s){const l=Ja(t,s);return l&&this.error(l),l}}class Cn{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let y=1;y<t.length-1;y+=2){const v=t[y];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const S=s.parse(t[y+1],y+1);if(!S)return null;l.push([v,S])}const p=s.parse(t[t.length-1],t.length-1,s.expectedType,l);return p?new Cn(l,p):null}outputDefined(){return this.result.outputDefined()}}class cn{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const l=t[1];return s.scope.has(l)?new cn(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ul{constructor(t,s,l){this.type=t,this.index=s,this.input=l}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,ot),p=s.parse(t[2],2,ji(s.expectedType||Dt));return l&&p?new Ul(p.type.itemType,l,p):null}evaluate(t){const s=this.index.evaluate(t),l=this.input.evaluate(t);if(s<0)throw new sr(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new sr(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new sr(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Mn{constructor(t,s){this.type=Ot,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Dt),p=s.parse(t[2],2,Dt);return l&&p?ph(l.type,[Ot,Mt,ot,Jt,Dt])?new Mn(l,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(l.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!jo(s,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${or(tr(s))} instead.`);if(!jo(l,["string","array"]))throw new sr(`Expected second argument to be of type array or string, but found ${or(tr(l))} instead.`);return l.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Gn{constructor(t,s,l){this.type=ot,this.needle=t,this.haystack=s,this.fromIndex=l}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Dt),p=s.parse(t[2],2,Dt);if(!l||!p)return null;if(!ph(l.type,[Ot,Mt,ot,Jt,Dt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(l.type)} instead`);if(t.length===4){const y=s.parse(t[3],3,ot);return y?new Gn(l,p,y):null}return new Gn(l,p)}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!jo(s,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${or(tr(s))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(t)),jo(l,["string"])){const y=l.indexOf(s,p);return y===-1?-1:[...l.slice(0,y)].length}if(jo(l,["array"]))return l.indexOf(s,p);throw new sr(`Expected second argument to be of type array or string, but found ${or(tr(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class In{constructor(t,s,l,p,y,v){this.inputType=t,this.type=s,this.input=l,this.cases=p,this.outputs=y,this.otherwise=v}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let l,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const y={},v=[];for(let I=2;I<t.length-1;I+=2){let A=t[I];const R=t[I+1];Array.isArray(A)||(A=[A]);const B=s.concat(I);if(A.length===0)return B.error("Expected at least one branch label.");for(const U of A){if(typeof U!="number"&&typeof U!="string")return B.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return B.error("Numeric branch labels must be integer values.");if(l){if(B.checkSubtype(l,tr(U)))return null}else l=tr(U);if(y[String(U)]!==void 0)return B.error("Branch labels must be unique.");y[String(U)]=v.length}const N=s.parse(R,I,p);if(!N)return null;p=p||N.type,v.push(N)}const S=s.parse(t[1],1,Dt);if(!S)return null;const E=s.parse(t[t.length-1],t.length-1,p);return E?S.type.kind!=="value"&&s.concat(1).checkSubtype(l,S.type)?null:new In(l,p,S,y,v,E):null}evaluate(t){const s=this.input.evaluate(t);return(tr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Vl{constructor(t,s,l){this.type=t,this.branches=s,this.otherwise=l}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);const p=[];for(let v=1;v<t.length-1;v+=2){const S=s.parse(t[v],v,Ot);if(!S)return null;const E=s.parse(t[v+1],v+1,l);if(!E)return null;p.push([S,E]),l=l||E.type}const y=s.parse(t[t.length-1],t.length-1,l);if(!y)return null;if(!l)throw new Error("Can't infer output type");return new Vl(l,p,y)}evaluate(t){for(const[s,l]of this.branches)if(s.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,l]of this.branches)t(s),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Gl{constructor(t,s,l,p){this.type=t,this.input=s,this.beginIndex=l,this.endIndex=p}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Dt),p=s.parse(t[2],2,ot);if(!l||!p)return null;if(!ph(l.type,[ji(Dt),Mt,Dt]))return s.error(`Expected first argument to be of type array or string, but found ${or(l.type)} instead`);if(t.length===4){const y=s.parse(t[3],3,ot);return y?new Gl(l.type,l,p,y):null}return new Gl(l.type,l,p)}evaluate(t){const s=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let p;if(this.endIndex&&(p=this.endIndex.evaluate(t)),jo(s,["string"]))return[...s].slice(l,p).join("");if(jo(s,["array"]))return s.slice(l,p);throw new sr(`Expected first argument to be of type array or string, but found ${or(tr(s))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function $l(o,t){const s=o.length-1;let l,p,y=0,v=s,S=0;for(;y<=v;)if(S=Math.floor((y+v)/2),l=o[S],p=o[S+1],l<=t){if(S===s||t<p)return S;y=S+1}else{if(!(l>t))throw new sr("Input is not a number.");v=S-1}return 0}class ga{constructor(t,s,l){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[p,y]of l)this.labels.push(p),this.outputs.push(y)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(t[1],1,ot);if(!l)return null;const p=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let v=1;v<t.length;v+=2){const S=v===1?-1/0:t[v],E=t[v+1],I=v,A=v+1;if(typeof S!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=S)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const R=s.parse(E,A,y);if(!R)return null;y=y||R.type,p.push([S,R])}return new ga(y,l,p)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return l[0].evaluate(t);const y=s.length;return p>=s[y-1]?l[y-1].evaluate(t):l[$l(s,p)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Md(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var wh,$u,Id=function(){if($u)return wh;function o(t,s,l,p){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=l,this.p2y=p}return $u=1,wh=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,p=0;p<8;p++){var y=this.sampleCurveX(l)-t;if(Math.abs(y)<s)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=y/v}var S=0,E=1;for(l=t,p=0;p<20&&(y=this.sampleCurveX(l),!(Math.abs(y-t)<s));p++)t>y?S=l:E=l,l=.5*(E-S)+S;return l},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},wh}(),Tr=Md(Id);class $n{constructor(t,s,l,p,y){this.type=t,this.operator=s,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[v,S]of y)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(t,s,l,p){let y=0;if(t.name==="exponential")y=io(s,t.base,l,p);else if(t.name==="linear")y=io(s,1,l,p);else if(t.name==="cubic-bezier"){const v=t.controlPoints;y=new Tr(v[0],v[1],v[2],v[3]).solve(io(s,1,l,p))}return y}static parse(t,s){let[l,p,y,...v]=t;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(A=>typeof A!="number"||A<0||A>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,ot),!y)return null;const S=[];let E=null;l==="interpolate-hcl"||l==="interpolate-lab"?E=fn:s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType);for(let I=0;I<v.length;I+=2){const A=v[I],R=v[I+1],B=I+3,N=I+4;if(typeof A!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(S.length&&S[S.length-1][0]>=A)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const U=s.parse(R,N,E);if(!U)return null;E=E||U.type,S.push([A,U])}return pa(E,ot)||pa(E,En)||pa(E,fn)||pa(E,Nr)||pa(E,ir)||pa(E,ji(ot))?new $n(E,l,p,y,S):s.error(`Type ${or(E)} is not interpolatable.`)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return l[0].evaluate(t);const y=s.length;if(p>=s[y-1])return l[y-1].evaluate(t);const v=$l(s,p),S=$n.interpolationFactor(this.interpolation,p,s[v],s[v+1]),E=l[v].evaluate(t),I=l[v+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return hn(E,I,S);case"color":return dn.interpolate(E,I,S);case"padding":return dr.interpolate(E,I,S);case"variableAnchorOffsetCollection":return pi.interpolate(E,I,S);case"array":return bo(E,I,S);case"projectionDefinition":return ii.interpolate(E,I,S)}case"interpolate-hcl":return dn.interpolate(E,I,S,"hcl");case"interpolate-lab":return dn.interpolate(E,I,S,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function io(o,t,s,l){const p=l-s,y=o-s;return p===0?0:t===1?y/p:(Math.pow(t,y)-1)/(Math.pow(t,p)-1)}const oo={color:dn.interpolate,number:hn,padding:dr.interpolate,variableAnchorOffsetCollection:pi.interpolate,array:bo};class cs{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l=null;const p=s.expectedType;p&&p.kind!=="value"&&(l=p);const y=[];for(const S of t.slice(1)){const E=s.parse(S,1+y.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,y.push(E)}if(!l)throw new Error("No output type");const v=p&&y.some(S=>Ja(p,S.type));return new cs(v?Dt:l,y)}evaluate(t){let s,l=null,p=0;for(const y of this.args)if(p++,l=y.evaluate(t),l&&l instanceof ri&&!l.available&&(s||(s=l.name),l=null,p===this.args.length&&(l=s)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Zn(o,t){return o==="=="||o==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Zu(o,t,s,l){return l.compare(t,s)===0}function hs(o,t,s){const l=o!=="=="&&o!=="!=";return class VT{constructor(y,v,S){this.type=Ot,this.lhs=y,this.rhs=v,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const S=y[0];let E=v.parse(y[1],1,Dt);if(!E)return null;if(!Zn(S,E.type))return v.concat(1).error(`"${S}" comparisons are not supported for type '${or(E.type)}'.`);let I=v.parse(y[2],2,Dt);if(!I)return null;if(!Zn(S,I.type))return v.concat(2).error(`"${S}" comparisons are not supported for type '${or(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${or(E.type)}' and '${or(I.type)}'.`);l&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new ro(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new ro(E.type,[I])));let A=null;if(y.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(A=v.parse(y[3],3,_r),!A)return null}return new VT(E,I,A)}evaluate(y){const v=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(l&&this.hasUntypedArgument){const E=tr(v),I=tr(S);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new sr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=tr(v),I=tr(S);if(E.kind!=="string"||I.kind!=="string")return t(y,v,S)}return this.collator?s(y,v,S,this.collator.evaluate(y)):t(y,v,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const bh=hs("==",function(o,t,s){return t===s},Zu),kd=hs("!=",function(o,t,s){return t!==s},function(o,t,s,l){return!Zu(0,t,s,l)}),Zl=hs("<",function(o,t,s){return t<s},function(o,t,s,l){return l.compare(t,s)<0}),qu=hs(">",function(o,t,s){return t>s},function(o,t,s,l){return l.compare(t,s)>0}),Ui=hs("<=",function(o,t,s){return t<=s},function(o,t,s,l){return l.compare(t,s)<=0}),Wu=hs(">=",function(o,t,s){return t>=s},function(o,t,s,l){return l.compare(t,s)>=0});class Kr{constructor(t,s,l){this.type=_r,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");const p=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Ot);if(!p)return null;const y=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Ot);if(!y)return null;let v=null;return l.locale&&(v=s.parse(l.locale,1,Mt),!v)?null:new Kr(p,y,v)}evaluate(t){return new ju(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Vi{constructor(t,s,l,p,y){this.type=Mt,this.number=t,this.locale=s,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const l=s.parse(t[1],1,ot);if(!l)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=s.parse(p.locale,1,Mt),!y))return null;let v=null;if(p.currency&&(v=s.parse(p.currency,1,Mt),!v))return null;let S=null;if(p["min-fraction-digits"]&&(S=s.parse(p["min-fraction-digits"],1,ot),!S))return null;let E=null;return p["max-fraction-digits"]&&(E=s.parse(p["max-fraction-digits"],1,ot),!E)?null:new Vi(l,y,v,S,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class tl{constructor(t){this.type=Bs,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");const p=[];let y=!1;for(let v=1;v<=t.length-1;++v){const S=t[v];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let E=null;if(S["font-scale"]&&(E=s.parse(S["font-scale"],1,ot),!E))return null;let I=null;if(S["text-font"]&&(I=s.parse(S["text-font"],1,ji(Mt)),!I))return null;let A=null;if(S["text-color"]&&(A=s.parse(S["text-color"],1,fn),!A))return null;let R=null;if(S["vertical-align"]){if(typeof S["vertical-align"]=="string"&&!vh.includes(S["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${S["vertical-align"]}' instead.`);if(R=s.parse(S["vertical-align"],1,Mt),!R)return null}const B=p[p.length-1];B.scale=E,B.font=I,B.textColor=A,B.verticalAlign=R}else{const E=s.parse(t[v],1,Dt);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new tl(p)}evaluate(t){return new hr(this.sections.map(s=>{const l=s.content.evaluate(t);return tr(l)===Sr?new ma("",l,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(t):null):new ma(jl(l),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null,s.verticalAlign?s.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor),s.verticalAlign&&t(s.verticalAlign)}outputDefined(){return!1}}class Gi{constructor(t){this.type=Sr,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const l=s.parse(t[1],1,Mt);return l?new Gi(l):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),l=ri.fromString(s);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(s)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class nl{constructor(t){this.type=ot,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=s.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${or(l.type)} instead.`):new nl(l):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new sr(`Expected value to be of type string or array, but found ${or(tr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const bi=8192;function pr(o,t){const s=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(s*p*bi),Math.round(l*p*bi)]}function Zo(o,t){const s=Math.pow(2,t.z);return[(p=(o[0]/bi+t.x)/s,360*p-180),(l=(o[1]/bi+t.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,p}function _a(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function ql(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function rl(o,t,s){const l=o[0]-t[0],p=o[1]-t[1],y=o[0]-s[0],v=o[1]-s[1];return l*v-y*p==0&&l*y<=0&&p*v<=0}function Hu(o,t,s,l){return(p=[l[0]-s[0],l[1]-s[1]])[0]*(y=[t[0]-o[0],t[1]-o[1]])[1]-p[1]*y[0]!=0&&!(!Rd(o,t,s,l)||!Rd(s,l,o,t));var p,y}function Ad(o,t,s){for(const l of s)for(let p=0;p<l.length-1;++p)if(Hu(o,t,l[p],l[p+1]))return!0;return!1}function ya(o,t,s=!1){let l=!1;for(const S of t)for(let E=0;E<S.length-1;E++){if(rl(o,S[E],S[E+1]))return s;(y=S[E])[1]>(p=o)[1]!=(v=S[E+1])[1]>p[1]&&p[0]<(v[0]-y[0])*(p[1]-y[1])/(v[1]-y[1])+y[0]&&(l=!l)}var p,y,v;return l}function zd(o,t){for(const s of t)if(ya(o,s))return!0;return!1}function il(o,t){for(const s of o)if(!ya(s,t))return!1;for(let s=0;s<o.length-1;++s)if(Ad(o[s],o[s+1],t))return!1;return!0}function ol(o,t){for(const s of t)if(il(o,s))return!0;return!1}function Rd(o,t,s,l){const p=l[0]-s[0],y=l[1]-s[1],v=(o[0]-s[0])*y-p*(o[1]-s[1]),S=(t[0]-s[0])*y-p*(t[1]-s[1]);return v>0&&S<0||v<0&&S>0}function Yu(o,t,s){const l=[];for(let p=0;p<o.length;p++){const y=[];for(let v=0;v<o[p].length;v++){const S=pr(o[p][v],s);_a(t,S),y.push(S)}l.push(y)}return l}function Sh(o,t,s){const l=[];for(let p=0;p<o.length;p++){const y=Yu(o[p],t,s);l.push(y)}return l}function Xu(o,t,s,l){if(o[0]<s[0]||o[0]>s[2]){const p=.5*l;let y=o[0]-s[0]>p?-l:s[0]-o[0]>p?l:0;y===0&&(y=o[0]-s[2]>p?-l:s[2]-o[0]>p?l:0),o[0]+=y}_a(t,o)}function Wl(o,t,s,l){const p=Math.pow(2,l.z)*bi,y=[l.x*bi,l.y*bi],v=[];for(const S of o)for(const E of S){const I=[E.x+y[0],E.y+y[1]];Xu(I,t,s,p),v.push(I)}return v}function Ku(o,t,s,l){const p=Math.pow(2,l.z)*bi,y=[l.x*bi,l.y*bi],v=[];for(const E of o){const I=[];for(const A of E){const R=[A.x+y[0],A.y+y[1]];_a(t,R),I.push(R)}v.push(I)}if(t[2]-t[0]<=p/2){(S=t)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of v)for(const I of E)Xu(I,t,s,p)}var S;return v}class js{constructor(t,s){this.type=Ot,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ns(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const p=[];for(const y of l.features){const{type:v,coordinates:S}=y.geometry;v==="Polygon"&&p.push(S),v==="MultiPolygon"&&p.push(...S)}if(p.length)return new js(l,{type:"MultiPolygon",coordinates:p})}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new js(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new js(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(l.type==="Polygon"){const S=Yu(l.coordinates,y,v),E=Wl(s.geometry(),p,y,v);if(!ql(p,y))return!1;for(const I of E)if(!ya(I,S))return!1}if(l.type==="MultiPolygon"){const S=Sh(l.coordinates,y,v),E=Wl(s.geometry(),p,y,v);if(!ql(p,y))return!1;for(const I of E)if(!zd(I,S))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(l.type==="Polygon"){const S=Yu(l.coordinates,y,v),E=Ku(s.geometry(),p,y,v);if(!ql(p,y))return!1;for(const I of E)if(!il(I,S))return!1}if(l.type==="MultiPolygon"){const S=Sh(l.coordinates,y,v),E=Ku(s.geometry(),p,y,v);if(!ql(p,y))return!1;for(const I of E)if(!ol(I,S))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ju=class{constructor(o=[],t=(s,l)=>s<l?-1:s>l?1:0){if(this.data=o,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:t,compare:s}=this,l=t[o];for(;o>0;){const p=o-1>>1,y=t[p];if(s(l,y)>=0)break;t[o]=y,o=p}t[o]=l}_down(o){const{data:t,compare:s}=this,l=this.length>>1,p=t[o];for(;o<l;){let y=1+(o<<1);const v=y+1;if(v<this.length&&s(t[v],t[y])<0&&(y=v),s(t[y],p)>=0)break;t[o]=t[y],o=y}t[o]=p}};function Qu(o,t,s=0,l=o.length-1,p=ec){for(;l>s;){if(l-s>600){const E=l-s+1,I=t-s+1,A=Math.log(E),R=.5*Math.exp(2*A/3),B=.5*Math.sqrt(A*R*(E-R)/E)*(I-E/2<0?-1:1);Qu(o,t,Math.max(s,Math.floor(t-I*R/E+B)),Math.min(l,Math.floor(t+(E-I)*R/E+B)),p)}const y=o[t];let v=s,S=l;for(Hl(o,s,t),p(o[l],y)>0&&Hl(o,s,l);v<S;){for(Hl(o,v,S),v++,S--;p(o[v],y)<0;)v++;for(;p(o[S],y)>0;)S--}p(o[s],y)===0?Hl(o,s,S):(S++,Hl(o,S,l)),S<=t&&(s=S+1),t<=S&&(l=S-1)}}function Hl(o,t,s){const l=o[t];o[t]=o[s],o[s]=l}function ec(o,t){return o<t?-1:o>t?1:0}function fi(o,t){if(o.length<=1)return[o];const s=[];let l,p;for(const y of o){const v=Yl(y);v!==0&&(y.area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(l&&s.push(l),l=[y]):l.push(y))}if(l&&s.push(l),t>1)for(let y=0;y<s.length;y++)s[y].length<=t||(Qu(s[y],t,1,s[y].length-1,Th),s[y]=s[y].slice(0,t));return s}function Th(o,t){return t.area-o.area}function Yl(o){let t=0;for(let s,l,p=0,y=o.length,v=y-1;p<y;v=p++)s=o[p],l=o[v],t+=(l.x-s.x)*(s.y+l.y);return t}const tc=1/298.257223563,nc=tc*(2-tc),Ld=Math.PI/180;class Ch{constructor(t){const s=6378.137*Ld*1e3,l=Math.cos(t*Ld),p=1/(1-nc*(1-l*l)),y=Math.sqrt(p);this.kx=s*y*l,this.ky=s*y*p*(1-nc)}distance(t,s){const l=this.wrap(t[0]-s[0])*this.kx,p=(t[1]-s[1])*this.ky;return Math.sqrt(l*l+p*p)}pointOnLine(t,s){let l,p,y,v,S=1/0;for(let E=0;E<t.length-1;E++){let I=t[E][0],A=t[E][1],R=this.wrap(t[E+1][0]-I)*this.kx,B=(t[E+1][1]-A)*this.ky,N=0;R===0&&B===0||(N=(this.wrap(s[0]-I)*this.kx*R+(s[1]-A)*this.ky*B)/(R*R+B*B),N>1?(I=t[E+1][0],A=t[E+1][1]):N>0&&(I+=R/this.kx*N,A+=B/this.ky*N)),R=this.wrap(s[0]-I)*this.kx,B=(s[1]-A)*this.ky;const U=R*R+B*B;U<S&&(S=U,l=I,p=A,y=E,v=N)}return{point:[l,p],index:y,t:Math.max(0,Math.min(1,v))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ph(o,t){return t[0]-o[0]}function Xl(o){return o[1]-o[0]+1}function ds(o,t){return o[1]>=o[0]&&o[1]<t}function Us(o,t){if(o[0]>o[1])return[null,null];const s=Xl(o);if(t){if(s===2)return[o,null];const p=Math.floor(s/2);return[[o[0],o[0]+p],[o[0]+p,o[1]]]}if(s===1)return[o,null];const l=Math.floor(s/2)-1;return[[o[0],o[0]+l],[o[0]+l+1,o[1]]]}function Eh(o,t){if(!ds(t,o.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)_a(s,o[l]);return s}function rc(o){const t=[1/0,1/0,-1/0,-1/0];for(const s of o)for(const l of s)_a(t,l);return t}function ic(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function oc(o,t,s){if(!ic(o)||!ic(t))return NaN;let l=0,p=0;return o[2]<t[0]&&(l=t[0]-o[2]),o[0]>t[2]&&(l=o[0]-t[2]),o[1]>t[3]&&(p=o[1]-t[3]),o[3]<t[1]&&(p=t[1]-o[3]),s.distance([0,0],[l,p])}function Si(o,t,s){const l=s.pointOnLine(t,o);return s.distance(o,l.point)}function sl(o,t,s,l,p){const y=Math.min(Si(o,[s,l],p),Si(t,[s,l],p)),v=Math.min(Si(s,[o,t],p),Si(l,[o,t],p));return Math.min(y,v)}function Fn(o,t,s,l,p){if(!ds(t,o.length)||!ds(l,s.length))return 1/0;let y=1/0;for(let v=t[0];v<t[1];++v){const S=o[v],E=o[v+1];for(let I=l[0];I<l[1];++I){const A=s[I],R=s[I+1];if(Hu(S,E,A,R))return 0;y=Math.min(y,sl(S,E,A,R,p))}}return y}function pf(o,t,s,l,p){if(!ds(t,o.length)||!ds(l,s.length))return NaN;let y=1/0;for(let v=t[0];v<=t[1];++v)for(let S=l[0];S<=l[1];++S)if(y=Math.min(y,p.distance(o[v],s[S])),y===0)return y;return y}function ff(o,t,s){if(ya(o,t,!0))return 0;let l=1/0;for(const p of t){const y=p[0],v=p[p.length-1];if(y!==v&&(l=Math.min(l,Si(o,[v,y],s)),l===0))return l;const S=s.pointOnLine(p,o);if(l=Math.min(l,s.distance(o,S.point)),l===0)return l}return l}function al(o,t,s,l){if(!ds(t,o.length))return NaN;for(let y=t[0];y<=t[1];++y)if(ya(o[y],s,!0))return 0;let p=1/0;for(let y=t[0];y<t[1];++y){const v=o[y],S=o[y+1];for(const E of s)for(let I=0,A=E.length,R=A-1;I<A;R=I++){const B=E[R],N=E[I];if(Hu(v,S,B,N))return 0;p=Math.min(p,sl(v,S,B,N,l))}}return p}function so(o,t){for(const s of o)for(const l of s)if(ya(l,t,!0))return!0;return!1}function Dd(o,t,s,l=1/0){const p=rc(o),y=rc(t);if(l!==1/0&&oc(p,y,s)>=l)return l;if(ql(p,y)){if(so(o,t))return 0}else if(so(t,o))return 0;let v=1/0;for(const S of o)for(let E=0,I=S.length,A=I-1;E<I;A=E++){const R=S[A],B=S[E];for(const N of t)for(let U=0,q=N.length,Q=q-1;U<q;Q=U++){const ae=N[Q],Me=N[U];if(Hu(R,B,ae,Me))return 0;v=Math.min(v,sl(R,B,ae,Me,s))}}return v}function Fd(o,t,s,l,p,y){if(!y)return;const v=oc(Eh(l,y),p,s);v<t&&o.push([v,y,[0,0]])}function sc(o,t,s,l,p,y,v){if(!y||!v)return;const S=oc(Eh(l,y),Eh(p,v),s);S<t&&o.push([S,y,v])}function ac(o,t,s,l,p=1/0){let y=Math.min(l.distance(o[0],s[0][0]),p);if(y===0)return y;const v=new Ju([[0,[0,o.length-1],[0,0]]],Ph),S=rc(s);for(;v.length>0;){const E=v.pop();if(E[0]>=y)continue;const I=E[1],A=t?50:100;if(Xl(I)<=A){if(!ds(I,o.length))return NaN;if(t){const R=al(o,I,s,l);if(isNaN(R)||R===0)return R;y=Math.min(y,R)}else for(let R=I[0];R<=I[1];++R){const B=ff(o[R],s,l);if(y=Math.min(y,B),y===0)return 0}}else{const R=Us(I,t);Fd(v,y,l,o,S,R[0]),Fd(v,y,l,o,S,R[1])}}return y}function lc(o,t,s,l,p,y=1/0){let v=Math.min(y,p.distance(o[0],s[0]));if(v===0)return v;const S=new Ju([[0,[0,o.length-1],[0,s.length-1]]],Ph);for(;S.length>0;){const E=S.pop();if(E[0]>=v)continue;const I=E[1],A=E[2],R=t?50:100,B=l?50:100;if(Xl(I)<=R&&Xl(A)<=B){if(!ds(I,o.length)&&ds(A,s.length))return NaN;let N;if(t&&l)N=Fn(o,I,s,A,p),v=Math.min(v,N);else if(t&&!l){const U=o.slice(I[0],I[1]+1);for(let q=A[0];q<=A[1];++q)if(N=Si(s[q],U,p),v=Math.min(v,N),v===0)return v}else if(!t&&l){const U=s.slice(A[0],A[1]+1);for(let q=I[0];q<=I[1];++q)if(N=Si(o[q],U,p),v=Math.min(v,N),v===0)return v}else N=pf(o,I,s,A,p),v=Math.min(v,N)}else{const N=Us(I,t),U=Us(A,l);sc(S,v,p,o,s,N[0],U[0]),sc(S,v,p,o,s,N[0],U[1]),sc(S,v,p,o,s,N[1],U[0]),sc(S,v,p,o,s,N[1],U[1])}}return v}function Mh(o){return o.type==="MultiPolygon"?o.coordinates.map(t=>({type:"Polygon",coordinates:t})):o.type==="MultiLineString"?o.coordinates.map(t=>({type:"LineString",coordinates:t})):o.type==="MultiPoint"?o.coordinates.map(t=>({type:"Point",coordinates:t})):[o]}class ao{constructor(t,s){this.type=ot,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ns(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new ao(l,l.features.map(p=>Mh(p.geometry)).flat());if(l.type==="Feature")return new ao(l,Mh(l.geometry));if("type"in l&&"coordinates"in l)return new ao(l,Mh(l))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const p=s.geometry(),y=p.flat().map(E=>Zo([E.x,E.y],s.canonical));if(p.length===0)return NaN;const v=new Ch(y[0][1]);let S=1/0;for(const E of l){switch(E.type){case"Point":S=Math.min(S,lc(y,!1,[E.coordinates],!1,v,S));break;case"LineString":S=Math.min(S,lc(y,!1,E.coordinates,!0,v,S));break;case"Polygon":S=Math.min(S,ac(y,!1,E.coordinates,v,S))}if(S===0)return S}return S}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const p=s.geometry(),y=p.flat().map(E=>Zo([E.x,E.y],s.canonical));if(p.length===0)return NaN;const v=new Ch(y[0][1]);let S=1/0;for(const E of l){switch(E.type){case"Point":S=Math.min(S,lc(y,!0,[E.coordinates],!1,v,S));break;case"LineString":S=Math.min(S,lc(y,!0,E.coordinates,!0,v,S));break;case"Polygon":S=Math.min(S,ac(y,!0,E.coordinates,v,S))}if(S===0)return S}return S}(t,this.geometries);if(t.geometryType()==="Polygon")return function(s,l){const p=s.geometry();if(p.length===0||p[0].length===0)return NaN;const y=fi(p,0).map(E=>E.map(I=>I.map(A=>Zo([A.x,A.y],s.canonical)))),v=new Ch(y[0][0][0][1]);let S=1/0;for(const E of l)for(const I of y){switch(E.type){case"Point":S=Math.min(S,ac([E.coordinates],!1,I,v,S));break;case"LineString":S=Math.min(S,ac(E.coordinates,!0,I,v,S));break;case"Polygon":S=Math.min(S,Dd(I,E.coordinates,v,S))}if(S===0)return S}return S}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Oe={"==":bh,"!=":kd,">":qu,"<":Zl,">=":Wu,"<=":Ui,array:ro,at:Ul,boolean:ro,case:Vl,coalesce:cs,collator:Kr,format:tl,image:Gi,in:Mn,"index-of":Gn,interpolate:$n,"interpolate-hcl":$n,"interpolate-lab":$n,length:nl,let:Cn,literal:Go,match:In,number:ro,"number-format":Vi,object:ro,slice:Gl,step:ga,string:ro,"to-boolean":us,"to-color":us,"to-number":us,"to-string":us,var:cn,within:js,distance:ao};class st{constructor(t,s,l,p){this.name=t,this.type=s,this._evaluate=l,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const l=t[0],p=st.definitions[l];if(!p)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,S=v.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let E=null;for(const[I,A]of S){E=new el(s.registry,vr,s.path,null,s.scope);const R=[];let B=!1;for(let N=1;N<t.length;N++){const U=t[N],q=Array.isArray(I)?I[N-1]:I.type,Q=E.parse(U,1+R.length,q);if(!Q){B=!0;break}R.push(Q)}if(!B)if(Array.isArray(I)&&I.length!==R.length)E.error(`Expected ${I.length} arguments, but found ${R.length} instead.`);else{for(let N=0;N<R.length;N++){const U=Array.isArray(I)?I[N]:I.type,q=R[N];E.concat(N+1).checkSubtype(U,q.type)}if(E.errors.length===0)return new st(l,y,A,R)}}if(S.length===1)s.errors.push(...E.errors);else{const I=(S.length?S:v).map(([R])=>{return B=R,Array.isArray(B)?`(${B.map(or).join(", ")})`:`(${or(B.type)}...)`;var B}).join(" | "),A=[];for(let R=1;R<t.length;R++){const B=s.parse(t[R],1+A.length);if(!B)return null;A.push(or(B.type))}s.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(t,s){st.definitions=s;for(const l in s)t[l]=st}}function tt(o,[t,s,l,p]){t=t.evaluate(o),s=s.evaluate(o),l=l.evaluate(o);const y=p?p.evaluate(o):1,v=Vu(t,s,l,y);if(v)throw new sr(v);return new dn(t/255,s/255,l/255,y,!1)}function Ut(o,t){return o in t}function sn(o,t){const s=t[o];return s===void 0?null:s}function Pn(o){return{type:o}}function vr(o){if(o instanceof cn)return vr(o.boundExpression);if(o instanceof st&&o.name==="error"||o instanceof Kr||o instanceof js||o instanceof ao)return!1;const t=o instanceof us||o instanceof ro;let s=!0;return o.eachChild(l=>{s=t?s&&vr(l):s&&l instanceof Go}),!!s&&qn(o)&&uc(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function qn(o){if(o instanceof st&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof js||o instanceof ao)return!1;let t=!0;return o.eachChild(s=>{t&&!qn(s)&&(t=!1)}),t}function va(o){if(o instanceof st&&o.name==="feature-state")return!1;let t=!0;return o.eachChild(s=>{t&&!va(s)&&(t=!1)}),t}function uc(o,t){if(o instanceof st&&t.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(l=>{s&&!uc(l,t)&&(s=!1)}),s}function $i(o){return{result:"success",value:o}}function ps(o){return{result:"error",value:o}}function ll(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function xa(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function ul(o){return!!o.expression&&o.expression.interpolated}function Tn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Bn(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function mf(o){return o}function Ih(o,t){const s=t.type==="color",l=o.stops&&typeof o.stops[0][0]=="object",p=l||!(l||o.property!==void 0),y=o.type||(ul(t)?"exponential":"interval");if(s||t.type==="padding"){const A=s?dn.parse:dr.parse;(o=Pt({},o)).stops&&(o.stops=o.stops.map(R=>[R[0],A(R[1])])),o.default=A(o.default?o.default:t.default)}if(o.colorSpace&&(v=o.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var v;let S,E,I;if(y==="exponential")S=Bd;else if(y==="interval")S=gf;else if(y==="categorical"){S=kh,E=Object.create(null);for(const A of o.stops)E[A[0]]=A[1];I=typeof o.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);S=cc}if(l){const A={},R=[];for(let U=0;U<o.stops.length;U++){const q=o.stops[U],Q=q[0].zoom;A[Q]===void 0&&(A[Q]={zoom:Q,type:o.type,property:o.property,default:o.default,stops:[]},R.push(Q)),A[Q].stops.push([q[0].value,q[1]])}const B=[];for(const U of R)B.push([A[U].zoom,Ih(A[U],t)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:$n.interpolationFactor.bind(void 0,N),zoomStops:B.map(U=>U[0]),evaluate:({zoom:U},q)=>Bd({stops:B,base:o.base},t,U).evaluate(U,q)}}if(p){const A=y==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:$n.interpolationFactor.bind(void 0,A),zoomStops:o.stops.map(R=>R[0]),evaluate:({zoom:R})=>S(o,t,R,E,I)}}return{kind:"source",evaluate(A,R){const B=R&&R.properties?R.properties[o.property]:void 0;return B===void 0?Vs(o.default,t.default):S(o,t,B,E,I)}}}function Vs(o,t,s){return o!==void 0?o:t!==void 0?t:s!==void 0?s:void 0}function kh(o,t,s,l,p){return Vs(typeof s===p?l[s]:void 0,o.default,t.default)}function gf(o,t,s){if(Tn(s)!=="number")return Vs(o.default,t.default);const l=o.stops.length;if(l===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[l-1][0])return o.stops[l-1][1];const p=$l(o.stops.map(y=>y[0]),s);return o.stops[p][1]}function Bd(o,t,s){const l=o.base!==void 0?o.base:1;if(Tn(s)!=="number")return Vs(o.default,t.default);const p=o.stops.length;if(p===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[p-1][0])return o.stops[p-1][1];const y=$l(o.stops.map(A=>A[0]),s),v=function(A,R,B,N){const U=N-B,q=A-B;return U===0?0:R===1?q/U:(Math.pow(R,q)-1)/(Math.pow(R,U)-1)}(s,l,o.stops[y][0],o.stops[y+1][0]),S=o.stops[y][1],E=o.stops[y+1][1],I=oo[t.type]||mf;return typeof S.evaluate=="function"?{evaluate(...A){const R=S.evaluate.apply(void 0,A),B=E.evaluate.apply(void 0,A);if(R!==void 0&&B!==void 0)return I(R,B,v,o.colorSpace)}}:I(S,E,v,o.colorSpace)}function cc(o,t,s){switch(t.type){case"color":s=dn.parse(s);break;case"formatted":s=hr.fromString(s.toString());break;case"resolvedImage":s=ri.fromString(s.toString());break;case"padding":s=dr.parse(s);break;default:Tn(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return Vs(s,o.default,t.default)}st.register(Oe,{error:[{kind:"error"},[Mt],(o,[t])=>{throw new sr(t.evaluate(o))}],typeof:[Mt,[Dt],(o,[t])=>or(tr(t.evaluate(o)))],"to-rgba":[ji(ot,4),[fn],(o,[t])=>{const[s,l,p,y]=t.evaluate(o).rgb;return[255*s,255*l,255*p,y]}],rgb:[fn,[ot,ot,ot],tt],rgba:[fn,[ot,ot,ot,ot],tt],has:{type:Ot,overloads:[[[Mt],(o,[t])=>Ut(t.evaluate(o),o.properties())],[[Mt,Yt],(o,[t,s])=>Ut(t.evaluate(o),s.evaluate(o))]]},get:{type:Dt,overloads:[[[Mt],(o,[t])=>sn(t.evaluate(o),o.properties())],[[Mt,Yt],(o,[t,s])=>sn(t.evaluate(o),s.evaluate(o))]]},"feature-state":[Dt,[Mt],(o,[t])=>sn(t.evaluate(o),o.featureState||{})],properties:[Yt,[],o=>o.properties()],"geometry-type":[Mt,[],o=>o.geometryType()],id:[Dt,[],o=>o.id()],zoom:[ot,[],o=>o.globals.zoom],"heatmap-density":[ot,[],o=>o.globals.heatmapDensity||0],"line-progress":[ot,[],o=>o.globals.lineProgress||0],accumulated:[Dt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[ot,Pn(ot),(o,t)=>{let s=0;for(const l of t)s+=l.evaluate(o);return s}],"*":[ot,Pn(ot),(o,t)=>{let s=1;for(const l of t)s*=l.evaluate(o);return s}],"-":{type:ot,overloads:[[[ot,ot],(o,[t,s])=>t.evaluate(o)-s.evaluate(o)],[[ot],(o,[t])=>-t.evaluate(o)]]},"/":[ot,[ot,ot],(o,[t,s])=>t.evaluate(o)/s.evaluate(o)],"%":[ot,[ot,ot],(o,[t,s])=>t.evaluate(o)%s.evaluate(o)],ln2:[ot,[],()=>Math.LN2],pi:[ot,[],()=>Math.PI],e:[ot,[],()=>Math.E],"^":[ot,[ot,ot],(o,[t,s])=>Math.pow(t.evaluate(o),s.evaluate(o))],sqrt:[ot,[ot],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[ot,[ot],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[ot,[ot],(o,[t])=>Math.log(t.evaluate(o))],log2:[ot,[ot],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[ot,[ot],(o,[t])=>Math.sin(t.evaluate(o))],cos:[ot,[ot],(o,[t])=>Math.cos(t.evaluate(o))],tan:[ot,[ot],(o,[t])=>Math.tan(t.evaluate(o))],asin:[ot,[ot],(o,[t])=>Math.asin(t.evaluate(o))],acos:[ot,[ot],(o,[t])=>Math.acos(t.evaluate(o))],atan:[ot,[ot],(o,[t])=>Math.atan(t.evaluate(o))],min:[ot,Pn(ot),(o,t)=>Math.min(...t.map(s=>s.evaluate(o)))],max:[ot,Pn(ot),(o,t)=>Math.max(...t.map(s=>s.evaluate(o)))],abs:[ot,[ot],(o,[t])=>Math.abs(t.evaluate(o))],round:[ot,[ot],(o,[t])=>{const s=t.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[ot,[ot],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[ot,[ot],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[Ot,[Mt,Dt],(o,[t,s])=>o.properties()[t.value]===s.value],"filter-id-==":[Ot,[Dt],(o,[t])=>o.id()===t.value],"filter-type-==":[Ot,[Mt],(o,[t])=>o.geometryType()===t.value],"filter-<":[Ot,[Mt,Dt],(o,[t,s])=>{const l=o.properties()[t.value],p=s.value;return typeof l==typeof p&&l<p}],"filter-id-<":[Ot,[Dt],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s<l}],"filter->":[Ot,[Mt,Dt],(o,[t,s])=>{const l=o.properties()[t.value],p=s.value;return typeof l==typeof p&&l>p}],"filter-id->":[Ot,[Dt],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s>l}],"filter-<=":[Ot,[Mt,Dt],(o,[t,s])=>{const l=o.properties()[t.value],p=s.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[Ot,[Dt],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s<=l}],"filter->=":[Ot,[Mt,Dt],(o,[t,s])=>{const l=o.properties()[t.value],p=s.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[Ot,[Dt],(o,[t])=>{const s=o.id(),l=t.value;return typeof s==typeof l&&s>=l}],"filter-has":[Ot,[Dt],(o,[t])=>t.value in o.properties()],"filter-has-id":[Ot,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Ot,[ji(Mt)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[Ot,[ji(Dt)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[Ot,[Mt,ji(Dt)],(o,[t,s])=>s.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[Ot,[Mt,ji(Dt)],(o,[t,s])=>function(l,p,y,v){for(;y<=v;){const S=y+v>>1;if(p[S]===l)return!0;p[S]>l?v=S-1:y=S+1}return!1}(o.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(o,[t,s])=>t.evaluate(o)&&s.evaluate(o)],[Pn(Ot),(o,t)=>{for(const s of t)if(!s.evaluate(o))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(o,[t,s])=>t.evaluate(o)||s.evaluate(o)],[Pn(Ot),(o,t)=>{for(const s of t)if(s.evaluate(o))return!0;return!1}]]},"!":[Ot,[Ot],(o,[t])=>!t.evaluate(o)],"is-supported-script":[Ot,[Mt],(o,[t])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(t.evaluate(o))}],upcase:[Mt,[Mt],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[Mt,[Mt],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[Mt,Pn(Dt),(o,t)=>t.map(s=>jl(s.evaluate(o))).join("")],"resolved-locale":[Mt,[_r],(o,[t])=>t.evaluate(o).resolvedLocale()]});class So{constructor(t,s){var l;this.expression=t,this._warningHistory={},this._evaluator=new Jn,this._defaultValue=s?(l=s).type==="color"&&Bn(l.default)?new dn(0,0,0,0):l.type==="color"?dn.parse(l.default)||null:l.type==="padding"?dr.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?pi.parse(l.default)||null:l.type==="projectionDefinition"?ii.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,l,p,y,v){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,s,l,p,y,v){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new sr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function wa(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Oe}function Kl(o,t){const s=new el(Oe,vr,[],t?function(p){const y={color:fn,string:Mt,number:ot,enum:Mt,boolean:Ot,formatted:Bs,padding:Nr,projectionDefinition:En,resolvedImage:Sr,variableAnchorOffsetCollection:ir};return p.type==="array"?ji(y[p.value]||Dt,p.length):y[p.type]}(t):void 0),l=s.parse(o,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?$i(new So(l,t)):ps(s.errors)}class fs{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!va(s.expression)}evaluateWithoutErrorHandling(t,s,l,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,p,y,v)}evaluate(t,s,l,p,y,v){return this._styleExpression.evaluate(t,s,l,p,y,v)}}class Jl{constructor(t,s,l,p){this.kind=t,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!va(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,s,l,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,p,y,v)}evaluate(t,s,l,p,y,v){return this._styleExpression.evaluate(t,s,l,p,y,v)}interpolationFactor(t,s,l){return this.interpolationType?$n.interpolationFactor(this.interpolationType,t,s,l):0}}function Ah(o,t){const s=Kl(o,t);if(s.result==="error")return s;const l=s.value.expression,p=qn(l);if(!p&&!ll(t))return ps([new Ct("","data expressions not supported")]);const y=uc(l,["zoom"]);if(!y&&!xa(t))return ps([new Ct("","zoom expressions not supported")]);const v=Ql(l);return v||y?v instanceof Ct?ps([v]):v instanceof $n&&!ul(t)?ps([new Ct("",'"interpolate" expressions cannot be used with this property')]):$i(v?new Jl(p?"camera":"composite",s.value,v.labels,v instanceof $n?v.interpolation:void 0):new fs(p?"constant":"source",s.value)):ps([new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ba{constructor(t,s){this._parameters=t,this._specification=s,Pt(this,Ih(this._parameters,this._specification))}static deserialize(t){return new ba(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ql(o){let t=null;if(o instanceof Cn)t=Ql(o.result);else if(o instanceof cs){for(const s of o.args)if(t=Ql(s),t)break}else(o instanceof ga||o instanceof $n)&&o.input instanceof st&&o.input.name==="zoom"&&(t=o);return t instanceof Ct||o.eachChild(s=>{const l=Ql(s);l instanceof Ct?t=l:!t&&l?t=new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new Ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Sa(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const t of o.slice(1))if(!Sa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ta={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ca(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Sa(o)||(o=hc(o));const t=Kl(o,Ta);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,l,p)=>t.value.evaluate(s,l,{},p),needGeometry:Nd(o)}}function Od(o,t){return o<t?-1:o>t?1:0}function Nd(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let t=1;t<o.length;t++)if(Nd(o[t]))return!0;return!1}function hc(o){if(!o)return!0;const t=o[0];return o.length<=1?t!=="any":t==="=="?Pa(o[1],o[2],"=="):t==="!="?tu(Pa(o[1],o[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Pa(o[1],o[2],t):t==="any"?(s=o.slice(1),["any"].concat(s.map(hc))):t==="all"?["all"].concat(o.slice(1).map(hc)):t==="none"?["all"].concat(o.slice(1).map(hc).map(tu)):t==="in"?cl(o[1],o.slice(2)):t==="!in"?tu(cl(o[1],o.slice(2))):t==="has"?eu(o[1]):t!=="!has"||tu(eu(o[1]));var s}function Pa(o,t,s){switch(o){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,o,t]}}function cl(o,t){if(t.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",o,["literal",t.sort(Od)]]:["filter-in-small",o,["literal",t]]}}function eu(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function tu(o){return["!",o]}function hl(o){const t=typeof o;if(t==="number"||t==="boolean"||t==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let p="[";for(const y of o)p+=`${hl(y)},`;return`${p}]`}const s=Object.keys(o).sort();let l="{";for(let p=0;p<s.length;p++)l+=`${JSON.stringify(s[p])}:${hl(o[s[p]])},`;return`${l}}`}function zh(o){let t="";for(const s of W)t+=`/${hl(o[s])}`;return t}function dc(o){const t=o.value;return t?[new ke(o.key,t,"constants have been deprecated as of v8")]:[]}function pn(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function xr(o){if(Array.isArray(o))return o.map(xr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const t={};for(const s in o)t[s]=xr(o[s]);return t}return pn(o)}function lo(o){const t=o.key,s=o.value,l=o.valueSpec||{},p=o.objectElementValidators||{},y=o.style,v=o.styleSpec,S=o.validateSpec;let E=[];const I=Tn(s);if(I!=="object")return[new ke(t,s,`object expected, ${I} found`)];for(const A in s){const R=A.split(".")[0],B=l[R]||l["*"];let N;if(p[R])N=p[R];else if(l[R])N=S;else if(p["*"])N=p["*"];else{if(!l["*"]){E.push(new ke(t,s[A],`unknown property "${A}"`));continue}N=S}E=E.concat(N({key:(t&&`${t}.`)+A,value:s[A],valueSpec:B,style:y,styleSpec:v,object:s,objectKey:A,validateSpec:S},s))}for(const A in l)p[A]||l[A].required&&l[A].default===void 0&&s[A]===void 0&&E.push(new ke(t,s,`missing required property "${A}"`));return E}function Rh(o){const t=o.value,s=o.valueSpec,l=o.style,p=o.styleSpec,y=o.key,v=o.arrayElementValidator||o.validateSpec;if(Tn(t)!=="array")return[new ke(y,t,`array expected, ${Tn(t)} found`)];if(s.length&&t.length!==s.length)return[new ke(y,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new ke(y,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let S={type:s.value,values:s.values};p.$version<7&&(S.function=s.function),Tn(s.value)==="object"&&(S=s.value);let E=[];for(let I=0;I<t.length;I++)E=E.concat(v({array:t,arrayIndex:I,value:t[I],valueSpec:S,validateSpec:o.validateSpec,style:l,styleSpec:p,key:`${y}[${I}]`}));return E}function pc(o){const t=o.key,s=o.value,l=o.valueSpec;let p=Tn(s);return p==="number"&&s!=s&&(p="NaN"),p!=="number"?[new ke(t,s,`number expected, ${p} found`)]:"minimum"in l&&s<l.minimum?[new ke(t,s,`${s} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&s>l.maximum?[new ke(t,s,`${s} is greater than the maximum value ${l.maximum}`)]:[]}function jd(o){const t=o.valueSpec,s=pn(o.value.type);let l,p,y,v={};const S=s!=="categorical"&&o.value.property===void 0,E=!S,I=Tn(o.value.stops)==="array"&&Tn(o.value.stops[0])==="array"&&Tn(o.value.stops[0][0])==="object",A=lo({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(N){if(s==="identity")return[new ke(N.key,N.value,'identity function may not have a "stops" property')];let U=[];const q=N.value;return U=U.concat(Rh({key:N.key,value:q,valueSpec:N.valueSpec,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:R})),Tn(q)==="array"&&q.length===0&&U.push(new ke(N.key,q,"array must have at least one stop")),U},default:function(N){return N.validateSpec({key:N.key,value:N.value,valueSpec:t,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec})}}});return s==="identity"&&S&&A.push(new ke(o.key,o.value,'missing required property "property"')),s==="identity"||o.value.stops||A.push(new ke(o.key,o.value,'missing required property "stops"')),s==="exponential"&&o.valueSpec.expression&&!ul(o.valueSpec)&&A.push(new ke(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!ll(o.valueSpec)?A.push(new ke(o.key,o.value,"property functions not supported")):S&&!xa(o.valueSpec)&&A.push(new ke(o.key,o.value,"zoom functions not supported"))),s!=="categorical"&&!I||o.value.property!==void 0||A.push(new ke(o.key,o.value,'"property" property is required')),A;function R(N){let U=[];const q=N.value,Q=N.key;if(Tn(q)!=="array")return[new ke(Q,q,`array expected, ${Tn(q)} found`)];if(q.length!==2)return[new ke(Q,q,`array length 2 expected, length ${q.length} found`)];if(I){if(Tn(q[0])!=="object")return[new ke(Q,q,`object expected, ${Tn(q[0])} found`)];if(q[0].zoom===void 0)return[new ke(Q,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new ke(Q,q,"object stop key must have value")];if(y&&y>pn(q[0].zoom))return[new ke(Q,q[0].zoom,"stop zoom values must appear in ascending order")];pn(q[0].zoom)!==y&&(y=pn(q[0].zoom),p=void 0,v={}),U=U.concat(lo({key:`${Q}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:pc,value:B}}))}else U=U.concat(B({key:`${Q}[0]`,value:q[0],validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec},q));return wa(xr(q[1]))?U.concat([new ke(`${Q}[1]`,q[1],"expressions are not allowed in function stops.")]):U.concat(N.validateSpec({key:`${Q}[1]`,value:q[1],valueSpec:t,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec}))}function B(N,U){const q=Tn(N.value),Q=pn(N.value),ae=N.value!==null?N.value:U;if(l){if(q!==l)return[new ke(N.key,ae,`${q} stop domain type must match previous stop domain type ${l}`)]}else l=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new ke(N.key,ae,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&s!=="categorical"){let Me=`number expected, ${q} found`;return ll(t)&&s===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(N.key,ae,Me)]}return s!=="categorical"||q!=="number"||isFinite(Q)&&Math.floor(Q)===Q?s!=="categorical"&&q==="number"&&p!==void 0&&Q<p?[new ke(N.key,ae,"stop domain values must appear in ascending order")]:(p=Q,s==="categorical"&&Q in v?[new ke(N.key,ae,"stop domain values must be unique")]:(v[Q]=!0,[])):[new ke(N.key,ae,`integer expected, found ${Q}`)]}}function Gs(o){const t=(o.expressionContext==="property"?Ah:Kl)(xr(o.value),o.valueSpec);if(t.result==="error")return t.value.map(l=>new ke(`${o.key}${l.key}`,o.value,l.message));const s=t.value.expression||t.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!s.outputDefined())return[new ke(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!va(s))return[new ke(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!va(s))return[new ke(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!uc(s,["zoom","feature-state"]))return[new ke(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!qn(s))return[new ke(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qo(o){const t=o.key,s=o.value,l=o.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(pn(s))===-1&&p.push(new ke(t,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(l.values).indexOf(pn(s))===-1&&p.push(new ke(t,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function dl(o){return Sa(xr(o.value))?Gs(Pt({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wo(o)}function Wo(o){const t=o.value,s=o.key;if(Tn(t)!=="array")return[new ke(s,t,`array expected, ${Tn(t)} found`)];const l=o.styleSpec;let p,y=[];if(t.length<1)return[new ke(s,t,"filter array must have at least 1 element")];switch(y=y.concat(qo({key:`${s}[0]`,value:t[0],valueSpec:l.filter_operator,style:o.style,styleSpec:o.styleSpec})),pn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&pn(t[1])==="$type"&&y.push(new ke(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new ke(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Tn(t[1]),p!=="string"&&y.push(new ke(`${s}[1]`,t[1],`string expected, ${p} found`)));for(let v=2;v<t.length;v++)p=Tn(t[v]),pn(t[1])==="$type"?y=y.concat(qo({key:`${s}[${v}]`,value:t[v],valueSpec:l.geometry_type,style:o.style,styleSpec:o.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new ke(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)y=y.concat(Wo({key:`${s}[${v}]`,value:t[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=Tn(t[1]),t.length!==2?y.push(new ke(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new ke(`${s}[1]`,t[1],`string expected, ${p} found`))}return y}function pl(o,t){const s=o.key,l=o.validateSpec,p=o.style,y=o.styleSpec,v=o.value,S=o.objectKey,E=y[`${t}_${o.layerType}`];if(!E)return[];const I=S.match(/^(.*)-transition$/);if(t==="paint"&&I&&E[I[1]]&&E[I[1]].transition)return l({key:s,value:v,valueSpec:y.transition,style:p,styleSpec:y});const A=o.valueSpec||E[S];if(!A)return[new ke(s,v,`unknown property "${S}"`)];let R;if(Tn(v)==="string"&&ll(A)&&!A.tokens&&(R=/^{([^}]+)}$/.exec(v)))return[new ke(s,v,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const B=[];return o.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&B.push(new ke(s,v,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Bn(xr(v))&&pn(v.type)==="identity"&&B.push(new ke(s,v,'"text-font" does not support identity functions'))),B.concat(l({key:o.key,value:v,valueSpec:A,style:p,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:S}))}function Ea(o){return pl(o,"paint")}function fl(o){return pl(o,"layout")}function Ma(o){let t=[];const s=o.value,l=o.key,p=o.style,y=o.styleSpec;s.type||s.ref||t.push(new ke(l,s,'either "type" or "ref" is required'));let v=pn(s.type);const S=pn(s.ref);if(s.id){const E=pn(s.id);for(let I=0;I<o.arrayIndex;I++){const A=p.layers[I];pn(A.id)===E&&t.push(new ke(l,s.id,`duplicate layer id "${s.id}", previously used at line ${A.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new ke(l,s[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{pn(I.id)===S&&(E=I)}),E?E.ref?t.push(new ke(l,s.ref,"ref cannot reference another ref layer")):v=pn(E.type):t.push(new ke(l,s.ref,`ref layer "${S}" not found`))}else if(v!=="background")if(s.source){const E=p.sources&&p.sources[s.source],I=E&&pn(E.type);E?I==="vector"&&v==="raster"?t.push(new ke(l,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"?t.push(new ke(l,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?t.push(new ke(l,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&v!=="hillshade"?t.push(new ke(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&E.lineMetrics||t.push(new ke(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ke(l,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new ke(l,s.source,`source "${s.source}" not found`))}else t.push(new ke(l,s,'missing required property "source"'));return t=t.concat(lo({key:l,value:s,valueSpec:y.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${l}.type`,value:s.type,valueSpec:y.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:s,objectKey:"type"}),filter:dl,layout:E=>lo({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>fl(Pt({layerType:v},I))}}),paint:E=>lo({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>Ea(Pt({layerType:v},I))}})}})),t}function $s(o){const t=o.value,s=o.key,l=Tn(t);return l!=="string"?[new ke(s,t,`string expected, ${l} found`)]:[]}const Lh={promoteId:function({key:o,value:t}){if(Tn(t)==="string")return $s({key:o,value:t});{const s=[];for(const l in t)s.push(...$s({key:`${o}.${l}`,value:t[l]}));return s}}};function ml(o){const t=o.value,s=o.key,l=o.styleSpec,p=o.style,y=o.validateSpec;if(!t.type)return[new ke(s,t,'"type" is required')];const v=pn(t.type);let S;switch(v){case"vector":case"raster":return S=lo({key:s,value:t,valueSpec:l[`source_${v.replace("-","_")}`],style:o.style,styleSpec:l,objectElementValidators:Lh,validateSpec:y}),S;case"raster-dem":return S=function(E){var I;const A=(I=E.sourceName)!==null&&I!==void 0?I:"",R=E.value,B=E.styleSpec,N=B.source_raster_dem,U=E.style;let q=[];const Q=Tn(R);if(R===void 0)return q;if(Q!=="object")return q.push(new ke("source_raster_dem",R,`object expected, ${Q} found`)),q;const ae=pn(R.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],de=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const O in R)!ae&&Me.includes(O)?q.push(new ke(O,R[O],`In "${A}": "${O}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):N[O]?q=q.concat(E.validateSpec({key:O,value:R[O],valueSpec:N[O],validateSpec:E.validateSpec,style:U,styleSpec:B})):q.push(new ke(O,R[O],`unknown property "${O}"`));return q}({sourceName:s,value:t,style:o.style,styleSpec:l,validateSpec:y}),S;case"geojson":if(S=lo({key:s,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:y,objectElementValidators:Lh}),t.cluster)for(const E in t.clusterProperties){const[I,A]=t.clusterProperties[E],R=typeof I=="string"?[I,["accumulated"],["get",E]]:I;S.push(...Gs({key:`${s}.${E}.map`,value:A,expressionContext:"cluster-map"})),S.push(...Gs({key:`${s}.${E}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return S;case"video":return lo({key:s,value:t,valueSpec:l.source_video,style:p,validateSpec:y,styleSpec:l});case"image":return lo({key:s,value:t,valueSpec:l.source_image,style:p,validateSpec:y,styleSpec:l});case"canvas":return[new ke(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qo({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ud(o){const t=o.value,s=o.styleSpec,l=s.light,p=o.style;let y=[];const v=Tn(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new ke("light",t,`object expected, ${v} found`)]),y;for(const S in t){const E=S.match(/^(.*)-transition$/);y=y.concat(E&&l[E[1]]&&l[E[1]].transition?o.validateSpec({key:S,value:t[S],valueSpec:s.transition,validateSpec:o.validateSpec,style:p,styleSpec:s}):l[S]?o.validateSpec({key:S,value:t[S],valueSpec:l[S],validateSpec:o.validateSpec,style:p,styleSpec:s}):[new ke(S,t[S],`unknown property "${S}"`)])}return y}function Vd(o){const t=o.value,s=o.styleSpec,l=s.sky,p=o.style,y=Tn(t);if(t===void 0)return[];if(y!=="object")return[new ke("sky",t,`object expected, ${y} found`)];let v=[];for(const S in t)v=v.concat(l[S]?o.validateSpec({key:S,value:t[S],valueSpec:l[S],style:p,styleSpec:s}):[new ke(S,t[S],`unknown property "${S}"`)]);return v}function nu(o){const t=o.value,s=o.styleSpec,l=s.terrain,p=o.style;let y=[];const v=Tn(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new ke("terrain",t,`object expected, ${v} found`)]),y;for(const S in t)y=y.concat(l[S]?o.validateSpec({key:S,value:t[S],valueSpec:l[S],validateSpec:o.validateSpec,style:p,styleSpec:s}):[new ke(S,t[S],`unknown property "${S}"`)]);return y}function gl(o){let t=[];const s=o.value,l=o.key;if(Array.isArray(s)){const p=[],y=[];for(const v in s)s[v].id&&p.includes(s[v].id)&&t.push(new ke(l,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),p.push(s[v].id),s[v].url&&y.includes(s[v].url)&&t.push(new ke(l,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),y.push(s[v].url),t=t.concat(lo({key:`${l}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return t}return $s({key:l,value:s})}const Dh={"*":()=>[],array:Rh,boolean:function(o){const t=o.value,s=o.key,l=Tn(t);return l!=="boolean"?[new ke(s,t,`boolean expected, ${l} found`)]:[]},number:pc,color:function(o){const t=o.key,s=o.value,l=Tn(s);return l!=="string"?[new ke(t,s,`color expected, ${l} found`)]:dn.parse(String(s))?[]:[new ke(t,s,`color expected, "${s}" found`)]},constants:dc,enum:qo,filter:dl,function:jd,layer:Ma,object:lo,source:ml,light:Ud,sky:Vd,terrain:nu,projection:function(o){const t=o.value,s=o.styleSpec,l=s.projection,p=o.style,y=Tn(t);if(t===void 0)return[];if(y!=="object")return[new ke("projection",t,`object expected, ${y} found`)];let v=[];for(const S in t)v=v.concat(l[S]?o.validateSpec({key:S,value:t[S],valueSpec:l[S],style:p,styleSpec:s}):[new ke(S,t[S],`unknown property "${S}"`)]);return v},projectionDefinition:function(o){const t=o.key;let s=o.value;s=s instanceof String?s.valueOf():s;const l=Tn(s);return l!=="array"||function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"}(s)||function(p){return!!["interpolate","step","literal"].includes(p[0])}(s)?["array","string"].includes(l)?[]:[new ke(t,s,`projection expected, invalid type "${l}" found`)]:[new ke(t,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:$s,formatted:function(o){return $s(o).length===0?[]:Gs(o)},resolvedImage:function(o){return $s(o).length===0?[]:Gs(o)},padding:function(o){const t=o.key,s=o.value;if(Tn(s)==="array"){if(s.length<1||s.length>4)return[new ke(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const l={type:"number"};let p=[];for(let y=0;y<s.length;y++)p=p.concat(o.validateSpec({key:`${t}[${y}]`,value:s[y],validateSpec:o.validateSpec,valueSpec:l}));return p}return pc({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const t=o.key,s=o.value,l=Tn(s),p=o.styleSpec;if(l!=="array"||s.length<1||s.length%2!=0)return[new ke(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let v=0;v<s.length;v+=2)y=y.concat(qo({key:`${t}[${v}]`,value:s[v],valueSpec:p.layout_symbol["text-anchor"]})),y=y.concat(Rh({key:`${t}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:p}));return y},sprite:gl};function X(o){const t=o.value,s=o.valueSpec,l=o.styleSpec;return o.validateSpec=X,s.expression&&Bn(pn(t))?jd(o):s.expression&&wa(xr(t))?Gs(o):s.type&&Dh[s.type]?Dh[s.type](o):lo(Pt({},o,{valueSpec:s.type?l[s.type]:s}))}function To(o){const t=o.value,s=o.key,l=$s(o);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new ke(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new ke(s,t,'"glyphs" url must include a "{range}" token'))),l}function Jr(o,t=te){let s=[];return s=s.concat(X({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,validateSpec:X,objectElementValidators:{glyphs:To,"*":()=>[]}})),o.constants&&(s=s.concat(dc({key:"constants",value:o.constants}))),_n(s)}function zn(o){return function(t){return o({...t,validateSpec:X})}}function _n(o){return[].concat(o).sort((t,s)=>t.line-s.line)}function Co(o){return function(...t){return _n(o.apply(this,t))}}Jr.source=Co(zn(ml)),Jr.sprite=Co(zn(gl)),Jr.glyphs=Co(zn(To)),Jr.light=Co(zn(Ud)),Jr.sky=Co(zn(Vd)),Jr.terrain=Co(zn(nu)),Jr.layer=Co(zn(Ma)),Jr.filter=Co(zn(dl)),Jr.paintProperty=Co(zn(Ea)),Jr.layoutProperty=Co(zn(fl));const _l=Jr,_f=_l.light,Po=_l.sky,Gd=_l.paintProperty,Fh=_l.layoutProperty;function $d(o,t){let s=!1;if(t&&t.length)for(const l of t)o.fire(new ls(new Error(l.message))),s=!0;return s}class Ia{constructor(t,s,l){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(s=v[1])+2*(l=v[2]);for(let E=0;E<this.d*this.d;E++){const I=v[3+E],A=v[3+E+1];p.push(I===A?null:v.subarray(I,A))}const S=v[3+p.length+1];this.keys=v.subarray(v[3+p.length],S),this.bboxes=v.subarray(S),this.insert=this._insertReadonly}else{this.d=s+2*l;for(let v=0;v<this.d*this.d;v++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=l,this.scale=s/t,this.uid=0;const y=l/s*t;this.min=-y,this.max=t+y}insert(t,s,l,p,y){this._forEachCell(s,l,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,l,p,y,v){this.cells[y].push(v)}query(t,s,l,p,y){const v=this.min,S=this.max;if(t<=v&&s<=v&&S<=l&&S<=p&&!y)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(t,s,l,p,this._queryCell,E,{},y),E}}_queryCell(t,s,l,p,y,v,S,E){const I=this.cells[y];if(I!==null){const A=this.keys,R=this.bboxes;for(let B=0;B<I.length;B++){const N=I[B];if(S[N]===void 0){const U=4*N;(E?E(R[U+0],R[U+1],R[U+2],R[U+3]):t<=R[U+2]&&s<=R[U+3]&&l>=R[U+0]&&p>=R[U+1])?(S[N]=!0,v.push(A[N])):S[N]=!1}}}}_forEachCell(t,s,l,p,y,v,S,E){const I=this._convertToCellCoord(t),A=this._convertToCellCoord(s),R=this._convertToCellCoord(l),B=this._convertToCellCoord(p);for(let N=I;N<=R;N++)for(let U=A;U<=B;U++){const q=this.d*U+N;if((!E||E(this._convertFromCellCoord(N),this._convertFromCellCoord(U),this._convertFromCellCoord(N+1),this._convertFromCellCoord(U+1)))&&y.call(this,t,s,l,p,q,v,S,E))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let l=0;for(let v=0;v<this.cells.length;v++)l+=this.cells[v].length;const p=new Int32Array(s+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=s;for(let v=0;v<t.length;v++){const S=t[v];p[3+v]=y,p.set(S,y),y+=S.length}return p[3+t.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+t.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(t,s){const l=t.toArrayBuffer();return s&&s.push(l),{buffer:l}}static deserialize(t){return new Ia(t.buffer)}}const ms={};function It(o,t,s={}){if(ms[o])throw new Error(`${o} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:o,writeable:!1}),ms[o]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}It("Object",Object),It("TransferableGridIndex",Ia),It("Color",dn),It("Error",Error),It("AJAXError",eo),It("ResolvedImage",ri),It("StylePropertyFunction",ba),It("StyleExpression",So,{omit:["_evaluator"]}),It("ZoomDependentExpression",Jl),It("ZoomConstantExpression",fs),It("CompoundExpression",st,{omit:["_evaluate"]});for(const o in Oe)Oe[o]._classRegistryKey||It(`Expression_${o}`,Oe[o]);function Zd(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function ka(o){return o.$name||o.constructor._classRegistryKey}function qd(o){return!function(t){if(t===null||typeof t!="object")return!1;const s=ka(t);return!(!s||s==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||Zd(o)||rn(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function ru(o,t){if(qd(o))return(Zd(o)||rn(o))&&t&&t.push(o),ArrayBuffer.isView(o)&&t&&t.push(o.buffer),o instanceof ImageData&&t&&t.push(o.data.buffer),o;if(Array.isArray(o)){const y=[];for(const v of o)y.push(ru(v,t));return y}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const s=ka(o);if(!s)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!ms[s])throw new Error(`${s} is not registered.`);const{klass:l}=ms[s],p=l.serialize?l.serialize(o,t):{};if(l.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in o){if(!o.hasOwnProperty(y)||ms[s].omit.indexOf(y)>=0)continue;const v=o[y];p[y]=ms[s].shallow.indexOf(y)>=0?v:ru(v,t)}o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(p.$name=s),p}function Zs(o){if(qd(o))return o;if(Array.isArray(o))return o.map(Zs);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const t=ka(o)||"Object";if(!ms[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=ms[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(o);const l=Object.create(s.prototype);for(const p of Object.keys(o)){if(p==="$name")continue;const y=o[p];l[p]=ms[t].shallow.indexOf(p)>=0?y:Zs(y)}return l}class Ho{constructor(){this.first=!0}update(t,s){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const yn={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function yl(o){for(const t of o)if(gc(t.charCodeAt(0)))return!0;return!1}function Wd(o){for(const t of o)if(!qs(t.charCodeAt(0)))return!1;return!0}function fc(o){const t=o.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(t.join("|"),"u")}const Hd=fc(["Arab","Dupl","Mong","Ougr","Syrc"]);function qs(o){return!Hd.test(String.fromCodePoint(o))}const mc=fc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function gc(o){return!(o!==746&&o!==747&&(o<4352||!(yn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||yn["CJK Compatibility"](o)||yn["CJK Strokes"](o)||!(!yn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||yn["Enclosed CJK Letters and Months"](o)||yn["Ideographic Description Characters"](o)||yn.Kanbun(o)||yn.Katakana(o)&&o!==12540||!(!yn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!yn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||yn["Vertical Forms"](o)||yn["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||mc.test(String.fromCodePoint(o)))))}function uo(o){return!(gc(o)||function(t){return!!(yn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||yn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||yn["Letterlike Symbols"](t)||yn["Number Forms"](t)||yn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||yn["Control Pictures"](t)&&t!==9251||yn["Optical Character Recognition"](t)||yn["Enclosed Alphanumerics"](t)||yn["Geometric Shapes"](t)||yn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||yn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||yn["CJK Symbols and Punctuation"](t)||yn.Katakana(t)||yn["Private Use Area"](t)||yn["CJK Compatibility Forms"](t)||yn["Small Form Variants"](t)||yn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(o))}const Yd=fc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Xd(o){return Yd.test(String.fromCodePoint(o))}function Kd(o,t){return!(!t&&Xd(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||yn.Khmer(o))}function Jd(o){for(const t of o)if(Xd(t.charCodeAt(0)))return!0;return!1}const gs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(gs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,t){return u(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;const s=o.pluginURL,l=new Promise(y=>{this.loadScriptResolve=y});t(s);const p=new Promise(y=>setTimeout(()=>y(),this.TIMEOUT));if(yield Promise.race([l,p]),this.isParsed()){const y={pluginStatus:"loaded",pluginURL:s};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class nr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ho,this.transition={})}isSupportedScript(t){return function(s,l){for(const p of s)if(!Kd(p.charCodeAt(0),l))return!1;return!0}(t,gs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class iu{constructor(t,s){this.property=t,this.value=s,this.expression=function(l,p){if(Bn(l))return new ba(l,p);if(wa(l)){const y=Ah(l,p);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=l;return p.type==="color"&&typeof l=="string"?y=dn.parse(l):p.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?y=pi.parse(l):p.type==="projectionDefinition"&&typeof l=="string"&&(y=ii.parse(l)):y=dr.parse(l),{kind:"constant",evaluate:()=>y}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,l){return this.property.possiblyEvaluate(this,t,s,l)}}class _c{constructor(t){this.property=t,this.value=new iu(t,void 0)}transitioned(t,s){return new ou(this.property,this.value,s,bt({},t.transition,this.transition),t.now)}untransitioned(){return new ou(this.property,this.value,null,{},0)}}class Bh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return on(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new _c(this._values[t].property)),this._values[t].value=new iu(this._values[t].property,s===null?void 0:on(s))}getTransition(t){return on(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new _c(this._values[t].property)),this._values[t].transition=on(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l);const p=this.getTransition(s);p!==void 0&&(t[`${s}-transition`]=p)}return t}transitioned(t,s){const l=new Aa(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(t,s._values[p]);return l}untransitioned(){const t=new Aa(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class ou{constructor(t,s,l,p,y){this.property=t,this.value=s,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(t,s,l){const p=t.now||0,y=this.value.possiblyEvaluate(t,s,l),v=this.prior;if(v){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return v.possiblyEvaluate(t,s,l);{const S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,s,l),y,ye(S))}}return y}}class Aa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,l){const p=new Ra(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,s,l);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class za{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return on(this._values[t].value)}setValue(t,s){this._values[t]=new iu(this._values[t].property,s===null?void 0:on(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l)}return t}possiblyEvaluate(t,s,l){const p=new Ra(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,s,l);return p}}class Yo{constructor(t,s,l){this.property=t,this.value=s,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,l,p){return this.property.evaluate(this.value,this.parameters,t,s,l,p)}}class Ra{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Vt{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,l){const p=oo[this.specification.type];return p?p(t,s,l):t}}class Gt{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,l,p){return new Yo(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},l,p)}:t.expression,s)}interpolate(t,s,l){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Yo(this,{kind:"constant",value:void 0},t.parameters);const p=oo[this.specification.type];if(p){const y=p(t.value.value,s.value.value,l);return new Yo(this,{kind:"constant",value:y},t.parameters)}return t}evaluate(t,s,l,p,y,v){return t.kind==="constant"?t.value:t.evaluate(s,l,p,y,v)}}class La extends Gt{possiblyEvaluate(t,s,l,p){if(t.value===void 0)return new Yo(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const y=t.expression.evaluate(s,null,{},l,p),v=t.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,S=this._calculate(v,v,v,s);return new Yo(this,{kind:"constant",value:S},s)}if(t.expression.kind==="camera"){const y=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Yo(this,{kind:"constant",value:y},s)}return new Yo(this,t.expression,s)}evaluate(t,s,l,p,y,v){if(t.kind==="source"){const S=t.evaluate(s,l,p,y,v);return this._calculate(S,S,S,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},l,p),t.evaluate({zoom:Math.floor(s.zoom)},l,p),t.evaluate({zoom:Math.floor(s.zoom)+1},l,p),s):t.value}_calculate(t,s,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class Xo{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const y=t.expression.evaluate(s,null,{},l,p);return this._calculate(y,y,y,s)}return this._calculate(t.expression.evaluate(new nr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new nr(Math.floor(s.zoom),s)),t.expression.evaluate(new nr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class _i{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,p){return!!t.expression.evaluate(s,null,{},l,p)}interpolate(){return!1}}class Ti{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const l=t[s];l.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new iu(l,void 0),y=this.defaultTransitionablePropertyValues[s]=new _c(l);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}}}It("DataDrivenProperty",Gt),It("DataConstantProperty",Vt),It("CrossFadedDataDrivenProperty",La),It("CrossFadedProperty",Xo),It("ColorRampProperty",_i);const Oh="-transition";class Eo extends No{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new za(s.layout)),s.paint)){this._transitionablePaint=new Bh(s.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ra(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,l={}){s!=null&&this._validate(Fh,`layers.${this.id}.layout.${t}`,t,s,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(Oh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,l={}){if(s!=null&&this._validate(Gd,`layers.${this.id}.paint.${t}`,t,s,l))return!1;if(t.endsWith(Oh))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[t],y=p.property.specification["property-type"]==="cross-faded-data-driven",v=p.value.isDataDriven(),S=p.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const E=this._transitionablePaint._values[t].value;return E.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(t,S,E)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Kt(t,(s,l)=>!(s===void 0||l==="layout"&&!Object.keys(s).length||l==="paint"&&!Object.keys(s).length))}_validate(t,s,l,p,y={}){return(!y||y.validate!==!1)&&$d(this,t.call(_l,{key:s,layerType:this.type,objectKey:l,value:p,styleSpec:te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Yo&&ll(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const su={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class co{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Cr(o,t=1){let s=0,l=0;return{members:o.map(p=>{const y=su[p.type].BYTES_PER_ELEMENT,v=s=au(s,Math.max(t,y)),S=p.components||1;return l=Math.max(l,y),s+=y*S,{name:p.name,type:p.type,components:S,offset:v}}),size:au(s,Math.max(l,t)),alignment:t}}function au(o,t){return Math.ceil(o/t)*t}class lu extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const p=2*t;return this.int16[p+0]=s,this.int16[p+1]=l,t}}lu.prototype.bytesPerElement=4,It("StructArrayLayout2i4",lu);class vl extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.int16[y+0]=s,this.int16[y+1]=l,this.int16[y+2]=p,t}}vl.prototype.bytesPerElement=6,It("StructArrayLayout3i6",vl);class jr extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,l,p)}emplace(t,s,l,p,y){const v=4*t;return this.int16[v+0]=s,this.int16[v+1]=l,this.int16[v+2]=p,this.int16[v+3]=y,t}}jr.prototype.bytesPerElement=8,It("StructArrayLayout4i8",jr);class uu extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,l,p,y,v)}emplace(t,s,l,p,y,v,S){const E=6*t;return this.int16[E+0]=s,this.int16[E+1]=l,this.int16[E+2]=p,this.int16[E+3]=y,this.int16[E+4]=v,this.int16[E+5]=S,t}}uu.prototype.bytesPerElement=12,It("StructArrayLayout2i4i12",uu);class Ko extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,l,p,y,v)}emplace(t,s,l,p,y,v,S){const E=4*t,I=8*t;return this.int16[E+0]=s,this.int16[E+1]=l,this.uint8[I+4]=p,this.uint8[I+5]=y,this.uint8[I+6]=v,this.uint8[I+7]=S,t}}Ko.prototype.bytesPerElement=8,It("StructArrayLayout2i4ub8",Ko);class yi extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const p=2*t;return this.float32[p+0]=s,this.float32[p+1]=l,t}}yi.prototype.bytesPerElement=8,It("StructArrayLayout2f8",yi);class Da extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v,S,E,I,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,s,l,p,y,v,S,E,I,A)}emplace(t,s,l,p,y,v,S,E,I,A,R){const B=10*t;return this.uint16[B+0]=s,this.uint16[B+1]=l,this.uint16[B+2]=p,this.uint16[B+3]=y,this.uint16[B+4]=v,this.uint16[B+5]=S,this.uint16[B+6]=E,this.uint16[B+7]=I,this.uint16[B+8]=A,this.uint16[B+9]=R,t}}Da.prototype.bytesPerElement=20,It("StructArrayLayout10ui20",Da);class Fa extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v,S,E,I,A,R,B){const N=this.length;return this.resize(N+1),this.emplace(N,t,s,l,p,y,v,S,E,I,A,R,B)}emplace(t,s,l,p,y,v,S,E,I,A,R,B,N){const U=12*t;return this.int16[U+0]=s,this.int16[U+1]=l,this.int16[U+2]=p,this.int16[U+3]=y,this.uint16[U+4]=v,this.uint16[U+5]=S,this.uint16[U+6]=E,this.uint16[U+7]=I,this.int16[U+8]=A,this.int16[U+9]=R,this.int16[U+10]=B,this.int16[U+11]=N,t}}Fa.prototype.bytesPerElement=24,It("StructArrayLayout4i4ui4i24",Fa);class Mo extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.float32[y+0]=s,this.float32[y+1]=l,this.float32[y+2]=p,t}}Mo.prototype.bytesPerElement=12,It("StructArrayLayout3f12",Mo);class yc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}yc.prototype.bytesPerElement=4,It("StructArrayLayout1ul4",yc);class zr extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v,S,E,I){const A=this.length;return this.resize(A+1),this.emplace(A,t,s,l,p,y,v,S,E,I)}emplace(t,s,l,p,y,v,S,E,I,A){const R=10*t,B=5*t;return this.int16[R+0]=s,this.int16[R+1]=l,this.int16[R+2]=p,this.int16[R+3]=y,this.int16[R+4]=v,this.int16[R+5]=S,this.uint32[B+3]=E,this.uint16[R+8]=I,this.uint16[R+9]=A,t}}zr.prototype.bytesPerElement=20,It("StructArrayLayout6i1ul2ui20",zr);class _s extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,l,p,y,v)}emplace(t,s,l,p,y,v,S){const E=6*t;return this.int16[E+0]=s,this.int16[E+1]=l,this.int16[E+2]=p,this.int16[E+3]=y,this.int16[E+4]=v,this.int16[E+5]=S,t}}_s.prototype.bytesPerElement=12,It("StructArrayLayout2i2i2i12",_s);class Nh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,l,p,y)}emplace(t,s,l,p,y,v){const S=4*t,E=8*t;return this.float32[S+0]=s,this.float32[S+1]=l,this.float32[S+2]=p,this.int16[E+6]=y,this.int16[E+7]=v,t}}Nh.prototype.bytesPerElement=16,It("StructArrayLayout2f1f2i16",Nh);class vc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,l,p,y,v)}emplace(t,s,l,p,y,v,S){const E=16*t,I=4*t,A=8*t;return this.uint8[E+0]=s,this.uint8[E+1]=l,this.float32[I+1]=p,this.float32[I+2]=y,this.int16[A+6]=v,this.int16[A+7]=S,t}}vc.prototype.bytesPerElement=16,It("StructArrayLayout2ub2f2i16",vc);class Ws extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.uint16[y+0]=s,this.uint16[y+1]=l,this.uint16[y+2]=p,t}}Ws.prototype.bytesPerElement=6,It("StructArrayLayout3ui6",Ws);class cu extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v,S,E,I,A,R,B,N,U,q,Q,ae){const Me=this.length;return this.resize(Me+1),this.emplace(Me,t,s,l,p,y,v,S,E,I,A,R,B,N,U,q,Q,ae)}emplace(t,s,l,p,y,v,S,E,I,A,R,B,N,U,q,Q,ae,Me){const de=24*t,O=12*t,J=48*t;return this.int16[de+0]=s,this.int16[de+1]=l,this.uint16[de+2]=p,this.uint16[de+3]=y,this.uint32[O+2]=v,this.uint32[O+3]=S,this.uint32[O+4]=E,this.uint16[de+10]=I,this.uint16[de+11]=A,this.uint16[de+12]=R,this.float32[O+7]=B,this.float32[O+8]=N,this.uint8[J+36]=U,this.uint8[J+37]=q,this.uint8[J+38]=Q,this.uint32[O+10]=ae,this.int16[de+22]=Me,t}}cu.prototype.bytesPerElement=48,It("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cu);class jh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,v,S,E,I,A,R,B,N,U,q,Q,ae,Me,de,O,J,_e,Ze,dt,Je,Xe,pt,mt){const wt=this.length;return this.resize(wt+1),this.emplace(wt,t,s,l,p,y,v,S,E,I,A,R,B,N,U,q,Q,ae,Me,de,O,J,_e,Ze,dt,Je,Xe,pt,mt)}emplace(t,s,l,p,y,v,S,E,I,A,R,B,N,U,q,Q,ae,Me,de,O,J,_e,Ze,dt,Je,Xe,pt,mt,wt){const it=32*t,Bt=16*t;return this.int16[it+0]=s,this.int16[it+1]=l,this.int16[it+2]=p,this.int16[it+3]=y,this.int16[it+4]=v,this.int16[it+5]=S,this.int16[it+6]=E,this.int16[it+7]=I,this.uint16[it+8]=A,this.uint16[it+9]=R,this.uint16[it+10]=B,this.uint16[it+11]=N,this.uint16[it+12]=U,this.uint16[it+13]=q,this.uint16[it+14]=Q,this.uint16[it+15]=ae,this.uint16[it+16]=Me,this.uint16[it+17]=de,this.uint16[it+18]=O,this.uint16[it+19]=J,this.uint16[it+20]=_e,this.uint16[it+21]=Ze,this.uint16[it+22]=dt,this.uint32[Bt+12]=Je,this.float32[Bt+13]=Xe,this.float32[Bt+14]=pt,this.uint16[it+30]=mt,this.uint16[it+31]=wt,t}}jh.prototype.bytesPerElement=64,It("StructArrayLayout8i15ui1ul2f2ui64",jh);class ys extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}ys.prototype.bytesPerElement=4,It("StructArrayLayout1f4",ys);class xc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.uint16[6*t+0]=s,this.float32[y+1]=l,this.float32[y+2]=p,t}}xc.prototype.bytesPerElement=12,It("StructArrayLayout1ui2f12",xc);class g extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=4*t;return this.uint32[2*t+0]=s,this.uint16[y+2]=l,this.uint16[y+3]=p,t}}g.prototype.bytesPerElement=8,It("StructArrayLayout1ul2ui8",g);class e extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const p=2*t;return this.uint16[p+0]=s,this.uint16[p+1]=l,t}}e.prototype.bytesPerElement=4,It("StructArrayLayout2ui4",e);class r extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}r.prototype.bytesPerElement=2,It("StructArrayLayout1ui2",r);class c extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,l,p)}emplace(t,s,l,p,y){const v=4*t;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=p,this.float32[v+3]=y,t}}c.prototype.bytesPerElement=16,It("StructArrayLayout4f16",c);class d extends co{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Be(this.anchorPointX,this.anchorPointY)}}d.prototype.size=20;class _ extends zr{get(t){return new d(this,t)}}It("CollisionBoxArray",_);class w extends co{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}w.prototype.size=48;class P extends cu{get(t){return new w(this,t)}}It("PlacedSymbolArray",P);class M extends co{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}M.prototype.size=64;class k extends jh{get(t){return new M(this,t)}}It("SymbolInstanceArray",k);class L extends ys{getoffsetX(t){return this.float32[1*t+0]}}It("GlyphOffsetArray",L);class D extends vl{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}It("SymbolLineVertexArray",D);class F extends co{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}F.prototype.size=12;class G extends xc{get(t){return new F(this,t)}}It("TextAnchorOffsetArray",G);class H extends co{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}H.prototype.size=8;class ie extends g{get(t){return new H(this,t)}}It("FeatureIndexArray",ie);class re extends lu{}class se extends lu{}class ce extends lu{}class ve extends uu{}class xe extends Ko{}class Se extends yi{}class Ce extends Da{}class Ee extends Fa{}class $e extends Mo{}class qe extends yc{}class nt extends _s{}class at extends vc{}class Qe extends Ws{}class lt extends e{}const Tt=Cr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ft}=Tt;class Et{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,s,l,p){const y=this.segments[this.segments.length-1];return t>Et.MAX_VERTEX_ARRAY_LENGTH&&Ht(`Max vertices per segment is ${Et.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Et.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+t>Et.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p?this.createNewSegment(s,l,p):y}createNewSegment(t,s,l){const p={vertexOffset:t.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(p.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(t,s,l){return this.prepareSegment(0,t,s,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,l,p){return new Et([{vertexOffset:t,primitiveOffset:s,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function an(o,t){return 256*(o=At(Math.floor(o),0,255))+At(Math.floor(t),0,255)}Et.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,It("SegmentVector",Et);const kn=Cr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ar,xn,lr,On={exports:{}},Nn={exports:{}},Wn={exports:{}},Qr=function(){if(lr)return On.exports;lr=1;var o=(ar||(ar=1,Nn.exports=function(s,l){var p,y,v,S,E,I,A,R;for(y=s.length-(p=3&s.length),v=l,E=3432918353,I=461845907,R=0;R<y;)A=255&s.charCodeAt(R)|(255&s.charCodeAt(++R))<<8|(255&s.charCodeAt(++R))<<16|(255&s.charCodeAt(++R))<<24,++R,v=27492+(65535&(S=5*(65535&(v=(v^=A=(65535&(A=(A=(65535&A)*E+(((A>>>16)*E&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(A=0,p){case 3:A^=(255&s.charCodeAt(R+2))<<16;case 2:A^=(255&s.charCodeAt(R+1))<<8;case 1:v^=A=(65535&(A=(A=(65535&(A^=255&s.charCodeAt(R)))*E+(((A>>>16)*E&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295}return v^=s.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),Nn.exports),t=(xn||(xn=1,Wn.exports=function(s,l){for(var p,y=s.length,v=l^y,S=0;y>=4;)p=1540483477*(65535&(p=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:v^=(255&s.charCodeAt(S+2))<<16;case 2:v^=(255&s.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&s.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),Wn.exports);return On.exports=o,On.exports.murmur3=o,On.exports.murmur2=t,On.exports}(),jn=j(Qr);class Qn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,l,p){this.ids.push(oi(t)),this.positions.push(s,l,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=oi(t);let l=0,p=this.ids.length-1;for(;l<p;){const v=l+p>>1;this.ids[v]>=s?p=v:l=v+1}const y=[];for(;this.ids[l]===s;)y.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return y}static serialize(t,s){const l=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Jo(l,p,0,l.length-1),s&&s.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(t){const s=new Qn;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function oi(o){const t=+o;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:jn(String(o))}function Jo(o,t,s,l){for(;s<l;){const p=o[s+l>>1];let y=s-1,v=l+1;for(;;){do y++;while(o[y]<p);do v--;while(o[v]>p);if(y>=v)break;Zi(o,y,v),Zi(t,3*y,3*v),Zi(t,3*y+1,3*v+1),Zi(t,3*y+2,3*v+2)}v-s<l-v?(Jo(o,t,s,v),s=v+1):(Jo(o,t,v+1,l),l=v)}}function Zi(o,t,s){const l=o[t];o[t]=o[s],o[s]=l}It("FeaturePositionMap",Qn);class Ci{constructor(t,s){this.gl=t.gl,this.location=s}}class Io extends Ci{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class xl extends Ci{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ba extends Ci{constructor(t,s){super(t,s),this.current=dn.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Hs=new Float32Array(16);function Pr(o){return[an(255*o.r,255*o.g),an(255*o.b,255*o.a)]}class ho{constructor(t,s,l){this.value=t,this.uniformNames=s.map(p=>`u_${p}`),this.type=l}setUniform(t,s,l){t.set(l.constantOr(this.value))}getBinding(t,s,l){return this.type==="color"?new Ba(t,s):new Io(t,s)}}class Ur{constructor(t,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,l,p){const y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)}getBinding(t,s,l){return l.substr(0,9)==="u_pattern"?new xl(t,s):new Io(t,s)}}class Pi{constructor(t,s,l,p){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,s,l,p,y){const v=this.paintVertexArray.length,S=this.expression.evaluate(new nr(0),s,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(v,t,S)}updatePaintArray(t,s,l,p){const y=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(t,s,y)}_setPaintValue(t,s,l){if(this.type==="color"){const p=Pr(l);for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hn{constructor(t,s,l,p,y,v){this.expression=t,this.uniformNames=s.map(S=>`u_${S}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(S=>({name:`a_${S}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,s,l,p,y){const v=this.expression.evaluate(new nr(this.zoom),s,{},p,[],y),S=this.expression.evaluate(new nr(this.zoom+1),s,{},p,[],y),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,v,S)}updatePaintArray(t,s,l,p){const y=this.expression.evaluate({zoom:this.zoom},l,p),v=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(t,s,y,v)}_setPaintValue(t,s,l,p){if(this.type==="color"){const y=Pr(l),v=Pr(p);for(let S=t;S<s;S++)this.paintVertexArray.emplace(S,y[0],y[1],v[0],v[1])}else{for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=At(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,s,l){return new Io(t,s)}}class er{constructor(t,s,l,p,y,v){this.expression=t,this.type=s,this.useIntegerZoom=l,this.zoom=p,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(t,s,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(t,s,l,p,y){this._setPaintValues(t,s,l.patterns&&l.patterns[this.layerId],y)}_setPaintValues(t,s,l,p){if(!p||!l)return;const{min:y,mid:v,max:S}=l,E=p[y],I=p[v],A=p[S];if(E&&I&&A)for(let R=t;R<s;R++)this.zoomInPaintVertexArray.emplace(R,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,kn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,kn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qi{constructor(t,s,l){this.binders={},this._buffers=[];const p=[];for(const y in t.paint._values){if(!l(y))continue;const v=t.paint.get(y);if(!(v instanceof Yo&&ll(v.property.specification)))continue;const S=yf(y,t.type),E=v.value,I=v.property.specification.type,A=v.property.useIntegerZoom,R=v.property.specification["property-type"],B=R==="cross-faded"||R==="cross-faded-data-driven";if(E.kind==="constant")this.binders[y]=B?new Ur(E.value,S):new ho(E.value,S,I),p.push(`/u_${y}`);else if(E.kind==="source"||B){const N=Uh(y,I,"source");this.binders[y]=B?new er(E,I,A,s,N,t.id):new Pi(E,S,I,N),p.push(`/a_${y}`)}else{const N=Uh(y,I,"composite");this.binders[y]=new Hn(E,S,I,A,s,N),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Pi||s instanceof Hn?s.maxValue:0}populatePaintArrays(t,s,l,p,y){for(const v in this.binders){const S=this.binders[v];(S instanceof Pi||S instanceof Hn||S instanceof er)&&S.populatePaintArray(t,s,l,p,y)}}setConstantPatternPositions(t,s){for(const l in this.binders){const p=this.binders[l];p instanceof Ur&&p.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,l,p,y){let v=!1;for(const S in t){const E=s.getPositions(S);for(const I of E){const A=l.feature(I.index);for(const R in this.binders){const B=this.binders[R];if((B instanceof Pi||B instanceof Hn||B instanceof er)&&B.expression.isStateDependent===!0){const N=p.paint.get(R);B.expression=N.value,B.updatePaintArray(I.start,I.end,A,t[S],y),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const l=this.binders[s];(l instanceof ho||l instanceof Ur)&&t.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Pi||l instanceof Hn)for(let p=0;p<l.paintVertexAttributes.length;p++)t.push(l.paintVertexAttributes[p].name);else if(l instanceof er)for(let p=0;p<kn.members.length;p++)t.push(kn.members[p].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof ho||l instanceof Ur||l instanceof Hn)for(const p of l.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const l=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof ho||y instanceof Ur||y instanceof Hn){for(const v of y.uniformNames)if(s[v]){const S=y.getBinding(t,s[v],v);l.push({name:v,property:p,binding:S})}}}return l}setUniforms(t,s,l,p){for(const{name:y,property:v,binding:S}of s)this.binders[v].setUniform(S,p,l.get(v),y)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(t&&l instanceof er){const p=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof Pi||l instanceof Hn)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const s in this.binders){const l=this.binders[s];(l instanceof Pi||l instanceof Hn||l instanceof er)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Pi||s instanceof Hn||s instanceof er)&&s.destroy()}}}class fr{constructor(t,s,l=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new qi(p,s,l);this.needsUpload=!1,this._featureMap=new Qn,this._bufferOffset=0}populatePaintArrays(t,s,l,p,y,v){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,s,p,y,v);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,l,p){for(const y of l)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,s,y,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function yf(o,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}function Uh(o,t,s){const l={color:{source:yi,composite:c},number:{source:ys,composite:yi}},p=function(y){return{"line-pattern":{source:Ce,composite:Ce},"fill-pattern":{source:Ce,composite:Ce},"fill-extrusion-pattern":{source:Ce,composite:Ce}}[y]}(o);return p&&p[s]||l[t][s]}It("ConstantBinder",ho),It("CrossFadedConstantBinder",Ur),It("SourceExpressionBinder",Pi),It("CrossFadedCompositeBinder",er),It("CompositeExpressionBinder",Hn),It("ProgramConfiguration",qi,{omit:["_buffers"]}),It("ProgramConfigurationSet",fr);const wc=Math.pow(2,14)-1,Qd=-wc-1;function Ys(o){const t=ze/o.extent,s=o.loadGeometry();for(let l=0;l<s.length;l++){const p=s[l];for(let y=0;y<p.length;y++){const v=p[y],S=Math.round(v.x*t),E=Math.round(v.y*t);v.x=At(S,Qd,wc),v.y=At(E,Qd,wc),(S<v.x||S>v.x+1||E<v.y||E>v.y+1)&&Ht("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Xs(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?Ys(o):[]}}const Er=-32768;function ko(o,t,s,l,p){o.emplaceBack(Er+8*t+l,Er+8*s+p)}class bc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new se,this.indexArray=new Qe,this.segments=new Et,this.programConfigurations=new fr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){const p=this.layers[0],y=[];let v=null,S=!1,E=p.type==="heatmap";if(p.type==="circle"){const A=p;v=A.layout.get("circle-sort-key"),S=!v.isConstant(),E=E||A.paint.get("circle-pitch-alignment")==="map"}const I=E?s.subdivisionGranularity.circle:1;for(const{feature:A,id:R,index:B,sourceLayerIndex:N}of t){const U=this.layers[0]._featureFilter.needGeometry,q=Xs(A,U);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),q,l))continue;const Q=S?v.evaluate(q,{},l):void 0,ae={id:R,properties:A.properties,type:A.type,sourceLayerIndex:N,index:B,geometry:U?q.geometry:Ys(A),patterns:{},sortKey:Q};y.push(ae)}S&&y.sort((A,R)=>A.sortKey-R.sortKey);for(const A of y){const{geometry:R,index:B,sourceLayerIndex:N}=A,U=t[B].feature;this.addFeature(A,R,B,l,I),s.featureIndex.insert(U,R,B,N,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ft),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,l,p,y=1){let v;switch(y){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}const S=v.length;for(const E of s)for(const I of E){const A=I.x,R=I.y;if(A<0||A>=ze||R<0||R>=ze)continue;const B=this.segments.prepareSegment(S*S,this.layoutVertexArray,this.indexArray,t.sortKey),N=B.vertexLength;for(let U=0;U<S;U++)for(let q=0;q<S;q++)ko(this.layoutVertexArray,A,R,v[q],v[U]);for(let U=0;U<S-1;U++)for(let q=0;q<S-1;q++){const Q=N+U*S+q,ae=N+(U+1)*S+q;this.indexArray.emplaceBack(Q,ae+1,Q+1),this.indexArray.emplaceBack(Q,ae,ae+1)}B.vertexLength+=S*S,B.primitiveLength+=(S-1)*(S-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},p)}}function Vh(o,t){for(let s=0;s<o.length;s++)if(Cc(t,o[s]))return!0;for(let s=0;s<t.length;s++)if(Cc(o,t[s]))return!0;return!!ep(o,t)}function wl(o,t,s){return!!Cc(o,t)||!!tp(t,o,s)}function Ks(o,t){if(o.length===1)return Tc(t,o[0]);for(let s=0;s<t.length;s++){const l=t[s];for(let p=0;p<l.length;p++)if(Cc(o,l[p]))return!0}for(let s=0;s<o.length;s++)if(Tc(t,o[s]))return!0;for(let s=0;s<t.length;s++)if(ep(o,t[s]))return!0;return!1}function Sc(o,t,s){if(o.length>1){if(ep(o,t))return!0;for(let l=0;l<t.length;l++)if(tp(t[l],o,s))return!0}for(let l=0;l<o.length;l++)if(tp(o[l],t,s))return!0;return!1}function ep(o,t){if(o.length===0||t.length===0)return!1;for(let s=0;s<o.length-1;s++){const l=o[s],p=o[s+1];for(let y=0;y<t.length-1;y++)if(f0(l,p,t[y],t[y+1]))return!0}return!1}function f0(o,t,s,l){return tn(o,s,l)!==tn(t,s,l)&&tn(o,t,s)!==tn(o,t,l)}function tp(o,t,s){const l=s*s;if(t.length===1)return o.distSqr(t[0])<l;for(let p=1;p<t.length;p++)if(hu(o,t[p-1],t[p])<l)return!0;return!1}function hu(o,t,s){const l=t.distSqr(s);if(l===0)return o.distSqr(t);const p=((o.x-t.x)*(s.x-t.x)+(o.y-t.y)*(s.y-t.y))/l;return o.distSqr(p<0?t:p>1?s:s.sub(t)._mult(p)._add(t))}function Tc(o,t){let s,l,p,y=!1;for(let v=0;v<o.length;v++){s=o[v];for(let S=0,E=s.length-1;S<s.length;E=S++)l=s[S],p=s[E],l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(y=!y)}return y}function Cc(o,t){let s=!1;for(let l=0,p=o.length-1;l<o.length;p=l++){const y=o[l],v=o[p];y.y>t.y!=v.y>t.y&&t.x<(v.x-y.x)*(t.y-y.y)/(v.y-y.y)+y.x&&(s=!s)}return s}function fg(o,t,s){const l=s[0],p=s[2];if(o.x<l.x&&t.x<l.x||o.x>p.x&&t.x>p.x||o.y<l.y&&t.y<l.y||o.y>p.y&&t.y>p.y)return!1;const y=tn(o,t,s[0]);return y!==tn(o,t,s[1])||y!==tn(o,t,s[2])||y!==tn(o,t,s[3])}function Pc(o,t,s){const l=t.paint.get(o).value;return l.kind==="constant"?l.value:s.programConfigurations.get(t.id).getMaxValue(o)}function du(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Gh(o,t,s,l,p){if(!t[0]&&!t[1])return o;const y=Be.convert(t)._mult(p);s==="viewport"&&y._rotate(-l);const v=[];for(let S=0;S<o.length;S++)v.push(o[S].sub(y));return v}let $h,np;It("CircleBucket",bc,{omit:["layers"]});var rp={get paint(){return np=np||new Ti({"circle-radius":new Gt(te.paint_circle["circle-radius"]),"circle-color":new Gt(te.paint_circle["circle-color"]),"circle-blur":new Gt(te.paint_circle["circle-blur"]),"circle-opacity":new Gt(te.paint_circle["circle-opacity"]),"circle-translate":new Vt(te.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(te.paint_circle["circle-stroke-opacity"])})},get layout(){return $h=$h||new Ti({"circle-sort-key":new Gt(te.layout_circle["circle-sort-key"])})}};class m0 extends Eo{constructor(t){super(t,rp)}createBucket(t){return new bc(t)}queryRadius(t){const s=t;return Pc("circle-radius",this,s)+Pc("circle-stroke-width",this,s)+du(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:s,featureState:l,geometry:p,transform:y,pixelsToTileUnits:v,pixelPosMatrix:S}){const E=Gh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,v),I=this.paint.get("circle-radius").evaluate(s,l)+this.paint.get("circle-stroke-width").evaluate(s,l),A=this.paint.get("circle-pitch-alignment")==="map",R=A?E:function(N,U){return N.map(q=>vf(q,U))}(E,S),B=A?I*v:I;for(const N of p)for(const U of N){const q=A?U:vf(U,S);let Q=B;const ae=Fe([],[U.x,U.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Q*=ae[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Q*=y.cameraToCenterDistance/ae[3]),wl(R,q,Q))return!0}return!1}}function vf(o,t){const s=Fe([],[o.x,o.y,0,1],t);return new Be(s[0]/s[3],s[1]/s[3])}class Zh extends bc{}let xf;It("HeatmapBucket",Zh,{omit:["layers"]});var wf={get paint(){return xf=xf||new Ti({"heatmap-radius":new Gt(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _i(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(te.paint_heatmap["heatmap-opacity"])})}};function bf(o,{width:t,height:s},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*s*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*s*l}`)}else p=new Uint8Array(t*s*l);return o.width=t,o.height=s,o.data=p,o}function Sf(o,{width:t,height:s},l){if(t===o.width&&s===o.height)return;const p=bf({},{width:t,height:s},l);vs(o,p,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,t),height:Math.min(o.height,s)},l),o.width=t,o.height=s,o.data=p.data}function vs(o,t,s,l,p,y){if(p.width===0||p.height===0)return t;if(p.width>o.width||p.height>o.height||s.x>o.width-p.width||s.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=o.data,S=t.data;if(v===S)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<p.height;E++){const I=((s.y+E)*o.width+s.x)*y,A=((l.y+E)*t.width+l.x)*y;for(let R=0;R<p.width*y;R++)S[A+R]=v[I+R]}return t}class Ec{constructor(t,s){bf(this,t,1,s)}resize(t){Sf(this,t,1)}clone(){return new Ec({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,p,y){vs(t,s,l,p,y,1)}}class po{constructor(t,s){bf(this,t,4,s)}resize(t){Sf(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,p,y){vs(t,s,l,p,y,4)}}function mg(o){const t={},s=o.resolution||256,l=o.clips?o.clips.length:1,p=o.image||new po({width:s,height:l});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(v,S,E)=>{t[o.evaluationKey]=E;const I=o.expression.evaluate(t);p.data[v+S+0]=Math.floor(255*I.r/I.a),p.data[v+S+1]=Math.floor(255*I.g/I.a),p.data[v+S+2]=Math.floor(255*I.b/I.a),p.data[v+S+3]=Math.floor(255*I.a)};if(o.clips)for(let v=0,S=0;v<l;++v,S+=4*s)for(let E=0,I=0;E<s;E++,I+=4){const A=E/(s-1),{start:R,end:B}=o.clips[v];y(S,I,R*(1-A)+B*A)}else for(let v=0,S=0;v<s;v++,S+=4)y(0,S,v/(s-1));return p}It("AlphaImage",Ec),It("RGBAImage",po);const ip="big-fb";class g0 extends Eo{createBucket(t){return new Zh(t)}constructor(t){super(t,wf),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ip)&&this.heatmapFbos.delete(ip)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let gg;var Oa={get paint(){return gg=gg||new Ti({"hillshade-illumination-direction":new Vt(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(te.paint_hillshade["hillshade-accent-color"])})}};class Tf extends Eo{constructor(t){super(t,Oa)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Cf=Cr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pf}=Cf;function Mc(o,t,s){const l=s.patternDependencies;let p=!1;for(const y of t){const v=y.paint.get(`${o}-pattern`);v.isConstant()||(p=!0);const S=v.constantOr(null);S&&(p=!0,l[S.to]=!0,l[S.from]=!0)}return p}function bl(o,t,s,l,p){const y=p.patternDependencies;for(const v of t){const S=v.paint.get(`${o}-pattern`).value;if(S.kind!=="constant"){let E=S.evaluate({zoom:l-1},s,{},p.availableImages),I=S.evaluate({zoom:l},s,{},p.availableImages),A=S.evaluate({zoom:l+1},s,{},p.availableImages);E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,A=A&&A.name?A.name:A,y[E]=!0,y[I]=!0,y[A]=!0,s.patterns[v.id]={min:E,mid:I,max:A}}}return s}function nn(o,t,s,l,p){let y;if(p===function(v,S,E,I){let A=0;for(let R=S,B=E-I;R<E;R+=I)A+=(v[B]-v[R])*(v[R+1]+v[B+1]),B=R;return A}(o,t,s,l)>0)for(let v=t;v<s;v+=l)y=vg(v/l|0,o[v],o[v+1],y);else for(let v=s-l;v>=t;v-=l)y=vg(v/l|0,o[v],o[v+1],y);return y&&fo(y,y.next)&&(Na(y),y=y.next),y}function Js(o,t){if(!o)return o;t||(t=o);let s,l=o;do if(s=!1,l.steiner||!fo(l,l.next)&&Mr(l.prev,l,l.next)!==0)l=l.next;else{if(Na(l),l=t=l.prev,l===l.next)break;s=!0}while(s||l!==t);return t}function pu(o,t,s,l,p,y,v){if(!o)return;!v&&y&&function(E,I,A,R){let B=E;do B.z===0&&(B.z=op(B.x,B.y,I,A,R)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==E);B.prevZ.nextZ=null,B.prevZ=null,function(N){let U,q=1;do{let Q,ae=N;N=null;let Me=null;for(U=0;ae;){U++;let de=ae,O=0;for(let _e=0;_e<q&&(O++,de=de.nextZ,de);_e++);let J=q;for(;O>0||J>0&&de;)O!==0&&(J===0||!de||ae.z<=de.z)?(Q=ae,ae=ae.nextZ,O--):(Q=de,de=de.nextZ,J--),Me?Me.nextZ=Q:N=Q,Q.prevZ=Me,Me=Q;ae=de}Me.nextZ=null,q*=2}while(U>1)}(B)}(o,l,p,y);let S=o;for(;o.prev!==o.next;){const E=o.prev,I=o.next;if(y?_0(o,l,p,y):fu(o))t.push(E.i,o.i,I.i),Na(o),o=I.next,S=I.next;else if((o=I)===S){v?v===1?pu(o=Ef(Js(o),t),t,s,l,p,y,2):v===2&&_g(o,t,s,l,p,y):pu(Js(o),t,s,l,p,y,1);break}}}function fu(o){const t=o.prev,s=o,l=o.next;if(Mr(t,s,l)>=0)return!1;const p=t.x,y=s.x,v=l.x,S=t.y,E=s.y,I=l.y,A=Math.min(p,y,v),R=Math.min(S,E,I),B=Math.max(p,y,v),N=Math.max(S,E,I);let U=l.next;for(;U!==t;){if(U.x>=A&&U.x<=B&&U.y>=R&&U.y<=N&&qh(p,S,y,E,v,I,U.x,U.y)&&Mr(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function _0(o,t,s,l){const p=o.prev,y=o,v=o.next;if(Mr(p,y,v)>=0)return!1;const S=p.x,E=y.x,I=v.x,A=p.y,R=y.y,B=v.y,N=Math.min(S,E,I),U=Math.min(A,R,B),q=Math.max(S,E,I),Q=Math.max(A,R,B),ae=op(N,U,t,s,l),Me=op(q,Q,t,s,l);let de=o.prevZ,O=o.nextZ;for(;de&&de.z>=ae&&O&&O.z<=Me;){if(de.x>=N&&de.x<=q&&de.y>=U&&de.y<=Q&&de!==p&&de!==v&&qh(S,A,E,R,I,B,de.x,de.y)&&Mr(de.prev,de,de.next)>=0||(de=de.prevZ,O.x>=N&&O.x<=q&&O.y>=U&&O.y<=Q&&O!==p&&O!==v&&qh(S,A,E,R,I,B,O.x,O.y)&&Mr(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;de&&de.z>=ae;){if(de.x>=N&&de.x<=q&&de.y>=U&&de.y<=Q&&de!==p&&de!==v&&qh(S,A,E,R,I,B,de.x,de.y)&&Mr(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;O&&O.z<=Me;){if(O.x>=N&&O.x<=q&&O.y>=U&&O.y<=Q&&O!==p&&O!==v&&qh(S,A,E,R,I,B,O.x,O.y)&&Mr(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function Ef(o,t){let s=o;do{const l=s.prev,p=s.next.next;!fo(l,p)&&Mi(l,s,s.next,p)&&mu(l,p)&&mu(p,l)&&(t.push(l.i,s.i,p.i),Na(s),Na(s.next),s=o=p),s=s.next}while(s!==o);return Js(s)}function _g(o,t,s,l,p,y){let v=o;do{let S=v.next.next;for(;S!==v.prev;){if(v.i!==S.i&&w0(v,S)){let E=yg(v,S);return v=Js(v,v.next),E=Js(E,E.next),pu(v,t,s,l,p,y,0),void pu(E,t,s,l,p,y,0)}S=S.next}v=v.next}while(v!==o)}function Ei(o,t){let s=o.x-t.x;return s===0&&(s=o.y-t.y,s===0)&&(s=(o.next.y-o.y)/(o.next.x-o.x)-(t.next.y-t.y)/(t.next.x-t.x)),s}function y0(o,t){const s=function(p,y){let v=y;const S=p.x,E=p.y;let I,A=-1/0;if(fo(p,v))return v;do{if(fo(p,v.next))return v.next;if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){const q=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(q<=S&&q>A&&(A=q,I=v.x<v.next.x?v:v.next,q===S))return I}v=v.next}while(v!==y);if(!I)return null;const R=I,B=I.x,N=I.y;let U=1/0;v=I;do{if(S>=v.x&&v.x>=B&&S!==v.x&&Mf(E<N?S:A,E,B,N,E<N?A:S,E,v.x,v.y)){const q=Math.abs(E-v.y)/(S-v.x);mu(v,p)&&(q<U||q===U&&(v.x>I.x||v.x===I.x&&v0(I,v)))&&(I=v,U=q)}v=v.next}while(v!==R);return I}(o,t);if(!s)return t;const l=yg(s,o);return Js(l,l.next),Js(s,s.next)}function v0(o,t){return Mr(o.prev,o,t.prev)<0&&Mr(t.next,o,o.next)<0}function op(o,t,s,l,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function x0(o){let t=o,s=o;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==o);return s}function Mf(o,t,s,l,p,y,v,S){return(p-v)*(t-S)>=(o-v)*(y-S)&&(o-v)*(l-S)>=(s-v)*(t-S)&&(s-v)*(y-S)>=(p-v)*(l-S)}function qh(o,t,s,l,p,y,v,S){return!(o===v&&t===S)&&Mf(o,t,s,l,p,y,v,S)}function w0(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!function(s,l){let p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==l.i&&p.next.i!==l.i&&Mi(p,p.next,s,l))return!0;p=p.next}while(p!==s);return!1}(o,t)&&(mu(o,t)&&mu(t,o)&&function(s,l){let p=s,y=!1;const v=(s.x+l.x)/2,S=(s.y+l.y)/2;do p.y>S!=p.next.y>S&&p.next.y!==p.y&&v<(p.next.x-p.x)*(S-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==s);return y}(o,t)&&(Mr(o.prev,o,t.prev)||Mr(o,t.prev,t))||fo(o,t)&&Mr(o.prev,o,o.next)>0&&Mr(t.prev,t,t.next)>0)}function Mr(o,t,s){return(t.y-o.y)*(s.x-t.x)-(t.x-o.x)*(s.y-t.y)}function fo(o,t){return o.x===t.x&&o.y===t.y}function Mi(o,t,s,l){const p=sp(Mr(o,t,s)),y=sp(Mr(o,t,l)),v=sp(Mr(s,l,o)),S=sp(Mr(s,l,t));return p!==y&&v!==S||!(p!==0||!Ic(o,s,t))||!(y!==0||!Ic(o,l,t))||!(v!==0||!Ic(s,o,l))||!(S!==0||!Ic(s,t,l))}function Ic(o,t,s){return t.x<=Math.max(o.x,s.x)&&t.x>=Math.min(o.x,s.x)&&t.y<=Math.max(o.y,s.y)&&t.y>=Math.min(o.y,s.y)}function sp(o){return o>0?1:o<0?-1:0}function mu(o,t){return Mr(o.prev,o,o.next)<0?Mr(o,t,o.next)>=0&&Mr(o,o.prev,t)>=0:Mr(o,t,o.prev)<0||Mr(o,o.next,t)<0}function yg(o,t){const s=ap(o.i,o.x,o.y),l=ap(t.i,t.x,t.y),p=o.next,y=t.prev;return o.next=t,t.prev=o,s.next=p,p.prev=s,l.next=s,s.prev=l,y.next=l,l.prev=y,l}function vg(o,t,s,l){const p=ap(o,t,s);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function Na(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function ap(o,t,s){return{i:o,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class gu{constructor(t,s){if(s>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=s}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class lp{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}lp.noSubdivision=new lp({fill:new gu(0,0),line:new gu(0,0),tile:new gu(0,0),stencil:new gu(0,0),circle:1}),It("SubdivisionGranularityExpression",gu),It("SubdivisionGranularitySetting",lp);const kc=-32768,Wh=32767;class b0{constructor(t,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ze/t,this._canonical=s}_getKey(t,s){return(t+=32768)<<16|(s+=32768)<<0}_vertexToIndex(t,s){if(t<-32768||s<-32768||t>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(t),p=0|Math.round(s),y=this._getKey(l,p);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,v),this._vertexBuffer.push(l,p),v}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(p,y){const v=[];for(let S=0;S<y.length;S+=3){const E=y[S],I=y[S+1],A=y[S+2],R=p[2*E],B=p[2*E+1];(p[2*I]-R)*(p[2*A+1]-B)-(p[2*I+1]-B)*(p[2*A]-R)>0?(v.push(E),v.push(A),v.push(I)):(v.push(E),v.push(I),v.push(A))}return v}(this._vertexBuffer,t);const s=[],l=t.length;for(let p=0;p<l;p+=3){const y=[t[p+0],t[p+1],t[p+2]],v=[this._vertexBuffer[2*t[p+0]+0],this._vertexBuffer[2*t[p+0]+1],this._vertexBuffer[2*t[p+1]+0],this._vertexBuffer[2*t[p+1]+1],this._vertexBuffer[2*t[p+2]+0],this._vertexBuffer[2*t[p+2]+1]];let S=1/0,E=1/0,I=-1/0,A=-1/0;for(let q=0;q<3;q++){const Q=v[2*q],ae=v[2*q+1];S=Math.min(S,Q),I=Math.max(I,Q),E=Math.min(E,ae),A=Math.max(A,ae)}if(S===I||E===A)continue;const R=Math.floor(S/this._granularityCellSize),B=Math.ceil(I/this._granularityCellSize),N=Math.floor(E/this._granularityCellSize),U=Math.ceil(A/this._granularityCellSize);if(R!==B||N!==U)for(let q=N;q<U;q++){const Q=this._scanlineGenerateVertexRingForCellRow(q,v,y);S0(this._vertexBuffer,Q,s)}else s.push(...y)}return s}_scanlineGenerateVertexRingForCellRow(t,s,l){const p=t*this._granularityCellSize,y=p+this._granularityCellSize,v=[];for(let S=0;S<3;S++){const E=s[2*S],I=s[2*S+1],A=s[2*(S+1)%6],R=s[(2*(S+1)+1)%6],B=s[2*(S+2)%6],N=s[(2*(S+2)+1)%6],U=A-E,q=R-I,Q=U===0,ae=q===0,Me=(p-I)/q,de=(y-I)/q,O=Math.min(Me,de),J=Math.max(Me,de);if(!ae&&(O>=1||J<=0)||ae&&(I<p||I>y)){R>=p&&R<=y&&v.push(l[(S+1)%3]);continue}!ae&&O>0&&v.push(this._vertexToIndex(E+U*O,I+q*O));const _e=E+U*Math.max(O,0),Ze=E+U*Math.min(J,1);Q||this._generateIntraEdgeVertices(v,E,I,A,R,_e,Ze),!ae&&J<1&&v.push(this._vertexToIndex(E+U*J,I+q*J)),(ae||R>=p&&R<=y)&&v.push(l[(S+1)%3]),!ae&&(R<=p||R>=y)&&this._generateInterEdgeVertices(v,E,I,A,R,B,N,Ze,p,y)}return v}_generateIntraEdgeVertices(t,s,l,p,y,v,S){const E=p-s,I=y-l,A=I===0,R=A?Math.min(s,p):Math.min(v,S),B=A?Math.max(s,p):Math.max(v,S),N=Math.floor(R/this._granularityCellSize)+1,U=Math.ceil(B/this._granularityCellSize)-1;if(A?s<p:v<S)for(let q=N;q<=U;q++){const Q=q*this._granularityCellSize;t.push(this._vertexToIndex(Q,l+I*(Q-s)/E))}else for(let q=U;q>=N;q--){const Q=q*this._granularityCellSize;t.push(this._vertexToIndex(Q,l+I*(Q-s)/E))}}_generateInterEdgeVertices(t,s,l,p,y,v,S,E,I,A){const R=y-l,B=v-p,N=S-y,U=(I-y)/N,q=(A-y)/N,Q=Math.min(U,q),ae=Math.max(U,q),Me=p+B*Q;let de=Math.floor(Math.min(Me,E)/this._granularityCellSize)+1,O=Math.ceil(Math.max(Me,E)/this._granularityCellSize)-1,J=E<Me;const _e=N===0;if(_e&&(S===I||S===A))return;if(_e||Q>=1||ae<=0){const dt=l-S,Je=v+(s-v)*Math.min((I-S)/dt,(A-S)/dt);de=Math.floor(Math.min(Je,E)/this._granularityCellSize)+1,O=Math.ceil(Math.max(Je,E)/this._granularityCellSize)-1,J=E<Je}const Ze=R>0?A:I;if(J)for(let dt=de;dt<=O;dt++)t.push(this._vertexToIndex(dt*this._granularityCellSize,Ze));else for(let dt=O;dt>=de;dt--)t.push(this._vertexToIndex(dt*this._granularityCellSize,Ze))}_generateOutline(t){const s=[];for(const l of t){const p=Sl(l,this._granularity,!0),y=this._pointArrayToIndices(p),v=[];for(let S=1;S<y.length;S++)v.push(y[S-1]),v.push(y[S]);s.push(v)}return s}_handlePoles(t){let s=!1,l=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(s||l)&&this._fillPoles(t,s,l)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let s=0;s<t.length;s+=2){const l=t[s+1];l===kc&&(t[s+1]=-32767),l===Wh&&(t[s+1]=32766)}}_generatePoleQuad(t,s,l,p,y,v){p>y!=(v===kc)?(t.push(s),t.push(l),t.push(this._vertexToIndex(p,v)),t.push(l),t.push(this._vertexToIndex(y,v)),t.push(this._vertexToIndex(p,v))):(t.push(l),t.push(s),t.push(this._vertexToIndex(p,v)),t.push(this._vertexToIndex(y,v)),t.push(l),t.push(this._vertexToIndex(p,v)))}_fillPoles(t,s,l){const p=this._vertexBuffer,y=ze,v=t.length;for(let S=2;S<v;S+=3){const E=t[S-2],I=t[S-1],A=t[S],R=p[2*E],B=p[2*E+1],N=p[2*I],U=p[2*I+1],q=p[2*A],Q=p[2*A+1];s&&(B===0&&U===0&&this._generatePoleQuad(t,E,I,R,N,kc),U===0&&Q===0&&this._generatePoleQuad(t,I,A,N,q,kc),Q===0&&B===0&&this._generatePoleQuad(t,A,E,q,R,kc)),l&&(B===y&&U===y&&this._generatePoleQuad(t,E,I,R,N,Wh),U===y&&Q===y&&this._generatePoleQuad(t,I,A,N,q,Wh),Q===y&&B===y&&this._generatePoleQuad(t,A,E,q,R,Wh))}}_initializeVertices(t){for(let s=0;s<t.length;s+=2)this._vertexToIndex(t[s],t[s+1])}subdividePolygonInternal(t,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:p}=function(S){const E=[],I=[];for(const A of S)if(A.length!==0){A!==S[0]&&E.push(I.length/2);for(let R=0;R<A.length;R++)I.push(A[R].x),I.push(A[R].y)}return{flattened:I,holeIndices:E}}(t);let y;this._initializeVertices(l);try{const S=function(I,A,R=2){const B=A&&A.length,N=B?A[0]*R:I.length;let U=nn(I,0,N,R,!0);const q=[];if(!U||U.next===U.prev)return q;let Q,ae,Me;if(B&&(U=function(de,O,J,_e){const Ze=[];for(let dt=0,Je=O.length;dt<Je;dt++){const Xe=nn(de,O[dt]*_e,dt<Je-1?O[dt+1]*_e:de.length,_e,!1);Xe===Xe.next&&(Xe.steiner=!0),Ze.push(x0(Xe))}Ze.sort(Ei);for(let dt=0;dt<Ze.length;dt++)J=y0(Ze[dt],J);return J}(I,A,U,R)),I.length>80*R){Q=1/0,ae=1/0;let de=-1/0,O=-1/0;for(let J=R;J<N;J+=R){const _e=I[J],Ze=I[J+1];_e<Q&&(Q=_e),Ze<ae&&(ae=Ze),_e>de&&(de=_e),Ze>O&&(O=Ze)}Me=Math.max(de-Q,O-ae),Me=Me!==0?32767/Me:0}return pu(U,q,R,Q,ae,Me,0),q}(l,p),E=this._convertIndices(l,S);y=this._subdivideTrianglesScanline(E)}catch(S){console.error(S)}let v=[];return s&&(v=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:v}}_convertIndices(t,s){const l=[];for(let p=0;p<s.length;p++)l.push(this._vertexToIndex(t[2*s[p]],t[2*s[p]+1]));return l}_pointArrayToIndices(t){const s=[];for(let l=0;l<t.length;l++){const p=t[l];s.push(this._vertexToIndex(p.x,p.y))}return s}}function If(o,t,s,l=!0){return new b0(s,t).subdividePolygonInternal(o,l)}function Sl(o,t,s=!1){if(!o||o.length<1)return[];if(o.length<2)return[];const l=o[0],p=o[o.length-1],y=s&&(l.x!==p.x||l.y!==p.y);if(t<2)return y?[...o,o[0]]:[...o];const v=Math.floor(ze/t),S=[];S.push(new Be(o[0].x,o[0].y));const E=o.length,I=y?E:E-1;for(let A=0;A<I;A++){const R=o[A],B=A<E-1?o[A+1]:o[0],N=R.x,U=R.y,q=B.x,Q=B.y,ae=N!==q,Me=U!==Q;if(!ae&&!Me)continue;const de=q-N,O=Q-U,J=Math.abs(de),_e=Math.abs(O);let Ze=N,dt=U;for(;;){const Xe=de>0?(Math.floor(Ze/v)+1)*v:(Math.ceil(Ze/v)-1)*v,pt=O>0?(Math.floor(dt/v)+1)*v:(Math.ceil(dt/v)-1)*v,mt=Math.abs(Ze-Xe),wt=Math.abs(dt-pt),it=Math.abs(Ze-q),Bt=Math.abs(dt-Q),qt=ae?mt/J:Number.POSITIVE_INFINITY,Zt=Me?wt/_e:Number.POSITIVE_INFINITY;if((it<=mt||!ae)&&(Bt<=wt||!Me))break;if(qt<Zt&&ae||!Me){Ze=Xe,dt+=O*qt;const jt=new Be(Ze,Math.round(dt));S[S.length-1].x===jt.x&&S[S.length-1].y===jt.y||S.push(jt)}else{Ze+=de*Zt,dt=pt;const jt=new Be(Math.round(Ze),dt);S[S.length-1].x===jt.x&&S[S.length-1].y===jt.y||S.push(jt)}}const Je=new Be(q,Q);S[S.length-1].x===Je.x&&S[S.length-1].y===Je.y||S.push(Je)}return S}function S0(o,t,s){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,p=o[2*t[0]];for(let E=1;E<t.length;E++){const I=o[2*t[E]];I<p&&(p=I,l=E)}const y=t.length;let v=l,S=(v+1)%y;for(;;){const E=v-1>=0?v-1:y-1,I=(S+1)%y,A=o[2*t[E]],R=o[2*t[I]],B=o[2*t[v]],N=o[2*t[v]+1],U=o[2*t[S]+1];let q=!1;if(A<R)q=!0;else if(A>R)q=!1;else{const Q=U-N,ae=-(o[2*t[S]]-B),Me=N<U?1:-1;((A-B)*Q+(o[2*t[E]+1]-N)*ae)*Me>((R-B)*Q+(o[2*t[I]+1]-N)*ae)*Me&&(q=!0)}if(q){const Q=t[E],ae=t[v],Me=t[S];Q!==ae&&Q!==Me&&ae!==Me&&s.push(Me,ae,Q),v--,v<0&&(v=y-1)}else{const Q=t[I],ae=t[v],Me=t[S];Q!==ae&&Q!==Me&&ae!==Me&&s.push(Me,ae,Q),S++,S>=y&&(S=0)}if(E===I)break}}function up(o,t,s,l,p,y,v,S,E){const I=p.length/2,A=v&&S&&E;if(I<Et.MAX_VERTEX_ARRAY_LENGTH){const R=t.prepareSegment(I,s,l),B=R.vertexLength;for(let q=0;q<y.length;q+=3)l.emplaceBack(B+y[q],B+y[q+1],B+y[q+2]);let N,U;R.vertexLength+=I,R.primitiveLength+=y.length/3,A&&(U=v.prepareSegment(I,s,S),N=U.vertexLength,U.vertexLength+=I);for(let q=0;q<p.length;q+=2)o(p[q],p[q+1]);if(A)for(let q=0;q<E.length;q++){const Q=E[q];for(let ae=1;ae<Q.length;ae+=2)S.emplaceBack(N+Q[ae-1],N+Q[ae]);U.primitiveLength+=Q.length/2}}else(function(R,B,N,U,q,Q){const ae=[];for(let _e=0;_e<U.length/2;_e++)ae.push(-1);const Me={count:0};let de=0,O=R.getOrCreateLatestSegment(B,N),J=O.vertexLength;for(let _e=2;_e<q.length;_e+=3){const Ze=q[_e-2],dt=q[_e-1],Je=q[_e];let Xe=ae[Ze]<de,pt=ae[dt]<de,mt=ae[Je]<de;O.vertexLength+((Xe?1:0)+(pt?1:0)+(mt?1:0))>Et.MAX_VERTEX_ARRAY_LENGTH&&(O=R.createNewSegment(B,N),de=Me.count,Xe=!0,pt=!0,mt=!0,J=0);const wt=Ac(ae,U,Q,Me,Ze,Xe,O),it=Ac(ae,U,Q,Me,dt,pt,O),Bt=Ac(ae,U,Q,Me,Je,mt,O);N.emplaceBack(J+wt-de,J+it-de,J+Bt-de),O.primitiveLength++}})(t,s,l,p,y,o),A&&function(R,B,N,U,q,Q){const ae=[];for(let _e=0;_e<U.length/2;_e++)ae.push(-1);const Me={count:0};let de=0,O=R.getOrCreateLatestSegment(B,N),J=O.vertexLength;for(let _e=0;_e<q.length;_e++){const Ze=q[_e];for(let dt=1;dt<q[_e].length;dt+=2){const Je=Ze[dt-1],Xe=Ze[dt];let pt=ae[Je]<de,mt=ae[Xe]<de;O.vertexLength+((pt?1:0)+(mt?1:0))>Et.MAX_VERTEX_ARRAY_LENGTH&&(O=R.createNewSegment(B,N),de=Me.count,pt=!0,mt=!0,J=0);const wt=Ac(ae,U,Q,Me,Je,pt,O),it=Ac(ae,U,Q,Me,Xe,mt,O);N.emplaceBack(J+wt-de,J+it-de),O.primitiveLength++}}}(v,s,S,p,E,o),t.forceNewSegmentOnNextPrepare(),v==null||v.forceNewSegmentOnNextPrepare()}function Ac(o,t,s,l,p,y,v){if(y){const S=l.count;return s(t[2*p],t[2*p+1]),o[p]=l.count,l.count++,v.vertexLength++,S}return o[p]}class _u{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ce,this.indexArray=new Qe,this.indexArray2=new lt,this.programConfigurations=new fr(t.layers,t.zoom),this.segments=new Et,this.segments2=new Et,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Mc("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),v=[];for(const{feature:S,id:E,index:I,sourceLayerIndex:A}of t){const R=this.layers[0]._featureFilter.needGeometry,B=Xs(S,R);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),B,l))continue;const N=y?p.evaluate(B,{},l,s.availableImages):void 0,U={id:E,properties:S.properties,type:S.type,sourceLayerIndex:A,index:I,geometry:R?B.geometry:Ys(S),patterns:{},sortKey:N};v.push(U)}y&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:I,sourceLayerIndex:A}=S;if(this.hasPattern){const R=bl("fill",this.layers,S,this.zoom,s);this.patternFeatures.push(R)}else this.addFeature(S,E,I,l,{},s.subdivisionGranularity);s.featureIndex.insert(t[I].feature,E,I,A,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Pf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,l,p,y,v){for(const S of fi(s,500)){const E=If(S,p,v.fill.getGranularityForZoomLevel(p.z)),I=this.layoutVertexArray;up((A,R)=>{I.emplaceBack(A,R)},this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}}let cp,kf;It("FillBucket",_u,{omit:["layers","patternFeatures"]});var xg={get paint(){return kf=kf||new Ti({"fill-antialias":new Vt(te.paint_fill["fill-antialias"]),"fill-opacity":new Gt(te.paint_fill["fill-opacity"]),"fill-color":new Gt(te.paint_fill["fill-color"]),"fill-outline-color":new Gt(te.paint_fill["fill-outline-color"]),"fill-translate":new Vt(te.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new La(te.paint_fill["fill-pattern"])})},get layout(){return cp=cp||new Ti({"fill-sort-key":new Gt(te.layout_fill["fill-sort-key"])})}};class hp extends Eo{constructor(t){super(t,xg)}recalculate(t,s){super.recalculate(t,s);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new _u(t)}queryRadius(){return du(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:s,transform:l,pixelsToTileUnits:p}){return Ks(Gh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,p),s)}isTileClipped(){return!0}}const wg=Cr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Qs=Cr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:yu}=wg;var Af,zf,Rf,bg,Lf,Sg,Tg,dp={};function Cg(){if(zf)return Af;zf=1;var o=ge();function t(p,y,v,S,E){this.properties={},this.extent=v,this.type=0,this._pbf=p,this._geometry=-1,this._keys=S,this._values=E,p.readFields(s,this,y)}function s(p,y,v){p==1?y.id=v.readVarint():p==2?function(S,E){for(var I=S.readVarint()+S.pos;S.pos<I;){var A=E._keys[S.readVarint()],R=E._values[S.readVarint()];E.properties[A]=R}}(v,y):p==3?y.type=v.readVarint():p==4&&(y._geometry=v.pos)}function l(p){for(var y,v,S=0,E=0,I=p.length,A=I-1;E<I;A=E++)S+=((v=p[A]).x-(y=p[E]).x)*(y.y+v.y);return S}return Af=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var y,v=p.readVarint()+p.pos,S=1,E=0,I=0,A=0,R=[];p.pos<v;){if(E<=0){var B=p.readVarint();S=7&B,E=B>>3}if(E--,S===1||S===2)I+=p.readSVarint(),A+=p.readSVarint(),S===1&&(y&&R.push(y),y=[]),y.push(new o(I,A));else{if(S!==7)throw new Error("unknown command "+S);y&&y.push(y[0].clone())}}return y&&R.push(y),R},t.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var y=p.readVarint()+p.pos,v=1,S=0,E=0,I=0,A=1/0,R=-1/0,B=1/0,N=-1/0;p.pos<y;){if(S<=0){var U=p.readVarint();v=7&U,S=U>>3}if(S--,v===1||v===2)(E+=p.readSVarint())<A&&(A=E),E>R&&(R=E),(I+=p.readSVarint())<B&&(B=I),I>N&&(N=I);else if(v!==7)throw new Error("unknown command "+v)}return[A,B,R,N]},t.prototype.toGeoJSON=function(p,y,v){var S,E,I=this.extent*Math.pow(2,v),A=this.extent*p,R=this.extent*y,B=this.loadGeometry(),N=t.types[this.type];function U(ae){for(var Me=0;Me<ae.length;Me++){var de=ae[Me];ae[Me]=[360*(de.x+A)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+R)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(S=0;S<B.length;S++)q[S]=B[S][0];U(B=q);break;case 2:for(S=0;S<B.length;S++)U(B[S]);break;case 3:for(B=function(ae){var Me=ae.length;if(Me<=1)return[ae];for(var de,O,J=[],_e=0;_e<Me;_e++){var Ze=l(ae[_e]);Ze!==0&&(O===void 0&&(O=Ze<0),O===Ze<0?(de&&J.push(de),de=[ae[_e]]):de.push(ae[_e]))}return de&&J.push(de),J}(B),S=0;S<B.length;S++)for(E=0;E<B[S].length;E++)U(B[S][E])}B.length===1?B=B[0]:N="Multi"+N;var Q={type:"Feature",geometry:{type:N,coordinates:B},properties:this.properties};return"id"in this&&(Q.id=this.id),Q},Af}function Pg(){if(bg)return Rf;bg=1;var o=Cg();function t(l,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(s,this,p),this.length=this._features.length}function s(l,p,y){l===15?p.version=y.readVarint():l===1?p.name=y.readString():l===5?p.extent=y.readVarint():l===2?p._features.push(y.pos):l===3?p._keys.push(y.readString()):l===4&&p._values.push(function(v){for(var S=null,E=v.readVarint()+v.pos;v.pos<E;){var I=v.readVarint()>>3;S=I===1?v.readString():I===2?v.readFloat():I===3?v.readDouble():I===4?v.readVarint64():I===5?v.readVarint():I===6?v.readSVarint():I===7?v.readBoolean():null}return S}(y))}return Rf=t,t.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var p=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,p,this.extent,this._keys,this._values)},Rf}function Eg(){return Tg||(Tg=1,dp.VectorTile=function(){if(Sg)return Lf;Sg=1;var o=Pg();function t(s,l,p){if(s===3){var y=new o(p,p.readVarint()+p.pos);y.length&&(l[y.name]=y)}}return Lf=function(s,l){this.layers=s.readFields(t,{},l)},Lf}(),dp.VectorTileFeature=Cg(),dp.VectorTileLayer=Pg()),dp}var Hh=j(Eg());const T0=Hh.VectorTileFeature.types,pp=Math.pow(2,13);function zc(o,t,s,l,p,y,v,S){o.emplaceBack(t,s,2*Math.floor(l*pp)+v,p*pp*2,y*pp*2,Math.round(S))}class fp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ve,this.centroidVertexArray=new re,this.indexArray=new Qe,this.programConfigurations=new fr(t.layers,t.zoom),this.segments=new Et,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.features=[],this.hasPattern=Mc("fill-extrusion",this.layers,s);for(const{feature:p,id:y,index:v,sourceLayerIndex:S}of t){const E=this.layers[0]._featureFilter.needGeometry,I=Xs(p,E);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),I,l))continue;const A={id:y,sourceLayerIndex:S,index:v,geometry:E?I.geometry:Ys(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(bl("fill-extrusion",this.layers,A,this.zoom,s)):this.addFeature(A,A.geometry,v,l,{},s.subdivisionGranularity),s.featureIndex.insert(p,A.geometry,v,S,this.index,!0)}}addFeatures(t,s,l){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,s,l,t.subdivisionGranularity)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yu),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Qs.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,l,p,y,v){for(const S of fi(s,500)){const E={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(E,p,t,S,v);const A=this.layoutVertexArray.length-I,R=Math.floor(E.x/E.sampleCount),B=Math.floor(E.y/E.sampleCount);for(let N=0;N<A;N++)this.centroidVertexArray.emplaceBack(R,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}processPolygon(t,s,l,p,y){if(p.length<1||Mg(p[0]))return;for(const R of p)R.length!==0&&C0(t,R);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},S=y.fill.getGranularityForZoomLevel(s.z),E=T0[l.type]==="Polygon";for(const R of p){if(R.length===0||Mg(R))continue;const B=Sl(R,S,E);this._generateSideFaces(B,v)}if(!E)return;const I=If(p,s,S,!1),A=this.layoutVertexArray;up((R,B)=>{zc(A,R,B,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(t,s){let l=0;for(let p=1;p<t.length;p++){const y=t[p],v=t[p-1];if(P0(y,v))continue;s.segment.vertexLength+4>Et.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const S=y.sub(v)._perp()._unit(),E=v.dist(y);l+E>32768&&(l=0),zc(this.layoutVertexArray,y.x,y.y,S.x,S.y,0,0,l),zc(this.layoutVertexArray,y.x,y.y,S.x,S.y,0,1,l),l+=E,zc(this.layoutVertexArray,v.x,v.y,S.x,S.y,0,0,l),zc(this.layoutVertexArray,v.x,v.y,S.x,S.y,0,1,l);const I=s.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function C0(o,t){for(let s=0;s<t.length;s++){const l=t[s];s===t.length-1&&t[0].x===l.x&&t[0].y===l.y||(o.x+=l.x,o.y+=l.y,o.sampleCount++)}}function P0(o,t){return o.x===t.x&&(o.x<0||o.x>ze)||o.y===t.y&&(o.y<0||o.y>ze)}function Mg(o){return o.every(t=>t.x<0)||o.every(t=>t.x>ze)||o.every(t=>t.y<0)||o.every(t=>t.y>ze)}let Df;It("FillExtrusionBucket",fp,{omit:["layers","features"]});var E0={get paint(){return Df=Df||new Ti({"fill-extrusion-opacity":new Vt(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new La(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vt(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class M0 extends Eo{constructor(t){super(t,E0)}createBucket(t){return new fp(t)}queryRadius(){return du(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:s,featureState:l,geometry:p,transform:y,pixelsToTileUnits:v,pixelPosMatrix:S}){const E=Gh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,v),I=this.paint.get("fill-extrusion-height").evaluate(s,l),A=this.paint.get("fill-extrusion-base").evaluate(s,l),R=function(N,U,q){const Q=[];for(const ae of N){const Me=[ae.x,ae.y,0,1];Fe(Me,Me,U),Q.push(new Be(Me[0]/Me[3],Me[1]/Me[3]))}return Q}(E,S),B=function(N,U,q,Q){const ae=[],Me=[],de=Q[8]*U,O=Q[9]*U,J=Q[10]*U,_e=Q[11]*U,Ze=Q[8]*q,dt=Q[9]*q,Je=Q[10]*q,Xe=Q[11]*q;for(const pt of N){const mt=[],wt=[];for(const it of pt){const Bt=it.x,qt=it.y,Zt=Q[0]*Bt+Q[4]*qt+Q[12],jt=Q[1]*Bt+Q[5]*qt+Q[13],wn=Q[2]*Bt+Q[6]*qt+Q[14],yr=Q[3]*Bt+Q[7]*qt+Q[15],Gr=wn+J,mi=yr+_e,_o=Zt+Ze,Ii=jt+dt,ai=wn+Je,mr=yr+Xe,ei=new Be((Zt+de)/mi,(jt+O)/mi);ei.z=Gr/mi,mt.push(ei);const li=new Be(_o/mr,Ii/mr);li.z=ai/mr,wt.push(li)}ae.push(mt),Me.push(wt)}return[ae,Me]}(p,A,I,S);return function(N,U,q){let Q=1/0;Ks(q,U)&&(Q=Ig(q,U[0]));for(let ae=0;ae<U.length;ae++){const Me=U[ae],de=N[ae];for(let O=0;O<Me.length-1;O++){const J=Me[O],_e=[J,Me[O+1],de[O+1],de[O],J];Vh(q,_e)&&(Q=Math.min(Q,Ig(q,_e)))}}return Q!==1/0&&Q}(B[0],B[1],R)}}function Yh(o,t){return o.x*t.x+o.y*t.y}function Ig(o,t){if(o.length===1){let s=0;const l=t[s++];let p;for(;!p||l.equals(p);)if(p=t[s++],!p)return 1/0;for(;s<t.length;s++){const y=t[s],v=o[0],S=p.sub(l),E=y.sub(l),I=v.sub(l),A=Yh(S,S),R=Yh(S,E),B=Yh(E,E),N=Yh(I,S),U=Yh(I,E),q=A*B-R*R,Q=(B*N-R*U)/q,ae=(A*U-R*N)/q,Me=l.z*(1-Q-ae)+p.z*Q+y.z*ae;if(isFinite(Me))return Me}return 1/0}{let s=1/0;for(const l of t)s=Math.min(s,l.z);return s}}const I0=Cr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:k0}=I0,Qo=Cr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:A0}=Qo,z0=Hh.VectorTileFeature.types,R0=Math.cos(Math.PI/180*37.5),Ff=Math.pow(2,14)/.5;class Bf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new xe,this.layoutVertexArray2=new Se,this.indexArray=new Qe,this.programConfigurations=new fr(t.layers,t.zoom),this.segments=new Et,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Mc("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),v=[];for(const{feature:S,id:E,index:I,sourceLayerIndex:A}of t){const R=this.layers[0]._featureFilter.needGeometry,B=Xs(S,R);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),B,l))continue;const N=y?p.evaluate(B,{},l):void 0,U={id:E,properties:S.properties,type:S.type,sourceLayerIndex:A,index:I,geometry:R?B.geometry:Ys(S),patterns:{},sortKey:N};v.push(U)}y&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:I,sourceLayerIndex:A}=S;if(this.hasPattern){const R=bl("line",this.layers,S,this.zoom,s);this.patternFeatures.push(R)}else this.addFeature(S,E,I,l,{},s.subdivisionGranularity);s.featureIndex.insert(t[I].feature,E,I,A,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,A0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,k0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,l,p,y,v){const S=this.layers[0].layout,E=S.get("line-join").evaluate(t,{}),I=S.get("line-cap"),A=S.get("line-miter-limit"),R=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const B of s)this.addLine(B,t,E,I,A,R,p,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}addLine(t,s,l,p,y,v,S,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Sl(t,S?E.line.getGranularityForZoomLevel(S.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<t.length-1;de++)this.totalDistance+=t[de].dist(t[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=z0[s.type]==="Polygon";let A=t.length;for(;A>=2&&t[A-1].equals(t[A-2]);)A--;let R=0;for(;R<A-1&&t[R].equals(t[R+1]);)R++;if(A<(I?3:2))return;l==="bevel"&&(y=1.05);const B=this.overscaling<=16?15*ze/(512*this.overscaling):0,N=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let U,q,Q,ae,Me;this.e1=this.e2=-1,I&&(U=t[A-2],Me=t[R].sub(U)._unit()._perp());for(let de=R;de<A;de++){if(Q=de===A-1?I?t[R+1]:void 0:t[de+1],Q&&t[de].equals(Q))continue;Me&&(ae=Me),U&&(q=U),U=t[de],Me=Q?Q.sub(U)._unit()._perp():ae,ae=ae||Me;let O=ae.add(Me);O.x===0&&O.y===0||O._unit();const J=ae.x*Me.x+ae.y*Me.y,_e=O.x*Me.x+O.y*Me.y,Ze=_e!==0?1/_e:1/0,dt=2*Math.sqrt(2-2*_e),Je=_e<R0&&q&&Q,Xe=ae.x*Me.y-ae.y*Me.x>0;if(Je&&de>R){const wt=U.dist(q);if(wt>2*B){const it=U.sub(U.sub(q)._mult(B/wt)._round());this.updateDistance(q,it),this.addCurrentVertex(it,ae,0,0,N),q=it}}const pt=q&&Q;let mt=pt?l:I?"butt":p;if(pt&&mt==="round"&&(Ze<v?mt="miter":Ze<=2&&(mt="fakeround")),mt==="miter"&&Ze>y&&(mt="bevel"),mt==="bevel"&&(Ze>2&&(mt="flipbevel"),Ze<y&&(mt="miter")),q&&this.updateDistance(q,U),mt==="miter")O._mult(Ze),this.addCurrentVertex(U,O,0,0,N);else if(mt==="flipbevel"){if(Ze>100)O=Me.mult(-1);else{const wt=Ze*ae.add(Me).mag()/ae.sub(Me).mag();O._perp()._mult(wt*(Xe?-1:1))}this.addCurrentVertex(U,O,0,0,N),this.addCurrentVertex(U,O.mult(-1),0,0,N)}else if(mt==="bevel"||mt==="fakeround"){const wt=-Math.sqrt(Ze*Ze-1),it=Xe?wt:0,Bt=Xe?0:wt;if(q&&this.addCurrentVertex(U,ae,it,Bt,N),mt==="fakeround"){const qt=Math.round(180*dt/Math.PI/20);for(let Zt=1;Zt<qt;Zt++){let jt=Zt/qt;if(jt!==.5){const yr=jt-.5;jt+=jt*yr*(jt-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*yr*yr+(.848013+J*(.215638*J-1.06021)))}const wn=Me.sub(ae)._mult(jt)._add(ae)._unit()._mult(Xe?-1:1);this.addHalfVertex(U,wn.x,wn.y,!1,Xe,0,N)}}Q&&this.addCurrentVertex(U,Me,-it,-Bt,N)}else if(mt==="butt")this.addCurrentVertex(U,O,0,0,N);else if(mt==="square"){const wt=q?1:-1;this.addCurrentVertex(U,O,wt,wt,N)}else mt==="round"&&(q&&(this.addCurrentVertex(U,ae,0,0,N),this.addCurrentVertex(U,ae,1,1,N,!0)),Q&&(this.addCurrentVertex(U,Me,-1,-1,N,!0),this.addCurrentVertex(U,Me,0,0,N)));if(Je&&de<A-1){const wt=U.dist(Q);if(wt>2*B){const it=U.add(Q.sub(U)._mult(B/wt)._round());this.updateDistance(U,it),this.addCurrentVertex(it,Me,0,0,N),U=it}}}}addCurrentVertex(t,s,l,p,y,v=!1){const S=s.y*p-s.x,E=-s.y-s.x*p;this.addHalfVertex(t,s.x+s.y*l,s.y-s.x*l,v,!1,l,y),this.addHalfVertex(t,S,E,v,!0,-p,y),this.distance>Ff/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,l,p,y,v))}addHalfVertex({x:t,y:s},l,p,y,v,S,E){const I=.5*(this.lineClips?this.scaledDistance*(Ff-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(s<<1)+(v?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(S===0?0:S<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,A,this.e2),E.primitiveLength++),v?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let kg,Ag;It("LineBucket",Bf,{omit:["layers","patternFeatures"]});var zg={get paint(){return Ag=Ag||new Ti({"line-opacity":new Gt(te.paint_line["line-opacity"]),"line-color":new Gt(te.paint_line["line-color"]),"line-translate":new Vt(te.paint_line["line-translate"]),"line-translate-anchor":new Vt(te.paint_line["line-translate-anchor"]),"line-width":new Gt(te.paint_line["line-width"]),"line-gap-width":new Gt(te.paint_line["line-gap-width"]),"line-offset":new Gt(te.paint_line["line-offset"]),"line-blur":new Gt(te.paint_line["line-blur"]),"line-dasharray":new Xo(te.paint_line["line-dasharray"]),"line-pattern":new La(te.paint_line["line-pattern"]),"line-gradient":new _i(te.paint_line["line-gradient"])})},get layout(){return kg=kg||new Ti({"line-cap":new Vt(te.layout_line["line-cap"]),"line-join":new Gt(te.layout_line["line-join"]),"line-miter-limit":new Vt(te.layout_line["line-miter-limit"]),"line-round-limit":new Vt(te.layout_line["line-round-limit"]),"line-sort-key":new Gt(te.layout_line["line-sort-key"])})}};class Of extends Gt{possiblyEvaluate(t,s){return s=new nr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,l,p){return s=bt({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,l,p)}}let mp;class L0 extends Eo{constructor(t){super(t,zg),this.gradientVersion=0,mp||(mp=new Of(zg.paint.properties["line-width"].specification),mp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof ga,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=mp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Bf(t)}queryRadius(t){const s=t,l=Rg(Pc("line-width",this,s),Pc("line-gap-width",this,s)),p=Pc("line-offset",this,s);return l/2+Math.abs(p)+du(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:s,featureState:l,geometry:p,transform:y,pixelsToTileUnits:v}){const S=Gh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,v),E=v/2*Rg(this.paint.get("line-width").evaluate(s,l),this.paint.get("line-gap-width").evaluate(s,l)),I=this.paint.get("line-offset").evaluate(s,l);return I&&(p=function(A,R){const B=[];for(let N=0;N<A.length;N++){const U=A[N],q=[];for(let Q=0;Q<U.length;Q++){const ae=U[Q-1],Me=U[Q],de=U[Q+1],O=Q===0?new Be(0,0):Me.sub(ae)._unit()._perp(),J=Q===U.length-1?new Be(0,0):de.sub(Me)._unit()._perp(),_e=O._add(J)._unit(),Ze=_e.x*J.x+_e.y*J.y;Ze!==0&&_e._mult(1/Ze),q.push(_e._mult(R)._add(Me))}B.push(q)}return B}(p,I*v)),function(A,R,B){for(let N=0;N<R.length;N++){const U=R[N];if(A.length>=3){for(let q=0;q<U.length;q++)if(Cc(A,U[q]))return!0}if(Sc(A,U,B))return!0}return!1}(S,p,E)}isTileClipped(){return!0}}function Rg(o,t){return t>0?t+2*o:o}const D0=Cr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),F0=Cr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Cr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const B0=Cr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Cr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Lg=Cr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),O0=Cr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function N0(o,t,s){return o.sections.forEach(l=>{l.text=function(p,y,v){const S=y.layout.get("text-transform").evaluate(v,{});return S==="uppercase"?p=p.toLocaleUpperCase():S==="lowercase"&&(p=p.toLocaleLowerCase()),gs.applyArabicShaping&&(p=gs.applyArabicShaping(p)),p}(l.text,t,s)}),o}Cr([{name:"triangle",components:3,type:"Uint16"}]),Cr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Cr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Cr([{type:"Float32",name:"offsetX"}]),Cr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Cr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Xh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Dg,Nf,Fg,Vr=24,jf={};function j0(){return Dg||(Dg=1,jf.read=function(o,t,s,l,p){var y,v,S=8*p-l-1,E=(1<<S)-1,I=E>>1,A=-7,R=s?p-1:0,B=s?-1:1,N=o[t+R];for(R+=B,y=N&(1<<-A)-1,N>>=-A,A+=S;A>0;y=256*y+o[t+R],R+=B,A-=8);for(v=y&(1<<-A)-1,y>>=-A,A+=l;A>0;v=256*v+o[t+R],R+=B,A-=8);if(y===0)y=1-I;else{if(y===E)return v?NaN:1/0*(N?-1:1);v+=Math.pow(2,l),y-=I}return(N?-1:1)*v*Math.pow(2,y-l)},jf.write=function(o,t,s,l,p,y){var v,S,E,I=8*y-p-1,A=(1<<I)-1,R=A>>1,B=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=l?0:y-1,U=l?1:-1,q=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(S=isNaN(t)?1:0,v=A):(v=Math.floor(Math.log(t)/Math.LN2),t*(E=Math.pow(2,-v))<1&&(v--,E*=2),(t+=v+R>=1?B/E:B*Math.pow(2,1-R))*E>=2&&(v++,E/=2),v+R>=A?(S=0,v=A):v+R>=1?(S=(t*E-1)*Math.pow(2,p),v+=R):(S=t*Math.pow(2,R-1)*Math.pow(2,p),v=0));p>=8;o[s+N]=255&S,N+=U,S/=256,p-=8);for(v=v<<p|S,I+=p;I>0;o[s+N]=255&v,N+=U,v/=256,I-=8);o[s+N-U]|=128*q}),jf}function Bg(){if(Fg)return Nf;Fg=1,Nf=t;var o=j0();function t(O){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(O)?O:new Uint8Array(O||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var s=4294967296,l=1/s,p=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function y(O){return O.type===t.Bytes?O.readVarint()+O.pos:O.pos+1}function v(O,J,_e){return _e?4294967296*J+(O>>>0):4294967296*(J>>>0)+(O>>>0)}function S(O,J,_e){var Ze=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));_e.realloc(Ze);for(var dt=_e.pos-1;dt>=O;dt--)_e.buf[dt+Ze]=_e.buf[dt]}function E(O,J){for(var _e=0;_e<O.length;_e++)J.writeVarint(O[_e])}function I(O,J){for(var _e=0;_e<O.length;_e++)J.writeSVarint(O[_e])}function A(O,J){for(var _e=0;_e<O.length;_e++)J.writeFloat(O[_e])}function R(O,J){for(var _e=0;_e<O.length;_e++)J.writeDouble(O[_e])}function B(O,J){for(var _e=0;_e<O.length;_e++)J.writeBoolean(O[_e])}function N(O,J){for(var _e=0;_e<O.length;_e++)J.writeFixed32(O[_e])}function U(O,J){for(var _e=0;_e<O.length;_e++)J.writeSFixed32(O[_e])}function q(O,J){for(var _e=0;_e<O.length;_e++)J.writeFixed64(O[_e])}function Q(O,J){for(var _e=0;_e<O.length;_e++)J.writeSFixed64(O[_e])}function ae(O,J){return(O[J]|O[J+1]<<8|O[J+2]<<16)+16777216*O[J+3]}function Me(O,J,_e){O[_e]=J,O[_e+1]=J>>>8,O[_e+2]=J>>>16,O[_e+3]=J>>>24}function de(O,J){return(O[J]|O[J+1]<<8|O[J+2]<<16)+(O[J+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(O,J,_e){for(_e=_e||this.length;this.pos<_e;){var Ze=this.readVarint(),dt=Ze>>3,Je=this.pos;this.type=7&Ze,O(dt,J,this),this.pos===Je&&this.skip(Ze)}return J},readMessage:function(O,J){return this.readFields(O,J,this.readVarint()+this.pos)},readFixed32:function(){var O=ae(this.buf,this.pos);return this.pos+=4,O},readSFixed32:function(){var O=de(this.buf,this.pos);return this.pos+=4,O},readFixed64:function(){var O=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*s;return this.pos+=8,O},readSFixed64:function(){var O=ae(this.buf,this.pos)+de(this.buf,this.pos+4)*s;return this.pos+=8,O},readFloat:function(){var O=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,O},readDouble:function(){var O=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,O},readVarint:function(O){var J,_e,Ze=this.buf;return J=127&(_e=Ze[this.pos++]),_e<128?J:(J|=(127&(_e=Ze[this.pos++]))<<7,_e<128?J:(J|=(127&(_e=Ze[this.pos++]))<<14,_e<128?J:(J|=(127&(_e=Ze[this.pos++]))<<21,_e<128?J:function(dt,Je,Xe){var pt,mt,wt=Xe.buf;if(pt=(112&(mt=wt[Xe.pos++]))>>4,mt<128||(pt|=(127&(mt=wt[Xe.pos++]))<<3,mt<128)||(pt|=(127&(mt=wt[Xe.pos++]))<<10,mt<128)||(pt|=(127&(mt=wt[Xe.pos++]))<<17,mt<128)||(pt|=(127&(mt=wt[Xe.pos++]))<<24,mt<128)||(pt|=(1&(mt=wt[Xe.pos++]))<<31,mt<128))return v(dt,pt,Je);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(_e=Ze[this.pos]))<<28,O,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var O=this.readVarint();return O%2==1?(O+1)/-2:O/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var O=this.readVarint()+this.pos,J=this.pos;return this.pos=O,O-J>=12&&p?function(_e,Ze,dt){return p.decode(_e.subarray(Ze,dt))}(this.buf,J,O):function(_e,Ze,dt){for(var Je="",Xe=Ze;Xe<dt;){var pt,mt,wt,it=_e[Xe],Bt=null,qt=it>239?4:it>223?3:it>191?2:1;if(Xe+qt>dt)break;qt===1?it<128&&(Bt=it):qt===2?(192&(pt=_e[Xe+1]))==128&&(Bt=(31&it)<<6|63&pt)<=127&&(Bt=null):qt===3?(mt=_e[Xe+2],(192&(pt=_e[Xe+1]))==128&&(192&mt)==128&&((Bt=(15&it)<<12|(63&pt)<<6|63&mt)<=2047||Bt>=55296&&Bt<=57343)&&(Bt=null)):qt===4&&(mt=_e[Xe+2],wt=_e[Xe+3],(192&(pt=_e[Xe+1]))==128&&(192&mt)==128&&(192&wt)==128&&((Bt=(15&it)<<18|(63&pt)<<12|(63&mt)<<6|63&wt)<=65535||Bt>=1114112)&&(Bt=null)),Bt===null?(Bt=65533,qt=1):Bt>65535&&(Bt-=65536,Je+=String.fromCharCode(Bt>>>10&1023|55296),Bt=56320|1023&Bt),Je+=String.fromCharCode(Bt),Xe+=qt}return Je}(this.buf,J,O)},readBytes:function(){var O=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,O);return this.pos=O,J},readPackedVarint:function(O,J){if(this.type!==t.Bytes)return O.push(this.readVarint(J));var _e=y(this);for(O=O||[];this.pos<_e;)O.push(this.readVarint(J));return O},readPackedSVarint:function(O){if(this.type!==t.Bytes)return O.push(this.readSVarint());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readSVarint());return O},readPackedBoolean:function(O){if(this.type!==t.Bytes)return O.push(this.readBoolean());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readBoolean());return O},readPackedFloat:function(O){if(this.type!==t.Bytes)return O.push(this.readFloat());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readFloat());return O},readPackedDouble:function(O){if(this.type!==t.Bytes)return O.push(this.readDouble());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readDouble());return O},readPackedFixed32:function(O){if(this.type!==t.Bytes)return O.push(this.readFixed32());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readFixed32());return O},readPackedSFixed32:function(O){if(this.type!==t.Bytes)return O.push(this.readSFixed32());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readSFixed32());return O},readPackedFixed64:function(O){if(this.type!==t.Bytes)return O.push(this.readFixed64());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readFixed64());return O},readPackedSFixed64:function(O){if(this.type!==t.Bytes)return O.push(this.readSFixed64());var J=y(this);for(O=O||[];this.pos<J;)O.push(this.readSFixed64());return O},skip:function(O){var J=7&O;if(J===t.Varint)for(;this.buf[this.pos++]>127;);else if(J===t.Bytes)this.pos=this.readVarint()+this.pos;else if(J===t.Fixed32)this.pos+=4;else{if(J!==t.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(O,J){this.writeVarint(O<<3|J)},realloc:function(O){for(var J=this.length||16;J<this.pos+O;)J*=2;if(J!==this.length){var _e=new Uint8Array(J);_e.set(this.buf),this.buf=_e,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(O){this.realloc(4),Me(this.buf,O,this.pos),this.pos+=4},writeSFixed32:function(O){this.realloc(4),Me(this.buf,O,this.pos),this.pos+=4},writeFixed64:function(O){this.realloc(8),Me(this.buf,-1&O,this.pos),Me(this.buf,Math.floor(O*l),this.pos+4),this.pos+=8},writeSFixed64:function(O){this.realloc(8),Me(this.buf,-1&O,this.pos),Me(this.buf,Math.floor(O*l),this.pos+4),this.pos+=8},writeVarint:function(O){(O=+O||0)>268435455||O<0?function(J,_e){var Ze,dt;if(J>=0?(Ze=J%4294967296|0,dt=J/4294967296|0):(dt=~(-J/4294967296),4294967295^(Ze=~(-J%4294967296))?Ze=Ze+1|0:(Ze=0,dt=dt+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");_e.realloc(10),function(Je,Xe,pt){pt.buf[pt.pos++]=127&Je|128,Je>>>=7,pt.buf[pt.pos++]=127&Je|128,Je>>>=7,pt.buf[pt.pos++]=127&Je|128,Je>>>=7,pt.buf[pt.pos++]=127&Je|128,pt.buf[pt.pos]=127&(Je>>>=7)}(Ze,0,_e),function(Je,Xe){var pt=(7&Je)<<4;Xe.buf[Xe.pos++]|=pt|((Je>>>=3)?128:0),Je&&(Xe.buf[Xe.pos++]=127&Je|((Je>>>=7)?128:0),Je&&(Xe.buf[Xe.pos++]=127&Je|((Je>>>=7)?128:0),Je&&(Xe.buf[Xe.pos++]=127&Je|((Je>>>=7)?128:0),Je&&(Xe.buf[Xe.pos++]=127&Je|((Je>>>=7)?128:0),Je&&(Xe.buf[Xe.pos++]=127&Je)))))}(dt,_e)}(O,this):(this.realloc(4),this.buf[this.pos++]=127&O|(O>127?128:0),O<=127||(this.buf[this.pos++]=127&(O>>>=7)|(O>127?128:0),O<=127||(this.buf[this.pos++]=127&(O>>>=7)|(O>127?128:0),O<=127||(this.buf[this.pos++]=O>>>7&127))))},writeSVarint:function(O){this.writeVarint(O<0?2*-O-1:2*O)},writeBoolean:function(O){this.writeVarint(!!O)},writeString:function(O){O=String(O),this.realloc(4*O.length),this.pos++;var J=this.pos;this.pos=function(Ze,dt,Je){for(var Xe,pt,mt=0;mt<dt.length;mt++){if((Xe=dt.charCodeAt(mt))>55295&&Xe<57344){if(!pt){Xe>56319||mt+1===dt.length?(Ze[Je++]=239,Ze[Je++]=191,Ze[Je++]=189):pt=Xe;continue}if(Xe<56320){Ze[Je++]=239,Ze[Je++]=191,Ze[Je++]=189,pt=Xe;continue}Xe=pt-55296<<10|Xe-56320|65536,pt=null}else pt&&(Ze[Je++]=239,Ze[Je++]=191,Ze[Je++]=189,pt=null);Xe<128?Ze[Je++]=Xe:(Xe<2048?Ze[Je++]=Xe>>6|192:(Xe<65536?Ze[Je++]=Xe>>12|224:(Ze[Je++]=Xe>>18|240,Ze[Je++]=Xe>>12&63|128),Ze[Je++]=Xe>>6&63|128),Ze[Je++]=63&Xe|128)}return Je}(this.buf,O,this.pos);var _e=this.pos-J;_e>=128&&S(J,_e,this),this.pos=J-1,this.writeVarint(_e),this.pos+=_e},writeFloat:function(O){this.realloc(4),o.write(this.buf,O,this.pos,!0,23,4),this.pos+=4},writeDouble:function(O){this.realloc(8),o.write(this.buf,O,this.pos,!0,52,8),this.pos+=8},writeBytes:function(O){var J=O.length;this.writeVarint(J),this.realloc(J);for(var _e=0;_e<J;_e++)this.buf[this.pos++]=O[_e]},writeRawMessage:function(O,J){this.pos++;var _e=this.pos;O(J,this);var Ze=this.pos-_e;Ze>=128&&S(_e,Ze,this),this.pos=_e-1,this.writeVarint(Ze),this.pos+=Ze},writeMessage:function(O,J,_e){this.writeTag(O,t.Bytes),this.writeRawMessage(J,_e)},writePackedVarint:function(O,J){J.length&&this.writeMessage(O,E,J)},writePackedSVarint:function(O,J){J.length&&this.writeMessage(O,I,J)},writePackedBoolean:function(O,J){J.length&&this.writeMessage(O,B,J)},writePackedFloat:function(O,J){J.length&&this.writeMessage(O,A,J)},writePackedDouble:function(O,J){J.length&&this.writeMessage(O,R,J)},writePackedFixed32:function(O,J){J.length&&this.writeMessage(O,N,J)},writePackedSFixed32:function(O,J){J.length&&this.writeMessage(O,U,J)},writePackedFixed64:function(O,J){J.length&&this.writeMessage(O,q,J)},writePackedSFixed64:function(O,J){J.length&&this.writeMessage(O,Q,J)},writeBytesField:function(O,J){this.writeTag(O,t.Bytes),this.writeBytes(J)},writeFixed32Field:function(O,J){this.writeTag(O,t.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(O,J){this.writeTag(O,t.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(O,J){this.writeTag(O,t.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(O,J){this.writeTag(O,t.Fixed64),this.writeSFixed64(J)},writeVarintField:function(O,J){this.writeTag(O,t.Varint),this.writeVarint(J)},writeSVarintField:function(O,J){this.writeTag(O,t.Varint),this.writeSVarint(J)},writeStringField:function(O,J){this.writeTag(O,t.Bytes),this.writeString(J)},writeFloatField:function(O,J){this.writeTag(O,t.Fixed32),this.writeFloat(J)},writeDoubleField:function(O,J){this.writeTag(O,t.Fixed64),this.writeDouble(J)},writeBooleanField:function(O,J){this.writeVarintField(O,!!J)}},Nf}var Uf=j(Bg());const Vf=3;function U0(o,t,s){o===1&&s.readMessage(Gf,t)}function Gf(o,t,s){if(o===3){const{id:l,bitmap:p,width:y,height:v,left:S,top:E,advance:I}=s.readMessage(Og,{});t.push({id:l,bitmap:new Ec({width:y+2*Vf,height:v+2*Vf},p),metrics:{width:y,height:v,left:S,top:E,advance:I}})}}function Og(o,t,s){o===1?t.id=s.readVarint():o===2?t.bitmap=s.readBytes():o===3?t.width=s.readVarint():o===4?t.height=s.readVarint():o===5?t.left=s.readSVarint():o===6?t.top=s.readSVarint():o===7&&(t.advance=s.readVarint())}const V0=Vf;function Ng(o){let t=0,s=0;for(const v of o)t+=v.w*v.h,s=Math.max(s,v.w);o.sort((v,S)=>S.h-v.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let p=0,y=0;for(const v of o)for(let S=l.length-1;S>=0;S--){const E=l[S];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,y=Math.max(y,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===E.w&&v.h===E.h){const I=l.pop();S<l.length&&(l[S]=I)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(l.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:p,h:y,fill:t/(p*y)||0}}const Wi=1;class $f{constructor(t,{pixelRatio:s,version:l,stretchX:p,stretchY:y,content:v,textFitWidth:S,textFitHeight:E}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=p,this.stretchY=y,this.content=v,this.version=l,this.textFitWidth=S,this.textFitHeight=E}get tl(){return[this.paddedRect.x+Wi,this.paddedRect.y+Wi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wi,this.paddedRect.y+this.paddedRect.h-Wi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Wi)/this.pixelRatio,(this.paddedRect.h-2*Wi)/this.pixelRatio]}}class jg{constructor(t,s){const l={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,l,y),this.addImages(s,p,y);const{w:v,h:S}=Ng(y),E=new po({width:v||1,height:S||1});for(const I in t){const A=t[I],R=l[I].paddedRect;po.copy(A.data,E,{x:0,y:0},{x:R.x+Wi,y:R.y+Wi},A.data)}for(const I in s){const A=s[I],R=p[I].paddedRect,B=R.x+Wi,N=R.y+Wi,U=A.data.width,q=A.data.height;po.copy(A.data,E,{x:0,y:0},{x:B,y:N},A.data),po.copy(A.data,E,{x:0,y:q-1},{x:B,y:N-1},{width:U,height:1}),po.copy(A.data,E,{x:0,y:0},{x:B,y:N+q},{width:U,height:1}),po.copy(A.data,E,{x:U-1,y:0},{x:B-1,y:N},{width:1,height:q}),po.copy(A.data,E,{x:0,y:0},{x:B+U,y:N},{width:1,height:q})}this.image=E,this.iconPositions=l,this.patternPositions=p}addImages(t,s,l){for(const p in t){const y=t[p],v={x:0,y:0,w:y.data.width+2*Wi,h:y.data.height+2*Wi};l.push(v),s[p]=new $f(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),s)}patchUpdatedImage(t,s,l){if(!t||!s||t.version===s.version)return;t.version=s.version;const[p,y]=t.tl;l.update(s.data,void 0,{x:p,y})}}var Tl;It("ImagePosition",$f),It("ImageAtlas",jg),b.af=void 0,(Tl=b.af||(b.af={}))[Tl.none=0]="none",Tl[Tl.horizontal=1]="horizontal",Tl[Tl.vertical=2]="vertical",Tl[Tl.horizontalOnly=3]="horizontalOnly";const gp=-17;class Kh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,s,l){const p=new Kh;return p.scale=t||1,p.fontStack=s,p.verticalAlign=l||"bottom",p}static forImage(t,s){const l=new Kh;return l.imageName=t,l.verticalAlign=s||"bottom",l}}class vu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const l=new vu;for(let p=0;p<t.sections.length;p++){const y=t.sections[p];y.image?l.addImageSection(y):l.addTextSection(y,s)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let l=0;l<t.length;l++){const p=t.charCodeAt(l+1)||null,y=t.charCodeAt(l-1)||null;s+=p&&uo(p)&&!Xh[t[l+1]]||y&&uo(y)&&!Xh[t[l-1]]||!Xh[t[l]]?t[l]:Xh[t[l]]}return s}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&xu[this.text.charCodeAt(l)];l++)t++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&xu[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const l=new vu;return l.text=this.text.substring(t,s),l.sectionIndex=this.sectionIndex.slice(t,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}getMaxImageSize(t){let s=0,l=0;for(let p=0;p<this.length();p++){const y=this.getSection(p);if(y.imageName){const v=t[y.imageName];if(!v)continue;const S=v.displaySize;s=Math.max(s,S[0]),l=Math.max(l,S[1])}}return{maxImageWidth:s,maxImageHeight:l}}addTextSection(t,s){this.text+=t.text,this.sections.push(Kh.forText(t.scale,t.fontStack||s,t.verticalAlign));const l=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(l)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void Ht("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Kh.forImage(s,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ht("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _p(o,t,s,l,p,y,v,S,E,I,A,R,B,N,U){const q=vu.fromFeature(o,p);let Q;R===b.af.vertical&&q.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:Me}=gs;if(ae&&q.sections.length===1){Q=[];const J=ae(q.toString(),Zf(q,I,y,t,l,N));for(const _e of J){const Ze=new vu;Ze.text=_e,Ze.sections=q.sections;for(let dt=0;dt<_e.length;dt++)Ze.sectionIndex.push(0);Q.push(Ze)}}else if(Me){Q=[];const J=Me(q.text,q.sectionIndex,Zf(q,I,y,t,l,N));for(const _e of J){const Ze=new vu;Ze.text=_e[0],Ze.sectionIndex=_e[1],Ze.sections=q.sections,Q.push(Ze)}}else Q=function(J,_e){const Ze=[],dt=J.text;let Je=0;for(const Xe of _e)Ze.push(J.substring(Je,Xe)),Je=Xe;return Je<dt.length&&Ze.push(J.substring(Je,dt.length)),Ze}(q,Zf(q,I,y,t,l,N));const de=[],O={positionedLines:de,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(J,_e,Ze,dt,Je,Xe,pt,mt,wt,it,Bt,qt){let Zt=0,jt=0,wn=0,yr=0;const Gr=mt==="right"?1:mt==="left"?0:.5,mi=Vr/qt;let _o=0;for(const mr of Je){mr.trim();const ei=mr.getMaxScale(),li={positionedGlyphs:[],lineOffset:0};J.positionedLines[_o]=li;const wr=li.positionedGlyphs;let ki=0;if(!mr.length()){jt+=Xe,++_o;continue}const zo=q0(dt,mr,mi);for(let Yi=0;Yi<mr.length();Yi++){const $r=mr.getSection(Yi),Zr=mr.getSectionIndex(Yi),qr=mr.getCharCode(Yi),Lr=W0(wt,Bt,qr);let rr;if($r.imageName){if(J.iconsInText=!0,$r.scale=$r.scale*mi,rr=Y0($r,Lr,ei,zo,dt),!rr)continue;ki=Math.max(ki,rr.imageOffset)}else if(rr=H0($r,qr,Lr,zo,_e,Ze),!rr)continue;const{rect:ws,metrics:Nc,baselineOffset:bs}=rr;wr.push({glyph:qr,imageName:$r.imageName,x:Zt,y:jt+bs+gp,vertical:Lr,scale:$r.scale,fontStack:$r.fontStack,sectionIndex:Zr,metrics:Nc,rect:ws}),Lr?(J.verticalizable=!0,Zt+=($r.imageName?Nc.advance:Vr)*$r.scale+it):Zt+=Nc.advance*$r.scale+it}wr.length!==0&&(wn=Math.max(Zt-it,wn),X0(wr,0,wr.length-1,Gr)),Zt=0,li.lineOffset=Math.max(ki,(ei-1)*Vr);const ti=Xe*ei+ki;jt+=ti,yr=Math.max(ti,yr),++_o}const{horizontalAlign:Ii,verticalAlign:ai}=qf(pt);(function(mr,ei,li,wr,ki,zo,ti,Yi,$r){const Zr=(ei-li)*ki;let qr=0;qr=zo!==ti?-Yi*wr-gp:-wr*$r*ti+.5*ti;for(const Lr of mr)for(const rr of Lr.positionedGlyphs)rr.x+=Zr,rr.y+=qr})(J.positionedLines,Gr,Ii,ai,wn,yr,Xe,jt,Je.length),J.top+=-ai*jt,J.bottom=J.top+jt,J.left+=-Ii*wn,J.right=J.left+wn}(O,t,s,l,Q,v,S,E,R,I,B,U),!function(J){for(const _e of J)if(_e.positionedGlyphs.length!==0)return!1;return!0}(de)&&O}const xu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},$0={40:!0};function Ug(o,t,s,l,p,y){if(t.imageName){const v=l[t.imageName];return v?v.displaySize[0]*t.scale*Vr/y+p:0}{const v=s[t.fontStack],S=v&&v[o];return S?S.metrics.advance*t.scale+p:0}}function Vg(o,t,s,l){const p=Math.pow(o-t,2);return l?o<t?p/2:2*p:p+Math.abs(s)*s}function Z0(o,t,s){let l=0;return o===10&&(l-=1e4),s&&(l+=150),o!==40&&o!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function Gg(o,t,s,l,p,y){let v=null,S=Vg(t,s,p,y);for(const E of l){const I=Vg(t-E.x,s,p,y)+E.badness;I<=S&&(v=E,S=I)}return{index:o,x:t,priorBreak:v,badness:S}}function $g(o){return o?$g(o.priorBreak).concat(o.index):[]}function Zf(o,t,s,l,p,y){if(!o)return[];const v=[],S=function(R,B,N,U,q,Q){let ae=0;for(let Me=0;Me<R.length();Me++){const de=R.getSection(Me);ae+=Ug(R.getCharCode(Me),de,U,q,B,Q)}return ae/Math.max(1,Math.ceil(ae/N))}(o,t,s,l,p,y),E=o.text.indexOf("")>=0;let I=0;for(let R=0;R<o.length();R++){const B=o.getSection(R),N=o.getCharCode(R);if(xu[N]||(I+=Ug(N,B,l,p,t,y)),R<o.length()-1){const U=!((A=N)<11904)&&(!!yn["CJK Compatibility Forms"](A)||!!yn["CJK Compatibility"](A)||!!yn["CJK Strokes"](A)||!!yn["CJK Symbols and Punctuation"](A)||!!yn["Enclosed CJK Letters and Months"](A)||!!yn["Halfwidth and Fullwidth Forms"](A)||!!yn["Ideographic Description Characters"](A)||!!yn["Vertical Forms"](A)||mc.test(String.fromCodePoint(A)));(G0[N]||U||B.imageName||R!==o.length()-2&&$0[o.getCharCode(R+1)])&&v.push(Gg(R+1,I,S,v,Z0(N,o.getCharCode(R+1),U&&E),!1))}}var A;return $g(Gg(o.length(),I,S,v,0,!0))}function qf(o){let t=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function q0(o,t,s){const l=t.getMaxScale()*Vr,{maxImageWidth:p,maxImageHeight:y}=t.getMaxImageSize(o),v=Math.max(l,y*s);return{verticalLineContentWidth:Math.max(l,p*s),horizontalLineContentHeight:v}}function Zg(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function W0(o,t,s){return!(o===b.af.horizontal||!t&&!gc(s)||t&&(xu[s]||(l=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function H0(o,t,s,l,p,y){const v=y[o.fontStack],S=function(I,A,R,B){if(I&&I.rect)return I;const N=A[R.fontStack],U=N&&N[B];return U?{rect:null,metrics:U.metrics}:null}(v&&v[t],p,o,t);if(S===null)return null;let E;if(s)E=l.verticalLineContentWidth-o.scale*Vr;else{const I=Zg(o.verticalAlign);E=(l.horizontalLineContentHeight-o.scale*Vr)*I}return{rect:S.rect,metrics:S.metrics,baselineOffset:E}}function Y0(o,t,s,l,p){const y=p[o.imageName];if(!y)return null;const v=y.paddedRect,S=y.displaySize,E={width:S[0],height:S[1],left:Wi,top:-3,advance:t?S[1]:S[0]};let I;if(t)I=l.verticalLineContentWidth-S[1]*o.scale;else{const A=Zg(o.verticalAlign);I=(l.horizontalLineContentHeight-S[1]*o.scale)*A}return{rect:v,metrics:E,baselineOffset:I,imageOffset:(t?S[0]:S[1])*o.scale-Vr*s}}function X0(o,t,s,l){if(l===0)return;const p=o[s],y=(o[s].x+p.metrics.advance*p.scale)*l;for(let v=t;v<=s;v++)o[v].x-=y}function K0(o,t,s){const{horizontalAlign:l,verticalAlign:p}=qf(s),y=t[0]-o.displaySize[0]*l,v=t[1]-o.displaySize[1]*p;return{image:o,top:v,bottom:v+o.displaySize[1],left:y,right:y+o.displaySize[0]}}function Wf(o){var t,s;let l=o.left,p=o.top,y=o.right-l,v=o.bottom-p;const S=(t=o.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",E=(s=o.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",I=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(E==="proportional"){if(S==="stretchOnly"&&y/v<I||S==="proportional"){const A=Math.ceil(v*I);l*=A/y,y=A}}else if(S==="proportional"&&E==="stretchOnly"&&I!==0&&y/v>I){const A=Math.ceil(y/I);p*=A/v,v=A}return{x1:l,y1:p,x2:l+y,y2:p+v}}function Hf(o,t,s,l,p,y){const v=o.image;let S;if(v.content){const Q=v.content,ae=v.pixelRatio||1;S=[Q[0]/ae,Q[1]/ae,v.displaySize[0]-Q[2]/ae,v.displaySize[1]-Q[3]/ae]}const E=t.left*y,I=t.right*y;let A,R,B,N;s==="width"||s==="both"?(N=p[0]+E-l[3],R=p[0]+I+l[1]):(N=p[0]+(E+I-v.displaySize[0])/2,R=N+v.displaySize[0]);const U=t.top*y,q=t.bottom*y;return s==="height"||s==="both"?(A=p[1]+U-l[0],B=p[1]+q+l[2]):(A=p[1]+(U+q-v.displaySize[1])/2,B=A+v.displaySize[1]),{image:v,top:A,right:R,bottom:B,left:N,collisionPadding:S}}const Jh=255,ea=128,Cl=Jh*ea;function qg(o,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new nr(o+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=s;let y=0;for(;y<l.length&&l[y]<=o;)y++;y=Math.max(0,y-1);let v=y;for(;v<l.length&&l[v]<o+1;)v++;v=Math.min(l.length-1,v);const S=l[y],E=l[v];return s.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:S,maxZoom:E,minSize:s.evaluate(new nr(S)),maxSize:s.evaluate(new nr(E)),interpolationType:p}}}function Rc(o,t,s){let l="never";const p=o.get(t);return p?l=p:o.get(s)&&(l="always"),l}const J0=Hh.VectorTileFeature.types,Q0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yp(o,t,s,l,p,y,v,S,E,I,A,R,B){const N=S?Math.min(Cl,Math.round(S[0])):0,U=S?Math.min(Cl,Math.round(S[1])):0;o.emplaceBack(t,s,Math.round(32*l),Math.round(32*p),y,v,(N<<1)+(E?1:0),U,16*I,16*A,256*R,256*B)}function Yf(o,t,s){o.emplaceBack(t.x,t.y,s),o.emplaceBack(t.x,t.y,s),o.emplaceBack(t.x,t.y,s),o.emplaceBack(t.x,t.y,s)}function ev(o){for(const t of o.sections)if(Jd(t.text))return!0;return!1}class Xf{constructor(t){this.layoutVertexArray=new Ee,this.indexArray=new Qe,this.programConfigurations=t,this.segments=new Et,this.dynamicLayoutVertexArray=new $e,this.opacityVertexArray=new qe,this.hasVisibleVertices=!1,this.placedSymbolArray=new P}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,D0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,F0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Q0,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}It("SymbolBuffers",Xf);class Kf{constructor(t,s,l){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Et,this.collisionVertexArray=new at}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,B0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}It("CollisionBuffers",Kf);class Lc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qg(this.zoom,s["text-size"]),this.iconSizeData=qg(this.zoom,s["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),y=l.get("symbol-z-order");this.canOverlap=Rc(l,"text-overlap","text-allow-overlap")!=="never"||Rc(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(v=>b.af[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Xf(new fr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Xf(new fr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new L,this.lineVertexArray=new D,this.symbolInstances=new k,this.textAnchorOffsets=new G}calculateGlyphDependencies(t,s,l,p,y){for(let v=0;v<t.length;v++)if(s[t.charCodeAt(v)]=!0,(l||p)&&y){const S=Xh[t.charAt(v)];S&&(s[S.charCodeAt(0)]=!0)}}populate(t,s,l){const p=this.layers[0],y=p.layout,v=y.get("text-font"),S=y.get("text-field"),E=y.get("icon-image"),I=(S.value.kind!=="constant"||S.value.value instanceof hr&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),A=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,R=y.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const B=s.iconDependencies,N=s.glyphDependencies,U=s.availableImages,q=new nr(this.zoom);for(const{feature:Q,id:ae,index:Me,sourceLayerIndex:de}of t){const O=p._featureFilter.needGeometry,J=Xs(Q,O);if(!p._featureFilter.filter(q,J,l))continue;let _e,Ze;if(O||(J.geometry=Ys(Q)),I){const Je=p.getValueAndResolveTokens("text-field",J,l,U),Xe=hr.factory(Je),pt=this.hasRTLText=this.hasRTLText||ev(Xe);(!pt||gs.getRTLTextPluginStatus()==="unavailable"||pt&&gs.isParsed())&&(_e=N0(Xe,p,J))}if(A){const Je=p.getValueAndResolveTokens("icon-image",J,l,U);Ze=Je instanceof ri?Je:ri.fromString(Je)}if(!_e&&!Ze)continue;const dt=this.sortFeaturesByKey?R.evaluate(J,{},l):void 0;if(this.features.push({id:ae,text:_e,icon:Ze,index:Me,sourceLayerIndex:de,geometry:J.geometry,properties:Q.properties,type:J0[Q.type],sortKey:dt}),Ze&&(B[Ze.name]=!0),_e){const Je=v.evaluate(J,{},l).join(","),Xe=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.af.vertical)>=0;for(const pt of _e.sections)if(pt.image)B[pt.image.name]=!0;else{const mt=yl(_e.toString()),wt=pt.fontStack||Je,it=N[wt]=N[wt]||{};this.calculateGlyphDependencies(pt.text,it,Xe,this.allowVerticalPlacement,mt)}}}y.get("symbol-placement")==="line"&&(this.features=function(Q){const ae={},Me={},de=[];let O=0;function J(Je){de.push(Q[Je]),O++}function _e(Je,Xe,pt){const mt=Me[Je];return delete Me[Je],Me[Xe]=mt,de[mt].geometry[0].pop(),de[mt].geometry[0]=de[mt].geometry[0].concat(pt[0]),mt}function Ze(Je,Xe,pt){const mt=ae[Xe];return delete ae[Xe],ae[Je]=mt,de[mt].geometry[0].shift(),de[mt].geometry[0]=pt[0].concat(de[mt].geometry[0]),mt}function dt(Je,Xe,pt){const mt=pt?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Je}:${mt.x}:${mt.y}`}for(let Je=0;Je<Q.length;Je++){const Xe=Q[Je],pt=Xe.geometry,mt=Xe.text?Xe.text.toString():null;if(!mt){J(Je);continue}const wt=dt(mt,pt),it=dt(mt,pt,!0);if(wt in Me&&it in ae&&Me[wt]!==ae[it]){const Bt=Ze(wt,it,pt),qt=_e(wt,it,de[Bt].geometry);delete ae[wt],delete Me[it],Me[dt(mt,de[qt].geometry,!0)]=qt,de[Bt].geometry=null}else wt in Me?_e(wt,it,pt):it in ae?Ze(wt,it,pt):(J(Je),ae[wt]=O-1,Me[it]=O-1)}return de.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,ae)=>Q.sortKey-ae.sortKey)}update(t,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const l=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(s[t.segment+1]),y=t.dist(s[t.segment]);const v={};for(let S=t.segment+1;S<s.length;S++)v[S]={x:s[S].x,y:s[S].y,tileUnitDistanceFromAnchor:p},S<s.length-1&&(p+=s[S+1].dist(s[S]));for(let S=t.segment||0;S>=0;S--)v[S]={x:s[S].x,y:s[S].y,tileUnitDistanceFromAnchor:y},S>0&&(y+=s[S-1].dist(s[S]));for(let S=0;S<s.length;S++){const E=v[S];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,s,l,p,y,v,S,E,I,A,R,B){const N=t.indexArray,U=t.layoutVertexArray,q=t.segments.prepareSegment(4*s.length,U,N,this.canOverlap?v.sortKey:void 0),Q=this.glyphOffsetArray.length,ae=q.vertexLength,Me=this.allowVerticalPlacement&&S===b.af.vertical?Math.PI/2:0,de=v.text&&v.text.sections;for(let O=0;O<s.length;O++){const{tl:J,tr:_e,bl:Ze,br:dt,tex:Je,pixelOffsetTL:Xe,pixelOffsetBR:pt,minFontScaleX:mt,minFontScaleY:wt,glyphOffset:it,isSDF:Bt,sectionIndex:qt}=s[O],Zt=q.vertexLength,jt=it[1];yp(U,E.x,E.y,J.x,jt+J.y,Je.x,Je.y,l,Bt,Xe.x,Xe.y,mt,wt),yp(U,E.x,E.y,_e.x,jt+_e.y,Je.x+Je.w,Je.y,l,Bt,pt.x,Xe.y,mt,wt),yp(U,E.x,E.y,Ze.x,jt+Ze.y,Je.x,Je.y+Je.h,l,Bt,Xe.x,pt.y,mt,wt),yp(U,E.x,E.y,dt.x,jt+dt.y,Je.x+Je.w,Je.y+Je.h,l,Bt,pt.x,pt.y,mt,wt),Yf(t.dynamicLayoutVertexArray,E,Me),N.emplaceBack(Zt,Zt+2,Zt+1),N.emplaceBack(Zt+1,Zt+2,Zt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(it[0]),O!==s.length-1&&qt===s[O+1].sectionIndex||t.programConfigurations.populatePaintArrays(U.length,v,v.index,{},B,de&&de[qt])}t.placedSymbolArray.emplaceBack(E.x,E.y,Q,this.glyphOffsetArray.length-Q,ae,I,A,E.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],S,0,!1,0,R)}_addCollisionDebugVertex(t,s,l,p,y,v){return s.emplaceBack(0,0),t.emplaceBack(l.x,l.y,p,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,s,l,p,y,v,S){const E=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=E.vertexLength,A=y.layoutVertexArray,R=y.collisionVertexArray,B=S.anchorX,N=S.anchorY;this._addCollisionDebugVertex(A,R,v,B,N,new Be(t,s)),this._addCollisionDebugVertex(A,R,v,B,N,new Be(l,s)),this._addCollisionDebugVertex(A,R,v,B,N,new Be(l,p)),this._addCollisionDebugVertex(A,R,v,B,N,new Be(t,p)),E.vertexLength+=4;const U=y.indexArray;U.emplaceBack(I,I+1),U.emplaceBack(I+1,I+2),U.emplaceBack(I+2,I+3),U.emplaceBack(I+3,I),E.primitiveLength+=4}addDebugCollisionBoxes(t,s,l,p){for(let y=t;y<s;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,p?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kf(nt,Lg.members,lt),this.iconCollisionBox=new Kf(nt,Lg.members,lt);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,l,p,y,v,S,E,I){const A={};for(let R=s;R<l;R++){const B=t.get(R);A.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.textFeatureIndex=B.featureIndex;break}for(let R=p;R<y;R++){const B=t.get(R);A.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.verticalTextFeatureIndex=B.featureIndex;break}for(let R=v;R<S;R++){const B=t.get(R);A.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.iconFeatureIndex=B.featureIndex;break}for(let R=E;R<I;R++){const B=t.get(R);A.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.verticalIconFeatureIndex=B.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const l=t.placedSymbolArray.get(s),p=l.vertexStartIndex+4*l.numGlyphs;for(let y=l.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+2,y+1),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),l=Math.cos(t),p=[],y=[],v=[];for(let S=0;S<this.symbolInstances.length;++S){v.push(S);const E=this.symbolInstances.get(S);p.push(0|Math.round(s*E.anchorX+l*E.anchorY)),y.push(E.featureIndex)}return v.sort((S,E)=>p[S]-p[E]||y[E]-y[S]),v}addToSortKeyRanges(t,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,y,v)=>{p>=0&&v.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Wg,Hg;It("SymbolBucket",Lc,{omit:["layers","collisionBoxArray","features","compareText"]}),Lc.MAX_GLYPHS=65535,Lc.addDynamicAttributes=Yf;var Jf={get paint(){return Hg=Hg||new Ti({"icon-opacity":new Gt(te.paint_symbol["icon-opacity"]),"icon-color":new Gt(te.paint_symbol["icon-color"]),"icon-halo-color":new Gt(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(te.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(te.paint_symbol["text-opacity"]),"text-color":new Gt(te.paint_symbol["text-color"],{runtimeType:fn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Gt(te.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(te.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(te.paint_symbol["text-halo-blur"]),"text-translate":new Vt(te.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(te.paint_symbol["text-translate-anchor"])})},get layout(){return Wg=Wg||new Ti({"symbol-placement":new Vt(te.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vt(te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Vt(te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Vt(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(te.layout_symbol["icon-size"]),"icon-text-fit":new Vt(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(te.layout_symbol["icon-image"]),"icon-rotate":new Gt(te.layout_symbol["icon-rotate"]),"icon-padding":new Gt(te.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(te.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(te.layout_symbol["icon-offset"]),"icon-anchor":new Gt(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(te.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(te.layout_symbol["text-field"]),"text-font":new Gt(te.layout_symbol["text-font"]),"text-size":new Gt(te.layout_symbol["text-size"]),"text-max-width":new Gt(te.layout_symbol["text-max-width"]),"text-line-height":new Vt(te.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(te.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(te.layout_symbol["text-justify"]),"text-radial-offset":new Gt(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(te.layout_symbol["text-anchor"]),"text-max-angle":new Vt(te.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(te.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(te.layout_symbol["text-rotate"]),"text-padding":new Vt(te.layout_symbol["text-padding"]),"text-keep-upright":new Vt(te.layout_symbol["text-keep-upright"]),"text-transform":new Gt(te.layout_symbol["text-transform"]),"text-offset":new Gt(te.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(te.layout_symbol["text-allow-overlap"]),"text-overlap":new Vt(te.layout_symbol["text-overlap"]),"text-ignore-placement":new Vt(te.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(te.layout_symbol["text-optional"])})}};class Qh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Jt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}It("FormatSectionOverride",Qh,{omit:["defaultValue"]});class vp extends Eo{constructor(t){super(t,Jf)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const y of l)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,l,p){const y=this.layout.get(t).evaluate(s,{},l,p),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||wa(v.value)||!y?y:function(S,E){return E.replace(/{([^{}]+)}/g,(I,A)=>S&&A in S?String(S[A]):"")}(s.properties,y)}createBucket(t){return new Lc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Jf.paint.overridableProperties){if(!vp.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),l=new Qh(s),p=new So(l,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new fs("source",p):new Jl("composite",p,s.value.zoomStops),this.paint._values[t]=new Yo(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&vp.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const l=t.get("text-field"),p=Jf.paint.properties[s];let y=!1;const v=S=>{for(const E of S)if(p.overrides&&p.overrides.hasOverride(E))return void(y=!0)};if(l.value.kind==="constant"&&l.value.value instanceof hr)v(l.value.value.sections);else if(l.value.kind==="source"){const S=I=>{y||(I instanceof Go&&tr(I.value)===Bs?v(I.value.sections):I instanceof tl?v(I.sections):I.eachChild(S))},E=l.value;E._styleExpression&&S(E._styleExpression.expression)}return y}}let Qf;var Yg={get paint(){return Qf=Qf||new Ti({"background-color":new Vt(te.paint_background["background-color"]),"background-pattern":new Xo(te.paint_background["background-pattern"]),"background-opacity":new Vt(te.paint_background["background-opacity"])})}};class em extends Eo{constructor(t){super(t,Yg)}}let tm;var Xg={get paint(){return tm=tm||new Ti({"raster-opacity":new Vt(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vt(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(te.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(te.paint_raster["raster-saturation"]),"raster-contrast":new Vt(te.paint_raster["raster-contrast"]),"raster-resampling":new Vt(te.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(te.paint_raster["raster-fade-duration"])})}};class Kg extends Eo{constructor(t){super(t,Xg)}}class Jg extends Eo{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class tv{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const nm=63710088e-1;class Pl{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pl(Lt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,l=this.lat*s,p=t.lat*s,y=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((t.lng-this.lng)*s);return nm*Math.acos(Math.min(y,1))}static convert(t){if(t instanceof Pl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Pl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Pl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ed=2*Math.PI*nm;function td(o){return ed*Math.cos(o*Math.PI/180)}function Qg(o){return(180+o)/360}function e_(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function xp(o,t){return o/td(t)}function wp(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function t_(o,t){return o*td(wp(t))}class nd{constructor(t,s,l=0){this.x=+t,this.y=+s,this.z=+l}static fromLngLat(t,s=0){const l=Pl.convert(t);return new nd(Qg(l.lng),e_(l.lat),xp(s,l.lat))}toLngLat(){return new Pl(360*this.x-180,wp(this.y))}toAltitude(){return t_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ed*(t=wp(this.y),1/Math.cos(t*Math.PI/180));var t}}function n_(o,t,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[o*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class rm{constructor(t,s,l){if(!function(p,y,v){return!(p<0||p>25||v<0||v>=Math.pow(2,p)||y<0||y>=Math.pow(2,p))}(t,s,l))throw new Error(`x=${s}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=l,this.key=Dc(0,t,t,s,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,l){const p=(v=this.y,S=this.z,E=n_(256*(y=this.x),256*(v=Math.pow(2,S)-v-1),S),I=n_(256*(y+1),256*(v+1),S),E[0]+","+E[1]+","+I[0]+","+I[1]);var y,v,S,E,I;const A=function(R,B,N){let U,q="";for(let Q=R;Q>0;Q--)U=1<<Q-1,q+=(B&U?1:0)+(N&U?2:0);return q}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new Be((t.x*s-this.x)*ze,(t.y*s-this.y)*ze)}toString(){return`${this.z}/${this.x}/${this.y}`}}class r_{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Dc(t,s.z,s.z,s.x,s.y)}}class Ao{constructor(t,s,l,p,y){if(this.terrainRttPosMatrix32f=null,t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=s,this.canonical=new rm(l,+p,+y),this.key=Dc(s,t,l,p,y)}clone(){return new Ao(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new Ao(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ao(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?Dc(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):Dc(this.wrap*+s,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Ao(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new Ao(s,this.wrap,s,l,p),new Ao(s,this.wrap,s,l+1,p),new Ao(s,this.wrap,s,l,p+1),new Ao(s,this.wrap,s,l+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ao(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ao(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new r_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new nd(t.x-this.wrap,t.y))}}function Dc(o,t,s,l,p){(o*=2)<0&&(o=-1*o-1);const y=1<<s;return(y*y*o+y*p+l).toString(36)+s.toString(36)+t.toString(36)}It("CanonicalTileID",rm),It("OverscaledTileID",Ao,{omit:["terrainRttPosMatrix32f"]});class i_{constructor(t,s,l,p=1,y=1,v=1,S=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Ht(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const E=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=y,this.blueFactor=v,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<E;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(E,I)]=this.data[this._idx(E-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,E)]=this.data[this._idx(I,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<E;I++)for(let A=0;A<E;A++){const R=this.get(I,A);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(t,s){const l=new Uint8Array(this.data.buffer),p=4*this._idx(t,s);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,l){return t*this.redFactor+s*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new po({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,y=s*this.dim+this.dim,v=l*this.dim,S=l*this.dim+this.dim;switch(s){case-1:p=y-1;break;case 1:y=p+1}switch(l){case-1:v=S-1;break;case 1:S=v+1}const E=-s*this.dim,I=-l*this.dim;for(let A=v;A<S;A++)for(let R=p;R<y;R++)this.data[this._idx(R,A)]=t.data[this._idx(R+E,A+I)]}}It("DEMData",i_);class o_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const l=t[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class s_{constructor(t,s,l,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=l,t._y=p,this.properties=t.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class a_{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ia(ze,16,0),this.grid3D=new Ia(ze,16,0),this.featureIndexArray=new ie,this.promoteId=s}insert(t,s,l,p,y,v){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,y);const E=v?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const A=s[I],R=[1/0,1/0,-1/0,-1/0];for(let B=0;B<A.length;B++){const N=A[B];R[0]=Math.min(R[0],N.x),R[1]=Math.min(R[1],N.y),R[2]=Math.max(R[2],N.x),R[3]=Math.max(R[3],N.y)}R[0]<ze&&R[1]<ze&&R[2]>=0&&R[3]>=0&&E.insert(S,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hh.VectorTile(new Uf(this.rawTileData)).layers,this.sourceLayerCoder=new o_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,l,p){this.loadVTLayers();const y=t.params,v=ze/t.tileSize/t.scale,S=Ca(y.filter),E=t.queryGeometry,I=t.queryPadding*v,A=es(E),R=this.grid.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I),B=es(t.cameraQueryGeometry),N=this.grid3D.query(B.minX-I,B.minY-I,B.maxX+I,B.maxY+I,(Q,ae,Me,de)=>function(O,J,_e,Ze,dt){for(const Xe of O)if(J<=Xe.x&&_e<=Xe.y&&Ze>=Xe.x&&dt>=Xe.y)return!0;const Je=[new Be(J,_e),new Be(J,dt),new Be(Ze,dt),new Be(Ze,_e)];if(O.length>2){for(const Xe of Je)if(Cc(O,Xe))return!0}for(let Xe=0;Xe<O.length-1;Xe++)if(fg(O[Xe],O[Xe+1],Je))return!0;return!1}(t.cameraQueryGeometry,Q-I,ae-I,Me+I,de+I));for(const Q of N)R.push(Q);R.sort(nv);const U={};let q;for(let Q=0;Q<R.length;Q++){const ae=R[Q];if(ae===q)continue;q=ae;const Me=this.featureIndexArray.get(ae);let de=null;this.loadMatchingFeature(U,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,S,y.layers,y.availableImages,s,l,p,(O,J,_e)=>(de||(de=Ys(O)),J.queryIntersectsFeature({queryGeometry:E,feature:O,featureState:_e,geometry:de,zoom:this.z,transform:t.transform,pixelsToTileUnits:v,pixelPosMatrix:t.pixelPosMatrix})))}return U}loadMatchingFeature(t,s,l,p,y,v,S,E,I,A,R){const B=this.bucketLayerIDs[s];if(v&&!B.some(Q=>v.has(Q)))return;const N=this.sourceLayerCoder.decode(l),U=this.vtLayers[N].feature(p);if(y.needGeometry){const Q=Xs(U,!0);if(!y.filter(new nr(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!y.filter(new nr(this.tileID.overscaledZ),U))return;const q=this.getId(U,N);for(let Q=0;Q<B.length;Q++){const ae=B[Q];if(v&&!v.has(ae))continue;const Me=E[ae];if(!Me)continue;let de={};q&&A&&(de=A.getState(Me.sourceLayer||"_geojsonTileLayer",q));const O=bt({},I[ae]);O.paint=l_(O.paint,Me.paint,U,de,S),O.layout=l_(O.layout,Me.layout,U,de,S);const J=!R||R(U,Me,de);if(!J)continue;const _e=new s_(U,this.z,this.x,this.y,q);_e.layer=O;let Ze=t[ae];Ze===void 0&&(Ze=t[ae]=[]),Ze.push({featureIndex:p,feature:_e,intersectionZ:J})}}lookupSymbolFeatures(t,s,l,p,y,v,S,E){const I={};this.loadVTLayers();const A=Ca(y);for(const R of t)this.loadMatchingFeature(I,l,p,R,A,v,S,E,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const l of s)if(t===l)return!0;return!1}getId(t,s){var l;let p=t.id;return this.promoteId&&(p=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((l=t.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(p=Number(t.properties.cluster_id))),p}}function l_(o,t,s,l,p){return Ft(o,(y,v)=>{const S=t instanceof Ra?t.get(v):null;return S&&S.evaluate?S.evaluate(s,l,p):S})}function es(o){let t=1/0,s=1/0,l=-1/0,p=-1/0;for(const y of o)t=Math.min(t,y.x),s=Math.min(s,y.y),l=Math.max(l,y.x),p=Math.max(p,y.y);return{minX:t,minY:s,maxX:l,maxY:p}}function nv(o,t){return t-o}function u_(o,t,s,l,p){const y=[];for(let v=0;v<o.length;v++){const S=o[v];let E;for(let I=0;I<S.length-1;I++){let A=S[I],R=S[I+1];A.x<t&&R.x<t||(A.x<t?A=new Be(t,A.y+(t-A.x)/(R.x-A.x)*(R.y-A.y))._round():R.x<t&&(R=new Be(t,A.y+(t-A.x)/(R.x-A.x)*(R.y-A.y))._round()),A.y<s&&R.y<s||(A.y<s?A=new Be(A.x+(s-A.y)/(R.y-A.y)*(R.x-A.x),s)._round():R.y<s&&(R=new Be(A.x+(s-A.y)/(R.y-A.y)*(R.x-A.x),s)._round()),A.x>=l&&R.x>=l||(A.x>=l?A=new Be(l,A.y+(l-A.x)/(R.x-A.x)*(R.y-A.y))._round():R.x>=l&&(R=new Be(l,A.y+(l-A.x)/(R.x-A.x)*(R.y-A.y))._round()),A.y>=p&&R.y>=p||(A.y>=p?A=new Be(A.x+(p-A.y)/(R.y-A.y)*(R.x-A.x),p)._round():R.y>=p&&(R=new Be(A.x+(p-A.y)/(R.y-A.y)*(R.x-A.x),p)._round()),E&&A.equals(E[E.length-1])||(E=[A],y.push(E)),E.push(R)))))}}return y}It("FeatureIndex",a_,{omit:["rawTileData","sourceLayerCoder"]});class mo extends Be{constructor(t,s,l,p){super(t,s),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new mo(this.x,this.y,this.angle,this.segment)}}function mn(o,t,s,l,p){if(t.segment===void 0||s===0)return!0;let y=t,v=t.segment+1,S=0;for(;S>-s/2;){if(v--,v<0)return!1;S-=o[v].dist(y),y=o[v]}S+=o[v].dist(o[v+1]),v++;const E=[];let I=0;for(;S<s/2;){const A=o[v],R=o[v+1];if(!R)return!1;let B=o[v-1].angleTo(A)-A.angleTo(R);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:B}),I+=B;S-E[0].distance>l;)I-=E.shift().angleDelta;if(I>p)return!1;v++,S+=A.dist(R)}return!0}function c_(o){let t=0;for(let s=0;s<o.length-1;s++)t+=o[s].dist(o[s+1]);return t}function Hi(o,t,s){return o?.6*t*s:0}function Rr(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function rv(o,t,s,l,p,y){const v=Hi(s,p,y),S=Rr(s,l)*y;let E=0;const I=c_(o)/2;for(let A=0;A<o.length-1;A++){const R=o[A],B=o[A+1],N=R.dist(B);if(E+N>I){const U=(I-E)/N,q=oo.number(R.x,B.x,U),Q=oo.number(R.y,B.y,U),ae=new mo(q,Q,B.angleTo(R),A);return ae._round(),!v||mn(o,ae,S,v,t)?ae:void 0}E+=N}}function El(o,t,s,l,p,y,v,S,E){const I=Hi(l,y,v),A=Rr(l,p),R=A*v,B=o[0].x===0||o[0].x===E||o[0].y===0||o[0].y===E;return t-R<t/4&&(t=R+t/4),h_(o,B?t/2*S%t:(A/2+2*y)*v*S%t,t,I,s,R,B,!1,E)}function h_(o,t,s,l,p,y,v,S,E){const I=y/2,A=c_(o);let R=0,B=t-s,N=[];for(let U=0;U<o.length-1;U++){const q=o[U],Q=o[U+1],ae=q.dist(Q),Me=Q.angleTo(q);for(;B+s<R+ae;){B+=s;const de=(B-R)/ae,O=oo.number(q.x,Q.x,de),J=oo.number(q.y,Q.y,de);if(O>=0&&O<E&&J>=0&&J<E&&B-I>=0&&B+I<=A){const _e=new mo(O,J,Me,U);_e._round(),l&&!mn(o,_e,y,l,p)||N.push(_e)}}R+=ae}return S||N.length||v||(N=h_(o,R/2,s,l,p,y,v,!0,E)),N}It("Anchor",mo);const rd=Wi;function d_(o,t,s,l){const p=[],y=o.image,v=y.pixelRatio,S=y.paddedRect.w-2*rd,E=y.paddedRect.h-2*rd;let I={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const A=y.stretchX||[[0,S]],R=y.stretchY||[[0,E]],B=(it,Bt)=>it+Bt[1]-Bt[0],N=A.reduce(B,0),U=R.reduce(B,0),q=S-N,Q=E-U;let ae=0,Me=N,de=0,O=U,J=0,_e=q,Ze=0,dt=Q;if(y.content&&l){const it=y.content,Bt=it[2]-it[0],qt=it[3]-it[1];(y.textFitWidth||y.textFitHeight)&&(I=Wf(o)),ae=bp(A,0,it[0]),de=bp(R,0,it[1]),Me=bp(A,it[0],it[2]),O=bp(R,it[1],it[3]),J=it[0]-ae,Ze=it[1]-de,_e=Bt-Me,dt=qt-O}const Je=I.x1,Xe=I.y1,pt=I.x2-Je,mt=I.y2-Xe,wt=(it,Bt,qt,Zt)=>{const jt=Fc(it.stretch-ae,Me,pt,Je),wn=Sp(it.fixed-J,_e,it.stretch,N),yr=Fc(Bt.stretch-de,O,mt,Xe),Gr=Sp(Bt.fixed-Ze,dt,Bt.stretch,U),mi=Fc(qt.stretch-ae,Me,pt,Je),_o=Sp(qt.fixed-J,_e,qt.stretch,N),Ii=Fc(Zt.stretch-de,O,mt,Xe),ai=Sp(Zt.fixed-Ze,dt,Zt.stretch,U),mr=new Be(jt,yr),ei=new Be(mi,yr),li=new Be(mi,Ii),wr=new Be(jt,Ii),ki=new Be(wn/v,Gr/v),zo=new Be(_o/v,ai/v),ti=t*Math.PI/180;if(ti){const Zr=Math.sin(ti),qr=Math.cos(ti),Lr=[qr,-Zr,Zr,qr];mr._matMult(Lr),ei._matMult(Lr),wr._matMult(Lr),li._matMult(Lr)}const Yi=it.stretch+it.fixed,$r=Bt.stretch+Bt.fixed;return{tl:mr,tr:ei,bl:wr,br:li,tex:{x:y.paddedRect.x+rd+Yi,y:y.paddedRect.y+rd+$r,w:qt.stretch+qt.fixed-Yi,h:Zt.stretch+Zt.fixed-$r},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ki,pixelOffsetBR:zo,minFontScaleX:_e/v/pt,minFontScaleY:dt/v/mt,isSDF:s}};if(l&&(y.stretchX||y.stretchY)){const it=p_(A,q,N),Bt=p_(R,Q,U);for(let qt=0;qt<it.length-1;qt++){const Zt=it[qt],jt=it[qt+1];for(let wn=0;wn<Bt.length-1;wn++)p.push(wt(Zt,Bt[wn],jt,Bt[wn+1]))}}else p.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:E+1}));return p}function bp(o,t,s){let l=0;for(const p of o)l+=Math.max(t,Math.min(s,p[1]))-Math.max(t,Math.min(s,p[0]));return l}function p_(o,t,s){const l=[{fixed:-1,stretch:0}];for(const[p,y]of o){const v=l[l.length-1];l.push({fixed:p-v.stretch,stretch:v.stretch}),l.push({fixed:p-v.stretch,stretch:v.stretch+(y-p)})}return l.push({fixed:t+rd,stretch:s}),l}function Fc(o,t,s,l){return o/t*s+l}function Sp(o,t,s,l){return o-t*s/l}class ts{constructor(t,s,l,p,y,v,S,E,I,A){var R;if(this.boxStartIndex=t.length,I){let B=v.top,N=v.bottom;const U=v.collisionPadding;U&&(B-=U[1],N+=U[3]);let q=N-B;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const B=!((R=v.image)===null||R===void 0)&&R.content&&(v.image.textFitWidth||v.image.textFitHeight)?Wf(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};B.y1=B.y1*S-E[0],B.y2=B.y2*S+E[2],B.x1=B.x1*S-E[3],B.x2=B.x2*S+E[1];const N=v.collisionPadding;if(N&&(B.x1-=N[0]*S,B.y1-=N[1]*S,B.x2+=N[2]*S,B.y2+=N[3]*S),A){const U=new Be(B.x1,B.y1),q=new Be(B.x2,B.y1),Q=new Be(B.x1,B.y2),ae=new Be(B.x2,B.y2),Me=A*Math.PI/180;U._rotate(Me),q._rotate(Me),Q._rotate(Me),ae._rotate(Me),B.x1=Math.min(U.x,q.x,Q.x,ae.x),B.x2=Math.max(U.x,q.x,Q.x,ae.x),B.y1=Math.min(U.y,q.y,Q.y,ae.y),B.y2=Math.max(U.y,q.y,Q.y,ae.y)}t.emplaceBack(s.x,s.y,B.x1,B.y1,B.x2,B.y2,l,p,y)}this.boxEndIndex=t.length}}class f_{constructor(t=[],s=(l,p)=>l<p?-1:l>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:l}=this,p=s[t];for(;t>0;){const y=t-1>>1,v=s[y];if(l(p,v)>=0)break;s[t]=v,t=y}s[t]=p}_down(t){const{data:s,compare:l}=this,p=this.length>>1,y=s[t];for(;t<p;){let v=1+(t<<1);const S=v+1;if(S<this.length&&l(s[S],s[v])<0&&(v=S),l(s[v],y)>=0)break;s[t]=s[v],t=v}s[t]=y}}function Tp(o,t=1,s=!1){let l=1/0,p=1/0,y=-1/0,v=-1/0;const S=o[0];for(let N=0;N<S.length;N++){const U=S[N];(!N||U.x<l)&&(l=U.x),(!N||U.y<p)&&(p=U.y),(!N||U.x>y)&&(y=U.x),(!N||U.y>v)&&(v=U.y)}const E=Math.min(y-l,v-p);let I=E/2;const A=new f_([],Ir);if(E===0)return new Be(l,p);for(let N=l;N<y;N+=E)for(let U=p;U<v;U+=E)A.push(new ur(N+I,U+I,I,o));let R=function(N){let U=0,q=0,Q=0;const ae=N[0];for(let Me=0,de=ae.length,O=de-1;Me<de;O=Me++){const J=ae[Me],_e=ae[O],Ze=J.x*_e.y-_e.x*J.y;q+=(J.x+_e.x)*Ze,Q+=(J.y+_e.y)*Ze,U+=3*Ze}return new ur(q/U,Q/U,0,N)}(o),B=A.length;for(;A.length;){const N=A.pop();(N.d>R.d||!R.d)&&(R=N,s&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,B)),N.max-R.d<=t||(I=N.h/2,A.push(new ur(N.p.x-I,N.p.y-I,I,o)),A.push(new ur(N.p.x+I,N.p.y-I,I,o)),A.push(new ur(N.p.x-I,N.p.y+I,I,o)),A.push(new ur(N.p.x+I,N.p.y+I,I,o)),B+=4)}return s&&(console.log(`num probes: ${B}`),console.log(`best distance: ${R.d}`)),R.p}function Ir(o,t){return t.max-o.max}function ur(o,t,s,l){this.p=new Be(o,t),this.h=s,this.d=function(p,y){let v=!1,S=1/0;for(let E=0;E<y.length;E++){const I=y[E];for(let A=0,R=I.length,B=R-1;A<R;B=A++){const N=I[A],U=I[B];N.y>p.y!=U.y>p.y&&p.x<(U.x-N.x)*(p.y-N.y)/(U.y-N.y)+N.x&&(v=!v),S=Math.min(S,hu(p,N,U))}}return(v?1:-1)*Math.sqrt(S)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var si;b.aw=void 0,(si=b.aw||(b.aw={}))[si.center=1]="center",si[si.left=2]="left",si[si.right=3]="right",si[si.top=4]="top",si[si.bottom=5]="bottom",si[si["top-left"]=6]="top-left",si[si["top-right"]=7]="top-right",si[si["bottom-left"]=8]="bottom-left",si[si["bottom-right"]=9]="bottom-right";const Ml=7,im=Number.POSITIVE_INFINITY;function m_(o,t){return t[1]!==im?function(s,l,p){let y=0,v=0;switch(l=Math.abs(l),p=Math.abs(p),s){case"top-right":case"top-left":case"top":v=p-Ml;break;case"bottom-right":case"bottom-left":case"bottom":v=-p+Ml}switch(s){case"top-right":case"bottom-right":case"right":y=-l;break;case"top-left":case"bottom-left":case"left":y=l}return[y,v]}(o,t[0],t[1]):function(s,l){let p=0,y=0;l<0&&(l=0);const v=l/Math.SQRT2;switch(s){case"top-right":case"top-left":y=v-Ml;break;case"bottom-right":case"bottom-left":y=-v+Ml;break;case"bottom":y=-l+Ml;break;case"top":y=l-Ml}switch(s){case"top-right":case"bottom-right":p=-v;break;case"top-left":case"bottom-left":p=v;break;case"left":p=l;break;case"right":p=-l}return[p,y]}(o,t[0])}function g_(o,t,s){var l;const p=o.layout,y=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},s);if(y){const S=y.values,E=[];for(let I=0;I<S.length;I+=2){const A=E[I]=S[I],R=S[I+1].map(B=>B*Vr);A.startsWith("top")?R[1]-=Ml:A.startsWith("bottom")&&(R[1]+=Ml),E[I+1]=R}return new pi(E)}const v=p.get("text-variable-anchor");if(v){let S;S=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},s)*Vr,im]:p.get("text-offset").evaluate(t,{},s).map(I=>I*Vr);const E=[];for(const I of v)E.push(I,m_(I,S));return new pi(E)}return null}function om(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function iv(o,t,s,l,p,y,v,S,E,I,A,R){let B=y.textMaxSize.evaluate(t,{});B===void 0&&(B=v);const N=o.layers[0].layout,U=N.get("icon-offset").evaluate(t,{},A),q=Bc(s.horizontal),Q=v/24,ae=o.tilePixelRatio*Q,Me=o.tilePixelRatio*B/24,de=o.tilePixelRatio*S,O=o.tilePixelRatio*N.get("symbol-spacing"),J=N.get("text-padding")*o.tilePixelRatio,_e=function(qt,Zt,jt,wn=1){const yr=qt.get("icon-padding").evaluate(Zt,{},jt),Gr=yr&&yr.values;return[Gr[0]*wn,Gr[1]*wn,Gr[2]*wn,Gr[3]*wn]}(N,t,A,o.tilePixelRatio),Ze=N.get("text-max-angle")/180*Math.PI,dt=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",Je=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Xe=N.get("symbol-placement"),pt=O/2,mt=N.get("icon-text-fit");let wt;l&&mt!=="none"&&(o.allowVerticalPlacement&&s.vertical&&(wt=Hf(l,s.vertical,mt,N.get("icon-text-fit-padding"),U,Q)),q&&(l=Hf(l,q,mt,N.get("icon-text-fit-padding"),U,Q)));const it=A?R.line.getGranularityForZoomLevel(A.z):1,Bt=(qt,Zt)=>{Zt.x<0||Zt.x>=ze||Zt.y<0||Zt.y>=ze||function(jt,wn,yr,Gr,mi,_o,Ii,ai,mr,ei,li,wr,ki,zo,ti,Yi,$r,Zr,qr,Lr,rr,ws,Nc,bs,ov){const jc=jt.addToLineVertexArray(wn,yr);let wu,Uc,Vc,Gc,x_=0,w_=0,b_=0,S_=0,cm=-1,hm=-1;const ja={};let T_=jn("");if(jt.allowVerticalPlacement&&Gr.vertical){const vi=ai.layout.get("text-rotate").evaluate(rr,{},bs)+90;Vc=new ts(mr,wn,ei,li,wr,Gr.vertical,ki,zo,ti,vi),Ii&&(Gc=new ts(mr,wn,ei,li,wr,Ii,$r,Zr,ti,vi))}if(mi){const vi=ai.layout.get("icon-rotate").evaluate(rr,{}),gr=ai.layout.get("icon-text-fit")!=="none",Ua=d_(mi,vi,Nc,gr),Ts=Ii?d_(Ii,vi,Nc,gr):void 0;Uc=new ts(mr,wn,ei,li,wr,mi,$r,Zr,!1,vi),x_=4*Ua.length;const bu=jt.iconSizeData;let na=null;bu.kind==="source"?(na=[ea*ai.layout.get("icon-size").evaluate(rr,{})],na[0]>Cl&&Ht(`${jt.layerIds[0]}: Value for "icon-size" is >= ${Jh}. Reduce your "icon-size".`)):bu.kind==="composite"&&(na=[ea*ws.compositeIconSizes[0].evaluate(rr,{},bs),ea*ws.compositeIconSizes[1].evaluate(rr,{},bs)],(na[0]>Cl||na[1]>Cl)&&Ht(`${jt.layerIds[0]}: Value for "icon-size" is >= ${Jh}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,Ua,na,Lr,qr,rr,b.af.none,wn,jc.lineStartIndex,jc.lineLength,-1,bs),cm=jt.icon.placedSymbolArray.length-1,Ts&&(w_=4*Ts.length,jt.addSymbols(jt.icon,Ts,na,Lr,qr,rr,b.af.vertical,wn,jc.lineStartIndex,jc.lineLength,-1,bs),hm=jt.icon.placedSymbolArray.length-1)}const C_=Object.keys(Gr.horizontal);for(const vi of C_){const gr=Gr.horizontal[vi];if(!wu){T_=jn(gr.text);const Ts=ai.layout.get("text-rotate").evaluate(rr,{},bs);wu=new ts(mr,wn,ei,li,wr,gr,ki,zo,ti,Ts)}const Ua=gr.positionedLines.length===1;if(b_+=sm(jt,wn,gr,_o,ai,ti,rr,Yi,jc,Gr.vertical?b.af.horizontal:b.af.horizontalOnly,Ua?C_:[vi],ja,cm,ws,bs),Ua)break}Gr.vertical&&(S_+=sm(jt,wn,Gr.vertical,_o,ai,ti,rr,Yi,jc,b.af.vertical,["vertical"],ja,hm,ws,bs));const sv=wu?wu.boxStartIndex:jt.collisionBoxArray.length,av=wu?wu.boxEndIndex:jt.collisionBoxArray.length,lv=Vc?Vc.boxStartIndex:jt.collisionBoxArray.length,uv=Vc?Vc.boxEndIndex:jt.collisionBoxArray.length,cv=Uc?Uc.boxStartIndex:jt.collisionBoxArray.length,dm=Uc?Uc.boxEndIndex:jt.collisionBoxArray.length,P_=Gc?Gc.boxStartIndex:jt.collisionBoxArray.length,E_=Gc?Gc.boxEndIndex:jt.collisionBoxArray.length;let Ss=-1;const Mp=(vi,gr)=>vi&&vi.circleDiameter?Math.max(vi.circleDiameter,gr):gr;Ss=Mp(wu,Ss),Ss=Mp(Vc,Ss),Ss=Mp(Uc,Ss),Ss=Mp(Gc,Ss);const M_=Ss>-1?1:0;M_&&(Ss*=ov/Vr),jt.glyphOffsetArray.length>=Lc.MAX_GLYPHS&&Ht("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),rr.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,rr.sortKey);const pm=g_(ai,rr,bs),[hv,dv]=function(vi,gr){const Ua=vi.length,Ts=gr==null?void 0:gr.values;if((Ts==null?void 0:Ts.length)>0)for(let bu=0;bu<Ts.length;bu+=2){const na=Ts[bu+1];vi.emplaceBack(b.aw[Ts[bu]],na[0],na[1])}return[Ua,vi.length]}(jt.textAnchorOffsets,pm);jt.symbolInstances.emplaceBack(wn.x,wn.y,ja.right>=0?ja.right:-1,ja.center>=0?ja.center:-1,ja.left>=0?ja.left:-1,ja.vertical||-1,cm,hm,T_,sv,av,lv,uv,cv,dm,P_,E_,ei,b_,S_,x_,w_,M_,0,ki,Ss,hv,dv)}(o,Zt,qt,s,l,p,wt,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,ae,[J,J,J,J],dt,E,de,_e,Je,U,t,y,I,A,v)};if(Xe==="line")for(const qt of u_(t.geometry,0,0,ze,ze)){const Zt=Sl(qt,it),jt=El(Zt,O,Ze,s.vertical||q,l,24,Me,o.overscaling,ze);for(const wn of jt)q&&am(o,q.text,pt,wn)||Bt(Zt,wn)}else if(Xe==="line-center"){for(const qt of t.geometry)if(qt.length>1){const Zt=Sl(qt,it),jt=rv(Zt,Ze,s.vertical||q,l,24,Me);jt&&Bt(Zt,jt)}}else if(t.type==="Polygon")for(const qt of fi(t.geometry,0)){const Zt=Tp(qt,16);Bt(Sl(qt[0],it,!0),new mo(Zt.x,Zt.y,0))}else if(t.type==="LineString")for(const qt of t.geometry){const Zt=Sl(qt,it);Bt(Zt,new mo(Zt[0].x,Zt[0].y,0))}else if(t.type==="Point")for(const qt of t.geometry)for(const Zt of qt)Bt([Zt],new mo(Zt.x,Zt.y,0))}function sm(o,t,s,l,p,y,v,S,E,I,A,R,B,N,U){const q=function(Me,de,O,J,_e,Ze,dt,Je){const Xe=J.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,pt=[];for(const mt of de.positionedLines)for(const wt of mt.positionedGlyphs){if(!wt.rect)continue;const it=wt.rect||{};let Bt=V0+1,qt=!0,Zt=1,jt=0;const wn=(_e||Je)&&wt.vertical,yr=wt.metrics.advance*wt.scale/2;if(Je&&de.verticalizable&&(jt=mt.lineOffset/2-(wt.imageName?-(Vr-wt.metrics.width*wt.scale)/2:(wt.scale-1)*Vr)),wt.imageName){const Zr=dt[wt.imageName];qt=Zr.sdf,Zt=Zr.pixelRatio,Bt=Wi/Zt}const Gr=_e?[wt.x+yr,wt.y]:[0,0];let mi=_e?[0,0]:[wt.x+yr+O[0],wt.y+O[1]-jt],_o=[0,0];wn&&(_o=mi,mi=[0,0]);const Ii=wt.metrics.isDoubleResolution?2:1,ai=(wt.metrics.left-Bt)*wt.scale-yr+mi[0],mr=(-wt.metrics.top-Bt)*wt.scale+mi[1],ei=ai+it.w/Ii*wt.scale/Zt,li=mr+it.h/Ii*wt.scale/Zt,wr=new Be(ai,mr),ki=new Be(ei,mr),zo=new Be(ai,li),ti=new Be(ei,li);if(wn){const Zr=new Be(-yr,yr-gp),qr=-Math.PI/2,Lr=Vr/2-yr,rr=new Be(5-gp-Lr,-(wt.imageName?Lr:0)),ws=new Be(..._o);wr._rotateAround(qr,Zr)._add(rr)._add(ws),ki._rotateAround(qr,Zr)._add(rr)._add(ws),zo._rotateAround(qr,Zr)._add(rr)._add(ws),ti._rotateAround(qr,Zr)._add(rr)._add(ws)}if(Xe){const Zr=Math.sin(Xe),qr=Math.cos(Xe),Lr=[qr,-Zr,Zr,qr];wr._matMult(Lr),ki._matMult(Lr),zo._matMult(Lr),ti._matMult(Lr)}const Yi=new Be(0,0),$r=new Be(0,0);pt.push({tl:wr,tr:ki,bl:zo,br:ti,tex:it,writingMode:de.writingMode,glyphOffset:Gr,sectionIndex:wt.sectionIndex,isSDF:qt,pixelOffsetTL:Yi,pixelOffsetBR:$r,minFontScaleX:0,minFontScaleY:0})}return pt}(0,s,S,p,y,v,l,o.allowVerticalPlacement),Q=o.textSizeData;let ae=null;Q.kind==="source"?(ae=[ea*p.layout.get("text-size").evaluate(v,{})],ae[0]>Cl&&Ht(`${o.layerIds[0]}: Value for "text-size" is >= ${Jh}. Reduce your "text-size".`)):Q.kind==="composite"&&(ae=[ea*N.compositeTextSizes[0].evaluate(v,{},U),ea*N.compositeTextSizes[1].evaluate(v,{},U)],(ae[0]>Cl||ae[1]>Cl)&&Ht(`${o.layerIds[0]}: Value for "text-size" is >= ${Jh}. Reduce your "text-size".`)),o.addSymbols(o.text,q,ae,S,y,v,I,t,E.lineStartIndex,E.lineLength,B,U);for(const Me of A)R[Me]=o.text.placedSymbolArray.length-1;return 4*q.length}function Bc(o){for(const t in o)return o[t];return null}function am(o,t,s,l){const p=o.compareText;if(t in p){const y=p[t];for(let v=y.length-1;v>=0;v--)if(l.dist(y[v])<s)return!0}else p[t]=[];return p[t].push(l),!1}const __=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,l]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const y=__[15&l];if(!y)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[S]=new Uint32Array(t,4,1);return new Cp(S,v,y,t)}constructor(t,s=64,l=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const y=__.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,S=t*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-S%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+E,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+S+E),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+E,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=s,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Oc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:v,nodeSize:S}=this,E=[0,y.length-1,0],I=[];for(;E.length;){const A=E.pop()||0,R=E.pop()||0,B=E.pop()||0;if(R-B<=S){for(let Q=B;Q<=R;Q++){const ae=v[2*Q],Me=v[2*Q+1];ae>=t&&ae<=l&&Me>=s&&Me<=p&&I.push(y[Q])}continue}const N=B+R>>1,U=v[2*N],q=v[2*N+1];U>=t&&U<=l&&q>=s&&q<=p&&I.push(y[N]),(A===0?t<=U:s<=q)&&(E.push(B),E.push(N-1),E.push(1-A)),(A===0?l>=U:p>=q)&&(E.push(N+1),E.push(R),E.push(1-A))}return I}within(t,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:v}=this,S=[0,p.length-1,0],E=[],I=l*l;for(;S.length;){const A=S.pop()||0,R=S.pop()||0,B=S.pop()||0;if(R-B<=v){for(let Q=B;Q<=R;Q++)y_(y[2*Q],y[2*Q+1],t,s)<=I&&E.push(p[Q]);continue}const N=B+R>>1,U=y[2*N],q=y[2*N+1];y_(U,q,t,s)<=I&&E.push(p[N]),(A===0?t-l<=U:s-l<=q)&&(S.push(B),S.push(N-1),S.push(1-A)),(A===0?t+l>=U:s+l>=q)&&(S.push(N+1),S.push(R),S.push(1-A))}return E}}function Oc(o,t,s,l,p,y){if(p-l<=s)return;const v=l+p>>1;go(o,t,v,l,p,y),Oc(o,t,s,l,v-1,1-y),Oc(o,t,s,v+1,p,1-y)}function go(o,t,s,l,p,y){for(;p>l;){if(p-l>600){const I=p-l+1,A=s-l+1,R=Math.log(I),B=.5*Math.exp(2*R/3),N=.5*Math.sqrt(R*B*(I-B)/I)*(A-I/2<0?-1:1);go(o,t,s,Math.max(l,Math.floor(s-A*B/I+N)),Math.min(p,Math.floor(s+(I-A)*B/I+N)),y)}const v=t[2*s+y];let S=l,E=p;for(ta(o,t,l,s),t[2*p+y]>v&&ta(o,t,l,p);S<E;){for(ta(o,t,S,E),S++,E--;t[2*S+y]<v;)S++;for(;t[2*E+y]>v;)E--}t[2*l+y]===v?ta(o,t,l,E):(E++,ta(o,t,E,p)),E<=s&&(l=E+1),s<=E&&(p=E-1)}}function ta(o,t,s,l){lm(o,s,l),lm(t,2*s,2*l),lm(t,2*s+1,2*l+1)}function lm(o,t,s){const l=o[t];o[t]=o[s],o[s]=l}function y_(o,t,s,l){const p=o-s,y=t-l;return p*p+y*y}var um;b.cf=void 0,(um=b.cf||(b.cf={})).create="create",um.load="load",um.fullLoad="fullLoad";let Pp=null,id=[];const Ep=1e3/60,xs="loadTime",vn="fullLoadTime",v_={mark(o){performance.mark(o)},frame(o){const t=o;Pp!=null&&id.push(t-Pp),Pp=t},clearMetrics(){Pp=null,id=[],performance.clearMeasures(xs),performance.clearMeasures(vn);for(const o in b.cf)performance.clearMarks(b.cf[o])},getPerformanceMetrics(){performance.measure(xs,b.cf.create,b.cf.load),performance.measure(vn,b.cf.create,b.cf.fullLoad);const o=performance.getEntriesByName(xs)[0].duration,t=performance.getEntriesByName(vn)[0].duration,s=id.length,l=1/(id.reduce((y,v)=>y+v,0)/s/1e3),p=id.filter(y=>y>Ep).reduce((y,v)=>y+(v-Ep)/Ep,0);return{loadTime:o,fullLoadTime:t,fps:l,percentDroppedFrames:p/(s+p)*100,totalFrames:s}}};b.$=rm,b.A=ht,b.B=nr,b.C=Po,b.D=Vt,b.E=No,b.F=function(o){if(Rt==null){const t=o.navigator?o.navigator.userAgent:null;Rt=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Rt},b.G=class{constructor(o,t){this.target=o,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new tv(()=>this.process()),this.subscription=function(s,l,p,y){return s.addEventListener(l,p,!1),{unsubscribe:()=>{s.removeEventListener(l,p,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=gn(self)?o:window}registerMessageHandler(o,t){this.messageHandlers[o]=t}sendAsync(o,t){return new Promise((s,l)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[p]={resolve:s,reject:l},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[p];const S={id:p,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)},{once:!0});const y=[],v=Object.assign(Object.assign({},o),{id:p,sourceMapId:this.mapId,origin:location.origin,data:ru(o.data,y)});this.target.postMessage(v,{transfer:y})})}receive(o){const t=o.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const l=this.abortControllers[s];return delete this.abortControllers[s],void(l&&l.abort())}if(gn(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),t=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(o,t)}processTask(o,t){return u(this,void 0,void 0,function*(){if(t.type==="<response>"){const p=this.resolveRejects[o];return delete this.resolveRejects[o],p?void(t.error?p.reject(Zs(t.error)):p.resolve(Zs(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Zs(t.data),l=new AbortController;this.abortControllers[o]=l;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,s,l);this.completeTask(o,null,p)}catch(p){this.completeTask(o,p)}})}completeTask(o,t,s){const l=[];delete this.abortControllers[o];const p={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ru(t):null,data:ru(s,l)};this.target.postMessage(p,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.H=Bi,b.I=$f,b.J=function(){var o=new ht(16);return ht!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},b.K=function(o,t,s){var l,p,y,v,S,E,I,A,R,B,N,U,q=s[0],Q=s[1],ae=s[2];return t===o?(o[12]=t[0]*q+t[4]*Q+t[8]*ae+t[12],o[13]=t[1]*q+t[5]*Q+t[9]*ae+t[13],o[14]=t[2]*q+t[6]*Q+t[10]*ae+t[14],o[15]=t[3]*q+t[7]*Q+t[11]*ae+t[15]):(p=t[1],y=t[2],v=t[3],S=t[4],E=t[5],I=t[6],A=t[7],R=t[8],B=t[9],N=t[10],U=t[11],o[0]=l=t[0],o[1]=p,o[2]=y,o[3]=v,o[4]=S,o[5]=E,o[6]=I,o[7]=A,o[8]=R,o[9]=B,o[10]=N,o[11]=U,o[12]=l*q+S*Q+R*ae+t[12],o[13]=p*q+E*Q+B*ae+t[13],o[14]=y*q+I*Q+N*ae+t[14],o[15]=v*q+A*Q+U*ae+t[15]),o},b.L=function(o,t,s){var l=s[0],p=s[1],y=s[2];return o[0]=t[0]*l,o[1]=t[1]*l,o[2]=t[2]*l,o[3]=t[3]*l,o[4]=t[4]*p,o[5]=t[5]*p,o[6]=t[6]*p,o[7]=t[7]*p,o[8]=t[8]*y,o[9]=t[9]*y,o[10]=t[10]*y,o[11]=t[11]*y,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},b.M=function(o,t,s){var l=t[0],p=t[1],y=t[2],v=t[3],S=t[4],E=t[5],I=t[6],A=t[7],R=t[8],B=t[9],N=t[10],U=t[11],q=t[12],Q=t[13],ae=t[14],Me=t[15],de=s[0],O=s[1],J=s[2],_e=s[3];return o[0]=de*l+O*S+J*R+_e*q,o[1]=de*p+O*E+J*B+_e*Q,o[2]=de*y+O*I+J*N+_e*ae,o[3]=de*v+O*A+J*U+_e*Me,o[4]=(de=s[4])*l+(O=s[5])*S+(J=s[6])*R+(_e=s[7])*q,o[5]=de*p+O*E+J*B+_e*Q,o[6]=de*y+O*I+J*N+_e*ae,o[7]=de*v+O*A+J*U+_e*Me,o[8]=(de=s[8])*l+(O=s[9])*S+(J=s[10])*R+(_e=s[11])*q,o[9]=de*p+O*E+J*B+_e*Q,o[10]=de*y+O*I+J*N+_e*ae,o[11]=de*v+O*A+J*U+_e*Me,o[12]=(de=s[12])*l+(O=s[13])*S+(J=s[14])*R+(_e=s[15])*q,o[13]=de*p+O*E+J*B+_e*Q,o[14]=de*y+O*I+J*N+_e*ae,o[15]=de*v+O*A+J*U+_e*Me,o},b.N=function(o,t){const s={};for(let l=0;l<t.length;l++){const p=t[l];p in o&&(s[p]=o[p])}return s},b.O=Pl,b.P=Be,b.Q=e_,b.R=po,b.S=Qg,b.T=Bh,b.U=Te,b.V=Ne,b.W=Un,b.X=Ao,b.Y=ze,b.Z=nd,b._=u,b.a=Fi,b.a$=function(){const o=new Float64Array(16);return le(o),o},b.a0=o=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const l of o){const p=window.document.createElement("source");to(l)||(t.crossOrigin="Anonymous"),p.src=l,t.appendChild(p)}})},b.a1=ke,b.a2=function(){return zt++},b.a3=_,b.a4=Lc,b.a5=Ca,b.a6=Xs,b.a7=s_,b.a8=function(o){const t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,p,y)=>{const v=p||y;return t[l]=!v||v.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},b.a9=function(o){return Math.log(o)/Math.LN2},b.aA=Cp,b.aB=Cr,b.aC=lp,b.aD=re,b.aE=Et,b.aF=Qe,b.aG=function(o){return Math.pow(2,o)},b.aH=85.051129,b.aI=xp,b.aJ=Lt,b.aK=Kn,b.aL=t_,b.aM=function(o,t,s){return o[0]=t[0]*s,o[1]=t[1]*s,o[2]=t[2]*s,o},b.aN=function(o,t,s){return o[0]=t[0]+s[0],o[1]=t[1]+s[1],o[2]=t[2]+s[2],o},b.aO=function(o){var t=new ht(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t},b.aP=function(o,t,s){return o[0]=t[0]*s[0],o[1]=t[1]*s[1],o[2]=t[2]*s[2],o[3]=t[3]*s[3],o},b.aQ=function(o,t,s){return o[0]=t[0]-s[0],o[1]=t[1]-s[1],o[2]=t[2]-s[2],o},b.aR=function(o,t){var s=t[0],l=t[1],p=t[2],y=s*s+l*l+p*p;return y>0&&(y=1/Math.sqrt(y)),o[0]=t[0]*y,o[1]=t[1]*y,o[2]=t[2]*y,o},b.aS=function(o,t,s){var l=t[0],p=t[1],y=t[2],v=s[0],S=s[1],E=s[2];return o[0]=p*E-y*S,o[1]=y*v-l*E,o[2]=l*S-p*v,o},b.aT=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]},b.aU=r_,b.aV=Dc,b.aW=function(o,t,s,l,p){var y,v=1/Math.tan(t/2);return o[0]=v/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,p!=null&&p!==1/0?(o[10]=(p+l)*(y=1/(l-p)),o[14]=2*p*l*y):(o[10]=-1,o[14]=-2*l),o},b.aX=function(o){var t=new ht(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},b.aY=function(o,t,s){var l=Math.sin(s),p=Math.cos(s),y=t[0],v=t[1],S=t[2],E=t[3],I=t[4],A=t[5],R=t[6],B=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=y*p+I*l,o[1]=v*p+A*l,o[2]=S*p+R*l,o[3]=E*p+B*l,o[4]=I*p-y*l,o[5]=A*p-v*l,o[6]=R*p-S*l,o[7]=B*p-E*l,o},b.aZ=function(o,t,s){var l=Math.sin(s),p=Math.cos(s),y=t[4],v=t[5],S=t[6],E=t[7],I=t[8],A=t[9],R=t[10],B=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=y*p+I*l,o[5]=v*p+A*l,o[6]=S*p+R*l,o[7]=E*p+B*l,o[8]=I*p-y*l,o[9]=A*p-v*l,o[10]=R*p-S*l,o[11]=B*p-E*l,o},b.a_=function(){const o=new Float32Array(16);return le(o),o},b.aa=function(o){var t=o[0],s=o[1];return t*t+s*s},b.ab=function(o){return o*Math.PI/180},b.ac=At,b.ad=function(o,t){const s=[];for(const l in o)l in t||s.push(l);return s},b.ae=function(o,t){let s=0,l=0;if(o.kind==="constant")l=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:v}=o,S=p?At($n.interpolationFactor(p,t,y,v),0,1):0;o.kind==="camera"?l=oo.number(o.minSize,o.maxSize,S):s=S}return{uSizeT:s,uSize:l}},b.ag=function(o,{uSize:t,uSizeT:s},{lowerSize:l,upperSize:p}){return o.kind==="source"?l/ea:o.kind==="composite"?oo.number(l/ea,p/ea,s):t},b.ah=function(o,t){var s=t[0],l=t[1],p=t[2],y=t[3],v=t[4],S=t[5],E=t[6],I=t[7],A=t[8],R=t[9],B=t[10],N=t[11],U=t[12],q=t[13],Q=t[14],ae=t[15],Me=s*S-l*v,de=s*E-p*v,O=s*I-y*v,J=l*E-p*S,_e=l*I-y*S,Ze=p*I-y*E,dt=A*q-R*U,Je=A*Q-B*U,Xe=A*ae-N*U,pt=R*Q-B*q,mt=R*ae-N*q,wt=B*ae-N*Q,it=Me*wt-de*mt+O*pt+J*Xe-_e*Je+Ze*dt;return it?(o[0]=(S*wt-E*mt+I*pt)*(it=1/it),o[1]=(p*mt-l*wt-y*pt)*it,o[2]=(q*Ze-Q*_e+ae*J)*it,o[3]=(B*_e-R*Ze-N*J)*it,o[4]=(E*Xe-v*wt-I*Je)*it,o[5]=(s*wt-p*Xe+y*Je)*it,o[6]=(Q*O-U*Ze-ae*de)*it,o[7]=(A*Ze-B*O+N*de)*it,o[8]=(v*mt-S*Xe+I*dt)*it,o[9]=(l*Xe-s*mt-y*dt)*it,o[10]=(U*_e-q*O+ae*Me)*it,o[11]=(R*O-A*_e-N*Me)*it,o[12]=(S*Je-v*pt-E*dt)*it,o[13]=(s*pt-l*Je+p*dt)*it,o[14]=(q*de-U*J-Q*Me)*it,o[15]=(A*J-R*de+B*Me)*it,o):null},b.ai=Ye,b.aj=function(o){return Math.hypot(o[0],o[1])},b.ak=function(o){return o[0]=0,o[1]=0,o},b.al=function(o,t,s){return o[0]=t[0]*s,o[1]=t[1]*s,o},b.am=Yf,b.an=Fe,b.ao=function(o,t,s,l){const p=t.y-o.y,y=t.x-o.x,v=l.y-s.y,S=l.x-s.x,E=v*y-S*p;if(E===0)return null;const I=(S*(o.y-s.y)-v*(o.x-s.x))/E;return new Be(o.x+I*y,o.y+I*p)},b.ap=u_,b.aq=Vh,b.ar=le,b.as=function(o){let t=1/0,s=1/0,l=-1/0,p=-1/0;for(const y of o)t=Math.min(t,y.x),s=Math.min(s,y.y),l=Math.max(l,y.x),p=Math.max(p,y.y);return[t,s,l,p]},b.at=Vr,b.au=We,b.av=function(o,t,s,l,p=!1){if(!s[0]&&!s[1])return[0,0];const y=p?l==="map"?-o.bearingInRadians:0:l==="viewport"?o.bearingInRadians:0;if(y){const v=Math.sin(y),S=Math.cos(y);s=[s[0]*S-s[1]*v,s[0]*v+s[1]*S]}return[p?s[0]:We(t,s[0],o.zoom),p?s[1]:We(t,s[1],o.zoom)]},b.ax=Rc,b.ay=om,b.az=qf,b.b=rn,b.b$=o=>o.type==="heatmap",b.b0=function(){return new Float64Array(16)},b.b1=function(o,t,s){const l=new Float64Array(4);return function(p,y,v,S){var E=.5*Math.PI/180;y*=E,v*=E,S*=E;var I=Math.sin(y),A=Math.cos(y),R=Math.sin(v),B=Math.cos(v),N=Math.sin(S),U=Math.cos(S);p[0]=I*B*U-A*R*N,p[1]=A*R*U+I*B*N,p[2]=A*B*N-I*R*U,p[3]=A*B*U+I*R*N}(l,o,t-90,s),l},b.b2=function(o,t,s,l){var p,y,v,S,E,I=t[0],A=t[1],R=t[2],B=t[3],N=s[0],U=s[1],q=s[2],Q=s[3];return(y=I*N+A*U+R*q+B*Q)<0&&(y=-y,N=-N,U=-U,q=-q,Q=-Q),1-y>ct?(p=Math.acos(y),v=Math.sin(p),S=Math.sin((1-l)*p)/v,E=Math.sin(l*p)/v):(S=1-l,E=l),o[0]=S*I+E*N,o[1]=S*A+E*U,o[2]=S*R+E*q,o[3]=S*B+E*Q,o},b.b3=function(o){const t=new Float64Array(9);var s,l,p,y,v,S,E,I,A,R,B,N,U,q,Q,ae,Me,de;R=(p=(l=o)[0])*(E=p+p),B=(y=l[1])*E,U=(v=l[2])*E,q=v*(I=y+y),ae=(S=l[3])*E,Me=S*I,de=S*(A=v+v),(s=t)[0]=1-(N=y*I)-(Q=v*A),s[3]=B-de,s[6]=U+Me,s[1]=B+de,s[4]=1-R-Q,s[7]=q-ae,s[2]=U-Me,s[5]=q+ae,s[8]=1-R-N;const O=Kn(-Math.asin(At(t[2],-1,1)));let J,_e;return Math.hypot(t[5],t[8])<.001?(J=0,_e=-Kn(Math.atan2(t[3],t[4]))):(J=Kn(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),_e=Kn(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:J,pitch:O+90,bearing:_e}},b.b4=function(o,t){return o.roll==t.roll&&o.pitch==t.pitch&&o.bearing==t.bearing},b.b5=dn,b.b6=Io,b.b7=kc,b.b8=Wh,b.b9=gu,b.bA=function o(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let l=0;l<t.length;l++)if(!o(t[l],s[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(!o(t[l],s[l]))return!1;return!0}return t===s},b.bB=Ft,b.bC=Kt,b.bD=class extends Ci{constructor(o,t){super(o,t),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},b.bE=Ba,b.bF=class extends Ci{constructor(o,t){super(o,t),this.current=Hs}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let t=1;t<16;t++)if(o[t]!==this.current[t]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},b.bG=xl,b.bH=class extends Ci{constructor(o,t){super(o,t),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},b.bI=class extends Ci{constructor(o,t){super(o,t),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},b.bJ=$,b.bK=function(o,t){var s=Math.sin(t),l=Math.cos(t);return o[0]=l,o[1]=s,o[2]=0,o[3]=-s,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},b.bL=function(o,t,s){var l=t[0],p=t[1],y=t[2];return o[0]=l*s[0]+p*s[3]+y*s[6],o[1]=l*s[1]+p*s[4]+y*s[7],o[2]=l*s[2]+p*s[5]+y*s[8],o},b.bM=function(o,t,s,l,p,y,v){var S=1/(t-s),E=1/(l-p),I=1/(y-v);return o[0]=-2*S,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*I,o[11]=0,o[12]=(t+s)*S,o[13]=(p+l)*E,o[14]=(v+y)*I,o[15]=1,o},b.bN=class extends Nh{},b.bO=O0,b.bP=class extends Ws{},b.bQ=ip,b.bR=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},b.bS=mg,b.bT=function(o,t,s){var l=t[0],p=t[1],y=t[2],v=s[3]*l+s[7]*p+s[11]*y+s[15];return o[0]=(s[0]*l+s[4]*p+s[8]*y+s[12])/(v=v||1),o[1]=(s[1]*l+s[5]*p+s[9]*y+s[13])/v,o[2]=(s[2]*l+s[6]*p+s[10]*y+s[14])/v,o},b.bU=class extends jr{},b.bV=class extends r{},b.bW=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]&&o[4]===t[4]&&o[5]===t[5]&&o[6]===t[6]&&o[7]===t[7]&&o[8]===t[8]&&o[9]===t[9]&&o[10]===t[10]&&o[11]===t[11]&&o[12]===t[12]&&o[13]===t[13]&&o[14]===t[14]&&o[15]===t[15]},b.bX=function(o,t){var s=o[0],l=o[1],p=o[2],y=o[3],v=o[4],S=o[5],E=o[6],I=o[7],A=o[8],R=o[9],B=o[10],N=o[11],U=o[12],q=o[13],Q=o[14],ae=o[15],Me=t[0],de=t[1],O=t[2],J=t[3],_e=t[4],Ze=t[5],dt=t[6],Je=t[7],Xe=t[8],pt=t[9],mt=t[10],wt=t[11],it=t[12],Bt=t[13],qt=t[14],Zt=t[15];return Math.abs(s-Me)<=ct*Math.max(1,Math.abs(s),Math.abs(Me))&&Math.abs(l-de)<=ct*Math.max(1,Math.abs(l),Math.abs(de))&&Math.abs(p-O)<=ct*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(y-J)<=ct*Math.max(1,Math.abs(y),Math.abs(J))&&Math.abs(v-_e)<=ct*Math.max(1,Math.abs(v),Math.abs(_e))&&Math.abs(S-Ze)<=ct*Math.max(1,Math.abs(S),Math.abs(Ze))&&Math.abs(E-dt)<=ct*Math.max(1,Math.abs(E),Math.abs(dt))&&Math.abs(I-Je)<=ct*Math.max(1,Math.abs(I),Math.abs(Je))&&Math.abs(A-Xe)<=ct*Math.max(1,Math.abs(A),Math.abs(Xe))&&Math.abs(R-pt)<=ct*Math.max(1,Math.abs(R),Math.abs(pt))&&Math.abs(B-mt)<=ct*Math.max(1,Math.abs(B),Math.abs(mt))&&Math.abs(N-wt)<=ct*Math.max(1,Math.abs(N),Math.abs(wt))&&Math.abs(U-it)<=ct*Math.max(1,Math.abs(U),Math.abs(it))&&Math.abs(q-Bt)<=ct*Math.max(1,Math.abs(q),Math.abs(Bt))&&Math.abs(Q-qt)<=ct*Math.max(1,Math.abs(Q),Math.abs(qt))&&Math.abs(ae-Zt)<=ct*Math.max(1,Math.abs(ae),Math.abs(Zt))},b.bY=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},b.bZ=o=>o.type==="symbol",b.b_=o=>o.type==="circle",b.ba=Ke,b.bb=ye,b.bc=ii,b.bd=function(o,t,s,l,p){return Ke(l,p,At((o-t)/(s-t),0,1))},b.be=be,b.bf=function(){return new Float64Array(4)},b.bg=function(){return new Float64Array(3)},b.bh=function(o,t,s,l){var p=[],y=[];return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],y[0]=p[0]*Math.cos(l)-p[1]*Math.sin(l),y[1]=p[0]*Math.sin(l)+p[1]*Math.cos(l),y[2]=p[2],o[0]=y[0]+s[0],o[1]=y[1]+s[1],o[2]=y[2]+s[2],o},b.bi=function(o,t,s,l){var p=[],y=[];return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],y[0]=p[0],y[1]=p[1]*Math.cos(l)-p[2]*Math.sin(l),y[2]=p[1]*Math.sin(l)+p[2]*Math.cos(l),o[0]=y[0]+s[0],o[1]=y[1]+s[1],o[2]=y[2]+s[2],o},b.bj=function(o,t,s,l){var p=[],y=[];return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],y[0]=p[2]*Math.sin(l)+p[0]*Math.cos(l),y[1]=p[1],y[2]=p[2]*Math.cos(l)-p[0]*Math.sin(l),o[0]=y[0]+s[0],o[1]=y[1]+s[1],o[2]=y[2]+s[2],o},b.bk=function(o,t,s){var l=Math.sin(s),p=Math.cos(s),y=t[0],v=t[1],S=t[2],E=t[3],I=t[8],A=t[9],R=t[10],B=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=y*p-I*l,o[1]=v*p-A*l,o[2]=S*p-R*l,o[3]=E*p-B*l,o[8]=y*l+I*p,o[9]=v*l+A*p,o[10]=S*l+R*p,o[11]=E*l+B*p,o},b.bl=function(o,t){const s=be(o,360),l=be(t,360),p=l-s,y=l>s?p-360:p+360;return Math.abs(p)<Math.abs(y)?p:y},b.bm=function(o){return o[0]=0,o[1]=0,o[2]=0,o},b.bn=function(o,t,s,l){const p=Math.sqrt(o*o+t*t),y=Math.sqrt(s*s+l*l);o/=p,t/=p,s/=y,l/=y;const v=Math.acos(o*s+t*l);return-t*s+o*l>0?v:-v},b.bo=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]+o[3]},b.bp=nm,b.bq=function(o,t){const s=be(o,2*Math.PI),l=be(t,2*Math.PI);return Math.min(Math.abs(s-l),Math.abs(s-l+2*Math.PI),Math.abs(s-l-2*Math.PI))},b.br=function(o){return Math.hypot(o[0],o[1],o[2])},b.bs=function(){const o={},t=te.$version;for(const s in te.$root){const l=te.$root[s];if(l.required){let p=null;p=s==="version"?t:l.type==="array"?[]:{},p!=null&&(o[s]=p)}}return o},b.bt=Ho,b.bu=Oi,b.bv=function(o){o=o.slice();const t=Object.create(null);for(let s=0;s<o.length;s++)t[o[s].id]=o[s];for(let s=0;s<o.length;s++)"ref"in o[s]&&(o[s]=Y(o[s],t[o[s].ref]));return o},b.bw=function(o){if(o.type==="custom")return new Jg(o);switch(o.type){case"background":return new em(o);case"circle":return new m0(o);case"fill":return new hp(o);case"fill-extrusion":return new M0(o);case"heatmap":return new g0(o);case"hillshade":return new Tf(o);case"line":return new L0(o);case"raster":return new Kg(o);case"symbol":return new vp(o)}},b.bx=on,b.by=function(o,t){if(!o)return[{command:"setStyle",args:[t]}];let s=[];try{if(!K(o.version,t.version))return[{command:"setStyle",args:[t]}];K(o.center,t.center)||s.push({command:"setCenter",args:[t.center]}),K(o.centerAltitude,t.centerAltitude)||s.push({command:"setCenterAltitude",args:[t.centerAltitude]}),K(o.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),K(o.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),K(o.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),K(o.roll,t.roll)||s.push({command:"setRoll",args:[t.roll]}),K(o.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),K(o.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),K(o.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),K(o.light,t.light)||s.push({command:"setLight",args:[t.light]}),K(o.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),K(o.sky,t.sky)||s.push({command:"setSky",args:[t.sky]}),K(o.projection,t.projection)||s.push({command:"setProjection",args:[t.projection]});const l={},p=[];(function(v,S,E,I){let A;for(A in S=S||{},v=v||{})Object.prototype.hasOwnProperty.call(v,A)&&(Object.prototype.hasOwnProperty.call(S,A)||De(A,E,I));for(A in S)Object.prototype.hasOwnProperty.call(S,A)&&(Object.prototype.hasOwnProperty.call(v,A)?K(v[A],S[A])||(v[A].type==="geojson"&&S[A].type==="geojson"&&Re(v,S,A)?he(E,{command:"setGeoJSONSourceData",args:[A,S[A].data]}):He(A,S,E,I)):Pe(A,S,E))})(o.sources,t.sources,p,l);const y=[];o.layers&&o.layers.forEach(v=>{"source"in v&&l[v.source]?s.push({command:"removeLayer",args:[v.id]}):y.push(v)}),s=s.concat(p),function(v,S,E){S=S||[];const I=(v=v||[]).map(et),A=S.map(et),R=v.reduce(Ue,{}),B=S.reduce(Ue,{}),N=I.slice(),U=Object.create(null);let q,Q,ae,Me,de;for(let O=0,J=0;O<I.length;O++)q=I[O],Object.prototype.hasOwnProperty.call(B,q)?J++:(he(E,{command:"removeLayer",args:[q]}),N.splice(N.indexOf(q,J),1));for(let O=0,J=0;O<A.length;O++)q=A[A.length-1-O],N[N.length-1-O]!==q&&(Object.prototype.hasOwnProperty.call(R,q)?(he(E,{command:"removeLayer",args:[q]}),N.splice(N.lastIndexOf(q,N.length-J),1)):J++,Me=N[N.length-O],he(E,{command:"addLayer",args:[B[q],Me]}),N.splice(N.length-O,0,q),U[q]=!0);for(let O=0;O<A.length;O++)if(q=A[O],Q=R[q],ae=B[q],!U[q]&&!K(Q,ae))if(K(Q.source,ae.source)&&K(Q["source-layer"],ae["source-layer"])&&K(Q.type,ae.type)){for(de in rt(Q.layout,ae.layout,E,q,null,"setLayoutProperty"),rt(Q.paint,ae.paint,E,q,null,"setPaintProperty"),K(Q.filter,ae.filter)||he(E,{command:"setFilter",args:[q,ae.filter]}),K(Q.minzoom,ae.minzoom)&&K(Q.maxzoom,ae.maxzoom)||he(E,{command:"setLayerZoomRange",args:[q,ae.minzoom,ae.maxzoom]}),Q)Object.prototype.hasOwnProperty.call(Q,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?rt(Q[de],ae[de],E,q,de.slice(6),"setPaintProperty"):K(Q[de],ae[de])||he(E,{command:"setLayerProperty",args:[q,de,ae[de]]}));for(de in ae)Object.prototype.hasOwnProperty.call(ae,de)&&!Object.prototype.hasOwnProperty.call(Q,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?rt(Q[de],ae[de],E,q,de.slice(6),"setPaintProperty"):K(Q[de],ae[de])||he(E,{command:"setLayerProperty",args:[q,de,ae[de]]}))}else he(E,{command:"removeLayer",args:[q]}),Me=N[N.lastIndexOf(q)+1],he(E,{command:"addLayer",args:[ae,Me]})}(y,t.layers,s)}catch(l){console.warn("Unable to compute style diff:",l),s=[{command:"setStyle",args:[t]}]}return s},b.bz=function(o){const t=[],s=o.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),o.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},b.c=Di,b.c0=o=>o.type==="line",b.c1=o=>o.type==="fill",b.c2=o=>o.type==="fill-extrusion",b.c3=o=>o.type==="hillshade",b.c4=o=>o.type==="raster",b.c5=o=>o.type==="background",b.c6=o=>o.type==="custom",b.c7=ue,b.c8=function(o,t,s){const l=Le(t.x-s.x,t.y-s.y),p=Le(o.x-s.x,o.y-s.y);var y,v;return Kn(Math.atan2(l[0]*p[1]-l[1]*p[0],(y=l)[0]*(v=p)[0]+y[1]*v[1]))},b.c9=gt,b.cA=Eg,b.cB=Bg,b.cC=Kl,b.cD=gs,b.ca=function(o,t,s){var l=t[0],p=t[1];return o[0]=s[0]*l+s[4]*p+s[12],o[1]=s[1]*l+s[5]*p+s[13],o},b.cb=function(o,t){const{x:s,y:l}=nd.fromLngLat(t);return!(o<0||o>25||l<0||l>=1||s<0||s>=1)},b.cc=function(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},b.cd=class extends vl{},b.ce=v_,b.cg=function(o){return o.message===Or},b.ch=eo,b.ci=function(o,t){Fi.REGISTERED_PROTOCOLS[o]=t},b.cj=function(o){delete Fi.REGISTERED_PROTOCOLS[o]},b.ck=function(o,t){const s={};for(let p=0;p<o.length;p++){const y=t&&t[o[p].id]||zh(o[p]);t&&(t[o[p].id]=y);let v=s[y];v||(v=s[y]=[]),v.push(o[p])}const l=[];for(const p in s)l.push(s[p]);return l},b.cl=It,b.cm=o_,b.cn=a_,b.co=jg,b.cp=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ze/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const t=o.bucket.layers[0],s=t.layout,l=t._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new nr(o.bucket.zoom+1),o.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new nr(o.bucket.zoom+1),o.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new nr(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=o.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new nr(I),o.canonical),l["text-size"].possiblyEvaluate(new nr(A),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=o.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new nr(I),o.canonical),l["icon-size"].possiblyEvaluate(new nr(A),o.canonical)]}const y=s.get("text-line-height")*Vr,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",S=s.get("text-keep-upright"),E=s.get("text-size");for(const I of o.bucket.features){const A=s.get("text-font").evaluate(I,{},o.canonical).join(","),R=E.evaluate(I,{},o.canonical),B=p.layoutTextSize.evaluate(I,{},o.canonical),N=p.layoutIconSize.evaluate(I,{},o.canonical),U={horizontal:{},vertical:void 0},q=I.text;let Q,ae=[0,0];if(q){const O=q.toString(),J=s.get("text-letter-spacing").evaluate(I,{},o.canonical)*Vr,_e=Wd(O)?J:0,Ze=s.get("text-anchor").evaluate(I,{},o.canonical),dt=g_(t,I,o.canonical);if(!dt){const mt=s.get("text-radial-offset").evaluate(I,{},o.canonical);ae=mt?m_(Ze,[mt*Vr,im]):s.get("text-offset").evaluate(I,{},o.canonical).map(wt=>wt*Vr)}let Je=v?"center":s.get("text-justify").evaluate(I,{},o.canonical);const Xe=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(I,{},o.canonical)*Vr:1/0,pt=()=>{o.bucket.allowVerticalPlacement&&yl(O)&&(U.vertical=_p(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Xe,y,Ze,"left",_e,ae,b.af.vertical,!0,B,R))};if(!v&&dt){const mt=new Set;if(Je==="auto")for(let it=0;it<dt.values.length;it+=2)mt.add(om(dt.values[it]));else mt.add(Je);let wt=!1;for(const it of mt)if(!U.horizontal[it])if(wt)U.horizontal[it]=U.horizontal[0];else{const Bt=_p(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Xe,y,"center",it,_e,ae,b.af.horizontal,!1,B,R);Bt&&(U.horizontal[it]=Bt,wt=Bt.positionedLines.length===1)}pt()}else{Je==="auto"&&(Je=om(Ze));const mt=_p(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Xe,y,Ze,Je,_e,ae,b.af.horizontal,!1,B,R);mt&&(U.horizontal[Je]=mt),pt(),yl(O)&&v&&S&&(U.vertical=_p(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Xe,y,Ze,Je,_e,ae,b.af.vertical,!1,B,R))}}let Me=!1;if(I.icon&&I.icon.name){const O=o.imageMap[I.icon.name];O&&(Q=K0(o.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},o.canonical),s.get("icon-anchor").evaluate(I,{},o.canonical)),Me=!!O.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=Me:o.bucket.sdfIcons!==Me&&Ht("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(O.pixelRatio!==o.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const de=Bc(U.horizontal)||U.vertical;o.bucket.iconsInText=!!de&&de.iconsInText,(de||Q)&&iv(o.bucket,I,U,Q,o.imageMap,p,B,N,ae,Me,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},b.cq=Bf,b.cr=_u,b.cs=fp,b.ct=Hh,b.cu=Uf,b.cv=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},b.cw=function(o,t,s,l,p){return u(this,void 0,void 0,function*(){if(Ne())try{return yield Un(o,t,s,l,p)}catch{}return function(y,v,S,E,I){const A=y.width,R=y.height;Br&&hi||(Br=new OffscreenCanvas(A,R),hi=Br.getContext("2d",{willReadFrequently:!0})),Br.width=A,Br.height=R,hi.drawImage(y,0,0,A,R);const B=hi.getImageData(v,S,E,I);return hi.clearRect(0,0,A,R),B.data}(o,t,s,l,p)})},b.cx=i_,b.cy=j,b.cz=ge,b.d=o=>u(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),b.e=bt,b.f=o=>new Promise((t,s)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Fr})},l.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(o)],{type:"image/png"});l.src=o.byteLength?URL.createObjectURL(p):Fr}),b.g=Fs,b.h=(o,t)=>di(bt(o,{type:"json"}),t),b.i=gn,b.j=ls,b.k=Oo,b.l=(o,t)=>di(bt(o,{type:"arrayBuffer"}),t),b.m=di,b.n=function(o){return new Uf(o).readFields(U0,[])},b.o=Ec,b.p=Ng,b.q=Ti,b.r=_f,b.s=to,b.t=$d,b.u=yn,b.v=te,b.w=Ht,b.x=_l,b.y=function([o,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:o*Math.cos(t)*Math.sin(s),y:o*Math.sin(t)*Math.sin(s),z:o*Math.cos(s)}},b.z=oo}),x("worker",["./shared"],function(b){class u{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,Y){for(const he of W){this._layerConfigs[he.id]=he;const Pe=this._layers[he.id]=b.bw(he);Pe._featureFilter=b.a5(Pe.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of Y)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const K=b.ck(Object.values(this._layerConfigs),this.keyCache);for(const he of K){const Pe=he.map(Ue=>this._layers[Ue.id]),De=Pe[0];if(De.visibility==="none")continue;const He=De.source||"";let Re=this.familiesBySource[He];Re||(Re=this.familiesBySource[He]={});const rt=De.sourceLayer||"_geojsonTileLayer";let et=Re[rt];et||(et=Re[rt]=[]),et.push(Pe)}}}class j{constructor(W){const Y={},K=[];for(const He in W){const Re=W[He],rt=Y[He]={};for(const et in Re){const Ue=Re[+et];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const ke={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};K.push(ke),rt[et]={rect:ke,metrics:Ue.metrics}}}const{w:he,h:Pe}=b.p(K),De=new b.o({width:he||1,height:Pe||1});for(const He in W){const Re=W[He];for(const rt in Re){const et=Re[+rt];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const Ue=Y[He][rt].rect;b.o.copy(et.bitmap,De,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},et.bitmap)}}this.image=De,this.positions=Y}}b.cl("GlyphAtlas",j);class Z{constructor(W){this.tileID=new b.X(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,Y,K,he,Pe){return b._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new b.a3;const De=new b.cm(Object.keys(W.layers).sort()),He=new b.cn(this.tileID,this.promoteId);He.bucketLayerIDs=[];const Re={},rt={featureIndex:He,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K,subdivisionGranularity:Pe},et=Y.familiesBySource[this.source];for(const Yt in et){const Dt=W.layers[Yt];if(!Dt)continue;Dt.version===1&&b.w(`Vector tile source "${this.source}" layer "${Yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _r=De.encode(Yt),Bs=[];for(let Nr=0;Nr<Dt.length;Nr++){const Sr=Dt.feature(Nr),ir=He.getId(Sr,Yt);Bs.push({feature:Sr,id:ir,index:Nr,sourceLayerIndex:_r})}for(const Nr of et[Yt]){const Sr=Nr[0];Sr.source!==this.source&&b.w(`layer.source = ${Sr.source} does not equal this.source = ${this.source}`),Sr.minzoom&&this.zoom<Math.floor(Sr.minzoom)||Sr.maxzoom&&this.zoom>=Sr.maxzoom||Sr.visibility!=="none"&&(me(Nr,this.zoom,K),(Re[Sr.id]=Sr.createBucket({index:He.bucketLayerIDs.length,layers:Nr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_r,sourceID:this.source})).populate(Bs,rt,this.tileID.canonical),He.bucketLayerIDs.push(Nr.map(ir=>ir.id)))}}const Ue=b.bB(rt.glyphDependencies,Yt=>Object.keys(Yt).map(Number));this.inFlightDependencies.forEach(Yt=>Yt==null?void 0:Yt.abort()),this.inFlightDependencies=[];let ke=Promise.resolve({});if(Object.keys(Ue).length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),ke=he.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},Yt)}const Pt=Object.keys(rt.iconDependencies);let Ct=Promise.resolve({});if(Pt.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Ct=he.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"icons"}},Yt)}const Wt=Object.keys(rt.patternDependencies);let Jt=Promise.resolve({});if(Wt.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Jt=he.sendAsync({type:"GI",data:{icons:Wt,source:this.source,tileID:this.tileID,type:"patterns"}},Yt)}const[ot,Mt,Ot]=yield Promise.all([ke,Ct,Jt]),fn=new j(ot),En=new b.co(Mt,Ot);for(const Yt in Re){const Dt=Re[Yt];Dt instanceof b.a4?(me(Dt.layers,this.zoom,K),b.cp({bucket:Dt,glyphMap:ot,glyphPositions:fn.positions,imageMap:Mt,imagePositions:En.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:rt.subdivisionGranularity})):Dt.hasPattern&&(Dt instanceof b.cq||Dt instanceof b.cr||Dt instanceof b.cs)&&(me(Dt.layers,this.zoom,K),Dt.addFeatures(rt,this.tileID.canonical,En.patternPositions))}return this.status="done",{buckets:Object.values(Re).filter(Yt=>!Yt.isEmpty()),featureIndex:He,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fn.image,imageAtlas:En,glyphMap:this.returnDependencies?ot:null,iconMap:this.returnDependencies?Mt:null,glyphPositions:this.returnDependencies?fn.positions:null}})}}function me(te,W,Y){const K=new b.B(W);for(const he of te)he.recalculate(K,Y)}class ge{constructor(W,Y,K){this.actor=W,this.layerIndex=Y,this.availableImages=K,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,Y){return b._(this,void 0,void 0,function*(){const K=yield b.l(W.request,Y);try{return{vectorTile:new b.ct.VectorTile(new b.cu(K.data)),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(he){const Pe=new Uint8Array(K.data);let De=`Unable to parse the tile at ${W.request.url}, `;throw De+=Pe[0]===31&&Pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.message}`,new Error(De)}})}loadTile(W){return b._(this,void 0,void 0,function*(){const Y=W.uid,K=!!(W&&W.request&&W.request.collectResourceTiming)&&new b.cv(W.request),he=new Z(W);this.loading[Y]=he;const Pe=new AbortController;he.abort=Pe;try{const De=yield this.loadVectorTile(W,Pe);if(delete this.loading[Y],!De)return null;const He=De.rawData,Re={};De.expires&&(Re.expires=De.expires),De.cacheControl&&(Re.cacheControl=De.cacheControl);const rt={};if(K){const Ue=K.finish();Ue&&(rt.resourceTiming=JSON.parse(JSON.stringify(Ue)))}he.vectorTile=De.vectorTile;const et=he.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[Y]=he,this.fetching[Y]={rawTileData:He,cacheControl:Re,resourceTiming:rt};try{const Ue=yield et;return b.e({rawTileData:He.slice(0)},Ue,Re,rt)}finally{delete this.fetching[Y]}}catch(De){throw delete this.loading[Y],he.status="done",this.loaded[Y]=he,De}})}reloadTile(W){return b._(this,void 0,void 0,function*(){const Y=W.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const K=this.loaded[Y];if(K.showCollisionBoxes=W.showCollisionBoxes,K.status==="parsing"){const he=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let Pe;if(this.fetching[Y]){const{rawTileData:De,cacheControl:He,resourceTiming:Re}=this.fetching[Y];delete this.fetching[Y],Pe=b.e({rawTileData:De.slice(0)},he,He,Re)}else Pe=he;return Pe}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)})}abortTile(W){return b._(this,void 0,void 0,function*(){const Y=this.loading,K=W.uid;Y&&Y[K]&&Y[K].abort&&(Y[K].abort.abort(),delete Y[K])})}removeTile(W){return b._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class fe{constructor(){this.loaded={}}loadTile(W){return b._(this,void 0,void 0,function*(){const{uid:Y,encoding:K,rawImageData:he,redFactor:Pe,greenFactor:De,blueFactor:He,baseShift:Re}=W,rt=he.width+2,et=he.height+2,Ue=b.b(he)?new b.R({width:rt,height:et},yield b.cw(he,-1,-1,rt,et)):he,ke=new b.cx(Y,Ue,K,Pe,De,He,Re);return this.loaded=this.loaded||{},this.loaded[Y]=ke,ke})}removeTile(W){const Y=this.loaded,K=W.uid;Y&&Y[K]&&delete Y[K]}}var oe,Be,_t=function(){if(Be)return oe;function te(Y,K){if(Y.length!==0){W(Y[0],K);for(var he=1;he<Y.length;he++)W(Y[he],!K)}}function W(Y,K){for(var he=0,Pe=0,De=0,He=Y.length,Re=He-1;De<He;Re=De++){var rt=(Y[De][0]-Y[Re][0])*(Y[Re][1]+Y[De][1]),et=he+rt;Pe+=Math.abs(he)>=Math.abs(rt)?he-et+rt:rt-et+he,he=et}he+Pe>=0!=!!K&&Y.reverse()}return Be=1,oe=function Y(K,he){var Pe,De=K&&K.type;if(De==="FeatureCollection")for(Pe=0;Pe<K.features.length;Pe++)Y(K.features[Pe],he);else if(De==="GeometryCollection")for(Pe=0;Pe<K.geometries.length;Pe++)Y(K.geometries[Pe],he);else if(De==="Feature")Y(K.geometry,he);else if(De==="Polygon")te(K.coordinates,he);else if(De==="MultiPolygon")for(Pe=0;Pe<K.coordinates.length;Pe++)te(K.coordinates[Pe],he);return K}}(),xt=b.cy(_t);const Ie=b.ct.VectorTileFeature.prototype.toGeoJSON;class ne{constructor(W){this._feature=W,this.extent=b.Y,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const Y of this._feature.geometry)W.push([new b.P(Y[0],Y[1])]);return W}{const W=[];for(const Y of this._feature.geometry){const K=[];for(const he of Y)K.push(new b.P(he[0],he[1]));W.push(K)}return W}}toGeoJSON(W,Y,K){return Ie.call(this,W,Y,K)}}class Te{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=b.Y,this.length=W.length,this._features=W}feature(W){return new ne(this._features[W])}}var Ne,ut,ct,ht={exports:{}},$=function(){if(ct)return ht.exports;ct=1;var te=b.cB(),W=function(){if(ut)return Ne;ut=1;var et=b.cz(),Ue=b.cA().VectorTileFeature;function ke(Ct,Wt){this.options=Wt||{},this.features=Ct,this.length=Ct.length}function Pt(Ct,Wt){this.id=typeof Ct.id=="number"?Ct.id:void 0,this.type=Ct.type,this.rawGeometry=Ct.type===1?[Ct.geometry]:Ct.geometry,this.properties=Ct.tags,this.extent=Wt||4096}return Ne=ke,ke.prototype.feature=function(Ct){return new Pt(this.features[Ct],this.options.extent)},Pt.prototype.loadGeometry=function(){var Ct=this.rawGeometry;this.geometry=[];for(var Wt=0;Wt<Ct.length;Wt++){for(var Jt=Ct[Wt],ot=[],Mt=0;Mt<Jt.length;Mt++)ot.push(new et(Jt[Mt][0],Jt[Mt][1]));this.geometry.push(ot)}return this.geometry},Pt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ct=this.geometry,Wt=1/0,Jt=-1/0,ot=1/0,Mt=-1/0,Ot=0;Ot<Ct.length;Ot++)for(var fn=Ct[Ot],En=0;En<fn.length;En++){var Yt=fn[En];Wt=Math.min(Wt,Yt.x),Jt=Math.max(Jt,Yt.x),ot=Math.min(ot,Yt.y),Mt=Math.max(Mt,Yt.y)}return[Wt,ot,Jt,Mt]},Pt.prototype.toGeoJSON=Ue.prototype.toGeoJSON,Ne}();function Y(et){var Ue=new te;return function(ke,Pt){for(var Ct in ke.layers)Pt.writeMessage(3,K,ke.layers[Ct])}(et,Ue),Ue.finish()}function K(et,Ue){var ke;Ue.writeVarintField(15,et.version||1),Ue.writeStringField(1,et.name||""),Ue.writeVarintField(5,et.extent||4096);var Pt={keys:[],values:[],keycache:{},valuecache:{}};for(ke=0;ke<et.length;ke++)Pt.feature=et.feature(ke),Ue.writeMessage(2,he,Pt);var Ct=Pt.keys;for(ke=0;ke<Ct.length;ke++)Ue.writeStringField(3,Ct[ke]);var Wt=Pt.values;for(ke=0;ke<Wt.length;ke++)Ue.writeMessage(4,rt,Wt[ke])}function he(et,Ue){var ke=et.feature;ke.id!==void 0&&Ue.writeVarintField(1,ke.id),Ue.writeMessage(2,Pe,et),Ue.writeVarintField(3,ke.type),Ue.writeMessage(4,Re,ke)}function Pe(et,Ue){var ke=et.feature,Pt=et.keys,Ct=et.values,Wt=et.keycache,Jt=et.valuecache;for(var ot in ke.properties){var Mt=ke.properties[ot],Ot=Wt[ot];if(Mt!==null){Ot===void 0&&(Pt.push(ot),Wt[ot]=Ot=Pt.length-1),Ue.writeVarint(Ot);var fn=typeof Mt;fn!=="string"&&fn!=="boolean"&&fn!=="number"&&(Mt=JSON.stringify(Mt));var En=fn+":"+Mt,Yt=Jt[En];Yt===void 0&&(Ct.push(Mt),Jt[En]=Yt=Ct.length-1),Ue.writeVarint(Yt)}}}function De(et,Ue){return(Ue<<3)+(7&et)}function He(et){return et<<1^et>>31}function Re(et,Ue){for(var ke=et.loadGeometry(),Pt=et.type,Ct=0,Wt=0,Jt=ke.length,ot=0;ot<Jt;ot++){var Mt=ke[ot],Ot=1;Pt===1&&(Ot=Mt.length),Ue.writeVarint(De(1,Ot));for(var fn=Pt===3?Mt.length-1:Mt.length,En=0;En<fn;En++){En===1&&Pt!==1&&Ue.writeVarint(De(2,fn-1));var Yt=Mt[En].x-Ct,Dt=Mt[En].y-Wt;Ue.writeVarint(He(Yt)),Ue.writeVarint(He(Dt)),Ct+=Yt,Wt+=Dt}Pt===3&&Ue.writeVarint(De(7,1))}}function rt(et,Ue){var ke=typeof et;ke==="string"?Ue.writeStringField(1,et):ke==="boolean"?Ue.writeBooleanField(7,et):ke==="number"&&(et%1!=0?Ue.writeDoubleField(3,et):et<0?Ue.writeSVarintField(6,et):Ue.writeVarintField(5,et))}return ht.exports=Y,ht.exports.fromVectorTileJs=Y,ht.exports.fromGeojsonVt=function(et,Ue){Ue=Ue||{};var ke={};for(var Pt in et)ke[Pt]=new W(et[Pt].features,Ue),ke[Pt].name=Pt,ke[Pt].version=Ue.version,ke[Pt].extent=Ue.extent;return Y({layers:ke})},ht.exports.GeoJSONWrapper=W,ht.exports}(),le=b.cy($);const pe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},Ve=Math.fround||(Fe=new Float32Array(1),te=>(Fe[0]=+te,Fe[0]));var Fe;const je=3,Ye=5,Le=6;class ze{constructor(W){this.options=Object.assign(Object.create(pe),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:Y,minZoom:K,maxZoom:he}=this.options;Y&&console.time("total time");const Pe=`prepare ${W.length} points`;Y&&console.time(Pe),this.points=W;const De=[];for(let Re=0;Re<W.length;Re++){const rt=W[Re];if(!rt.geometry)continue;const[et,Ue]=rt.geometry.coordinates,ke=Ve(Ke(et)),Pt=Ve(ye(Ue));De.push(ke,Pt,1/0,Re,-1,1),this.options.reduce&&De.push(0)}let He=this.trees[he+1]=this._createTree(De);Y&&console.timeEnd(Pe);for(let Re=he;Re>=K;Re--){const rt=+Date.now();He=this.trees[Re]=this._createTree(this._cluster(He,Re)),Y&&console.log("z%d: %d clusters in %dms",Re,He.numItems,+Date.now()-rt)}return Y&&console.timeEnd("total time"),this}getClusters(W,Y){let K=((W[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,W[1]));let Pe=W[2]===180?180:((W[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)K=-180,Pe=180;else if(K>Pe){const Ue=this.getClusters([K,he,180,De],Y),ke=this.getClusters([-180,he,Pe,De],Y);return Ue.concat(ke)}const He=this.trees[this._limitZoom(Y)],Re=He.range(Ke(K),ye(De),Ke(Pe),ye(he)),rt=He.data,et=[];for(const Ue of Re){const ke=this.stride*Ue;et.push(rt[ke+Ye]>1?We(rt,ke,this.clusterProps):this.points[rt[ke+je]])}return et}getChildren(W){const Y=this._getOriginId(W),K=this._getOriginZoom(W),he="No cluster with the specified id.",Pe=this.trees[K];if(!Pe)throw new Error(he);const De=Pe.data;if(Y*this.stride>=De.length)throw new Error(he);const He=this.options.radius/(this.options.extent*Math.pow(2,K-1)),Re=Pe.within(De[Y*this.stride],De[Y*this.stride+1],He),rt=[];for(const et of Re){const Ue=et*this.stride;De[Ue+4]===W&&rt.push(De[Ue+Ye]>1?We(De,Ue,this.clusterProps):this.points[De[Ue+je]])}if(rt.length===0)throw new Error(he);return rt}getLeaves(W,Y,K){const he=[];return this._appendLeaves(he,W,Y=Y||10,K=K||0,0),he}getTile(W,Y,K){const he=this.trees[this._limitZoom(W)],Pe=Math.pow(2,W),{extent:De,radius:He}=this.options,Re=He/De,rt=(K-Re)/Pe,et=(K+1+Re)/Pe,Ue={features:[]};return this._addTileFeatures(he.range((Y-Re)/Pe,rt,(Y+1+Re)/Pe,et),he.data,Y,K,Pe,Ue),Y===0&&this._addTileFeatures(he.range(1-Re/Pe,rt,1,et),he.data,Pe,K,Pe,Ue),Y===Pe-1&&this._addTileFeatures(he.range(0,rt,Re/Pe,et),he.data,-1,K,Pe,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(W){let Y=this._getOriginZoom(W)-1;for(;Y<=this.options.maxZoom;){const K=this.getChildren(W);if(Y++,K.length!==1)break;W=K[0].properties.cluster_id}return Y}_appendLeaves(W,Y,K,he,Pe){const De=this.getChildren(Y);for(const He of De){const Re=He.properties;if(Re&&Re.cluster?Pe+Re.point_count<=he?Pe+=Re.point_count:Pe=this._appendLeaves(W,Re.cluster_id,K,he,Pe):Pe<he?Pe++:W.push(He),W.length===K)break}return Pe}_createTree(W){const Y=new b.aA(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<W.length;K+=this.stride)Y.add(W[K],W[K+1]);return Y.finish(),Y.data=W,Y}_addTileFeatures(W,Y,K,he,Pe,De){for(const He of W){const Re=He*this.stride,rt=Y[Re+Ye]>1;let et,Ue,ke;if(rt)et=be(Y,Re,this.clusterProps),Ue=Y[Re],ke=Y[Re+1];else{const Wt=this.points[Y[Re+je]];et=Wt.properties;const[Jt,ot]=Wt.geometry.coordinates;Ue=Ke(Jt),ke=ye(ot)}const Pt={type:1,geometry:[[Math.round(this.options.extent*(Ue*Pe-K)),Math.round(this.options.extent*(ke*Pe-he))]],tags:et};let Ct;Ct=rt||this.options.generateId?Y[Re+je]:this.points[Y[Re+je]].id,Ct!==void 0&&(Pt.id=Ct),De.features.push(Pt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,Y){const{radius:K,extent:he,reduce:Pe,minPoints:De}=this.options,He=K/(he*Math.pow(2,Y)),Re=W.data,rt=[],et=this.stride;for(let Ue=0;Ue<Re.length;Ue+=et){if(Re[Ue+2]<=Y)continue;Re[Ue+2]=Y;const ke=Re[Ue],Pt=Re[Ue+1],Ct=W.within(Re[Ue],Re[Ue+1],He),Wt=Re[Ue+Ye];let Jt=Wt;for(const ot of Ct){const Mt=ot*et;Re[Mt+2]>Y&&(Jt+=Re[Mt+Ye])}if(Jt>Wt&&Jt>=De){let ot,Mt=ke*Wt,Ot=Pt*Wt,fn=-1;const En=((Ue/et|0)<<5)+(Y+1)+this.points.length;for(const Yt of Ct){const Dt=Yt*et;if(Re[Dt+2]<=Y)continue;Re[Dt+2]=Y;const _r=Re[Dt+Ye];Mt+=Re[Dt]*_r,Ot+=Re[Dt+1]*_r,Re[Dt+4]=En,Pe&&(ot||(ot=this._map(Re,Ue,!0),fn=this.clusterProps.length,this.clusterProps.push(ot)),Pe(ot,this._map(Re,Dt)))}Re[Ue+4]=En,rt.push(Mt/Jt,Ot/Jt,1/0,En,-1,Jt),Pe&&rt.push(fn)}else{for(let ot=0;ot<et;ot++)rt.push(Re[Ue+ot]);if(Jt>1)for(const ot of Ct){const Mt=ot*et;if(!(Re[Mt+2]<=Y)){Re[Mt+2]=Y;for(let Ot=0;Ot<et;Ot++)rt.push(Re[Mt+Ot])}}}}return rt}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,Y,K){if(W[Y+Ye]>1){const De=this.clusterProps[W[Y+Le]];return K?Object.assign({},De):De}const he=this.points[W[Y+je]].properties,Pe=this.options.map(he);return K&&Pe===he?Object.assign({},Pe):Pe}}function We(te,W,Y){return{type:"Feature",id:te[W+je],properties:be(te,W,Y),geometry:{type:"Point",coordinates:[(K=te[W],360*(K-.5)),ue(te[W+1])]}};var K}function be(te,W,Y){const K=te[W+Ye],he=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,Pe=te[W+Le],De=Pe===-1?{}:Object.assign({},Y[Pe]);return Object.assign(De,{cluster:!0,cluster_id:te[W+je],point_count:K,point_count_abbreviated:he})}function Ke(te){return te/360+.5}function ye(te){const W=Math.sin(te*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function ue(te){const W=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function gt(te,W,Y,K){let he=K;const Pe=W+(Y-W>>1);let De,He=Y-W;const Re=te[W],rt=te[W+1],et=te[Y],Ue=te[Y+1];for(let ke=W+3;ke<Y;ke+=3){const Pt=At(te[ke],te[ke+1],Re,rt,et,Ue);if(Pt>he)De=ke,he=Pt;else if(Pt===he){const Ct=Math.abs(ke-Pe);Ct<He&&(De=ke,He=Ct)}}he>K&&(De-W>3&&gt(te,W,De,K),te[De+2]=he,Y-De>3&&gt(te,De,Y,K))}function At(te,W,Y,K,he,Pe){let De=he-Y,He=Pe-K;if(De!==0||He!==0){const Re=((te-Y)*De+(W-K)*He)/(De*De+He*He);Re>1?(Y=he,K=Pe):Re>0&&(Y+=De*Re,K+=He*Re)}return De=te-Y,He=W-K,De*De+He*He}function Lt(te,W,Y,K){const he={id:te??null,type:W,geometry:Y,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")bt(he,Y);else if(W==="Polygon")bt(he,Y[0]);else if(W==="MultiLineString")for(const Pe of Y)bt(he,Pe);else if(W==="MultiPolygon")for(const Pe of Y)bt(he,Pe[0]);return he}function bt(te,W){for(let Y=0;Y<W.length;Y+=3)te.minX=Math.min(te.minX,W[Y]),te.minY=Math.min(te.minY,W[Y+1]),te.maxX=Math.max(te.maxX,W[Y]),te.maxY=Math.max(te.maxY,W[Y+1])}function zt(te,W,Y,K){if(!W.geometry)return;const he=W.geometry.coordinates;if(he&&he.length===0)return;const Pe=W.geometry.type,De=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let He=[],Re=W.id;if(Y.promoteId?Re=W.properties[Y.promoteId]:Y.generateId&&(Re=K||0),Pe==="Point")Ft(he,He);else if(Pe==="MultiPoint")for(const rt of he)Ft(rt,He);else if(Pe==="LineString")Kt(he,He,De,!1);else if(Pe==="MultiLineString"){if(Y.lineMetrics){for(const rt of he)He=[],Kt(rt,He,De,!1),te.push(Lt(Re,"LineString",He,W.properties));return}on(he,He,De,!1)}else if(Pe==="Polygon")on(he,He,De,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(const rt of W.geometry.geometries)zt(te,{id:Re,geometry:rt,properties:W.properties},Y,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const rt of he){const et=[];on(rt,et,De,!0),He.push(et)}}te.push(Lt(Re,Pe,He,W.properties))}function Ft(te,W){W.push(Dn(te[0]),Ht(te[1]),0)}function Kt(te,W,Y,K){let he,Pe,De=0;for(let Re=0;Re<te.length;Re++){const rt=Dn(te[Re][0]),et=Ht(te[Re][1]);W.push(rt,et,0),Re>0&&(De+=K?(he*et-rt*Pe)/2:Math.sqrt(Math.pow(rt-he,2)+Math.pow(et-Pe,2))),he=rt,Pe=et}const He=W.length-3;W[2]=1,gt(W,0,He,Y),W[He+2]=1,W.size=Math.abs(De),W.start=0,W.end=W.size}function on(te,W,Y,K){for(let he=0;he<te.length;he++){const Pe=[];Kt(te[he],Pe,Y,K),W.push(Pe)}}function Dn(te){return te/360+.5}function Ht(te){const W=Math.sin(te*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function tn(te,W,Y,K,he,Pe,De,He){if(K/=W,Pe>=(Y/=W)&&De<K)return te;if(De<Y||Pe>=K)return null;const Re=[];for(const rt of te){const et=rt.geometry;let Ue=rt.type;const ke=he===0?rt.minX:rt.minY,Pt=he===0?rt.maxX:rt.maxY;if(ke>=Y&&Pt<K){Re.push(rt);continue}if(Pt<Y||ke>=K)continue;let Ct=[];if(Ue==="Point"||Ue==="MultiPoint")gn(et,Ct,Y,K,he);else if(Ue==="LineString")Rt(et,Ct,Y,K,he,!1,He.lineMetrics);else if(Ue==="MultiLineString")Fr(et,Ct,Y,K,he,!1);else if(Ue==="Polygon")Fr(et,Ct,Y,K,he,!0);else if(Ue==="MultiPolygon")for(const Wt of et){const Jt=[];Fr(Wt,Jt,Y,K,he,!0),Jt.length&&Ct.push(Jt)}if(Ct.length){if(He.lineMetrics&&Ue==="LineString"){for(const Wt of Ct)Re.push(Lt(rt.id,Ue,Wt,rt.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(Ct.length===1?(Ue="LineString",Ct=Ct[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=Ct.length===3?"Point":"MultiPoint"),Re.push(Lt(rt.id,Ue,Ct,rt.tags))}}return Re.length?Re:null}function gn(te,W,Y,K,he){for(let Pe=0;Pe<te.length;Pe+=3){const De=te[Pe+he];De>=Y&&De<=K&&Un(W,te[Pe],te[Pe+1],te[Pe+2])}}function Rt(te,W,Y,K,he,Pe,De){let He=rn(te);const Re=he===0?Br:hi;let rt,et,Ue=te.start;for(let Jt=0;Jt<te.length-3;Jt+=3){const ot=te[Jt],Mt=te[Jt+1],Ot=te[Jt+2],fn=te[Jt+3],En=te[Jt+4],Yt=he===0?ot:Mt,Dt=he===0?fn:En;let _r=!1;De&&(rt=Math.sqrt(Math.pow(ot-fn,2)+Math.pow(Mt-En,2))),Yt<Y?Dt>Y&&(et=Re(He,ot,Mt,fn,En,Y),De&&(He.start=Ue+rt*et)):Yt>K?Dt<K&&(et=Re(He,ot,Mt,fn,En,K),De&&(He.start=Ue+rt*et)):Un(He,ot,Mt,Ot),Dt<Y&&Yt>=Y&&(et=Re(He,ot,Mt,fn,En,Y),_r=!0),Dt>K&&Yt<=K&&(et=Re(He,ot,Mt,fn,En,K),_r=!0),!Pe&&_r&&(De&&(He.end=Ue+rt*et),W.push(He),He=rn(te)),De&&(Ue+=rt)}let ke=te.length-3;const Pt=te[ke],Ct=te[ke+1],Wt=he===0?Pt:Ct;Wt>=Y&&Wt<=K&&Un(He,Pt,Ct,te[ke+2]),ke=He.length-3,Pe&&ke>=3&&(He[ke]!==He[0]||He[ke+1]!==He[1])&&Un(He,He[0],He[1],He[2]),He.length&&W.push(He)}function rn(te){const W=[];return W.size=te.size,W.start=te.start,W.end=te.end,W}function Fr(te,W,Y,K,he,Pe){for(const De of te)Rt(De,W,Y,K,he,Pe,!1)}function Un(te,W,Y,K){te.push(W,Y,K)}function Br(te,W,Y,K,he,Pe){const De=(Pe-W)/(K-W);return Un(te,Pe,Y+(he-Y)*De,1),De}function hi(te,W,Y,K,he,Pe){const De=(Pe-Y)/(he-Y);return Un(te,W+(K-W)*De,Pe,1),De}function Kn(te,W){const Y=[];for(let K=0;K<te.length;K++){const he=te[K],Pe=he.type;let De;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")De=Or(he.geometry,W);else if(Pe==="MultiLineString"||Pe==="Polygon"){De=[];for(const He of he.geometry)De.push(Or(He,W))}else if(Pe==="MultiPolygon"){De=[];for(const He of he.geometry){const Re=[];for(const rt of He)Re.push(Or(rt,W));De.push(Re)}}Y.push(Lt(he.id,Pe,De,he.tags))}return Y}function Or(te,W){const Y=[];Y.size=te.size,te.start!==void 0&&(Y.start=te.start,Y.end=te.end);for(let K=0;K<te.length;K+=3)Y.push(te[K]+W,te[K+1],te[K+2]);return Y}function Di(te,W){if(te.transformed)return te;const Y=1<<te.z,K=te.x,he=te.y;for(const Pe of te.features){const De=Pe.geometry,He=Pe.type;if(Pe.geometry=[],He===1)for(let Re=0;Re<De.length;Re+=2)Pe.geometry.push(Fi(De[Re],De[Re+1],W,Y,K,he));else for(let Re=0;Re<De.length;Re++){const rt=[];for(let et=0;et<De[Re].length;et+=2)rt.push(Fi(De[Re][et],De[Re][et+1],W,Y,K,he));Pe.geometry.push(rt)}}return te.transformed=!0,te}function Fi(te,W,Y,K,he,Pe){return[Math.round(Y*(te*K-he)),Math.round(Y*(W*K-Pe))]}function Fs(te,W,Y,K,he){const Pe=W===he.maxZoom?0:he.tolerance/((1<<W)*he.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:te.length,source:null,x:Y,y:K,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const He of te)Bi(De,He,Pe,he);return De}function Bi(te,W,Y,K){const he=W.geometry,Pe=W.type,De=[];if(te.minX=Math.min(te.minX,W.minX),te.minY=Math.min(te.minY,W.minY),te.maxX=Math.max(te.maxX,W.maxX),te.maxY=Math.max(te.maxY,W.maxY),Pe==="Point"||Pe==="MultiPoint")for(let He=0;He<he.length;He+=3)De.push(he[He],he[He+1]),te.numPoints++,te.numSimplified++;else if(Pe==="LineString")eo(De,he,te,Y,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(let He=0;He<he.length;He++)eo(De,he[He],te,Y,Pe==="Polygon",He===0);else if(Pe==="MultiPolygon")for(let He=0;He<he.length;He++){const Re=he[He];for(let rt=0;rt<Re.length;rt++)eo(De,Re[rt],te,Y,!0,rt===0)}if(De.length){let He=W.tags||null;if(Pe==="LineString"&&K.lineMetrics){He={};for(const rt in W.tags)He[rt]=W.tags[rt];He.mapbox_clip_start=he.start/he.size,He.mapbox_clip_end=he.end/he.size}const Re={geometry:De,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:He};W.id!==null&&(Re.id=W.id),te.features.push(Re)}}function eo(te,W,Y,K,he,Pe){const De=K*K;if(K>0&&W.size<(he?De:K))return void(Y.numPoints+=W.length/3);const He=[];for(let Re=0;Re<W.length;Re+=3)(K===0||W[Re+2]>De)&&(Y.numSimplified++,He.push(W[Re],W[Re+1])),Y.numPoints++;he&&function(Re,rt){let et=0;for(let Ue=0,ke=Re.length,Pt=ke-2;Ue<ke;Pt=Ue,Ue+=2)et+=(Re[Ue]-Re[Pt])*(Re[Ue+1]+Re[Pt+1]);if(et>0===rt)for(let Ue=0,ke=Re.length;Ue<ke/2;Ue+=2){const Pt=Re[Ue],Ct=Re[Ue+1];Re[Ue]=Re[ke-2-Ue],Re[Ue+1]=Re[ke-1-Ue],Re[ke-2-Ue]=Pt,Re[ke-1-Ue]=Ct}}(He,Pe),te.push(He)}const Oi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class di{constructor(W,Y){const K=(Y=this.options=function(Pe,De){for(const He in De)Pe[He]=De[He];return Pe}(Object.create(Oi),Y)).debug;if(K&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let he=function(Pe,De){const He=[];if(Pe.type==="FeatureCollection")for(let Re=0;Re<Pe.features.length;Re++)zt(He,Pe.features[Re],De,Re);else zt(He,Pe.type==="Feature"?Pe:{geometry:Pe},De);return He}(W,Y);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=function(Pe,De){const He=De.buffer/De.extent;let Re=Pe;const rt=tn(Pe,1,-1-He,He,0,-1,2,De),et=tn(Pe,1,1-He,2+He,0,-1,2,De);return(rt||et)&&(Re=tn(Pe,1,-He,1+He,0,-1,2,De)||[],rt&&(Re=Kn(rt,1).concat(Re)),et&&(Re=Re.concat(Kn(et,-1)))),Re}(he,Y),he.length&&this.splitTile(he,0,0,0),K&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,Y,K,he,Pe,De,He){const Re=[W,Y,K,he],rt=this.options,et=rt.debug;for(;Re.length;){he=Re.pop(),K=Re.pop(),Y=Re.pop(),W=Re.pop();const Ue=1<<Y,ke=to(Y,K,he);let Pt=this.tiles[ke];if(!Pt&&(et>1&&console.time("creation"),Pt=this.tiles[ke]=Fs(W,Y,K,he,rt),this.tileCoords.push({z:Y,x:K,y:he}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,K,he,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));const _r=`z${Y}`;this.stats[_r]=(this.stats[_r]||0)+1,this.total++}if(Pt.source=W,Pe==null){if(Y===rt.indexMaxZoom||Pt.numPoints<=rt.indexMaxPoints)continue}else{if(Y===rt.maxZoom||Y===Pe)continue;if(Pe!=null){const _r=Pe-Y;if(K!==De>>_r||he!==He>>_r)continue}}if(Pt.source=null,W.length===0)continue;et>1&&console.time("clipping");const Ct=.5*rt.buffer/rt.extent,Wt=.5-Ct,Jt=.5+Ct,ot=1+Ct;let Mt=null,Ot=null,fn=null,En=null,Yt=tn(W,Ue,K-Ct,K+Jt,0,Pt.minX,Pt.maxX,rt),Dt=tn(W,Ue,K+Wt,K+ot,0,Pt.minX,Pt.maxX,rt);W=null,Yt&&(Mt=tn(Yt,Ue,he-Ct,he+Jt,1,Pt.minY,Pt.maxY,rt),Ot=tn(Yt,Ue,he+Wt,he+ot,1,Pt.minY,Pt.maxY,rt),Yt=null),Dt&&(fn=tn(Dt,Ue,he-Ct,he+Jt,1,Pt.minY,Pt.maxY,rt),En=tn(Dt,Ue,he+Wt,he+ot,1,Pt.minY,Pt.maxY,rt),Dt=null),et>1&&console.timeEnd("clipping"),Re.push(Mt||[],Y+1,2*K,2*he),Re.push(Ot||[],Y+1,2*K,2*he+1),Re.push(fn||[],Y+1,2*K+1,2*he),Re.push(En||[],Y+1,2*K+1,2*he+1)}}getTile(W,Y,K){W=+W,Y=+Y,K=+K;const he=this.options,{extent:Pe,debug:De}=he;if(W<0||W>24)return null;const He=1<<W,Re=to(W,Y=Y+He&He-1,K);if(this.tiles[Re])return Di(this.tiles[Re],Pe);De>1&&console.log("drilling down to z%d-%d-%d",W,Y,K);let rt,et=W,Ue=Y,ke=K;for(;!rt&&et>0;)et--,Ue>>=1,ke>>=1,rt=this.tiles[to(et,Ue,ke)];return rt&&rt.source?(De>1&&(console.log("found parent tile z%d-%d-%d",et,Ue,ke),console.time("drilling down")),this.splitTile(rt.source,et,Ue,ke,W,Y,K),De>1&&console.timeEnd("drilling down"),this.tiles[Re]?Di(this.tiles[Re],Pe):null):null}}function to(te,W,Y){return 32*((1<<te)*Y+W)+te}function Ni(te,W){return W?te.properties[W]:te.id}function no(te,W){if(te==null)return!0;if(te.type==="Feature")return Ni(te,W)!=null;if(te.type==="FeatureCollection"){const Y=new Set;for(const K of te.features){const he=Ni(K,W);if(he==null||Y.has(he))return!1;Y.add(he)}return!0}return!1}function Oo(te,W){const Y=new Map;if(te!=null)if(te.type==="Feature")Y.set(Ni(te,W),te);else for(const K of te.features)Y.set(Ni(K,W),K);return Y}class ls extends ge{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,Y){return b._(this,void 0,void 0,function*(){const K=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const he=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!he)return null;const Pe=new Te(he.features);let De=le(Pe);return De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),{vectorTile:Pe,rawData:De.buffer}})}loadData(W){return b._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const K=!!(W&&W.request&&W.request.collectResourceTiming)&&new b.cv(W.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest),this._geoJSONIndex=W.cluster?new ze(function({superclusterOptions:De,clusterProperties:He}){if(!He||!De)return De;const Re={},rt={},et={accumulated:null,zoom:0},Ue={properties:null},ke=Object.keys(He);for(const Pt of ke){const[Ct,Wt]=He[Pt],Jt=b.cC(Wt),ot=b.cC(typeof Ct=="string"?[Ct,["accumulated"],["get",Pt]]:Ct);Re[Pt]=Jt.value,rt[Pt]=ot.value}return De.map=Pt=>{Ue.properties=Pt;const Ct={};for(const Wt of ke)Ct[Wt]=Re[Wt].evaluate(et,Ue);return Ct},De.reduce=(Pt,Ct)=>{Ue.properties=Ct;for(const Wt of ke)et.accumulated=Pt[Wt],Pt[Wt]=rt[Wt].evaluate(et,Ue)},De}(W)).load((yield this._pendingData).features):(he=yield this._pendingData,new di(he,W.geojsonVtOptions)),this.loaded={};const Pe={};if(K){const De=K.finish();De&&(Pe.resourceTiming={},Pe.resourceTiming[W.source]=JSON.parse(JSON.stringify(De)))}return Pe}catch(Pe){if(delete this._pendingRequest,b.cg(Pe))return{abandoned:!0};throw Pe}var he})}getData(){return b._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(W){const Y=this.loaded;return Y&&Y[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,Y){return b._(this,void 0,void 0,function*(){let K=yield this.loadGeoJSON(W,Y);if(delete this._pendingRequest,typeof K!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(xt(K,!0),W.filter){const he=b.cC(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map(De=>`${De.key}: ${De.message}`).join(", "));K={type:"FeatureCollection",features:K.features.filter(De=>he.value.evaluate({zoom:0},De))}}return K})}loadGeoJSON(W,Y){return b._(this,void 0,void 0,function*(){const{promoteId:K}=W;if(W.request){const he=yield b.h(W.request,Y);return this._dataUpdateable=no(he.data,K)?Oo(he.data,K):void 0,he.data}if(typeof W.data=="string")try{const he=JSON.parse(W.data);return this._dataUpdateable=no(he,K)?Oo(he,K):void 0,he}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(he,Pe,De){var He,Re,rt,et;if(Pe.removeAll&&he.clear(),Pe.remove)for(const Ue of Pe.remove)he.delete(Ue);if(Pe.add)for(const Ue of Pe.add){const ke=Ni(Ue,De);ke!=null&&he.set(ke,Ue)}if(Pe.update)for(const Ue of Pe.update){let ke=he.get(Ue.id);if(ke==null)continue;const Pt=!Ue.removeAllProperties&&(((He=Ue.removeProperties)===null||He===void 0?void 0:He.length)>0||((Re=Ue.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0);if((Ue.newGeometry||Ue.removeAllProperties||Pt)&&(ke=Object.assign({},ke),he.set(Ue.id,ke),Pt&&(ke.properties=Object.assign({},ke.properties))),Ue.newGeometry&&(ke.geometry=Ue.newGeometry),Ue.removeAllProperties)ke.properties={};else if(((rt=Ue.removeProperties)===null||rt===void 0?void 0:rt.length)>0)for(const Ct of Ue.removeProperties)Object.prototype.hasOwnProperty.call(ke.properties,Ct)&&delete ke.properties[Ct];if(((et=Ue.addOrUpdateProperties)===null||et===void 0?void 0:et.length)>0)for(const{key:Ct,value:Wt}of Ue.addOrUpdateProperties)ke.properties[Ct]=Wt}}(this._dataUpdateable,W.dataDiff,K),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return b._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class No{constructor(W){this.self=W,this.actor=new b.G(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,K)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=K},this.self.addProtocol=b.ci,this.self.removeProtocol=b.cj,this.self.registerRTLTextPlugin=Y=>{b.cD.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,K)=>this._getDEMWorkerSource(Y,K.source).loadTile(K)),this.actor.registerMessageHandler("RDT",(Y,K)=>b._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,K.source).removeTile(K)})),this.actor.registerMessageHandler("GCEZ",(Y,K)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,K.type,K.source).getClusterExpansionZoom(K)})),this.actor.registerMessageHandler("GCC",(Y,K)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,K.type,K.source).getClusterChildren(K)})),this.actor.registerMessageHandler("GCL",(Y,K)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,K.type,K.source).getClusterLeaves(K)})),this.actor.registerMessageHandler("LD",(Y,K)=>this._getWorkerSource(Y,K.type,K.source).loadData(K)),this.actor.registerMessageHandler("GD",(Y,K)=>this._getWorkerSource(Y,K.type,K.source).getData()),this.actor.registerMessageHandler("LT",(Y,K)=>this._getWorkerSource(Y,K.type,K.source).loadTile(K)),this.actor.registerMessageHandler("RT",(Y,K)=>this._getWorkerSource(Y,K.type,K.source).reloadTile(K)),this.actor.registerMessageHandler("AT",(Y,K)=>this._getWorkerSource(Y,K.type,K.source).abortTile(K)),this.actor.registerMessageHandler("RMT",(Y,K)=>this._getWorkerSource(Y,K.type,K.source).removeTile(K)),this.actor.registerMessageHandler("RS",(Y,K)=>b._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][K.type]||!this.workerSources[Y][K.type][K.source])return;const he=this.workerSources[Y][K.type][K.source];delete this.workerSources[Y][K.type][K.source],he.removeSource!==void 0&&he.removeSource(K)})),this.actor.registerMessageHandler("RM",Y=>b._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,K)=>b._(this,void 0,void 0,function*(){this.referrer=K})),this.actor.registerMessageHandler("SRPS",(Y,K)=>this._syncRTLPluginState(Y,K)),this.actor.registerMessageHandler("IS",(Y,K)=>b._(this,void 0,void 0,function*(){this.self.importScripts(K)})),this.actor.registerMessageHandler("SI",(Y,K)=>this._setImages(Y,K)),this.actor.registerMessageHandler("UL",(Y,K)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(K.layers,K.removedIds)})),this.actor.registerMessageHandler("SL",(Y,K)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(K)}))}_setImages(W,Y){return b._(this,void 0,void 0,function*(){this.availableImages[W]=Y;for(const K in this.workerSources[W]){const he=this.workerSources[W][K];for(const Pe in he)he[Pe].availableImages=Y}})}_syncRTLPluginState(W,Y){return b._(this,void 0,void 0,function*(){return yield b.cD.syncState(Y,this.self.importScripts)})}_getAvailableImages(W){let Y=this.availableImages[W];return Y||(Y=[]),Y}_getLayerIndex(W){let Y=this.layerIndexes[W];return Y||(Y=this.layerIndexes[W]=new u),Y}_getWorkerSource(W,Y,K){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Y]||(this.workerSources[W][Y]={}),!this.workerSources[W][Y][K]){const he={sendAsync:(Pe,De)=>(Pe.targetMapId=W,this.actor.sendAsync(Pe,De))};switch(Y){case"vector":this.workerSources[W][Y][K]=new ge(he,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][Y][K]=new ls(he,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][Y][K]=new this.externalWorkerSourceTypes[Y](he,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][Y][K]}_getDEMWorkerSource(W,Y){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Y]||(this.demWorkerSources[W][Y]=new fe),this.demWorkerSources[W][Y]}}return b.i(self)&&(self.worker=new No(self)),No}),x("index",["exports","./shared"],function(b,u){var j="5.1.1";function Z(){var g=new u.A(4);return u.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let me,ge;const fe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,e,r){const c=requestAnimationFrame(e);g.signal.addEventListener("abort",()=>{cancelAnimationFrame(c),r(u.c())})},frameAsync(g){return new Promise((e,r)=>{this.frame(g,e,r)})},getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,r.drawImage(g,0,0,g.width,g.height),r},resolveURL:g=>(me||(me=document.createElement("a")),me.href=g,me.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ge==null&&(ge=matchMedia("(prefers-reduced-motion: reduce)")),ge.matches)}};class oe{static testProp(e){if(!oe.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in oe.docStyle)return e[r];return e[0]}static create(e,r,c){const d=window.document.createElement(e);return r!==void 0&&(d.className=r),c&&c.appendChild(d),d}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){oe.docStyle&&oe.selectProp&&(oe.userSelect=oe.docStyle[oe.selectProp],oe.docStyle[oe.selectProp]="none")}static enableDrag(){oe.docStyle&&oe.selectProp&&(oe.docStyle[oe.selectProp]=oe.userSelect)}static setTransform(e,r){e.style[oe.transformProp]=r}static addEventListener(e,r,c,d={}){e.addEventListener(r,c,"passive"in d?d:d.capture)}static removeEventListener(e,r,c,d={}){e.removeEventListener(r,c,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",oe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",oe.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",oe.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,c){const d=r.boundingClientRect;return new u.P((c.clientX-d.left)/r.x-e.clientLeft,(c.clientY-d.top)/r.y-e.clientTop)}static mousePos(e,r){const c=oe.getScale(e);return oe.getPoint(e,c,r)}static touchPos(e,r){const c=[],d=oe.getScale(e);for(let _=0;_<r.length;_++)c.push(oe.getPoint(e,d,r[_]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),c=r.querySelectorAll("script");for(const d of c)d.remove();return oe.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const c=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const c of r)oe.removeAttributes(c),oe.clean(c)}static removeAttributes(e){for(const{name:r,value:c}of e.attributes)oe.isPossiblyDangerous(r,c)&&e.removeAttribute(r)}}oe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,oe.selectProp=oe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),oe.transformProp=oe.testProp(["transform","WebkitTransform"]);const Be={supported:!1,testSupport:function(g){!Ie&&xt&&(ne?Te(g):_t=g)}};let _t,xt,Ie=!1,ne=!1;function Te(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,xt),g.isContextLost())return;Be.supported=!0}catch{}g.deleteTexture(e),Ie=!0}var Ne;typeof document<"u"&&(xt=document.createElement("img"),xt.onload=()=>{_t&&Te(_t),_t=null,ne=!0},xt.onerror=()=>{Ie=!0,_t=null},xt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let e,r,c,d;g.resetRequestQueue=()=>{e=[],r=0,c=0,d={}},g.addThrottleControl=M=>{const k=c++;return d[k]=M,k},g.removeThrottleControl=M=>{delete d[M],w()},g.getImage=(M,k,L=!0)=>new Promise((D,F)=>{Be.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),u.e(M,{type:"image"}),e.push({abortController:k,requestParameters:M,supportImageRefresh:L,state:"queued",onError:G=>{F(G)},onSuccess:G=>{D(G)}}),w()});const _=M=>u._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:k,supportImageRefresh:L,onError:D,onSuccess:F,abortController:G}=M,H=L===!1&&!u.i(self)&&!u.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((se,ce)=>se&&ce==="accept",!0));r++;const ie=H?P(k,G):u.m(k,G);try{const se=yield ie;delete M.abortController,M.state="completed",se.data instanceof HTMLImageElement||u.b(se.data)?F(se):se.data&&F({data:yield(re=se.data,typeof createImageBitmap=="function"?u.d(re):u.f(re)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete M.abortController,D(se)}finally{r--,w()}var re}),w=()=>{const M=(()=>{for(const k of Object.keys(d))if(d[k]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=r;k<M&&e.length>0;k++){const L=e.shift();L.abortController.signal.aborted?k--:_(L)}},P=(M,k)=>new Promise((L,D)=>{const F=new Image,G=M.url,H=M.credentials;H&&H==="include"?F.crossOrigin="use-credentials":(H&&H==="same-origin"||!u.s(G))&&(F.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{F.src="",D(u.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,L({data:F})},F.onerror=()=>{F.onerror=F.onload=null,k.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=G})}(Ne||(Ne={})),Ne.resetRequestQueue();class ut{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ct(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const r=[];for(const{id:c,url:d}of g){const _=`${c}${d}`;r.indexOf(_)===-1&&(r.push(_),e.push({id:c,url:d}))}}return e}function ht(g,e,r){try{const c=new URL(g);return c.pathname+=`${e}${r}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class ${constructor(e,r,c,d){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(r,d)}update(e,r,c){const{width:d,height:_}=e,w=!(this.size&&this.size[0]===d&&this.size[1]===_||c),{context:P}=this,{gl:M}=P;if(this.useMipmap=!!(r&&r.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!r||r.premultiply!==!1)),w)this.size=[d,_],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,d,_,0,this.format,M.UNSIGNED_BYTE,e.data);else{const{x:k,y:L}=c||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?M.texSubImage2D(M.TEXTURE_2D,0,k,L,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,k,L,d,_,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(e,r,c){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),c!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=_.LINEAR),e!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,e),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,c||e),this.filter=e),r!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,r),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function le(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class pe extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:c}of this.requestors)c(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const c=r.spriteData;r.data=new u.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let c=!0;const d=r.data||r.spriteData;return this._validateStretch(r.stretchX,d&&d.width)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,d&&d.height)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,r){if(!e)return!0;let c=0;for(const d of e){if(d[0]<c||d[1]<d[0]||r<d[1])return!1;c=d[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const c=r.spriteData,d=c&&c.width||r.data.width,_=c&&c.height||r.data.height;return!(e[0]<0||d<e[0]||e[1]<0||_<e[1]||e[2]<0||d<e[2]||e[3]<0||_<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,c=!0){const d=this.getImage(e);if(c&&(d.data.width!==r.data.width||d.data.height!==r.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=d.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,c)=>{let d=!0;if(!this.isLoaded())for(const _ of e)this.images[_]||(d=!1);this.isLoaded()||d?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const c of e){let d=this.getImage(c);d||(this.fire(new u.k("styleimagemissing",{id:c})),d=this.getImage(c)),d?r[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:u.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],c=this.getImage(e);if(!c)return null;if(r&&r.position.version===c.version)return r.position;if(r)r.position.version=c.version;else{const d={w:c.data.width+2,h:c.data.height+2,x:0,y:0},_=new u.I(d,c);this.patterns[e]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new $(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const _ in this.patterns)e.push(this.patterns[_].bin);const{w:r,h:c}=u.p(e),d=this.atlasImage;d.resize({width:r||1,height:c||1});for(const _ in this.patterns){const{bin:w}=this.patterns[_],P=w.x+1,M=w.y+1,k=this.getImage(_).data,L=k.width,D=k.height;u.R.copy(k,d,{x:0,y:0},{x:P,y:M},{width:L,height:D}),u.R.copy(k,d,{x:0,y:D-1},{x:P,y:M-1},{width:L,height:1}),u.R.copy(k,d,{x:0,y:0},{x:P,y:M+D},{width:L,height:1}),u.R.copy(k,d,{x:L-1,y:0},{x:P-1,y:M},{width:1,height:D}),u.R.copy(k,d,{x:0,y:0},{x:P+L,y:M},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const c=this.getImage(r);c||u.w(`Image with ID: "${r}" was not found`),le(c)&&this.updateImage(r,c)}}}const Ve=1e20;function Fe(g,e,r,c,d,_,w,P,M){for(let k=e;k<e+c;k++)je(g,r*_+k,_,d,w,P,M);for(let k=r;k<r+d;k++)je(g,k*_+e,1,c,w,P,M)}function je(g,e,r,c,d,_,w){_[0]=0,w[0]=-1e20,w[1]=Ve,d[0]=g[e];for(let P=1,M=0,k=0;P<c;P++){d[P]=g[e+P*r];const L=P*P;do{const D=_[M];k=(d[P]-d[D]+L-D*D)/(P-D)/2}while(k<=w[M]&&--M>-1);M++,_[M]=P,w[M]=k,w[M+1]=Ve}for(let P=0,M=0;P<c;P++){for(;w[M+1]<P;)M++;const k=_[M],L=P-k;g[e+P*r]=d[k]+L*L}}class Ye{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return u._(this,void 0,void 0,function*(){const r=[];for(const _ in e)for(const w of e[_])r.push(this._getAndCacheGlyphsPromise(_,w));const c=yield Promise.all(r),d={};for(const{stack:_,id:w,glyph:P}of c)d[_]||(d[_]={}),d[_][w]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return d})}_getAndCacheGlyphsPromise(e,r){return u._(this,void 0,void 0,function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=c.glyphs[r];if(d!==void 0)return{stack:e,id:r,glyph:d};if(d=this._tinySDF(c,e,r),d)return c.glyphs[r]=d,{stack:e,id:r,glyph:d};const _=Math.floor(r/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(c.ranges[_])return{stack:e,id:r,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!c.requests[_]){const P=Ye.loadGlyphRange(e,_,this.url,this.requestManager);c.requests[_]=P}const w=yield c.requests[_];for(const P in w)this._doesCharSupportLocalGlyph(+P)||(c.glyphs[+P]=w[+P]);return c.ranges[_]=!0,{stack:e,id:r,glyph:w[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||u.u["CJK Unified Ideographs"](e)||u.u["Hangul Syllables"](e)||u.u.Hiragana(e)||u.u.Katakana(e)||u.u["CJK Symbols and Punctuation"](e)||u.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,c){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let _=e.tinySDF;if(!_){let P="400";/bold/i.test(r)?P="900":/medium/i.test(r)?P="500":/light/i.test(r)&&(P="200"),_=e.tinySDF=new Ye.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:P})}const w=_.draw(String.fromCharCode(c));return{id:c,bitmap:new u.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ye.loadGlyphRange=function(g,e,r,c){return u._(this,void 0,void 0,function*(){const d=256*e,_=d+255,w=c.transformRequest(r.replace("{fontstack}",g).replace("{range}",`${d}-${_}`),"Glyphs"),P=yield u.l(w,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${_}`);const M={};for(const k of u.n(P.data))M[k.id]=k;return M})},Ye.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:r=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:w="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=r;const P=this.size=g+4*e,M=this._createCanvas(P),k=this.ctx=M.getContext("2d",{willReadFrequently:!0});k.font=`${w} ${_} ${g}px ${d}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(g),w=Math.ceil(r),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),M=Math.min(this.size-this.buffer,w+Math.ceil(c)),k=P+2*this.buffer,L=M+2*this.buffer,D=Math.max(k*L,0),F=new Uint8ClampedArray(D),G={data:F,width:k,height:L,glyphWidth:P,glyphHeight:M,glyphTop:w,glyphLeft:0,glyphAdvance:e};if(P===0||M===0)return G;const{ctx:H,buffer:ie,gridInner:re,gridOuter:se}=this;H.clearRect(ie,ie,P,M),H.fillText(g,ie,ie+w);const ce=H.getImageData(ie,ie,P,M);se.fill(Ve,0,D),re.fill(0,0,D);for(let ve=0;ve<M;ve++)for(let xe=0;xe<P;xe++){const Se=ce.data[4*(ve*P+xe)+3]/255;if(Se===0)continue;const Ce=(ve+ie)*k+xe+ie;if(Se===1)se[Ce]=0,re[Ce]=Ve;else{const Ee=.5-Se;se[Ce]=Ee>0?Ee*Ee:0,re[Ce]=Ee<0?Ee*Ee:0}}Fe(se,0,0,k,L,k,this.f,this.v,this.z),Fe(re,ie,ie,P,M,k,this.f,this.v,this.z);for(let ve=0;ve<D;ve++){const xe=Math.sqrt(se[ve])-Math.sqrt(re[ve]);F[ve]=Math.round(255-255*(xe/this.radius+this.cutoff))}return G}};class Le{constructor(){this.specification=u.v.light.position}possiblyEvaluate(e,r){return u.y(e.expression.evaluate(r))}interpolate(e,r,c){return{x:u.z.number(e.x,r.x,c),y:u.z.number(e.y,r.y,c),z:u.z.number(e.z,r.z,c)}}}let ze;class We extends u.E{constructor(e){super(),ze=ze||new u.q({anchor:new u.D(u.v.light.anchor),position:new Le,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(ze),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(u.r,e,r))for(const c in e){const d=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c){return(!c||c.validate!==!1)&&u.t(this,e.call(u.x,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const be=new u.q({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class Ke extends u.E{constructor(e){super(),this._transitionable=new u.T(be),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.B(0))}setSky(e,r={}){if(!this._validate(u.C,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in e){const d=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c={}){return(c==null?void 0:c.validate)!==!1&&u.t(this,e.call(u.x,u.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ye{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const c=e.join(",")+String(r);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,r)),this.dashEntry[c]}getDashRanges(e,r,c){const d=[];let _=e.length%2==1?-e[e.length-1]*c:0,w=e[0]*c,P=!0;d.push({left:_,right:w,isDash:P,zeroLength:e[0]===0});let M=e[0];for(let k=1;k<e.length;k++){P=!P;const L=e[k];_=M*c,M+=L,w=M*c,d.push({left:_,right:w,isDash:P,zeroLength:L===0})}return d}addRoundDash(e,r,c){const d=r/2;for(let _=-c;_<=c;_++){const w=this.width*(this.nextRow+c+_);let P=0,M=e[P];for(let k=0;k<this.width;k++){k/M.right>1&&(M=e[++P]);const L=Math.abs(k-M.left),D=Math.abs(k-M.right),F=Math.min(L,D);let G;const H=_/c*(d+1);if(M.isDash){const ie=d-Math.abs(H);G=Math.sqrt(F*F+ie*ie)}else G=d-Math.sqrt(F*F+H*H);this.data[w+k]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let P=e.length-1;P>=0;--P){const M=e[P],k=e[P+1];M.zeroLength?e.splice(P,1):k&&k.isDash===M.isDash&&(k.left=M.left,e.splice(P,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const d=this.width*this.nextRow;let _=0,w=e[_];for(let P=0;P<this.width;P++){P/w.right>1&&(w=e[++_]);const M=Math.abs(P-w.left),k=Math.abs(P-w.right),L=Math.min(M,k);this.data[d+P]=Math.max(0,Math.min(255,(w.isDash?L:-L)+128))}}addDash(e,r){const c=r?7:0,d=2*c+1;if(this.nextRow+d>this.height)return u.w("LineAtlas out of space"),null;let _=0;for(let P=0;P<e.length;P++)_+=e[P];if(_!==0){const P=this.width/_,M=this.getDashRanges(e,this.width,P);r?this.addRoundDash(M,P,c):this.addRegularDash(M)}const w={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:_};return this.nextRow+=d,this.dirty=!0,w}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const ue="maplibre_preloaded_worker_pool";class gt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<gt.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ue]}numActive(){return Object.keys(this.active).length}}const At=Math.floor(fe.hardwareConcurrency/2);let Lt,bt;function zt(){return Lt||(Lt=new gt),Lt}gt.workerCount=u.F(globalThis)?Math.max(Math.min(At,3),1):1;class Ft{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const c=this.workerPool.acquire(r);for(let d=0;d<c.length;d++){const _=new u.G(c[d],r);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const c=[];for(const d of this.actors)c.push(d.sendAsync({type:e,data:r}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const c of this.actors)c.registerMessageHandler(e,r)}}function Kt(){return bt||(bt=new Ft(zt(),u.H),bt.registerMessageHandler("GR",(g,e,r)=>u.m(e,r))),bt}function on(g,e){const r=u.J();return u.K(r,r,[1,1,0]),u.L(r,r,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?u.M(r,r,g.calculatePosMatrix(e.toUnwrapped())):r}function Dn(g,e,r,c,d,_){var w;const P=function(D,F,G){if(D)for(const H of D){const ie=F[H];if(ie&&ie.source===G&&ie.type==="fill-extrusion")return!0}else for(const H in F){const ie=F[H];if(ie.source===G&&ie.type==="fill-extrusion")return!0}return!1}((w=d==null?void 0:d.layers)!==null&&w!==void 0?w:null,e,g.id),M=_.maxPitchScaleFactor(),k=g.tilesIn(c,M,P);k.sort(Ht);const L=[];for(const D of k)L.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(e,r,g._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,d,_,M,on(g.transform,D.tileID))});return function(D,F){for(const G in D)for(const H of D[G])tn(H,F);return D}(function(D){const F={},G={};for(const H of D){const ie=H.queryResults,re=H.wrappedTileID,se=G[re]=G[re]||{};for(const ce in ie){const ve=ie[ce],xe=se[ce]=se[ce]||{},Se=F[ce]=F[ce]||[];for(const Ce of ve)xe[Ce.featureIndex]||(xe[Ce.featureIndex]=!0,Se.push(Ce))}}return F}(L),g)}function Ht(g,e){const r=g.tileID,c=e.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function tn(g,e){const r=g.feature,c=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=c}function gn(g,e,r){return u._(this,void 0,void 0,function*(){let c=g;if(g.url?c=(yield u.h(e.transformRequest(g.url,"Source"),r)).data:yield fe.frameAsync(r),!c)return null;const d=u.N(u.e(c,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(d.vectorLayerIds=c.vector_layers.map(_=>_.id)),d})}class Rt{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof u.O?new u.O(e.lng,e.lat):u.O.convert(e),this}setSouthWest(e){return this._sw=e instanceof u.O?new u.O(e.lng,e.lat):u.O.convert(e),this}extend(e){const r=this._sw,c=this._ne;let d,_;if(e instanceof u.O)d=e,_=e;else{if(!(e instanceof Rt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Rt.convert(e)):this.extend(u.O.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(u.O.convert(e)):this;if(d=e._sw,_=e._ne,!d||!_)return this}return r||c?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new u.O(d.lng,d.lat),this._ne=new u.O(_.lng,_.lat)),this}getCenter(){return new u.O((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.O(this.getWest(),this.getNorth())}getSouthEast(){return new u.O(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:c}=u.O.convert(e);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(e){return e instanceof Rt?e:e&&new Rt(e)}static fromLngLat(e,r=0){const c=360*r/40075017,d=c/Math.cos(Math.PI/180*e.lat);return new Rt(new u.O(e.lng-d,e.lat-c),new u.O(e.lng+d,e.lat+c))}adjustAntiMeridian(){const e=new u.O(this._sw.lng,this._sw.lat),r=new u.O(this._ne.lng,this._ne.lat);return new Rt(e,e.lng>r.lng?new u.O(r.lng+360,r.lat):r)}}class rn{constructor(e,r,c){this.bounds=Rt.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),c=Math.floor(u.S(this.bounds.getWest())*r),d=Math.floor(u.Q(this.bounds.getNorth())*r),_=Math.ceil(u.S(this.bounds.getEast())*r),w=Math.ceil(u.Q(this.bounds.getSouth())*r);return e.x>=c&&e.x<_&&e.y>=d&&e.y<w}}class Fr extends u.E{constructor(e,r,c,d){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.N(r,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield gn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(u.e(this,e),e.bounds&&(this.tileBounds=new rn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(e){return u._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};c.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((_,w)=>{e.reloadPromise={resolve:_,reject:w}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const _=yield e.actor.sendAsync({type:d,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,_)}catch(_){if(delete e.abortController,e.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Un extends u.E{constructor(e,r,c,d){super(),this.id=e,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},r),u.e(this,u.N(r,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield gn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(u.e(this,r),r.bounds&&(this.tileBounds=new rn(r.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this.fire(new u.j(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return u.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return u._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const c=yield Ne.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const d=this.map.painter.context,_=d.gl,w=c.data;e.texture=this.map.painter.getTileTexture(w.width),e.texture?e.texture.update(w,{useMipmap:!0}):(e.texture=new $(d,w,_.RGBA,{useMipmap:!0}),e.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Br extends Un{constructor(e,r,c,d){super(e,r,c,d),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return u._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield Ne.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const w=u.b(_)&&u.U()?_:yield this.readImageNow(_),P={type:this.type,uid:e.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const M=yield e.actor.sendAsync({type:"LDT",data:P});e.dem=M,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.V()){const r=e.width+2,c=e.height+2;try{return new u.R({width:r,height:c},yield u.W(e,-1,-1,r,c))}catch{}}return fe.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,c=Math.pow(2,r.z),d=(r.x-1+c)%c,_=r.x===0?e.wrap-1:e.wrap,w=(r.x+1+c)%c,P=r.x+1===c?e.wrap+1:e.wrap,M={};return M[new u.X(e.overscaledZ,_,r.z,d,r.y).key]={backfilled:!1},M[new u.X(e.overscaledZ,P,r.z,w,r.y).key]={backfilled:!1},r.y>0&&(M[new u.X(e.overscaledZ,_,r.z,d,r.y-1).key]={backfilled:!1},M[new u.X(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},M[new u.X(e.overscaledZ,P,r.z,w,r.y-1).key]={backfilled:!1}),r.y+1<c&&(M[new u.X(e.overscaledZ,_,r.z,d,r.y+1).key]={backfilled:!1},M[new u.X(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},M[new u.X(e.overscaledZ,P,r.z,w,r.y+1).key]={backfilled:!1}),M}unloadTile(e){return u._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class hi extends u.E{constructor(e,r,c,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(d),this._data=r.data,this._options=u.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:u.Y,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:u.Y,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(u.Y/this.tileSize)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return u._(this,void 0,void 0,function*(){const e=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:c}})}_updateWorkerData(e){return u._(this,void 0,void 0,function*(){const r=u.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(fe.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||c.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let d=null;c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&u.e(_,{resourceTiming:d}),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(c){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(c))}})}loaded(){return this._pendingLoads===0}loadTile(e){return u._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:r,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,r==="RT")})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Kn extends u.E{constructor(e,r,c,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=r}load(e){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Ne.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new u.j(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(u.Z.fromLngLat);var c;return this.tileID=function(d){let _=1/0,w=1/0,P=-1/0,M=-1/0;for(const F of d)_=Math.min(_,F.x),w=Math.min(w,F.y),P=Math.max(P,F.x),M=Math.max(M,F.y);const k=Math.max(P-_,M-w),L=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),D=Math.pow(2,L);return new u.$(L,Math.floor((_+P)/2*D),Math.floor((w+M)/2*D))}(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(d=>this.tileID.getTilePoint(d)._round()),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new $(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Or extends Kn{constructor(e,r,c,d){super(e,r,c,d),this.roundZoom=!0,this.type="video",this.options=r}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield u.a0(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new u.j(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new u.j(new u.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new $(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Di extends Kn{constructor(e,r,c,d){super(e,r,c,d),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(w=>typeof w!="number"))||this.fire(new u.j(new u.a1(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a1(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new u.j(new u.a1(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a1(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a1(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,c=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new $(r,this.canvas,c.RGBA,{premultiply:!0});let d=!1;for(const _ in this.tiles){const w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Fi={},Fs=g=>{switch(g){case"geojson":return hi;case"image":return Kn;case"raster":return Un;case"raster-dem":return Br;case"vector":return Fr;case"video":return Or;case"canvas":return Di}return Fi[g]},Bi="RTLPluginLoaded";class eo extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Kt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return u._(this,arguments,void 0,function*(r,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=fe.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(Bi))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Oi=null;function di(){return Oi||(Oi=new eo),Oi}class to{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=u.a2(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,_){const w={};if(!_)return w;for(const P of d){const M=P.layerIds.map(k=>_.getLayer(k)).filter(Boolean);if(M.length!==0){P.layers=M,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(k=>M.filter(L=>L.id===k)[0]));for(const k of M)w[k.id]=P}}return w}(e.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof u.a4){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof u.a4&&_.hasRTLText){this.hasRTLText=!0,di().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(d).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u.a3}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,c,d,_,w,P,M,k,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:w,tileSize:this.tileSize,pixelPosMatrix:L,transform:M,params:P,queryPadding:this.queryPadding*k},e,r,c):{}}querySourceFeatures(e,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",w=d._geojsonTileLayer||d[_];if(!w)return;const P=u.a5(r&&r.filter),{z:M,x:k,y:L}=this.tileID.canonical,D={z:M,x:k,y:L};for(let F=0;F<w.length;F++){const G=w.feature(F);if(P.needGeometry){const re=u.a6(G,!0);if(!P.filter(new u.B(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!P.filter(new u.B(this.tileID.overscaledZ),G))continue;const H=c.getId(G,_),ie=new u.a7(G,M,k,L,H);ie.tile=D,e.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const c=u.a8(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{const _=this.expirationTime-r;_?this.expirationTime=c+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const _=this.buckets[d],w=_.layers[0].sourceLayer||"_geojsonTileLayer",P=c[w],M=e[w];if(!P||!M||Object.keys(M).length===0)continue;_.update(M,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=r&&r.style&&r.style.getLayer(d);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=fe.now()+e}setDependencies(e,r){const c={};for(const d of r)c[d]=!0;this.dependencies[e]=c}hasDependency(e,r){for(const c of e){const d=this.dependencies[c];if(d){for(const _ of r)if(d[_])return!0}}return!1}}class Ni{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,c){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:r,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout(()=>{this.remove(e,_)},c)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const c=e.wrapped().key,d=r===void 0?0:this.data[c].indexOf(r),_=this.data[c][d];return this.data[c].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const c in this.data)for(const d of this.data[c])e(d.value)||r.push(d);for(const c of r)this.remove(c.value.tileID,c)}}class no{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,c){const d=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},u.e(this.stateChanges[e][d],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const _ in this.state[e])_!==d&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const _ in this.state[e][d])c[_]||(this.deletedStates[e][d][_]=null)}else for(const _ in c)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][_]===null&&delete this.deletedStates[e][d][_]}removeFeatureState(e,r,c){if(this.deletedStates[e]===null)return;const d=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&r!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][c]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(c in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][c]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,r){const c=String(r),d=u.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const _=this.deletedStates[e][r];if(_===null)return{};for(const w in _)delete d[w]}return d}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const w in this.stateChanges[d])this.state[d][w]||(this.state[d][w]={}),u.e(this.state[d][w],this.stateChanges[d][w]),_[w]=this.state[d][w];c[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const w in this.state[d])_[w]={},this.state[d][w]={};else for(const w in this.deletedStates[d]){if(this.deletedStates[d][w]===null)this.state[d][w]={};else for(const P of Object.keys(this.deletedStates[d][w]))delete this.state[d][w][P];_[w]=this.state[d][w]}c[d]=c[d]||{},u.e(c[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in e)e[d].setFeatureState(c,r)}}function Oo(g,e,r){const c=e.intersectsFrustum(g);if(!r)return c;const d=e.intersectsPlane(r);return c===0||d===0?0:c===2&&d===2?2:1}function ls(g,e,r,c,d){let _=g;const w=Math.atan(e/r),P=Math.hypot(e,r);return _=g+u.a9(c/P/Math.max(.5,Math.cos(u.ab(d/2)))),_+=1*u.a9(Math.cos(w))/2,_+=u.ac(g-_,-0,0),_}function No(g,e){const r=(e.roundZoom?Math.round:Math.floor)(g.zoom+u.a9(g.tileSize/e.tileSize));return Math.max(0,r)}function te(g,e){const r=g.getCameraFrustum(),c=g.getClippingPlane(),d=g.screenPointToMercatorCoordinate(g.getCameraPoint()),_=u.Z.fromLngLat(g.center,g.elevation);d.z=_.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const w=g.getCoveringTilesDetailsProvider(),P=w.allowVariableZoom(g,e),M=No(g,e),k=e.minzoom||0,L=e.maxzoom!==void 0?e.maxzoom:g.maxZoom,D=Math.min(Math.max(0,M),L),F=Math.pow(2,D),G=[F*d.x,F*d.y,0],H=[F*_.x,F*_.y,0],ie=Math.hypot(_.x-d.x,_.y-d.y),re=Math.abs(_.z-d.z),se=Math.hypot(ie,re),ce=Se=>({zoom:0,x:0,y:0,wrap:Se,fullyVisible:!1}),ve=[],xe=[];if(g.renderWorldCopies&&w.allowWorldCopies())for(let Se=1;Se<=3;Se++)ve.push(ce(-Se)),ve.push(ce(Se));for(ve.push(ce(0));ve.length>0;){const Se=ve.pop(),Ce=Se.x,Ee=Se.y;let $e=Se.fullyVisible;const qe={x:Ce,y:Ee,z:Se.zoom},nt=w.getTileAABB(qe,Se.wrap,g.elevation,e);if(!$e){const Tt=Oo(r,nt,c);if(Tt===0)continue;$e=Tt===2}const at=w.distanceToTile2d(d.x,d.y,qe,nt);let Qe=M;P&&(Qe=(e.calculateTileZoom||ls)(g.zoom+u.a9(g.tileSize/e.tileSize),at,re,se,g.fov)),Qe=(e.roundZoom?Math.round:Math.floor)(Qe),Qe=Math.max(0,Qe);const lt=Math.min(Qe,L);if(Se.wrap=w.getWrap(_,qe,Se.wrap),Se.zoom>=lt){if(Se.zoom<k)continue;const Tt=D-Se.zoom,ft=G[0]-.5-(Ce<<Tt),Et=G[1]-.5-(Ee<<Tt),an=e.reparseOverscaled?Math.max(Se.zoom,Qe):Se.zoom;xe.push({tileID:new u.X(Se.zoom===L?an:Se.zoom,Se.wrap,Se.zoom,Ce,Ee),distanceSq:u.aa([H[0]-.5-Ce,H[1]-.5-Ee]),tileDistanceToCamera:Math.sqrt(ft*ft+Et*Et)})}else for(let Tt=0;Tt<4;Tt++)ve.push({zoom:Se.zoom+1,x:(Ce<<1)+Tt%2,y:(Ee<<1)+(Tt>>1),wrap:Se.wrap,fullyVisible:$e})}return xe.sort((Se,Ce)=>Se.distanceSq-Ce.distanceSq).map(Se=>Se.tileID)}class W extends u.E{constructor(e,r,c){super(),this.id=e,this.dispatcher=c,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,_,w,P)=>{const M=new(Fs(_.type))(d,_,w,P);if(M.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${M.id}`);return M})(e,r,c,this),this._tiles={},this._cache=new Ni(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new no,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,c){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,c)}catch(d){e.state="errored",d.status!==404?this._source.fire(new u.j(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new u.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Y).map(e=>e.key)}getRenderableIds(e){const r=[];for(const c in this._tiles)this._isIdRenderable(c,e)&&r.push(this._tiles[c]);return e?r.sort((c,d)=>{const _=c.tileID,w=d.tileID,P=new u.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians),M=new u.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians);return _.overscaledZ-w.overscaledZ||M.y-P.y||M.x-P.x}).map(c=>c.tileID.key):r.map(c=>c.tileID).sort(Y).map(c=>c.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)(e||this._tiles[r].state!=="errored")&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return u._(this,void 0,void 0,function*(){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=r),yield this._loadTile(c,e,r))})}_tileLoaded(e,r,c){e.timeAdded=fe.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let d=0;d<r.length;d++){const _=r[d];if(e.neighboringTiles&&e.neighboringTiles[_]){const w=this.getTileByID(_);c(e,w),c(w,e)}}function c(d,_){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let w=_.tileID.canonical.x-d.tileID.canonical.x;const P=_.tileID.canonical.y-d.tileID.canonical.y,M=Math.pow(2,d.tileID.canonical.z),k=_.tileID.key;w===0&&P===0||Math.abs(P)>1||(Math.abs(w)>1&&(Math.abs(w+M)===1?w+=M:Math.abs(w-M)===1&&(w-=M)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,w,P),d.neighboringTiles&&d.neighboringTiles[k]&&(d.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,c,d){for(const _ in this._tiles){let w=this._tiles[_];if(d[_]||!w.hasData()||w.tileID.overscaledZ<=r||w.tileID.overscaledZ>c)continue;let P=w.tileID;for(;w&&w.tileID.overscaledZ>r+1;){const k=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[k.key],w&&w.hasData()&&(P=k)}let M=P;for(;M.overscaledZ>r;)if(M=M.scaledTo(M.overscaledZ-1),e[M.key]||e[M.canonical.key]){d[P.key]=P;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=e.overscaledZ-1;c>=r;c--){const d=e.scaledTo(c),_=this._getLoadedTile(d);if(_)return _}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(r*c*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const c={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),c[_.tileID.key]=_}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,r,c,d,_,w){const P={},M={},k=Object.keys(e),L=fe.now();for(const D of k){const F=e[D],G=this._tiles[D];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=L)continue;const H=this.findLoadedParent(F,r),ie=this.findLoadedSibling(F),re=H||ie||null;re&&(this._addTile(re.tileID),P[re.tileID.key]=re.tileID),M[D]=F}this._retainLoadedChildren(M,d,c,e);for(const D in P)e[D]||(this._coveredTiles[D]=!0,e[D]=P[D]);if(w){const D={},F={};for(const G of _)this._tiles[G.key].hasData()?D[G.key]=G:F[G.key]=G;for(const G in F){const H=F[G].children(this._source.maxzoom);this._tiles[H[0].key]&&this._tiles[H[1].key]&&this._tiles[H[2].key]&&this._tiles[H[3].key]&&(D[H[0].key]=e[H[0].key]=H[0],D[H[1].key]=e[H[1].key]=H[1],D[H[2].key]=e[H[2].key]=H[2],D[H[3].key]=e[H[3].key]=H[3],delete F[G])}for(const G in F){const H=F[G],ie=this.findLoadedParent(H,this._source.minzoom),re=this.findLoadedSibling(H),se=ie||re||null;if(se){D[se.tileID.key]=e[se.tileID.key]=se.tileID;for(const ce in D)D[ce].isChildOf(se.tileID)&&delete D[ce]}}for(const G in this._tiles)D[G]||(this._coveredTiles[G]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new u.X(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)):(c=te(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter(L=>this._source.hasTile(L)))):c=[];const d=No(e,this._source),_=Math.max(d-W.maxOverzooming,this._source.minzoom),w=Math.max(d+W.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const D of c)if(D.canonical.z>this._source.minzoom){const F=D.scaledTo(D.canonical.z-1);L[F.key]=F;const G=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));L[G.key]=G}c=c.concat(Object.values(L))}const P=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(c,d);K(this._source.type)&&this._updateCoveredAndRetainedTiles(M,_,w,d,c,r);for(const L in M)this._tiles[L].clearFadeHold();const k=u.ad(this._tiles,M);for(const L of k){const D=this._tiles[L];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var c;const d={},_={},w=Math.max(r-W.maxOverzooming,this._source.minzoom),P=Math.max(r+W.maxUnderzooming,this._source.minzoom),M={};for(const k of e){const L=this._addTile(k);d[k.key]=k,L.hasData()||r<this._source.maxzoom&&(M[k.key]=k)}this._retainLoadedChildren(M,r,P,d);for(const k of e){let L=this._tiles[k.key];if(L.hasData())continue;if(r+1>this._source.maxzoom){const F=k.children(this._source.maxzoom)[0],G=this.getTile(F);if(G&&G.hasData()){d[F.key]=F;continue}}else{const F=k.children(this._source.maxzoom);if(d[F[0].key]&&d[F[1].key]&&d[F[2].key]&&d[F[3].key])continue}let D=L.wasRequested();for(let F=k.overscaledZ-1;F>=w;--F){const G=k.scaledTo(F);if(_[G.key])break;if(_[G.key]=!0,L=this.getTile(G),!L&&D&&(L=this._addTile(G)),L){const H=L.hasData();if((H||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||D)&&(d[G.key]=G),D=L.wasRequested(),H)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let c,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}r.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;d=_}for(const _ of r)this._loadedParentTiles[_]=c}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,c=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=c}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const c=r;return r||(r=new to(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,c||this._source.fire(new u.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const c=r.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,c){const d=[],_=this.transform;if(!_)return d;const w=c?_.getCameraQueryGeometry(e):e,P=e.map(H=>_.screenPointToMercatorCoordinate(H,this.terrain)),M=w.map(H=>_.screenPointToMercatorCoordinate(H,this.terrain)),k=this.getIds();let L=1/0,D=1/0,F=-1/0,G=-1/0;for(const H of M)L=Math.min(L,H.x),D=Math.min(D,H.y),F=Math.max(F,H.x),G=Math.max(G,H.y);for(let H=0;H<k.length;H++){const ie=this._tiles[k[H]];if(ie.holdingForFade())continue;const re=ie.tileID,se=Math.pow(2,_.zoom-ie.tileID.overscaledZ),ce=r*ie.queryPadding*u.Y/ie.tileSize/se,ve=[re.getTilePoint(new u.Z(L,D)),re.getTilePoint(new u.Z(F,G))];if(ve[0].x-ce<u.Y&&ve[0].y-ce<u.Y&&ve[1].x+ce>=0&&ve[1].y+ce>=0){const xe=P.map(Ce=>re.getTilePoint(Ce)),Se=M.map(Ce=>re.getTilePoint(Ce));d.push({tile:ie,tileID:re,queryGeometry:xe,cameraQueryGeometry:Se,scale:se})}}return d}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(K(this._source.type)){const e=fe.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,c){this._state.updateState(e=e||"_geojsonTileLayer",r,c)}removeFeatureState(e,r,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,c)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,c){const d=this._tiles[e];d&&d.setDependencies(r,c)}reloadTilesForDependencies(e,r){for(const c in this._tiles)this._tiles[c].hasDependency(e,r)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(e,r))}}function Y(g,e){const r=Math.abs(2*g.wrap)-+(g.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||c-r||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function K(g){return g==="raster"||g==="image"||g==="video"}W.maxOverzooming=10,W.maxUnderzooming=3;class he{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=u.ac(e,0,1);let r=1,c=this._distances[r];const d=e*this.paddedLength+this.padding;for(;c<d&&r<this._distances.length;)c=this._distances[++r];const _=r-1,w=this._distances[_],P=c-w,M=P>0?(d-w)/P:0;return this.points[_].mult(1-M).add(this.points[r].mult(M))}}function Pe(g,e){let r=!0;return g==="always"||g!=="never"&&e!=="never"||(r=!1),r}class De{constructor(e,r,c){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(r/c);for(let w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,c,d,_){this._forEachCell(r,c,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(e,r,c,d){this._forEachCell(r-d,c-d,r+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(c),this.circles.push(d)}_insertBoxCell(e,r,c,d,_,w){this.boxCells[_].push(w)}_insertCircleCell(e,r,c,d,_,w){this.circleCells[_].push(w)}_query(e,r,c,d,_,w,P){if(c<0||e>this.width||d<0||r>this.height)return[];const M=[];if(e<=0&&r<=0&&this.width<=c&&this.height<=d){if(_)return[{key:null,x1:e,y1:r,x2:c,y2:d}];for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],D=this.circles[3*k+1],F=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:L-F,y1:D-F,x2:L+F,y2:D+F})}}else this._forEachCell(e,r,c,d,this._queryCell,M,{hitTest:_,overlapMode:w,seenUids:{box:{},circle:{}}},P);return M}query(e,r,c,d){return this._query(e,r,c,d,!1,null)}hitTest(e,r,c,d,_,w){return this._query(e,r,c,d,!0,_,w).length>0}hitTestCircle(e,r,c,d,_){const w=e-c,P=e+c,M=r-c,k=r+c;if(P<0||w>this.width||k<0||M>this.height)return!1;const L=[];return this._forEachCell(w,M,P,k,this._queryCellCircle,L,{hitTest:!0,overlapMode:d,circle:{x:e,y:r,radius:c},seenUids:{box:{},circle:{}}},_),L.length>0}_queryCell(e,r,c,d,_,w,P,M){const{seenUids:k,hitTest:L,overlapMode:D}=P,F=this.boxCells[_];if(F!==null){const H=this.bboxes;for(const ie of F)if(!k.box[ie]){k.box[ie]=!0;const re=4*ie,se=this.boxKeys[ie];if(e<=H[re+2]&&r<=H[re+3]&&c>=H[re+0]&&d>=H[re+1]&&(!M||M(se))&&(!L||!Pe(D,se.overlapMode))&&(w.push({key:se,x1:H[re],y1:H[re+1],x2:H[re+2],y2:H[re+3]}),L))return!0}}const G=this.circleCells[_];if(G!==null){const H=this.circles;for(const ie of G)if(!k.circle[ie]){k.circle[ie]=!0;const re=3*ie,se=this.circleKeys[ie];if(this._circleAndRectCollide(H[re],H[re+1],H[re+2],e,r,c,d)&&(!M||M(se))&&(!L||!Pe(D,se.overlapMode))){const ce=H[re],ve=H[re+1],xe=H[re+2];if(w.push({key:se,x1:ce-xe,y1:ve-xe,x2:ce+xe,y2:ve+xe}),L)return!0}}}return!1}_queryCellCircle(e,r,c,d,_,w,P,M){const{circle:k,seenUids:L,overlapMode:D}=P,F=this.boxCells[_];if(F!==null){const H=this.bboxes;for(const ie of F)if(!L.box[ie]){L.box[ie]=!0;const re=4*ie,se=this.boxKeys[ie];if(this._circleAndRectCollide(k.x,k.y,k.radius,H[re+0],H[re+1],H[re+2],H[re+3])&&(!M||M(se))&&!Pe(D,se.overlapMode))return w.push(!0),!0}}const G=this.circleCells[_];if(G!==null){const H=this.circles;for(const ie of G)if(!L.circle[ie]){L.circle[ie]=!0;const re=3*ie,se=this.circleKeys[ie];if(this._circlesCollide(H[re],H[re+1],H[re+2],k.x,k.y,k.radius)&&(!M||M(se))&&!Pe(D,se.overlapMode))return w.push(!0),!0}}}_forEachCell(e,r,c,d,_,w,P,M){const k=this._convertToXCellCoord(e),L=this._convertToYCellCoord(r),D=this._convertToXCellCoord(c),F=this._convertToYCellCoord(d);for(let G=k;G<=D;G++)for(let H=L;H<=F;H++)if(_.call(this,e,r,c,d,this.xCellCount*H+G,w,P,M))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,c,d,_,w){const P=d-e,M=_-r,k=c+w;return k*k>P*P+M*M}_circleAndRectCollide(e,r,c,d,_,w,P){const M=(w-d)/2,k=Math.abs(e-(d+M));if(k>M+c)return!1;const L=(P-_)/2,D=Math.abs(r-(_+L));if(D>L+c)return!1;if(k<=M||D<=L)return!0;const F=k-M,G=D-L;return F*F+G*G<=c*c}}function He(g,e,r){const c=u.J();if(!g){const{vecSouth:D,vecEast:F}=rt(e),G=Z();G[0]=F[0],G[1]=F[1],G[2]=D[0],G[3]=D[1],d=G,(L=(w=(_=G)[0])*(k=_[3])-(M=_[2])*(P=_[1]))&&(d[0]=k*(L=1/L),d[1]=-P*L,d[2]=-M*L,d[3]=w*L),c[0]=G[0],c[1]=G[1],c[4]=G[2],c[5]=G[3]}var d,_,w,P,M,k,L;return u.L(c,c,[1/r,1/r,1]),c}function Re(g,e,r,c){if(g){const d=u.J();if(!e){const{vecSouth:_,vecEast:w}=rt(r);d[0]=w[0],d[1]=w[1],d[4]=_[0],d[5]=_[1]}return u.L(d,d,[c,c,1]),d}return r.pixelsToClipSpaceMatrix}function rt(g){const e=Math.cos(g.rollInRadians),r=Math.sin(g.rollInRadians),c=Math.cos(g.pitchInRadians),d=Math.cos(g.bearingInRadians),_=Math.sin(g.bearingInRadians),w=u.ai();w[0]=-d*c*r-_*e,w[1]=-_*c*r+d*e;const P=u.aj(w);P<1e-9?u.ak(w):u.al(w,w,1/P);const M=u.ai();M[0]=d*c*e-_*r,M[1]=_*c*e+d*r;const k=u.aj(M);return k<1e-9?u.ak(M):u.al(M,M,1/k),{vecEast:M,vecSouth:w}}function et(g,e,r,c){let d;c?(d=[g,e,c(g,e),1],u.an(d,d,r)):(d=[g,e,0,1],Sr(d,d,r));const _=d[3];return{point:new u.P(d[0]/_,d[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Ue(g,e){return .5+g/e*.5}function ke(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function Pt(g,e,r,c,d,_,w,P,M,k,L,D,F){const G=r?g.textSizeData:g.iconSizeData,H=u.ae(G,e.transform.zoom),ie=[256/e.width*2+1,256/e.height*2+1],re=r?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;re.clear();const se=g.lineVertexArray,ce=r?g.text.placedSymbolArray:g.icon.placedSymbolArray,ve=e.transform.width/e.transform.height;let xe=!1;for(let Se=0;Se<ce.length;Se++){const Ce=ce.get(Se);if(Ce.hidden||Ce.writingMode===u.af.vertical&&!xe){Nr(Ce.numGlyphs,re);continue}xe=!1;const Ee=new u.P(Ce.anchorX,Ce.anchorY),$e={getElevation:F,pitchedLabelPlaneMatrix:c,lineVertexArray:se,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:Ee,unwrappedTileID:M,width:k,height:L,translation:D},qe=En(Ce.anchorX,Ce.anchorY,$e);if(!ke(qe.point,ie)){Nr(Ce.numGlyphs,re);continue}const nt=Ue(e.transform.cameraToCenterDistance,qe.signedDistanceFromCamera),at=u.ag(G,H,Ce),Qe=_?at*e.transform.getPitchedTextCorrection(Ce.anchorX,Ce.anchorY,M)/nt:at*nt,lt=Jt({projectionContext:$e,pitchedLabelPlaneMatrixInverse:d,symbol:Ce,fontSize:Qe,flip:!1,keepUpright:w,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:re,aspectRatio:ve,rotateToLine:P});xe=lt.useVertical,(lt.notEnoughRoom||xe||lt.needsFlipping&&Jt({projectionContext:$e,pitchedLabelPlaneMatrixInverse:d,symbol:Ce,fontSize:Qe,flip:!0,keepUpright:w,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:re,aspectRatio:ve,rotateToLine:P}).notEnoughRoom)&&Nr(Ce.numGlyphs,re)}r?g.text.dynamicLayoutVertexBuffer.updateData(re):g.icon.dynamicLayoutVertexBuffer.updateData(re)}function Ct(g,e,r,c,d,_,w,P){const M=_.glyphStartIndex+_.numGlyphs,k=_.lineStartIndex,L=_.lineStartIndex+_.lineLength,D=e.getoffsetX(_.glyphStartIndex),F=e.getoffsetX(M-1),G=_r(g*D,r,c,d,_.segment,k,L,P,w);if(!G)return null;const H=_r(g*F,r,c,d,_.segment,k,L,P,w);return H?P.projectionCache.anyProjectionOccluded?null:{first:G,last:H}:null}function Wt(g,e,r,c){return g===u.af.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*c?{useVertical:!0}:(g===u.af.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function Jt(g){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:c,fontSize:d,flip:_,keepUpright:w,glyphOffsetArray:P,dynamicLayoutVertexArray:M,aspectRatio:k,rotateToLine:L}=g,D=d/24,F=c.lineOffsetX*D,G=c.lineOffsetY*D;let H;if(c.numGlyphs>1){const ie=c.glyphStartIndex+c.numGlyphs,re=c.lineStartIndex,se=c.lineStartIndex+c.lineLength,ce=Ct(D,P,F,G,_,c,L,e);if(!ce)return{notEnoughRoom:!0};const ve=fn(ce.first.point.x,ce.first.point.y,e,r),xe=fn(ce.last.point.x,ce.last.point.y,e,r);if(w&&!_){const Se=Wt(c.writingMode,ve,xe,k);if(Se)return Se}H=[ce.first];for(let Se=c.glyphStartIndex+1;Se<ie-1;Se++)H.push(_r(D*P.getoffsetX(Se),F,G,_,c.segment,re,se,e,L));H.push(ce.last)}else{if(w&&!_){const re=Ot(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,se=c.lineStartIndex+c.segment+1,ce=new u.P(e.lineVertexArray.getx(se),e.lineVertexArray.gety(se)),ve=Ot(ce.x,ce.y,e),xe=ve.signedDistanceFromCamera>0?ve.point:ot(e.tileAnchorPoint,ce,re,1,e),Se=fn(re.x,re.y,e,r),Ce=fn(xe.x,xe.y,e,r),Ee=Wt(c.writingMode,Se,Ce,k);if(Ee)return Ee}const ie=_r(D*P.getoffsetX(c.glyphStartIndex),F,G,_,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,e,L);if(!ie||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[ie]}for(const ie of H)u.am(M,ie.point,ie.angle);return{}}function ot(g,e,r,c,d){const _=g.add(g.sub(e)._unit()),w=Ot(_.x,_.y,d).point,P=r.sub(w);return r.add(P._mult(c/P.mag()))}function Mt(g,e,r){const c=e.projectionCache;if(c.projections[g])return c.projections[g];const d=new u.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),_=Ot(d.x,d.y,e);if(_.signedDistanceFromCamera>0)return c.projections[g]=_.point,c.anyProjectionOccluded=c.anyProjectionOccluded||_.isOccluded,_.point;const w=g-r.direction;return ot(r.distanceFromAnchor===0?e.tileAnchorPoint:new u.P(e.lineVertexArray.getx(w),e.lineVertexArray.gety(w)),d,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Ot(g,e,r){const c=g+r.translation[0],d=e+r.translation[1];let _;return r.pitchWithMap?(_=et(c,d,r.pitchedLabelPlaneMatrix,r.getElevation),_.isOccluded=!1):(_=r.transform.projectTileCoordinates(c,d,r.unwrappedTileID,r.getElevation),_.point.x=(.5*_.point.x+.5)*r.width,_.point.y=(.5*-_.point.y+.5)*r.height),_}function fn(g,e,r,c){if(r.pitchWithMap){const d=[g,e,0,1];return u.an(d,d,c),r.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],r.unwrappedTileID,r.getElevation).point}return{x:g/r.width*2-1,y:e/r.height*2-1}}function En(g,e,r){return r.transform.projectTileCoordinates(g,e,r.unwrappedTileID,r.getElevation)}function Yt(g,e,r){return g._unit()._perp()._mult(e*r)}function Dt(g,e,r,c,d,_,w,P,M){if(P.projectionCache.offsets[g])return P.projectionCache.offsets[g];const k=r.add(e);if(g+M.direction<c||g+M.direction>=d)return P.projectionCache.offsets[g]=k,k;const L=Mt(g+M.direction,P,M),D=Yt(L.sub(r),w,M.direction),F=r.add(D),G=L.add(D);return P.projectionCache.offsets[g]=u.ao(_,k,F,G)||k,P.projectionCache.offsets[g]}function _r(g,e,r,c,d,_,w,P,M){const k=c?g-e:g+e;let L=k>0?1:-1,D=0;c&&(L*=-1,D=Math.PI),L<0&&(D+=Math.PI);let F,G=L>0?_+d:_+d+1;P.projectionCache.cachedAnchorPoint?F=P.projectionCache.cachedAnchorPoint:(F=Ot(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=F);let H,ie,re=F,se=F,ce=0,ve=0;const xe=Math.abs(k),Se=[];let Ce;for(;ce+ve<=xe;){if(G+=L,G<_||G>=w)return null;ce+=ve,se=re,ie=H;const qe={absOffsetX:xe,direction:L,distanceFromAnchor:ce,previousVertex:se};if(re=Mt(G,P,qe),r===0)Se.push(se),Ce=re.sub(se);else{let nt;const at=re.sub(se);nt=at.mag()===0?Yt(Mt(G+L,P,qe).sub(re),r,L):Yt(at,r,L),ie||(ie=se.add(nt)),H=Dt(G,nt,re,_,w,ie,r,P,qe),Se.push(ie),Ce=H.sub(ie)}ve=Ce.mag()}const Ee=Ce._mult((xe-ce)/ve)._add(ie||se),$e=D+Math.atan2(re.y-se.y,re.x-se.x);return Se.push(Ee),{point:Ee,angle:M?$e:0,path:Se}}const Bs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Nr(g,e){for(let r=0;r<g;r++){const c=e.length;e.resize(c+4),e.float32.set(Bs,3*c)}}function Sr(g,e,r){const c=e[0],d=e[1];return g[0]=r[0]*c+r[4]*d+r[12],g[1]=r[1]*c+r[5]*d+r[13],g[3]=r[3]*c+r[7]*d+r[15],g}const ir=100;class ji{constructor(e,r=new De(e.width+200,e.height+200,25),c=new De(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ir,this.screenBottomBoundary=e.height+ir,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,c,d,_,w,P,M,k,L,D,F){const G=this.projectAndGetPerspectiveRatio(e.anchorPointX+M[0],e.anchorPointY+M[1],_,L,F),H=c*G.perspectiveRatio;let ie;if(w||P)ie=this._projectCollisionBox(e,H,d,_,w,P,M,G,L,D,F);else{const Ce=G.x+(D?D.x*H:0),Ee=G.y+(D?D.y*H:0);ie={allPointsOccluded:!1,box:[Ce+e.x1*H,Ee+e.y1*H,Ce+e.x2*H,Ee+e.y2*H]}}const[re,se,ce,ve]=ie.box,xe=w?ie.allPointsOccluded:G.isOccluded;let Se=xe;return Se||(Se=G.perspectiveRatio<this.perspectiveRatioCutoff),Se||(Se=!this.isInsideGrid(re,se,ce,ve)),Se||r!=="always"&&this.grid.hitTest(re,se,ce,ve,r,k)?{box:[re,se,ce,ve],placeable:!1,offscreen:!1,occluded:xe}:{box:[re,se,ce,ve],placeable:!0,offscreen:this.isOffscreen(re,se,ce,ve),occluded:xe}}placeCollisionCircles(e,r,c,d,_,w,P,M,k,L,D,F,G,H){const ie=[],re=new u.P(r.anchorX,r.anchorY),se=this.getPerspectiveRatio(re.x,re.y,w,H),ce=(k?_*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,w)/se:_*se)/u.at,ve={getElevation:H,pitchedLabelPlaneMatrix:P,lineVertexArray:c,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:re,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:G},xe=Ct(ce,d,r.lineOffsetX*ce,r.lineOffsetY*ce,!1,r,!1,ve);let Se=!1,Ce=!1,Ee=!0;if(xe){const $e=.5*D*se+F,qe=new u.P(-100,-100),nt=new u.P(this.screenRightBoundary,this.screenBottomBoundary),at=new he,Qe=xe.first,lt=xe.last;let Tt=[];for(let an=Qe.path.length-1;an>=1;an--)Tt.push(Qe.path[an]);for(let an=1;an<lt.path.length;an++)Tt.push(lt.path[an]);const ft=2.5*$e;if(k){const an=this.projectPathToScreenSpace(Tt,ve);Tt=an.some(kn=>kn.signedDistanceFromCamera<=0)?[]:an.map(kn=>kn.point)}let Et=[];if(Tt.length>0){const an=Tt[0].clone(),kn=Tt[0].clone();for(let ar=1;ar<Tt.length;ar++)an.x=Math.min(an.x,Tt[ar].x),an.y=Math.min(an.y,Tt[ar].y),kn.x=Math.max(kn.x,Tt[ar].x),kn.y=Math.max(kn.y,Tt[ar].y);Et=an.x>=qe.x&&kn.x<=nt.x&&an.y>=qe.y&&kn.y<=nt.y?[Tt]:kn.x<qe.x||an.x>nt.x||kn.y<qe.y||an.y>nt.y?[]:u.ap([Tt],qe.x,qe.y,nt.x,nt.y)}for(const an of Et){at.reset(an,.25*$e);let kn=0;kn=at.length<=.5*$e?1:Math.ceil(at.paddedLength/ft)+1;for(let ar=0;ar<kn;ar++){const xn=ar/Math.max(kn-1,1),lr=at.lerp(xn),On=lr.x+ir,Nn=lr.y+ir;ie.push(On,Nn,$e,0);const Wn=On-$e,Qr=Nn-$e,jn=On+$e,Qn=Nn+$e;if(Ee=Ee&&this.isOffscreen(Wn,Qr,jn,Qn),Ce=Ce||this.isInsideGrid(Wn,Qr,jn,Qn),e!=="always"&&this.grid.hitTestCircle(On,Nn,$e,e,L)&&(Se=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Se}}}}return{circles:!M&&Se||!Ce||se<this.perspectiveRatioCutoff?[]:ie,offscreen:Ee,collisionDetected:Se}}projectPathToScreenSpace(e,r){const c=function(d,_){const w=u.J();return u.ah(w,_.pitchedLabelPlaneMatrix),d.map(P=>{const M=et(P.x,P.y,w,_.getElevation),k=_.transform.projectTileCoordinates(M.point.x,M.point.y,_.unwrappedTileID,_.getElevation);return k.point.x=(.5*k.point.x+.5)*_.width,k.point.y=(.5*-k.point.y+.5)*_.height,k})}(e,r);return function(d){let _=0,w=0,P=0,M=0;for(let k=0;k<d.length;k++)d[k].isOccluded?(P=k+1,M=0):(M++,M>w&&(w=M,_=P));return d.slice(_,_+w)}(c)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let c=1/0,d=1/0,_=-1/0,w=-1/0;for(const L of e){const D=new u.P(L.x+ir,L.y+ir);c=Math.min(c,D.x),d=Math.min(d,D.y),_=Math.max(_,D.x),w=Math.max(w,D.y),r.push(D)}const P=this.grid.query(c,d,_,w).concat(this.ignoredGrid.query(c,d,_,w)),M={},k={};for(const L of P){const D=L.key;if(M[D.bucketInstanceId]===void 0&&(M[D.bucketInstanceId]={}),M[D.bucketInstanceId][D.featureIndex])continue;const F=[new u.P(L.x1,L.y1),new u.P(L.x2,L.y1),new u.P(L.x2,L.y2),new u.P(L.x1,L.y2)];u.aq(r,F)&&(M[D.bucketInstanceId][D.featureIndex]=!0,k[D.bucketInstanceId]===void 0&&(k[D.bucketInstanceId]=[]),k[D.bucketInstanceId].push(D.featureIndex))}return k}insertCollisionBox(e,r,c,d,_,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:w,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,c,d,_,w){const P=c?this.ignoredGrid:this.grid,M={bucketInstanceId:d,featureIndex:_,collisionGroupID:w,overlapMode:r};for(let k=0;k<e.length;k+=4)P.insertCircle(M,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,r,c,d,_){if(_){let w;d?(w=[e,r,d(e,r),1],u.an(w,w,_)):(w=[e,r,0,1],Sr(w,w,_));const P=w[3];return{x:(w[0]/P+1)/2*this.transform.width+ir,y:(-w[1]/P+1)/2*this.transform.height+ir,perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}{const w=this.transform.projectTileCoordinates(e,r,c,d);return{x:(w.point.x+1)/2*this.transform.width+ir,y:(1-w.point.y)/2*this.transform.height+ir,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,c,d){const _=this.transform.projectTileCoordinates(e,r,c,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(e,r,c,d){return c<ir||e>=this.screenRightBoundary||d<ir||r>this.screenBottomBoundary}isInsideGrid(e,r,c,d){return c>=0&&e<this.gridRightBoundary&&d>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=u.ar([]);return u.K(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,c,d,_,w,P,M,k,L,D){let F=1,G=0,H=0,ie=1;const re=e.anchorPointX+P[0],se=e.anchorPointY+P[1];if(w&&!_){const Tt=this.projectAndGetPerspectiveRatio(re+1,se,d,k,D),ft=Tt.x-M.x,Et=Math.atan((Tt.y-M.y)/ft)+(ft<0?Math.PI:0),an=Math.sin(Et),kn=Math.cos(Et);F=kn,G=an,H=-an,ie=kn}else if(!w&&_){const Tt=rt(this.transform);F=Tt.vecEast[0],G=Tt.vecEast[1],H=Tt.vecSouth[0],ie=Tt.vecSouth[1]}let ce=M.x,ve=M.y,xe=r;_&&(ce=re,ve=se,xe=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),xe*=this.transform.getPitchedTextCorrection(re,se,d),L||(xe*=u.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),L&&(ce+=F*L.x*xe+H*L.y*xe,ve+=G*L.x*xe+ie*L.y*xe);const Se=e.x1*xe,Ce=e.x2*xe,Ee=(Se+Ce)/2,$e=e.y1*xe,qe=e.y2*xe,nt=($e+qe)/2,at=[{offsetX:Se,offsetY:$e},{offsetX:Ee,offsetY:$e},{offsetX:Ce,offsetY:$e},{offsetX:Ce,offsetY:nt},{offsetX:Ce,offsetY:qe},{offsetX:Ee,offsetY:qe},{offsetX:Se,offsetY:qe},{offsetX:Se,offsetY:nt}];let Qe=[];for(const{offsetX:Tt,offsetY:ft}of at)Qe.push(new u.P(ce+F*Tt+H*ft,ve+G*Tt+ie*ft));let lt=!1;if(_){const Tt=Qe.map(ft=>this.projectAndGetPerspectiveRatio(ft.x,ft.y,d,k,D));lt=Tt.some(ft=>!ft.isOccluded),Qe=Tt.map(ft=>new u.P(ft.x,ft.y))}else lt=!0;return{box:u.as(Qe),allPointsOccluded:!lt}}}class or{constructor(e,r,c,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Bl{constructor(e,r,c,d,_){this.text=new or(e?e.text:null,r,c,_),this.icon=new or(e?e.icon:null,r,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ja{constructor(e,r,c){this.text=e,this.icon=r,this.skipFade=c}}class ph{constructor(e,r,c,d,_){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=_}}class jo{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[e]}}function pa(g,e,r,c,d){const{horizontalAlign:_,verticalAlign:w}=u.az(g);return new u.P(-(_-.5)*e+c[0]*d,-(w-.5)*r+c[1]*d)}class Ol{constructor(e,r,c,d,_){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new ji(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new jo(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(c,d)=>r.getElevation(e,c,d):null}getBucketParts(e,r,c,d){const _=c.getBucket(r),w=c.latestFeatureIndex;if(!_||!w||r.id!==_.layerIds[0])return;const P=c.collisionBoxArray,M=_.layers[0].layout,k=_.layers[0].paint,L=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),D=c.tileSize/u.Y,F=c.tileID.toUnwrapped(),G=M.get("text-rotation-alignment")==="map",H=u.au(c,1,this.transform.zoom),ie=u.av(this.collisionIndex.transform,c,k.get("text-translate"),k.get("text-translate-anchor")),re=u.av(this.collisionIndex.transform,c,k.get("icon-translate"),k.get("icon-translate-anchor")),se=He(G,this.transform,H);this.retainedQueryData[_.bucketInstanceId]=new ph(_.bucketInstanceId,w,_.sourceLayerIndex,_.index,c.tileID);const ce={bucket:_,layout:M,translationText:ie,translationIcon:re,unwrappedTileID:F,pitchedLabelPlaneMatrix:se,scale:L,textPixelRatio:D,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:u.ae(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const ve of _.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:Se,symbolInstanceEnd:Ce}=ve;e.push({sortKey:xe,symbolInstanceStart:Se,symbolInstanceEnd:Ce,parameters:ce})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(e,r,c,d,_,w,P,M,k,L,D,F,G,H,ie,re,se,ce,ve,xe){const Se=u.aw[e.textAnchor],Ce=[e.textOffset0,e.textOffset1],Ee=pa(Se,c,d,Ce,_),$e=this.collisionIndex.placeCollisionBox(r,F,M,k,L,P,w,re,D.predicate,ve,Ee,xe);if((!ce||this.collisionIndex.placeCollisionBox(ce,F,M,k,L,P,w,se,D.predicate,ve,Ee,xe).placeable)&&$e.placeable){let qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:Ce,width:c,height:d,anchor:Se,textBoxScale:_,prevAnchor:qe},this.markUsedJustification(H,Se,G,ie),H.allowVerticalPlacement&&(this.markUsedOrientation(H,ie,G),this.placedOrientations[G.crossTileID]=ie),{shift:Ee,placedGlyphBoxes:$e}}}placeLayerBucketPart(e,r,c){const{bucket:d,layout:_,translationText:w,translationIcon:P,unwrappedTileID:M,pitchedLabelPlaneMatrix:k,textPixelRatio:L,holdingForFade:D,collisionBoxArray:F,partiallyEvaluatedTextSize:G,collisionGroup:H}=e.parameters,ie=_.get("text-optional"),re=_.get("icon-optional"),se=u.ax(_,"text-overlap","text-allow-overlap"),ce=se==="always",ve=u.ax(_,"icon-overlap","icon-allow-overlap"),xe=ve==="always",Se=_.get("text-rotation-alignment")==="map",Ce=_.get("text-pitch-alignment")==="map",Ee=_.get("icon-text-fit")!=="none",$e=_.get("symbol-z-order")==="viewport-y",qe=ce&&(xe||!d.hasIconData()||re),nt=xe&&(ce||!d.hasTextData()||ie);!d.collisionArrays&&F&&d.deserializeCollisionBoxes(F);const at=this.retainedQueryData[d.bucketInstanceId].tileID,Qe=this._getTerrainElevationFunc(at),lt=this.transform.getFastPathSimpleProjectionMatrix(at),Tt=(ft,Et,an)=>{var kn,ar;if(r[ft.crossTileID])return;if(D)return void(this.placements[ft.crossTileID]=new Ja(!1,!1,!1));let xn=!1,lr=!1,On=!0,Nn=null,Wn={box:null,placeable:!1,offscreen:null,occluded:!1},Qr={placeable:!1},jn=null,Qn=null,oi=null,Jo=0,Zi=0,Ci=0;Et.textFeatureIndex?Jo=Et.textFeatureIndex:ft.useRuntimeCollisionCircles&&(Jo=ft.featureIndex),Et.verticalTextFeatureIndex&&(Zi=Et.verticalTextFeatureIndex);const Io=Et.textBox;if(Io){const Pr=Hn=>{let er=u.af.horizontal;if(d.allowVerticalPlacement&&!Hn&&this.prevPlacement){const qi=this.prevPlacement.placedOrientations[ft.crossTileID];qi&&(this.placedOrientations[ft.crossTileID]=qi,er=qi,this.markUsedOrientation(d,er,ft))}return er},ho=(Hn,er)=>{if(d.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&Et.verticalTextBox){for(const qi of d.writingModes)if(qi===u.af.vertical?(Wn=er(),Qr=Wn):Wn=Hn(),Wn&&Wn.placeable)break}else Wn=Hn()},Ur=ft.textAnchorOffsetStartIndex,Pi=ft.textAnchorOffsetEndIndex;if(Pi===Ur){const Hn=(er,qi)=>{const fr=this.collisionIndex.placeCollisionBox(er,se,L,at,M,Ce,Se,w,H.predicate,Qe,void 0,lt);return fr&&fr.placeable&&(this.markUsedOrientation(d,qi,ft),this.placedOrientations[ft.crossTileID]=qi),fr};ho(()=>Hn(Io,u.af.horizontal),()=>{const er=Et.verticalTextBox;return d.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&er?Hn(er,u.af.vertical):{box:null,offscreen:null}}),Pr(Wn&&Wn.placeable)}else{let Hn=u.aw[(ar=(kn=this.prevPlacement)===null||kn===void 0?void 0:kn.variableOffsets[ft.crossTileID])===null||ar===void 0?void 0:ar.anchor];const er=(fr,yf,Uh)=>{const wc=fr.x2-fr.x1,Qd=fr.y2-fr.y1,Ys=ft.textBoxScale,Xs=Ee&&ve==="never"?yf:null;let Er=null,ko=se==="never"?1:2,bc="never";Hn&&ko++;for(let Vh=0;Vh<ko;Vh++){for(let wl=Ur;wl<Pi;wl++){const Ks=d.textAnchorOffsets.get(wl);if(Hn&&Ks.textAnchor!==Hn)continue;const Sc=this.attemptAnchorPlacement(Ks,fr,wc,Qd,Ys,Se,Ce,L,at,M,H,bc,ft,d,Uh,w,P,Xs,Qe);if(Sc&&(Er=Sc.placedGlyphBoxes,Er&&Er.placeable))return xn=!0,Nn=Sc.shift,Er}Hn?Hn=null:bc=se}return c&&!Er&&(Er={box:this.collisionIndex.placeCollisionBox(Io,"always",L,at,M,Ce,Se,w,H.predicate,Qe,void 0,lt).box,offscreen:!1,placeable:!1,occluded:!1}),Er};ho(()=>er(Io,Et.iconBox,u.af.horizontal),()=>{const fr=Et.verticalTextBox;return d.allowVerticalPlacement&&(!Wn||!Wn.placeable)&&ft.numVerticalGlyphVertices>0&&fr?er(fr,Et.verticalIconBox,u.af.vertical):{box:null,occluded:!0,offscreen:null}}),Wn&&(xn=Wn.placeable,On=Wn.offscreen);const qi=Pr(Wn&&Wn.placeable);if(!xn&&this.prevPlacement){const fr=this.prevPlacement.variableOffsets[ft.crossTileID];fr&&(this.variableOffsets[ft.crossTileID]=fr,this.markUsedJustification(d,fr.anchor,ft,qi))}}}if(jn=Wn,xn=jn&&jn.placeable,On=jn&&jn.offscreen,ft.useRuntimeCollisionCircles){const Pr=d.text.placedSymbolArray.get(ft.centerJustifiedTextSymbolIndex),ho=u.ag(d.textSizeData,G,Pr),Ur=_.get("text-padding");Qn=this.collisionIndex.placeCollisionCircles(se,Pr,d.lineVertexArray,d.glyphOffsetArray,ho,M,k,c,Ce,H.predicate,ft.collisionCircleDiameter,Ur,w,Qe),Qn.circles.length&&Qn.collisionDetected&&!c&&u.w("Collisions detected, but collision boxes are not shown"),xn=ce||Qn.circles.length>0&&!Qn.collisionDetected,On=On&&Qn.offscreen}if(Et.iconFeatureIndex&&(Ci=Et.iconFeatureIndex),Et.iconBox){const Pr=ho=>this.collisionIndex.placeCollisionBox(ho,ve,L,at,M,Ce,Se,P,H.predicate,Qe,Ee&&Nn?Nn:void 0,lt);Qr&&Qr.placeable&&Et.verticalIconBox?(oi=Pr(Et.verticalIconBox),lr=oi.placeable):(oi=Pr(Et.iconBox),lr=oi.placeable),On=On&&oi.offscreen}const xl=ie||ft.numHorizontalGlyphVertices===0&&ft.numVerticalGlyphVertices===0,Ba=re||ft.numIconVertices===0;xl||Ba?Ba?xl||(lr=lr&&xn):xn=lr&&xn:lr=xn=lr&&xn;const Hs=lr&&oi.placeable;if(xn&&jn.placeable&&this.collisionIndex.insertCollisionBox(jn.box,se,_.get("text-ignore-placement"),d.bucketInstanceId,Qr&&Qr.placeable&&Zi?Zi:Jo,H.ID),Hs&&this.collisionIndex.insertCollisionBox(oi.box,ve,_.get("icon-ignore-placement"),d.bucketInstanceId,Ci,H.ID),Qn&&xn&&this.collisionIndex.insertCollisionCircles(Qn.circles,se,_.get("text-ignore-placement"),d.bucketInstanceId,Jo,H.ID),c&&this.storeCollisionData(d.bucketInstanceId,an,Et,jn,oi,Qn),ft.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ft.crossTileID]=new Ja((xn||qe)&&!(jn!=null&&jn.occluded),(lr||nt)&&!(oi!=null&&oi.occluded),On||d.justReloaded),r[ft.crossTileID]=!0};if($e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ft=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Et=ft.length-1;Et>=0;--Et){const an=ft[Et];Tt(d.symbolInstances.get(an),d.collisionArrays[an],an)}}else for(let ft=e.symbolInstanceStart;ft<e.symbolInstanceEnd;ft++)Tt(d.symbolInstances.get(ft),d.collisionArrays[ft],ft);d.justReloaded=!1}storeCollisionData(e,r,c,d,_,w){if(c.textBox||c.iconBox){let P,M;this.collisionBoxArrays.has(e)?P=this.collisionBoxArrays.get(e):(P=new Map,this.collisionBoxArrays.set(e,P)),P.has(r)?M=P.get(r):(M={text:null,icon:null},P.set(r,M)),c.textBox&&(M.text=d.box),c.iconBox&&(M.icon=_.box)}if(w){let P=this.collisionCircleArrays[e];P===void 0&&(P=this.collisionCircleArrays[e]=[]);for(let M=0;M<w.circles.length;M+=4)P.push(w.circles[M+0]-ir),P.push(w.circles[M+1]-ir),P.push(w.circles[M+2]),P.push(w.collisionDetected?1:0)}}markUsedJustification(e,r,c,d){let _;_=d===u.af.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[u.ay(r)];const w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const P of w)P>=0&&(e.text.placedSymbolArray.get(P).crossTileID=_>=0&&P!==_?0:c.crossTileID)}markUsedOrientation(e,r,c){const d=r===u.af.horizontal||r===u.af.horizontalOnly?r:0,_=r===u.af.vertical?r:0,w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const P of w)e.text.placedSymbolArray.get(P).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const d=r?r.symbolFadeChange(e):1,_=r?r.opacities:{},w=r?r.variableOffsets:{},P=r?r.placedOrientations:{};for(const M in this.placements){const k=this.placements[M],L=_[M];L?(this.opacities[M]=new Bl(L,d,k.text,k.icon),c=c||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[M]=new Bl(null,d,k.text,k.icon,k.skipFade),c=c||k.text||k.icon)}for(const M in _){const k=_[M];if(!this.opacities[M]){const L=new Bl(k,d,!1,!1);L.isHidden()||(this.opacities[M]=L,c=c||k.text.placed||k.icon.placed)}}for(const M in w)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=w[M]);for(const M in P)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=P[M]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const c={};for(const d of r){const _=d.getBucket(e);_&&d.latestFeatureIndex&&e.id===_.layerIds[0]&&this.updateBucketOpacities(_,d.tileID,c,d.collisionBoxArray)}}updateBucketOpacities(e,r,c,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const _=e.layers[0],w=_.layout,P=new Bl(null,0,!1,!1,!0),M=w.get("text-allow-overlap"),k=w.get("icon-allow-overlap"),L=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=w.get("text-rotation-alignment")==="map",F=w.get("text-pitch-alignment")==="map",G=w.get("icon-text-fit")!=="none",H=new Bl(null,0,M&&(k||!e.hasIconData()||w.get("icon-optional")),k&&(M||!e.hasTextData()||w.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const ie=(se,ce,ve)=>{for(let xe=0;xe<ce/4;xe++)se.opacityVertexArray.emplaceBack(ve);se.hasVisibleVertices=se.hasVisibleVertices||ve!==fa},re=this.collisionBoxArrays.get(e.bucketInstanceId);for(let se=0;se<e.symbolInstances.length;se++){const ce=e.symbolInstances.get(se),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:xe,crossTileID:Se}=ce;let Ce=this.opacities[Se];c[Se]?Ce=P:Ce||(Ce=H,this.opacities[Se]=Ce),c[Se]=!0;const Ee=ce.numIconVertices>0,$e=this.placedOrientations[ce.crossTileID],qe=$e===u.af.vertical,nt=$e===u.af.horizontal||$e===u.af.horizontalOnly;if(ve>0||xe>0){const Qe=gh(Ce.text);ie(e.text,ve,qe?fa:Qe),ie(e.text,xe,nt?fa:Qe);const lt=Ce.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(Et=>{Et>=0&&(e.text.placedSymbolArray.get(Et).hidden=lt||qe?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=lt||nt?1:0);const Tt=this.variableOffsets[ce.crossTileID];Tt&&this.markUsedJustification(e,Tt.anchor,ce,$e);const ft=this.placedOrientations[ce.crossTileID];ft&&(this.markUsedJustification(e,"left",ce,ft),this.markUsedOrientation(e,ft,ce))}if(Ee){const Qe=gh(Ce.icon),lt=!(G&&ce.verticalPlacedIconSymbolIndex&&qe);ce.placedIconSymbolIndex>=0&&(ie(e.icon,ce.numIconVertices,lt?Qe:fa),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=Ce.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(ie(e.icon,ce.numVerticalIconVertices,lt?fa:Qe),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=Ce.icon.isHidden())}const at=re&&re.has(se)?re.get(se):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Qe=e.collisionArrays[se];if(Qe){let lt=new u.P(0,0);if(Qe.textBox||Qe.verticalTextBox){let Tt=!0;if(L){const ft=this.variableOffsets[Se];ft?(lt=pa(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textBoxScale),D&&lt._rotate(F?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Tt=!1}if(Qe.textBox||Qe.verticalTextBox){let ft;Qe.textBox&&(ft=qe),Qe.verticalTextBox&&(ft=nt),fh(e.textCollisionBox.collisionVertexArray,Ce.text.placed,!Tt||ft,at.text,lt.x,lt.y)}}if(Qe.iconBox||Qe.verticalIconBox){const Tt=!!(!nt&&Qe.verticalIconBox);let ft;Qe.iconBox&&(ft=Tt),Qe.verticalIconBox&&(ft=!Tt),fh(e.iconCollisionBox.collisionVertexArray,Ce.icon.placed,ft,at.icon,G?lt.x:0,G?lt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function fh(g,e,r,c,d,_){c&&c.length!==0||(c=[0,0,0,0]);const w=c[0]-ir,P=c[1]-ir,M=c[2]-ir,k=c[3]-ir;g.emplaceBack(e?1:0,r?1:0,d||0,_||0,w,P),g.emplaceBack(e?1:0,r?1:0,d||0,_||0,M,P),g.emplaceBack(e?1:0,r?1:0,d||0,_||0,M,k),g.emplaceBack(e?1:0,r?1:0,d||0,_||0,w,k)}const Td=Math.pow(2,25),Qa=Math.pow(2,24),mh=Math.pow(2,17),Cd=Math.pow(2,16),Pd=Math.pow(2,9),df=Math.pow(2,8),Ed=Math.pow(2,1);function gh(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,r=Math.floor(127*g.opacity);return r*Td+e*Qa+r*mh+e*Cd+r*Pd+e*df+r*Ed+e}const fa=0;class Bu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,c,d,_){const w=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(w,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((P,M)=>P.sortKey-M.sortKey));this._currentPartIndex<w.length;)if(r.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,_())return!0;return!1}}class _h{constructor(e,r,c,d,_,w,P,M){this.placement=new Ol(e,r,w,P,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(e,r,c){const d=fe.now(),_=()=>!this._forceFullPlacement&&fe.now()-d>2;for(;this._currentPlacementIndex>=0;){const w=r[e[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=P)&&(!w.maxzoom||w.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Bu(w)),this._inProgressLayer.continuePlacement(c[w.source],this.placement,this._showCollisionBoxes,w,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Os=512/u.Y/2;class Nl{constructor(e,r,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};const d=new Map;for(let _=0;_<r.length;_++){const w=r.get(_),P=w.key,M=d.get(P);M?M.push(w):d.set(P,[w])}for(const[_,w]of d){const P={positions:w.map(M=>({x:Math.floor(M.anchorX*Os),y:Math.floor(M.anchorY*Os)})),crossTileIDs:w.map(M=>M.crossTileID)};if(P.positions.length>128){const M=new u.aA(P.positions.length,16,Uint16Array);for(const{x:k,y:L}of P.positions)M.add(k,L);M.finish(),delete P.positions,P.index=M}this._symbolsByKey[_]=P}}getScaledCoordinates(e,r){const{x:c,y:d,z:_}=this.tileID.canonical,{x:w,y:P,z:M}=r.canonical,k=Os/Math.pow(2,M-_),L=(P*u.Y+e.anchorY)*k,D=d*u.Y*Os;return{x:Math.floor((w*u.Y+e.anchorX)*k-c*u.Y*Os),y:Math.floor(L-D)}}findMatches(e,r,c){const d=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<e.length;_++){const w=e.get(_);if(w.crossTileID)continue;const P=this._symbolsByKey[w.key];if(!P)continue;const M=this.getScaledCoordinates(w,r);if(P.index){const k=P.index.range(M.x-d,M.y-d,M.x+d,M.y+d).sort();for(const L of k){const D=P.crossTileIDs[L];if(!c[D]){c[D]=!0,w.crossTileID=D;break}}}else if(P.positions)for(let k=0;k<P.positions.length;k++){const L=P.positions[k],D=P.crossTileIDs[k];if(Math.abs(L.x-M.x)<=d&&Math.abs(L.y-M.y)<=d&&!c[D]){c[D]=!0,w.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ou{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class yh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const c in this.indexes){const d=this.indexes[c],_={};for(const w in d){const P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+r),_[P.tileID.key]=P}this.indexes[c]=_}this.lng=e}addBucket(e,r,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const _ in this.indexes){const w=this.indexes[_];if(Number(_)>e.overscaledZ)for(const P in w){const M=w[P];M.tileID.isChildOf(e)&&M.findMatches(r.symbolInstances,e,d)}else{const P=w[e.scaledTo(Number(_)).key];P&&P.findMatches(r.symbolInstances,e,d)}}for(let _=0;_<r.symbolInstances.length;_++){const w=r.symbolInstances.get(_);w.crossTileID||(w.crossTileID=c.generate(),d[w.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Nl(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const c of r.getCrossTileIDsLists())for(const d of c)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let r=!1;for(const c in this.indexes){const d=this.indexes[c];for(const _ in d)e[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[_]),delete d[_],r=!0)}return r}}class Uo{constructor(){this.layerIndexes={},this.crossTileIDs=new Ou,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,c){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new yh);let _=!1;const w={};d.handleWrapJump(c);for(const P of r){const M=P.getBucket(e);M&&e.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(P.tileID,M,this.crossTileIDs)&&(_=!0),w[M.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(_=!0),_}pruneUnusedLayers(e){const r={};e.forEach(c=>{r[c]=!0});for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}var Nu="void main() {fragColor=vec4(1.0);}";const Vo={prelude:hn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:hn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:hn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:hn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:hn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hn(Nu,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:hn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:hn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:hn(Nu,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:hn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:hn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:hn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:hn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:hn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:hn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:hn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:hn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:hn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:hn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:hn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function hn(g,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/in ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=_?_.concat(d):d,P={};return{fragmentSource:g=g.replace(r,(M,k,L,D,F)=>(P[F]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${L} ${D} ${F};
#else
uniform ${L} ${D} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${L} ${D} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(r,(M,k,L,D,F)=>{const G=D==="float"?"vec2":"vec4",H=F.match(/color/)?"color":G;return P[F]?k==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${L} ${G} a_${F};
out ${L} ${D} ${F};
#else
uniform ${L} ${D} u_${F};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${L} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${H}(a_${F}, u_${F}_t);
#else
    ${L} ${D} ${F} = u_${F};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${L} ${G} a_${F};
#else
uniform ${L} ${D} u_${F};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${L} ${D} ${F} = a_${F};
#else
    ${L} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${L} ${D} ${F} = unpack_mix_${H}(a_${F}, u_${F}_t);
#else
    ${L} ${D} ${F} = u_${F};
#endif
`}),staticAttributes:c,staticUniforms:w}}class bo{constructor(e,r,c){this.vertexBuffer=e,this.indexBuffer=r,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var dn=u.aB([{name:"a_pos",type:"Int16",components:2}]);const ju="#define PROJECTION_MERCATOR",vh="mercator";class ma{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return vh}get shaderDefine(){return ju}get shaderPreludeCode(){return Vo.projectionMercator}get vertexShaderPreludeCode(){return Vo.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aC.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,c,d,_){if(this._cachedMesh)return this._cachedMesh;const w=new u.aD;w.emplaceBack(0,0),w.emplaceBack(u.Y,0),w.emplaceBack(0,u.Y),w.emplaceBack(u.Y,u.Y);const P=e.createVertexBuffer(w,dn.members),M=u.aE.simpleSegment(0,0,4,2),k=new u.aF;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3);const L=e.createIndexBuffer(k);return this._cachedMesh=new bo(P,L,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function hr(g,e){const r=u.ac(e.lat,-85.051129,u.aH);return new u.P(u.S(e.lng)*g,u.Q(r)*g)}function dr(g,e){return new u.Z(e.x/g,e.y/g).toLngLat()}function sr(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(u.ab(90-g.pitch)),Math.tan(u.ab(89.25-g.pitch)))}function Uu(g,e){const r=g.canonical,c=e/u.aG(r.z),d=r.x+Math.pow(2,r.z)*g.wrap,_=u.ar(new Float64Array(16));return u.K(_,_,[d*c,r.y*c,0]),u.L(_,_,[c/u.Y,c/u.Y,1]),_}function pi(g,e,r,c,d){const _=u.Z.fromLngLat(g,e),w=d*u.aI(1,g.lat),P=w*Math.cos(u.ab(r)),M=Math.sqrt(w*w-P*P),k=M*Math.sin(u.ab(-c)),L=M*Math.cos(u.ab(-c));return new u.Z(_.x+k,_.y+L,_.z+P)}class ri{constructor(e=0,r=0,c=0,d=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=c,this.right=d}interpolate(e,r,c){return r.top!=null&&e.top!=null&&(this.top=u.z.number(e.top,r.top,c)),r.bottom!=null&&e.bottom!=null&&(this.bottom=u.z.number(e.bottom,r.bottom,c)),r.left!=null&&e.left!=null&&(this.left=u.z.number(e.left,r.left,c)),r.right!=null&&e.right!=null&&(this.right=u.z.number(e.right,r.right,c)),this}getCenter(e,r){const c=u.ac((this.left+e-this.right)/2,0,e),d=u.ac((this.top+r-this.bottom)/2,0,r);return new u.P(c,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ri(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ii(g,e){if(!g.renderWorldCopies||g.lngRange)return;const r=e.lng-g.center.lng;e.lng+=r>180?-360:r<-180?360:0}function Vu(g){return Math.max(0,Math.floor(g))}class Ns{constructor(e,r,c,d,_,w){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=d??0,this._maxPitch=_??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.O(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Vu(this._zoom),this._scale=u.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ri,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,c){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Vu(this._zoom),this._scale=u.aG(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new ri(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!c&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=u.aJ(e,-180,180)*Math.PI/180;var c,d,_,w,P,M,k,L,D;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=Z(),c=this._rotationMatrix,_=-this._bearingInRadians,w=(d=this._rotationMatrix)[0],P=d[1],M=d[2],k=d[3],L=Math.sin(_),D=Math.cos(_),c[0]=w*D+M*L,c[1]=P*D+k*L,c[2]=w*-L+M*D,c[3]=P*-L+k*D)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=u.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aK(this._fovInRadians)}setFov(e){e=u.ac(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=u.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=u.aG(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,c){this._unmodified=!1,this._edgeInsets.interpolate(e,r,c),this._constrain(),this._calcMatrices()}resize(e,r,c=!0){this._width=e,this._height=r,c&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Rt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,u.aH])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{let c=e.x,d=e.y,_=e.x,w=e.y;for(const P of r)c=Math.min(c,P.x),d=Math.min(d,P.y),_=Math.max(_,P.x),w=Math.max(w,P.y);return[new u.P(c,d),new u.P(_,d),new u.P(_,w),new u.P(c,w),new u.P(c,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:c}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=u.ar(new Float64Array(16));u.L(e,e,[this._width/2,-this._height/2,1]),u.K(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=u.ar(new Float64Array(16)),u.L(e,e,[1,-1,1]),u.K(e,e,[-1,-1,0]),u.L(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,c,d){const _=c!==void 0?c:this.bearing,w=d=d!==void 0?d:this.pitch,P=u.Z.fromLngLat(e,r),M=-Math.cos(u.ab(w)),k=Math.sin(u.ab(w)),L=k*Math.sin(u.ab(_)),D=-k*Math.cos(u.ab(_));let F=this.elevation;const G=r-F;let H;M*G>=0||Math.abs(M)<.1?(H=1e4,F=r+H*M):H=-G/M;let ie,re,se=u.aL(1,P.y),ce=0;do{if(ce+=1,ce>10)break;re=H/se,ie=new u.Z(P.x+L*re,P.y+D*re),se=1/ie.meterInMercatorCoordinateUnits()}while(Math.abs(H-re*se)>1e-12);return{center:ie.toLngLat(),elevation:F,zoom:u.a9(this.height/2/Math.tan(this.fovInRadians/2)/re/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=u.aI(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/r,d=u.Z.fromLngLat(this.center,this.elevation),_=pi(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=e;const w=this.calculateCenterFromCameraLngLatAlt(_.toLngLat(),u.aL(_.z,d.y),this.bearing,this.pitch);this._elevation=w.elevation,this._center=w.center,this.setZoom(w.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=u.aI(1,this.center.lat)*this.worldSize;return pi(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/u.Y,1/r/u.Y]}}class tr{constructor(e,r){this.min=e,this.max=r,this.center=u.aM([],u.aN([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],c=u.aO(this.min),d=u.aO(this.max);for(let _=0;_<r.length;_++)c[_]=r[_]?this.min[_]:this.center[_],d[_]=r[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new tr(c,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let c=0;c<e.planes.length;c++){const d=this.intersectsPlane(e.planes[c]);if(d===0)return 0;d===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],c=e[3];for(let d=0;d<3;d++)e[d]>0?(r+=e[d]*this.min[d],c+=e[d]*this.max[d]):(c+=e[d]*this.min[d],r+=e[d]*this.max[d]);return r>=0?2:c<0?0:1}}class jl{distanceToTile2d(e,r,c,d){const _=d.distanceX([e,r]),w=d.distanceY([e,r]);return Math.hypot(_,w)}getWrap(e,r,c){return c}getTileAABB(e,r,c,d){var _,w;let P=c,M=c;if(d.terrain){const L=new u.X(e.z,r,e.z,e.x,e.y),D=d.terrain.getMinMaxElevation(L);P=(_=D.minElevation)!==null&&_!==void 0?_:c,M=(w=D.maxElevation)!==null&&w!==void 0?w:c}const k=1<<e.z;return new tr([r+e.x/k,e.y/k,P],[r+(e.x+1)/k,(e.y+1)/k,M])}allowVariableZoom(e,r){const c=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=u.ac(78.5-c/2,0,60);return!!r.terrain||e.pitch>d}allowWorldCopies(){return!0}recalculateCache(){}}class Go{constructor(e,r,c){this.points=e,this.planes=r,this.aabb=c}static fromInvProjectionMatrix(e,r=1,c=0){const d=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const L=1/(k=u.an([],k,e))[3]/r*d;return u.aP(k,k,[L,L,1/k[3],L])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const L=u.aQ([],_[k[0]],_[k[1]]),D=u.aQ([],_[k[2]],_[k[1]]),F=u.aR([],u.aS([],L,D)),G=-u.aT(F,_[k[1]]);return F.concat(G)}),P=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],M=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const k of _)for(let L=0;L<3;L++)P[L]=Math.min(P[L],k[L]),M[L]=Math.max(M[L],k[L]);return new Go(_,w,new tr(P,M))}}class $o{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,c,d,_){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ns({calcMatrices:()=>{this._calcMatrices()},getConstrained:(w,P)=>this.getConstrained(w,P)},e,r,c,d,_),this._coveringTilesDetailsProvider=new jl}clone(){const e=new $o;return e.apply(this),e}apply(e,r,c){this._helper.apply(e,r,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new u.aU(0,e)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new u.P(0,0)),d=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),P=Math.floor(Math.min(c.x,d.x,_.x,w.x)),M=Math.floor(Math.max(c.x,d.x,_.x,w.x)),k=1;for(let L=P-k;L<=M+k;L++)L!==0&&r.push(new u.aU(L,e))}return r}getCameraFrustum(){return Go.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,r){const c=u.aI(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(r,c),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),w=u.Z.fromLngLat(e),P=new u.Z(w.x-(d.x-_.x),w.y-(d.y-_.y));this.setCenter(P==null?void 0:P.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(u.Z.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(u.Z.fromLngLat(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const c=r||0,d=[e.x,e.y,0,1],_=[e.x,e.y,1,1];u.an(d,d,this._pixelMatrixInverse),u.an(_,_,this._pixelMatrixInverse);const w=d[3],P=_[3],M=d[1]/w,k=_[1]/P,L=d[2]/w,D=_[2]/P,F=L===D?0:(c-L)/(D-L);return new u.Z(u.z.number(d[0]/w,_[0]/P,F)/this.worldSize,u.z.number(M,k,F)/this.worldSize,c)}coordinatePoint(e,r=0,c=this._pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,r,1];return u.an(d,d,c),new u.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this._helper._height/2-sr(this));return new Rt().extend(this.screenPointToLocation(new u.P(0,e))).extend(this.screenPointToLocation(new u.P(this._helper._width,e))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-sr(this)}calculatePosMatrix(e,r=!1,c){var d;const _=(d=e.key)!==null&&d!==void 0?d:u.aV(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),w=r?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(_)){const k=w.get(_);return c?k.f32:k.f64}const P=Uu(e,this.worldSize);u.M(P,r?this._alignedProjMatrix:this._viewProjMatrix,P);const M={f64:P,f32:new Float32Array(P)};return w.set(_,M),c?M.f32:M.f64}calculateFogMatrix(e){const r=e.key,c=this._fogMatrixCacheF32;if(c.has(r))return c.get(r);const d=Uu(e,this.worldSize);return u.M(d,this._fogMatrix,d),c.set(r,new Float32Array(d)),c.get(r)}getConstrained(e,r){r=u.ac(+r,this.minZoom,this.maxZoom);const c={center:new u.O(e.lng,e.lat),zoom:r};let d=this._helper._lngRange;this._helper._renderWorldCopies||d!==null||(d=[-179.9999999999,180-1e-10]);const _=this.tileSize*u.aG(c.zoom);let w=0,P=_,M=0,k=_,L=0,D=0;const{x:F,y:G}=this.size;if(this._helper._latRange){const ve=this._helper._latRange;w=u.Q(ve[1])*_,P=u.Q(ve[0])*_,P-w<G&&(L=G/(P-w))}d&&(M=u.aJ(u.S(d[0])*_,0,_),k=u.aJ(u.S(d[1])*_,0,_),k<M&&(k+=_),k-M<F&&(D=F/(k-M)));const{x:H,y:ie}=hr(_,e);let re,se;const ce=Math.max(D||0,L||0);if(ce){const ve=new u.P(D?(k+M)/2:H,L?(P+w)/2:ie);return c.center=dr(_,ve).wrap(),c.zoom+=u.a9(ce),c}if(this._helper._latRange){const ve=G/2;ie-ve<w&&(se=w+ve),ie+ve>P&&(se=P-ve)}if(d){const ve=(M+k)/2;let xe=H;this._helper._renderWorldCopies&&(xe=u.aJ(H,ve-_/2,ve+_/2));const Se=F/2;xe-Se<M&&(re=M+Se),xe+Se>k&&(re=k-Se)}if(re!==void 0||se!==void 0){const ve=new u.P(re??H,se??ie);c.center=dr(_,ve).wrap()}return c}calculateCenterFromCameraLngLatAlt(e,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,d)}_calculateNearFarZIfNeeded(e,r,c){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=e-d*this._helper._pixelPerMeter/Math.cos(r),w=d<0?_:e,P=Math.PI/2+this.pitchInRadians,M=u.ab(this.fov)*(Math.abs(Math.cos(u.ab(this.roll)))*this.height+Math.abs(Math.sin(u.ab(this.roll)))*this.width)/this.height*(.5+c.y/this.height),k=Math.sin(M)*w/Math.sin(u.ac(Math.PI-P-M,.01,Math.PI-.01)),L=sr(this),D=Math.atan(L/this._helper.cameraToCenterDistance),F=u.ab(.75),G=D>F?2*D*(.5+c.y/(2*L)):F,H=Math.sin(G)*w/Math.sin(u.ac(Math.PI-P-G,.01,Math.PI-.01)),ie=Math.min(k,H);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*ie+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=hr(this.worldSize,this.center),c=r.x,d=r.y;this._helper._pixelPerMeter=u.aI(1,this.center.lat)*this.worldSize;const _=u.ab(Math.min(this.pitch,89.25)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let P;this._calculateNearFarZIfNeeded(w,_,e),P=new Float64Array(16),u.aW(P,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.ah(this._invProjMatrix,P),P[8]=2*-e.x/this._helper._width,P[9]=2*e.y/this._helper._height,this._projectionMatrix=u.aX(P),u.L(P,P,[1,-1,1]),u.K(P,P,[0,0,-this._helper.cameraToCenterDistance]),u.aY(P,P,-this.rollInRadians),u.aZ(P,P,this.pitchInRadians),u.aY(P,P,-this.bearingInRadians),u.K(P,P,[-c,-d,0]),this._mercatorMatrix=u.L([],P,[this.worldSize,this.worldSize,this.worldSize]),u.L(P,P,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.M(new Float64Array(16),this.clipSpaceToPixelsMatrix,P),u.K(P,P,[0,0,-this.elevation]),this._viewProjMatrix=P,this._invViewProjMatrix=u.ah([],P);const M=[0,0,-1,1];u.an(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),u.aW(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,u.L(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.K(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.aY(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.aZ(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.aY(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.K(this._fogMatrix,this._fogMatrix,[-c,-d,0]),u.L(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.K(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.M(new Float64Array(16),this.clipSpaceToPixelsMatrix,P);const k=this._helper._width%2/2,L=this._helper._height%2/2,D=Math.cos(this.bearingInRadians),F=Math.sin(-this.bearingInRadians),G=c-Math.round(c)+D*k+F*L,H=d-Math.round(d)+D*L+F*k,ie=new Float64Array(P);if(u.K(ie,ie,[G>.5?G-1:G,H>.5?H-1:H,0]),this._alignedProjMatrix=ie,P=u.ah(new Float64Array(16),this._pixelMatrix),!P)throw new Error("failed to invert matrix");this._pixelMatrixInverse=P,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new u.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return u.an(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=u.aI(1,this.center.lat)*this.worldSize;return pi(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const c=u.Z.fromLngLat(e),d=[c.x*this.worldSize,c.y*this.worldSize,r,1];return u.an(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){const{overscaledTileID:r,aligned:c,applyTerrainMatrix:d}=e,_=this._helper.getMercatorTileCoordinates(r),w=r?this.calculatePosMatrix(r,c,!0):null;let P;return P=r&&r.terrainRttPosMatrix32f&&d?r.terrainRttPosMatrix32f:w||u.a_(),{mainMatrix:P,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:P}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,c){return 1}transformLightDirection(e){return u.aO(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,c,d){const _=this.calculatePosMatrix(c);let w;d?(w=[e,r,d(e,r),1],u.an(w,w,_)):(w=[e,r,0,1],Sr(w,w,_));const P=w[3];return{point:new u.P(w[0]/P,w[1]/P),signedDistanceFromCamera:P,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const c=u.Z.fromLngLat(e,r),d=c.meterInMercatorCoordinateUnits(),_=u.a$();return u.K(_,_,[c.x,c.y,c.z]),u.aY(_,_,Math.PI),u.aZ(_,_,Math.PI/2),u.L(_,_,[-d,d,d]),_}getProjectionDataForCustomLayer(e=!0){const r=new u.X(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),d=Uu(r,this.worldSize);u.M(d,this._viewProjMatrix,d),c.tileMercatorCoords=[0,0,1,1];const _=[u.Y,u.Y,this.worldSize/this._helper.pixelsPerMeter],w=u.b0();return u.L(w,d,_),c.fallbackMatrix=w,c.mainMatrix=w,c}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function ro(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function xh(g){if(g.useSlerp)if(g.k<1){const e=u.b1(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),r=u.b1(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),c=new Float64Array(4);u.b2(c,e,r,g.k);const d=u.b3(c);g.tr.setRoll(d.roll),g.tr.setPitch(d.pitch),g.tr.setBearing(d.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(u.z.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(u.z.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(u.z.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function us(g,e,r,c,d){const _=d.padding,w=hr(d.worldSize,r.getNorthWest()),P=hr(d.worldSize,r.getNorthEast()),M=hr(d.worldSize,r.getSouthEast()),k=hr(d.worldSize,r.getSouthWest()),L=u.ab(-c),D=w.rotate(L),F=P.rotate(L),G=M.rotate(L),H=k.rotate(L),ie=new u.P(Math.max(D.x,F.x,H.x,G.x),Math.max(D.y,F.y,H.y,G.y)),re=new u.P(Math.min(D.x,F.x,H.x,G.x),Math.min(D.y,F.y,H.y,G.y)),se=ie.sub(re),ce=(d.width-(_.left+_.right+e.left+e.right))/se.x,ve=(d.height-(_.top+_.bottom+e.top+e.bottom))/se.y;if(ve<0||ce<0)return void ro();const xe=Math.min(u.a9(d.scale*Math.min(ce,ve)),g.maxZoom),Se=u.P.convert(g.offset),Ce=new u.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(u.ab(c)),Ee=Se.add(Ce).mult(d.scale/u.aG(xe));return{center:dr(d.worldSize,w.add(M).div(2).sub(Ee)),zoom:xe,bearing:c}}class Gu{get useGlobeControls(){return!1}handlePanInertia(e,r){return{easingOffset:e,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,c){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,r,c,d,_){return us(e,r,c,d,_)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(u.O.convert(r.center))}handleEaseTo(e,r){const c=e.zoom,d=e.padding,_={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},P=r.zoom!==void 0,M=!e.isPaddingEqual(r.padding);let k=!1;const L=P?+r.zoom:e.zoom;let D=e.centerPoint.add(r.offsetAsPoint);const F=e.screenPointToLocation(D),{center:G,zoom:H}=e.getConstrained(u.O.convert(r.center||F),L??c);ii(e,G);const ie=hr(e.worldSize,F),re=hr(e.worldSize,G).sub(ie),se=u.aG(H-c);return k=H!==c,{easeFunc:ce=>{if(k&&e.setZoom(u.z.number(c,H,ce)),u.b4(_,w)||xh({startEulerAngles:_,endEulerAngles:w,tr:e,k:ce,useSlerp:_.roll!=w.roll}),M&&(e.interpolatePadding(d,r.padding,ce),D=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const ve=u.aG(e.zoom-c),xe=H>c?Math.min(2,se):Math.max(.5,se),Se=Math.pow(xe,1-ce),Ce=dr(e.worldSize,ie.add(re.mult(ce*Se)).mult(ve));e.setLocationAtPoint(e.renderWorldCopies?Ce.wrap():Ce,D)}},isZooming:k,elevationCenter:G}}handleFlyTo(e,r){const c=r.zoom!==void 0,d=e.zoom,_=e.getConstrained(u.O.convert(r.center||r.locationAtOffset),c?+r.zoom:d),w=_.center,P=_.zoom;ii(e,w);const M=hr(e.worldSize,r.locationAtOffset),k=hr(e.worldSize,w).sub(M),L=k.mag(),D=u.aG(P-d);let F;if(r.minZoom!==void 0){const G=Math.min(+r.minZoom,d,P),H=e.getConstrained(w,G).zoom;F=u.aG(H-d)}return{easeFunc:(G,H,ie,re)=>{e.setZoom(G===1?P:d+u.a9(H));const se=G===1?w:dr(e.worldSize,M.add(k.mult(ie)).mult(H));e.setLocationAtPoint(e.renderWorldCopies?se.wrap():se,re)},scaleOfZoom:D,targetCenter:w,scaleOfMinZoom:F,pixelPathLength:L}}}class Jn{constructor(e,r,c){this.blendFunction=e,this.blendColor=r,this.mask=c}}Jn.Replace=[1,0],Jn.disabled=new Jn(Jn.Replace,u.b5.transparent,[!1,!1,!1,!1]),Jn.unblended=new Jn(Jn.Replace,u.b5.transparent,[!0,!0,!0,!0]),Jn.alphaBlended=new Jn([1,771],u.b5.transparent,[!0,!0,!0,!0]);const el=2305;class Cn{constructor(e,r,c){this.enable=e,this.mode=r,this.frontFace=c}}Cn.disabled=new Cn(!1,1029,el),Cn.backCCW=new Cn(!0,1029,el),Cn.frontCCW=new Cn(!0,1028,el);class cn{constructor(e,r,c){this.func=e,this.mask=r,this.range=c}}cn.ReadOnly=!1,cn.ReadWrite=!0,cn.disabled=new cn(519,cn.ReadOnly,[0,1]);const Ul=7680;class Mn{constructor(e,r,c,d,_,w){this.test=e,this.ref=r,this.mask=c,this.fail=d,this.depthFail=_,this.pass=w}}Mn.disabled=new Mn({func:519,mask:0},0,0,Ul,Ul,Ul);const Gn=new WeakMap;function In(g){var e;if(Gn.has(g))return Gn.get(g);{const r=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Gn.set(g,r),r}}class Vl{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,c=r.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const d=new u.aD;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const _=new u.aF;_.emplaceBack(0,1,2),this._fullscreenTriangle=new bo(r.createVertexBuffer(d,dn.members),r.createIndexBuffer(_),u.aE.simpleSegment(0,0,d.length,_.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(c.TEXTURE1);const w=c.createTexture();c.bindTexture(c.TEXTURE_2D,w),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),In(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const c=this._cachedRenderContext.context,d=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:u.b5.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,d.TRIANGLES,cn.disabled,Mn.disabled,Jn.unblended,Cn.disabled,((_,w)=>({u_input:_,u_output_expected:w}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&In(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const _=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&In(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Vl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const Gl=u.Y/128;function $l(g,e){const r=g.granularity!==void 0?Math.max(g.granularity,1):1,c=r+(g.generateBorders?2:0),d=r+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),_=c+1,w=d+1,P=g.generateBorders?-1:0,M=g.generateBorders||g.extendToNorthPole?-1:0,k=r+(g.generateBorders?1:0),L=r+(g.generateBorders||g.extendToSouthPole?1:0),D=_*w,F=c*d*6,G=_*w>65536;if(G&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const H=G||e==="32bit",ie=new Int16Array(2*D);let re=0;for(let ve=M;ve<=L;ve++)for(let xe=P;xe<=k;xe++){let Se=xe/r*u.Y;xe===-1&&(Se=-64),xe===r+1&&(Se=u.Y+Gl);let Ce=ve/r*u.Y;ve===-1&&(Ce=g.extendToNorthPole?u.b7:-64),ve===r+1&&(Ce=g.extendToSouthPole?u.b8:u.Y+Gl),ie[re++]=Se,ie[re++]=Ce}const se=H?new Uint32Array(F):new Uint16Array(F);let ce=0;for(let ve=0;ve<d;ve++)for(let xe=0;xe<c;xe++){const Se=xe+1+ve*_,Ce=xe+(ve+1)*_,Ee=xe+1+(ve+1)*_;se[ce++]=xe+ve*_,se[ce++]=Ce,se[ce++]=Se,se[ce++]=Se,se[ce++]=Ce,se[ce++]=Ee}return{vertices:ie.buffer.slice(0),indices:se.buffer.slice(0),uses32bitIndices:H}}const ga=new u.aC({fill:new u.b9(128,2),line:new u.b9(512,0),tile:new u.b9(128,32),stencil:new u.b9(128,1),circle:3});class Md{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Vo.projectionGlobe}get vertexShaderPreludeCode(){return Vo.projectionMercator.vertexSource}get subdivisionGranularity(){return ga}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Vl(e));const r=u.Q(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(r,c),_=fe.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=_);const w=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.ba(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.bb(w))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,c,d,_){const w=(_==="stencil"?ga.stencil:ga.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:w,generateBorders:c,extendToNorthPole:r.y===0&&d,extendToSouthPole:r.y===(1<<r.z)-1&&d})}_getMesh(e,r){const c=this._getMeshKey(r);if(c in this._tileMeshCache)return this._tileMeshCache[c];const d=function(_,w){const P=$l(w,"16bit"),M=u.aD.deserialize({arrayBuffer:P.vertices,length:P.vertices.byteLength/2/2}),k=u.aF.deserialize({arrayBuffer:P.indices,length:P.indices.byteLength/2/3});return new bo(_.createVertexBuffer(M,dn.members),_.createIndexBuffer(k),u.aE.simpleSegment(0,0,M.length,k.length))}(e,r);return this._tileMeshCache[c]=d,d}recalculate(e){}hasTransition(){const e=fe.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const wh=new u.q({type:new u.D(u.v.projection.type)});class $u extends u.E{constructor(e){super(),this._transitionable=new u.T(wh),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.B(0)),this._mercatorProjection=new ma,this._verticalPerspectiveProjection=new Md}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof u.bc){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,c,d,_){return this.currentProjection.getMeshFromTileID(e,r,c,d,_)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Id(g){const e=io(g.worldSize,g.center.lat);return 2*Math.PI*e}function Tr(g,e,r,c,d){const _=1/(1<<d),w=e/u.Y*_+c*_,P=u.be((g/u.Y*_+r*_)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,k=Math.cos(M),L=new Float64Array(3);return L[0]=Math.sin(P)*k,L[1]=Math.sin(M),L[2]=Math.cos(P)*k,L}function $n(g){return function(e,r){const c=Math.cos(r),d=new Float64Array(3);return d[0]=Math.sin(e)*c,d[1]=Math.sin(r),d[2]=Math.cos(e)*c,d}(g.lng*Math.PI/180,g.lat*Math.PI/180)}function io(g,e){return g/(2*Math.PI)/Math.cos(e*Math.PI/180)}function oo(g){const e=Math.asin(g[1])/Math.PI*180,r=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(r>1e-6){const c=g[0]/r,d=Math.acos(g[2]/r),_=(c>0?d:-d)/Math.PI*180;return new u.O(u.aJ(_,-180,180),e)}return new u.O(0,e)}function cs(g){return Math.cos(g*Math.PI/180)}function Zn(g,e){const r=cs(g),c=cs(e);return u.a9(c/r)}function Zu(g,e){const r=g.rotate(e.bearingInRadians),c=e.zoom+Zn(e.center.lat,0),d=u.ba(1/cs(e.center.lat),1/cs(Math.min(Math.abs(e.center.lat),60)),u.bd(c,7,3,0,1)),_=360/Id({worldSize:e.worldSize,center:{lat:e.center.lat}});return new u.O(e.center.lng-r.x*_*d,u.ac(e.center.lat+r.y*_,-85.051129,u.aH))}function hs(g){const e=.5*g,r=Math.sin(e),c=Math.cos(e);return Math.log(r+c)-Math.log(c-r)}function bh(g,e,r,c){const d=g.lat+r*c;if(Math.abs(r)>1){const _=(Math.sign(g.lat+r)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,w=Math.abs(g.lat+r)*Math.PI/180,P=hs(_+c*(w-_)),M=hs(_),k=hs(w);return new u.O(g.lng+e*((P-M)/(k-M)),d)}return new u.O(g.lng+e*c,d)}class kd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,r,c,d){const _=`${e.z}_${e.x}_${e.y}`,w=this._cache.get(_);if(w)return w;const P=this._cachePrevious.get(_);if(P)return this._cache.set(_,P),P;const M=this._aabbFactory(e,r,c,d);return this._cache.set(_,M),this._hadAnyChanges=!0,M}}function Zl(g,e,r){const c=g-e;return c<0?-c:Math.max(0,c-r)}function qu(g,e,r,c,d){const _=g-r;let w;return w=_<0?Math.min(-_,1+_-d):_>1?Math.min(Math.max(_-d,0),1-_):0,Math.max(w,Zl(e,c,d))}class Ui{constructor(){this._aabbCache=new kd(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,r,c,d){const _=1<<c.z,w=1/_,P=c.x/_,M=c.y/_;let k=2;return k=Math.min(k,qu(e,r,P,M,w)),k=Math.min(k,qu(e,r,P+.5,-M-w,w)),k=Math.min(k,qu(e,r,P+.5,2-M-w,w)),k}getWrap(e,r,c){const d=1<<r.z,_=1/d,w=r.x/d,P=Zl(e.x,w,_),M=Zl(e.x,w-1,_),k=Zl(e.x,w+1,_),L=Math.min(P,M,k);return L===k?1:L===M?-1:0}allowVariableZoom(e,r){return No(e,r)>4}allowWorldCopies(){return!1}getTileAABB(e,r,c,d){return this._aabbCache.getTileAABB(e,r,c,d)}_computeTileAABB(e,r,c,d){if(e.z<=0)return new tr([-1,-1,-1],[1,1,1]);if(e.z===1)return new tr([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const _=[Tr(0,0,e.x,e.y,e.z),Tr(u.Y,0,e.x,e.y,e.z),Tr(u.Y,u.Y,e.x,e.y,e.z),Tr(0,u.Y,e.x,e.y,e.z)],w=[1,1,1],P=[-1,-1,-1];for(const M of _)for(let k=0;k<3;k++)w[k]=Math.min(w[k],M[k]),P[k]=Math.max(P[k],M[k]);if(e.y===0||e.y===(1<<e.z)-1){const M=[0,e.y===0?1:-1,0];for(let k=0;k<3;k++)w[k]=Math.min(w[k],M[k]),P[k]=Math.max(P[k],M[k])}return new tr(w,P)}}}class Wu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=u.bf(),this._projectionMatrix=u.a$(),this._globeViewProjMatrix32f=u.a_(),this._globeViewProjMatrixNoCorrection=u.a$(),this._globeViewProjMatrixNoCorrectionInverted=u.a$(),this._globeProjMatrixInverted=u.a$(),this._cameraPosition=u.bg(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ns({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new Ui}clone(){const e=new Wu;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=u.bg();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:c}=e,d=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,c=this.cameraToCenterDistance/e,d=Math.sin(r)*c,_=Math.cos(r)*c+1,w=1/Math.sqrt(d*d+_*_)*1;let P=-d,M=_;const k=Math.sqrt(P*P+M*M);P/=k,M/=k;const L=[0,P,M];return u.bh(L,L,[0,0,0],-this.bearingInRadians),u.bi(L,L,[0,0,0],-1*this.center.lat*Math.PI/180),u.bj(L,L,[0,0,0],this.center.lng*Math.PI/180),u.aM(L,L,.25),[...L,.25*-w]}isLocationOccluded(e){return!this.isSurfacePointVisible($n(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,d=Math.cos(c),_=[Math.sin(r)*d,Math.sin(c),Math.cos(r)*d],w=[_[2],0,-_[0]],P=[0,0,0];u.aS(P,w,_),u.aR(w,w),u.aR(P,P);const M=[0,0,0];return u.aR(M,[w[0]*e[0]+P[0]*e[1]+_[0]*e[2],w[1]*e[0]+P[1]*e[1]+_[1]*e[2],w[2]*e[0]+P[2]*e[1]+_[2]*e[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,c){const d=function(P,M,k){const L=1/(1<<k.z);return new u.Z(P/u.Y*L+k.x*L,M/u.Y*L+k.y*L)}(e,r,c.canonical),_=(w=d.y,[u.be(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(e,r,c,d){const _=c.canonical,w=Tr(e,r,_.x,_.y,_.z),P=1+(d?d(e,r):0)/u.bp,M=[w[0]*P,w[1]*P,w[2]*P,1];u.an(M,M,this._globeViewProjMatrixNoCorrection);const k=this._cachedClippingPlane,L=k[0]*w[0]+k[1]*w[1]+k[2]*w[2]+k[3]<0;return{point:new u.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:L}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=io(this.worldSize,this.center.lat),r=u.b0(),c=u.b0();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),u.aW(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;r[8]=2*-d.x/this._helper._width,r[9]=2*d.y/this._helper._height,this._projectionMatrix=u.aX(r),this._globeProjMatrixInverted=u.b0(),u.ah(this._globeProjMatrixInverted,r),u.K(r,r,[0,0,-this.cameraToCenterDistance]),u.aY(r,r,this.rollInRadians),u.aZ(r,r,-this.pitchInRadians),u.aY(r,r,this.bearingInRadians),u.K(r,r,[0,0,-e]);const _=u.bg();_[0]=e,_[1]=e,_[2]=e,u.aZ(c,r,this.center.lat*Math.PI/180),u.bk(c,c,-this.center.lng*Math.PI/180),u.L(c,c,_),this._globeViewProjMatrixNoCorrection=c,u.aZ(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.bk(r,r,-this.center.lng*Math.PI/180),u.L(r,r,_),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=u.b0(),u.ah(this._globeViewProjMatrixNoCorrectionInverted,c);const w=u.bg();this._cameraPosition=u.bg(),this._cameraPosition[2]=this.cameraToCenterDistance/e,u.bh(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),u.bi(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),u.bh(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),u.aN(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bi(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),u.bj(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const P=u.aX(this._globeViewProjMatrixNoCorrectionInverted);u.L(P,P,[1,1,-1]),this._cachedFrustum=Go.fromInvProjectionMatrix(P)}calculateFogMatrix(e){u.w("calculateFogMatrix is not supported on globe projection.");const r=u.b0();return u.ar(r),r}getVisibleUnwrappedCoordinates(e){return[new u.aU(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=$n(e);u.aM(c,c,1+r/u.bp);const d=u.bf();return u.an(d,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,c=[new u.P(0,0),new u.P(e,0),new u.P(this.width,0),new u.P(this.width,r),new u.P(this.width,this.height),new u.P(e,this.height),new u.P(0,this.height),new u.P(0,r)],d=[];for(const D of c)d.push(this.unprojectScreenPoint(D));let _=0,w=0,P=0,M=0;const k=this.center;for(const D of d){const F=u.bl(k.lng,D.lng),G=u.bl(k.lat,D.lat);F<w&&(w=F),F>_&&(_=F),G<M&&(M=G),G>P&&(P=G)}const L=[k.lng+w,k.lat+M,k.lng+_,k.lat+P];return this.isSurfacePointOnScreen([0,1,0])&&(L[3]=90,L[0]=-180,L[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(L[1]=-90,L[0]=-180,L[2]=180),new Rt(L)}getConstrained(e,r){const c=u.ac(e.lat,-85.051129,u.aH),d=u.ac(+r,this.minZoom+Zn(0,c),this.maxZoom);return{center:new u.O(e.lng,c),zoom:d}}calculateCenterFromCameraLngLatAlt(e,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,d)}setLocationAtPoint(e,r){const c=$n(this.unprojectScreenPoint(r)),d=$n(e),_=u.bg();u.bm(_);const w=u.bg();u.bj(w,c,_,-this.center.lng*Math.PI/180),u.bi(w,w,_,this.center.lat*Math.PI/180);const P=d[0]*d[0]+d[2]*d[2],M=w[0]*w[0];if(P<M)return;const k=Math.sqrt(P-M),L=-k,D=u.bn(d[0],d[2],w[0],k),F=u.bn(d[0],d[2],w[0],L),G=u.bg();u.bj(G,d,_,-D);const H=u.bn(G[1],G[2],w[1],w[2]),ie=u.bg();u.bj(ie,d,_,-F);const re=u.bn(ie[1],ie[2],w[1],w[2]),se=.5*Math.PI,ce=H>=-se&&H<=se,ve=re>=-se&&re<=se;let xe,Se;if(ce&&ve){const qe=this.center.lng*Math.PI/180,nt=this.center.lat*Math.PI/180;u.bq(D,qe)+u.bq(H,nt)<u.bq(F,qe)+u.bq(re,nt)?(xe=D,Se=H):(xe=F,Se=re)}else if(ce)xe=D,Se=H;else{if(!ve)return;xe=F,Se=re}const Ce=xe/Math.PI*180,Ee=Se/Math.PI*180,$e=this.center.lat;this.setCenter(new u.O(Ce,u.ac(Ee,-90,90))),this.setZoom(this.zoom+Zn($e,this.center.lat))}locationToScreenPoint(e,r){const c=$n(e);if(r){const d=r.getElevationForLngLatZoom(e,this._helper._tileZoom);u.aM(c,c,1+d/u.bp)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(e){const r=u.bf();return u.an(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new u.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c)return c}return u.Z.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(e,r){const c=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,d)}getRayDirectionFromPixel(e){const r=u.bf();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,u.an(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const c=u.bg();c[0]=r[0]-this._cameraPosition[0],c[1]=r[1]-this._cameraPosition[1],c[2]=r[2]-this._cameraPosition[2];const d=u.bg();return u.aR(d,c),d}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=u.bf();return u.an(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const c=u.aT(e,r),d=u.bg(),_=u.bg();u.aM(_,r,c),u.aQ(d,e,_);const w=1-u.aT(d,d);if(w<0)return null;const P=u.aT(e,e)-1,M=-c+(c<0?1:-1)*Math.sqrt(w),k=P/M,L=M;return{tMin:Math.min(k,L),tMax:Math.max(k,L)}}unprojectScreenPoint(e){const r=this._cameraPosition,c=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(r,c);if(d){const k=u.bg();u.aN(k,r,[c[0]*d.tMin,c[1]*d.tMin,c[2]*d.tMin]);const L=u.bg();return u.aR(L,k),oo(L)}const _=this._cachedClippingPlane[0]*c[0]+this._cachedClippingPlane[1]*c[1]+this._cachedClippingPlane[2]*c[2],w=-u.bo(this._cachedClippingPlane,r)/_,P=u.bg();if(w>0)u.aN(P,r,[c[0]*w,c[1]*w,c[2]*w]);else{const k=u.bg();u.aN(k,r,[2*c[0],2*c[1],2*c[2]]);const L=u.bo(this._cachedClippingPlane,k);u.aQ(P,k,[this._cachedClippingPlane[0]*L,this._cachedClippingPlane[1]*L,this._cachedClippingPlane[2]*L])}const M=u.bg();return u.aR(M,P),oo(M)}getMatrixForModel(e,r){const c=u.O.convert(e),d=1/u.bp,_=u.a$();return u.bk(_,_,c.lng/180*Math.PI),u.aZ(_,_,-c.lat/180*Math.PI),u.K(_,_,[0,0,1+r/u.bp]),u.aZ(_,_,.5*Math.PI),u.L(_,_,[d,d,d]),_}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new u.X(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Kr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ns({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new $o,this._verticalPerspectiveTransform=new Wu}clone(){const e=new Kr;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:r.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return u.ba(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.ba(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,c){const d=this._mercatorTransform.getPitchedTextCorrection(e,r,c),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,c);return u.ba(d,_,this._globeness)}projectTileCoordinates(e,r,c,d){return this.currentTransform.projectTileCoordinates(e,r,c,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,d)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=r.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Vi{get useGlobeControls(){return!0}handlePanInertia(e,r){const c=Zu(e,r);return Math.abs(c.lng-r.center.lng)>180&&(c.lng=r.center.lng+179.5*Math.sign(c.lng-r.center.lng)),{easingCenter:c,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const c=e.around,d=r.screenPointToLocation(c);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const _=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const w=r.zoom-_;if(w===0)return;const P=u.bl(r.center.lng,d.lng),M=P/(Math.abs(P/180)+1),k=u.bl(r.center.lat,d.lat),L=r.getRayDirectionFromPixel(c),D=r.cameraPosition,F=-1*u.aT(D,L),G=u.bg();u.aN(G,D,[L[0]*F,L[1]*F,L[2]*F]);const H=u.br(G)-1,ie=Math.exp(.5*-Math.max(H-.3,0)),re=io(r.worldSize,r.center.lat)/Math.min(r.width,r.height),se=u.bd(re,.9,.5,1,.25),ce=(1-u.aG(-w))*Math.min(ie,se),ve=r.center.lat,xe=r.zoom,Se=new u.O(r.center.lng+M*ce,u.ac(r.center.lat+k*ce,-85.051129,u.aH));r.setLocationAtPoint(d,c);const Ce=r.center,Ee=u.bd(Math.abs(P),45,85,0,1),$e=u.bd(re,.75,.35,0,1),qe=Math.pow(Math.max(Ee,$e),.25),nt=u.bl(Ce.lng,Se.lng),at=u.bl(Ce.lat,Se.lat);r.setCenter(new u.O(Ce.lng+nt*qe,Ce.lat+at*qe).wrap()),r.setZoom(xe+Zn(ve,r.center.lat))}handleMapControlsPan(e,r,c){if(!e.panDelta)return;const d=r.center.lat,_=r.zoom;r.setCenter(Zu(e.panDelta,r).wrap()),r.setZoom(_+Zn(d,r.center.lat))}cameraForBoxAndBearing(e,r,c,d,_){const w=us(e,r,c,d,_),P=r.left/_.width*2-1,M=(_.width-r.right)/_.width*2-1,k=r.top/_.height*-2+1,L=(_.height-r.bottom)/_.height*-2+1,D=u.bl(c.getWest(),c.getEast())<0,F=D?c.getEast():c.getWest(),G=D?c.getWest():c.getEast(),H=Math.max(c.getNorth(),c.getSouth()),ie=Math.min(c.getNorth(),c.getSouth()),re=F+.5*u.bl(F,G),se=H+.5*u.bl(H,ie),ce=_.clone();ce.setCenter(w.center),ce.setBearing(w.bearing),ce.setPitch(0),ce.setRoll(0),ce.setZoom(w.zoom);const ve=ce.modelViewProjectionMatrix,xe=[$n(c.getNorthWest()),$n(c.getNorthEast()),$n(c.getSouthWest()),$n(c.getSouthEast()),$n(new u.O(G,se)),$n(new u.O(F,se)),$n(new u.O(re,H)),$n(new u.O(re,ie))],Se=$n(w.center);let Ce=Number.POSITIVE_INFINITY;for(const Ee of xe)P<0&&(Ce=Vi.getLesserNonNegativeNonNull(Ce,Vi.solveVectorScale(Ee,Se,ve,"x",P))),M>0&&(Ce=Vi.getLesserNonNegativeNonNull(Ce,Vi.solveVectorScale(Ee,Se,ve,"x",M))),k>0&&(Ce=Vi.getLesserNonNegativeNonNull(Ce,Vi.solveVectorScale(Ee,Se,ve,"y",k))),L<0&&(Ce=Vi.getLesserNonNegativeNonNull(Ce,Vi.solveVectorScale(Ee,Se,ve,"y",L)));if(Number.isFinite(Ce)&&Ce!==0)return w.zoom=ce.zoom+u.a9(Ce),w;ro()}handleJumpToCenterZoom(e,r){const c=e.center.lat,d=e.getConstrained(r.center?u.O.convert(r.center):e.center,e.zoom).center;e.setCenter(d.wrap());const _=r.zoom!==void 0?+r.zoom:e.zoom+Zn(c,d.lat);e.zoom!==_&&e.setZoom(_)}handleEaseTo(e,r){const c=e.zoom,d=e.center,_=e.padding,w={roll:e.roll,pitch:e.pitch,bearing:e.bearing},P={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},M=r.zoom!==void 0,k=!e.isPaddingEqual(r.padding);let L=!1;const D=r.center?u.O.convert(r.center):d,F=e.getConstrained(D,c).center;ii(e,F);const G=e.clone();G.setCenter(F),G.setZoom(M?+r.zoom:c+Zn(d.lat,D.lat)),G.setBearing(r.bearing);const H=new u.P(u.ac(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),u.ac(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));G.setLocationAtPoint(F,H);const ie=(r.offset&&r.offsetAsPoint.mag())>0?G.center:F,re=M?+r.zoom:c+Zn(d.lat,ie.lat),se=c+Zn(d.lat,0),ce=re+Zn(ie.lat,0),ve=u.bl(d.lng,ie.lng),xe=u.bl(d.lat,ie.lat),Se=u.aG(ce-se);return L=re!==c,{easeFunc:Ce=>{if(u.b4(w,P)||xh({startEulerAngles:w,endEulerAngles:P,tr:e,k:Ce,useSlerp:w.roll!=P.roll}),k&&e.interpolatePadding(_,r.padding,Ce),r.around)u.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const Ee=ce>se?Math.min(2,Se):Math.max(.5,Se),$e=Math.pow(Ee,1-Ce),qe=bh(d,ve,xe,Ce*$e);e.setCenter(qe.wrap())}if(L){const Ee=u.z.number(se,ce,Ce)+Zn(0,e.center.lat);e.setZoom(Ee)}},isZooming:L,elevationCenter:ie}}handleFlyTo(e,r){const c=r.zoom!==void 0,d=e.center,_=e.zoom,w=e.padding,P=!e.isPaddingEqual(r.padding),M=e.getConstrained(u.O.convert(r.center||r.locationAtOffset),_).center,k=c?+r.zoom:e.zoom+Zn(e.center.lat,M.lat),L=e.clone();L.setCenter(M),L.setZoom(k),L.setBearing(r.bearing);const D=new u.P(u.ac(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),u.ac(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));L.setLocationAtPoint(M,D);const F=L.center;ii(e,F);const G=function(xe,Se,Ce){const Ee=$n(Se),$e=$n(Ce),qe=u.aT(Ee,$e),nt=Math.acos(qe),at=Id(xe);return nt/(2*Math.PI)*at}(e,d,F),H=_+Zn(d.lat,0),ie=k+Zn(F.lat,0),re=u.aG(ie-H);let se;if(typeof r.minZoom=="number"){const xe=+r.minZoom+Zn(F.lat,0),Se=Math.min(xe,H,ie)+Zn(0,F.lat),Ce=e.getConstrained(F,Se).zoom+Zn(F.lat,0);se=u.aG(Ce-H)}const ce=u.bl(d.lng,F.lng),ve=u.bl(d.lat,F.lat);return{easeFunc:(xe,Se,Ce,Ee)=>{const $e=bh(d,ce,ve,Ce);P&&e.interpolatePadding(w,r.padding,xe);const qe=xe===1?F:$e;e.setCenter(qe.wrap());const nt=H+u.a9(Se);e.setZoom(xe===1?k:nt+Zn(0,qe.lat))},scaleOfZoom:re,targetCenter:F,scaleOfMinZoom:se,pixelPathLength:G}}static solveVectorScale(e,r,c,d,_){const w=d==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],P=[c[3],c[7],c[11],c[15]],M=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],k=e[0]*P[0]+e[1]*P[1]+e[2]*P[2],L=r[0]*w[0]+r[1]*w[1]+r[2]*w[2],D=r[0]*P[0]+r[1]*P[1]+r[2]*P[2];return L+_*k===M+_*D||P[3]*(M-L)+w[3]*(D-k)+M*D==L*k?null:(L+w[3]-_*D-_*P[3])/(L-M-_*D+_*k)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class tl{constructor(e){this._globe=e,this._mercatorCameraHelper=new Gu,this._verticalPerspectiveCameraHelper=new Vi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,c){this.currentHelper.handleMapControlsPan(e,r,c)}cameraForBoxAndBearing(e,r,c,d,_){return this.currentHelper.cameraForBoxAndBearing(e,r,c,d,_)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const Gi=(g,e)=>u.t(g,e&&e.filter(r=>r.identifier!=="source.canvas")),nl=u.bs();class bi extends u.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const c in this.sourceCaches){const d=this.sourceCaches[c].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[c].reload()}},this.map=e,this.dispatcher=new Ft(zt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(c,d)=>this.getGlyphs(c,d)),this.dispatcher.registerMessageHandler("GI",(c,d)=>this.getImages(c,d)),this.imageManager=new pe,this.imageManager.setEventedParent(this),this.glyphManager=new Ye(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new ye(256,512),this.crossTileSymbolIndex=new Uo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.bt,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.bu()),di().on(Bi,this._rtlPluginLoaded),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const w in this._layers){const P=this._layers[w];P.source===_.id&&this._validateLayer(P)}})}loadURL(e,r={},c){this.fire(new u.k("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;u.h(d,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,r,c)}).catch(w=>{this._loadStyleRequest=null,w&&!_.signal.aborted&&this.fire(new u.j(w))})}loadJSON(e,r={},c){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,fe.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,c)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(nl,{validate:!1})}_load(e,r,c){var d,_;const w=r.transformStyle?r.transformStyle(c,e):e;if(!r.validate||!Gi(this,u.x(w))){this._loaded=!0,this.stylesheet=w;for(const P in w.sources)this.addSource(P,w.sources[P],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new We(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Ke(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const e=u.bv(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const c=u.bw(r);c.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=c}}_loadSprite(e,r=!1,c=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,w,P,M){return u._(this,void 0,void 0,function*(){const k=ct(_),L=P>1?"@2x":"",D={},F={};for(const{id:G,url:H}of k){const ie=w.transformRequest(ht(H,L,".json"),"SpriteJSON");D[G]=u.h(ie,M);const re=w.transformRequest(ht(H,L,".png"),"SpriteImage");F[G]=Ne.getImage(re,M)}return yield Promise.all([...Object.values(D),...Object.values(F)]),function(G,H){return u._(this,void 0,void 0,function*(){const ie={};for(const re in G){ie[re]={};const se=fe.getImageCanvasContext((yield H[re]).data),ce=(yield G[re]).data;for(const ve in ce){const{width:xe,height:Se,x:Ce,y:Ee,sdf:$e,pixelRatio:qe,stretchX:nt,stretchY:at,content:Qe,textFitWidth:lt,textFitHeight:Tt}=ce[ve];ie[re][ve]={data:null,pixelRatio:qe,sdf:$e,stretchX:nt,stretchY:at,content:Qe,textFitWidth:lt,textFitHeight:Tt,spriteData:{width:xe,height:Se,x:Ce,y:Ee,context:se}}}}return ie})}(D,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const w in _){this._spritesImagesIds[w]=[];const P=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(M=>!(M in _)):[];for(const M of P)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in _[w]){const k=w==="default"?M:`${w}:${M}`;this._spritesImagesIds[w].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,_[w][M],!1):this.imageManager.addImage(k,_[w][M]),r&&(this._changedImages[k]=!0)}}}).catch(_=>{this._spriteRequest=null,d=_,this.fire(new u.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),c&&c(d)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const c=e.sourceLayer;if(!c)return;const d=r.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(c)===-1)&&this.fire(new u.j(new Error(`Source layer "${c}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?u.bx(c):c);const d=[];for(const _ of e)if(c[_]){const w=r?u.bx(c[_]):c[_];d.push(w)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const c of r){const d=this._layers[c];d.type!=="custom"&&(e[c]=d.serialize())}return e}hasTransitions(){var e,r,c;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const w in this._updatedSources){const P=this._updatedSources[w];if(P==="reload")this._reloadSource(w);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const c={};for(const d in this.sourceCaches){const _=this.sourceCaches[d];c[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(e,this._availableImages),!_.isHidden(e.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const d in c){const _=this.sourceCaches[d];!!c[d]!=!!_.used&&_.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var c;this._checkLoaded();const d=this.serialize();if(e=r.transformStyle?r.transformStyle(d,e):e,((c=r.validate)===null||c===void 0||c)&&Gi(this,u.x(e)))return!1;(e=u.bx(e)).layers=u.bv(e.layers);const _=u.by(d,e),w=this._getOperationsToPerform(_);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const P of w.operations)P();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],c=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":r.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":r.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,d.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setSky":r.push(()=>this.setSky.apply(this,d.args));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setTransition":r.push(()=>{});break;default:c.push(d.command)}return{operations:r,unimplemented:c}}addImage(e,r){if(this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,c={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(u.x.source,`sources.${e}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const d=this.sourceCaches[e]=new W(e,r,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===e)return this.fire(new u.j(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const c=this.sourceCaches[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,c={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new u.j(new Error(`Layer "${d}" already exists on this map.`)));let _;if(e.type==="custom"){if(Gi(this,u.bz(e)))return;_=u.bw(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=u.bx(e),e=u.e(e,{source:d})),this._validate(u.x.layer,`layers.${d}`,e,{arrayIndex:-1},c))return;_=u.bw(e),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const w=r?this._order.indexOf(r):this._order.length;if(r&&w===-1)this.fire(new u.j(new Error(`Cannot add layer "${d}" before non-existing layer "${r}".`)));else{if(this._order.splice(w,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const P=this._removedLayers[d];delete this._removedLayers[d],P.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new u.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const c=this._order.indexOf(e);this._order.splice(c,1);const d=r?this._order.indexOf(r):this._order.length;r&&d===-1?this.fire(new u.j(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,c){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===r&&d.maxzoom===c||(r!=null&&(d.minzoom=r),c!=null&&(d.maxzoom=c),this._updateLayer(d)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,c={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!u.bA(d.filter,r))return r==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(u.x.filter,`layers.${d.id}.filter`,r,null,c)||(d.filter=u.bx(r),this._updateLayer(d)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return u.bx(this.getLayer(e).filter)}setLayoutProperty(e,r,c,d={}){this._checkLoaded();const _=this.getLayer(e);_?u.bA(_.getLayoutProperty(r),c)||(_.setLayoutProperty(r,c,d),this._updateLayer(_)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const c=this.getLayer(e);if(c)return c.getLayoutProperty(r);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,c,d={}){this._checkLoaded();const _=this.getLayer(e);_?u.bA(_.getPaintProperty(r),c)||(_.setPaintProperty(r,c,d)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const c=e.source,d=e.sourceLayer,_=this.sourceCaches[c];if(_===void 0)return void this.fire(new u.j(new Error(`The source '${c}' does not exist in the map's style.`)));const w=_.getSource().type;w==="geojson"&&d?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||d?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,e.id,r)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const c=e.source,d=this.sourceCaches[c];if(d===void 0)return void this.fire(new u.j(new Error(`The source '${c}' does not exist in the map's style.`)));const _=d.getSource().type,w=_==="vector"?e.sourceLayer:void 0;_!=="vector"||w?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(w,e.id,r):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,c=e.sourceLayer,d=this.sourceCaches[r];if(d!==void 0)return d.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(c,e.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=u.bB(this.sourceCaches,_=>_.serialize()),r=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,d=this.stylesheet;return u.bC({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:r,terrain:c},_=>_!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=w=>this._layers[w].type==="fill-extrusion",c={},d=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(r(P)){c[P]=w;for(const M of e){const k=M[P];if(k)for(const L of k)d.push(L)}}}d.sort((w,P)=>P.intersectionZ-w.intersectionZ);const _=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(r(P))for(let M=d.length-1;M>=0;M--){const k=d[M].feature;if(c[k.layer.id]<w)break;_.push(k),d.pop()}else for(const M of e){const k=M[P];if(k)for(const L of k)_.push(L.feature)}}return _}queryRenderedFeatures(e,r,c){r&&r.filter&&this._validate(u.x.filter,"queryRenderedFeatures.filter",r.filter,null,r);const d={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new u.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const k of r.layers){const L=this._layers[k];if(!L)return this.fire(new u.j(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];d[L.source]=!0}}const _=[];r.availableImages=this._availableImages;const w=this._serializedAllLayers(),P=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,M=Object.assign(Object.assign({},r),{layers:P});for(const k in this.sourceCaches)r.layers&&!d[k]||_.push(Dn(this.sourceCaches[k],this._layers,w,e,M,c));return this.placement&&_.push(function(k,L,D,F,G,H,ie){const re={},se=H.queryRenderedSymbols(F),ce=[];for(const ve of Object.keys(se).map(Number))ce.push(ie[ve]);ce.sort(Ht);for(const ve of ce){const xe=ve.featureIndex.lookupSymbolFeatures(se[ve.bucketInstanceId],L,ve.bucketIndex,ve.sourceLayerIndex,G.filter,G.layers,G.availableImages,k);for(const Se in xe){const Ce=re[Se]=re[Se]||[],Ee=xe[Se];Ee.sort(($e,qe)=>{const nt=ve.featureSortOrder;if(nt){const at=nt.indexOf($e.featureIndex);return nt.indexOf(qe.featureIndex)-at}return qe.featureIndex-$e.featureIndex});for(const $e of Ee)Ce.push($e)}}return function(ve,xe,Se){for(const Ce in ve)for(const Ee of ve[Ce])tn(Ee,Se[xe[Ce].source]);return ve}(re,k,D)}(this._layers,w,this.sourceCaches,e,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(e,r){r&&r.filter&&this._validate(u.x.filter,"querySourceFeatures.filter",r.filter,null,r);const c=this.sourceCaches[e];return c?function(d,_){const w=d.getRenderableIds().map(k=>d.getTileByID(k)),P=[],M={};for(let k=0;k<w.length;k++){const L=w[k],D=L.tileID.canonical.key;M[D]||(M[D]=!0,L.querySourceFeatures(P,_))}return P}(c,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const c=this.light.getLight();let d=!1;for(const w in e)if(!u.bA(e[w],c[w])){d=!0;break}if(!d)return;const _={now:fe.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(_)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const c=this.getSky();let d=!1;if(!e&&!c)return;if(e&&!c)d=!0;else if(!e&&c)d=!0;else for(const w in e)if(!u.bA(e[w],c[w])){d=!0;break}if(!d)return;const _={now:fe.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(_)}_setProjectionInternal(e){const r=function(c){if(Array.isArray(c)){const d=new $u({type:c});return{projection:d,transform:new Kr,cameraHelper:new tl(d)}}switch(c){case"mercator":return{projection:new ma,transform:new $o,cameraHelper:new Gu};case"globe":{const d=new $u({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Kr,cameraHelper:new tl(d)}}case"vertical-perspective":return{projection:new Md,transform:new Wu,cameraHelper:new Vi};default:return u.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new ma,transform:new $o,cameraHelper:new Gu}}}(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const c in this.sourceCaches)this.sourceCaches[c].reload()}_validate(e,r,c,d,_={}){return(!_||_.validate!==!1)&&Gi(this,e.call(u.x,u.e({key:r,style:this.serialize(),value:c,styleSpec:u.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),di().off(Bi,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const c=this.sourceCaches[r];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,c,d,_=!1){let w=!1,P=!1;const M={};for(const k of this._order){const L=this._layers[k];if(L.type!=="symbol")continue;if(!M[L.source]){const F=this.sourceCaches[L.source];M[L.source]=F.getRenderableIds(!0).map(G=>F.getTileByID(G)).sort((G,H)=>H.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(H.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(L,M[L.source],e.center.lng);w=w||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(fe.now(),e.zoom))&&(this.pauseablePlacement=new _h(e,this.map.terrain,this._order,_,r,c,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(fe.now()),P=!0),w&&this.pauseablePlacement.placement.setStale()),P||w)for(const k of this._order){const L=this._layers[k];L.type==="symbol"&&this.placement.updateLayerOpacities(L,M[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(fe.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return u._(this,void 0,void 0,function*(){const c=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,r.icons),c})}getGlyphs(e,r){return u._(this,void 0,void 0,function*(){const c=yield this.glyphManager.getGlyphs(r.stacks),d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,[""]),c})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(u.x.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,c={},d){this._checkLoaded();const _=[{id:e,url:r}],w=[...ct(this.stylesheet.sprite),..._];this._validate(u.x.sprite,"sprite",w,null,c)||(this.stylesheet.sprite=w,this._loadSprite(_,!0,d))}removeSprite(e){this._checkLoaded();const r=ct(this.stylesheet.sprite);if(r.find(c=>c.id===e)){if(this._spritesImagesIds[e])for(const c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;r.splice(r.findIndex(c=>c.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ct(this.stylesheet.sprite)}setSprite(e,r={},c){this._checkLoaded(),e&&this._validate(u.x.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}}var pr=u.aB([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Zo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,c,d,_,w,P,M,k){this.context=e;let L=this.boundPaintVertexBuffers.length!==d.length;for(let D=0;!L&&D<d.length;D++)this.boundPaintVertexBuffers[D]!==d[D]&&(L=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||L||this.boundIndexBuffer!==_||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==k?this.freshBind(r,c,d,_,w,P,M,k):(e.bindVertexArray.set(this.vao),P&&P.bind(),_&&_.dynamicDraw&&_.bind(),M&&M.bind(),k&&k.bind())}freshBind(e,r,c,d,_,w,P,M){const k=e.numAttributes,L=this.context,D=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=M,r.enableAttributes(D,e);for(const F of c)F.enableAttributes(D,e);w&&w.enableAttributes(D,e),P&&P.enableAttributes(D,e),M&&M.enableAttributes(D,e),r.bind(),r.setVertexAttribPointers(D,e,_);for(const F of c)F.bind(),F.setVertexAttribPointers(D,e,_);w&&(w.bind(),w.setVertexAttribPointers(D,e,_)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(D,e,_)),M&&(M.bind(),M.setVertexAttribPointers(D,e,_)),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const _a=(g,e,r,c,d)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):u.b5.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:r?r.calculateFogBlendOpacity(c):0,u_horizon_color:r?r.properties.get("horizon-color"):u.b5.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),ql={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function rl(g){const e=[];for(let r=0;r<g.length;r++){if(g[r]===null)continue;const c=g[r].split(" ");e.push(c.pop())}return e}class Hu{constructor(e,r,c,d,_,w,P,M){const k=e.gl;this.program=k.createProgram();const L=rl(r.staticAttributes),D=c?c.getBinderAttributes():[],F=L.concat(D),G=Vo.prelude.staticUniforms?rl(Vo.prelude.staticUniforms):[],H=P.staticUniforms?rl(P.staticUniforms):[],ie=r.staticUniforms?rl(r.staticUniforms):[],re=c?c.getBinderUniforms():[],se=G.concat(H).concat(ie).concat(re),ce=[];for(const qe of se)ce.indexOf(qe)<0&&ce.push(qe);const ve=c?c.defines():[];In(k)&&ve.unshift("#version 300 es"),_&&ve.push("#define OVERDRAW_INSPECTOR;"),w&&ve.push("#define TERRAIN3D;"),M&&ve.push(M);let xe=ve.concat(Vo.prelude.fragmentSource,P.fragmentSource,r.fragmentSource).join(`
`),Se=ve.concat(Vo.prelude.vertexSource,P.vertexSource,r.vertexSource).join(`
`);In(k)||(xe=function(qe){return qe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(xe),Se=function(qe){return qe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Se));const Ce=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(Ce,xe),k.compileShader(Ce),!k.getShaderParameter(Ce,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(Ce)}`);k.attachShader(this.program,Ce);const Ee=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(Ee,Se),k.compileShader(Ee),!k.getShaderParameter(Ee,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(Ee)}`);k.attachShader(this.program,Ee),this.attributes={};const $e={};this.numAttributes=F.length;for(let qe=0;qe<this.numAttributes;qe++)F[qe]&&(k.bindAttribLocation(this.program,qe,F[qe]),this.attributes[F[qe]]=qe);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(Ee),k.deleteShader(Ce);for(let qe=0;qe<ce.length;qe++){const nt=ce[qe];if(nt&&!$e[nt]){const at=k.getUniformLocation(this.program,nt);at&&($e[nt]=at)}}this.fixedUniforms=d(e,$e),this.terrainUniforms=((qe,nt)=>({u_depth:new u.bD(qe,nt.u_depth),u_terrain:new u.bD(qe,nt.u_terrain),u_terrain_dim:new u.b6(qe,nt.u_terrain_dim),u_terrain_matrix:new u.bF(qe,nt.u_terrain_matrix),u_terrain_unpack:new u.bG(qe,nt.u_terrain_unpack),u_terrain_exaggeration:new u.b6(qe,nt.u_terrain_exaggeration)}))(e,$e),this.projectionUniforms=((qe,nt)=>({u_projection_matrix:new u.bF(qe,nt.u_projection_matrix),u_projection_tile_mercator_coords:new u.bG(qe,nt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.bG(qe,nt.u_projection_clipping_plane),u_projection_transition:new u.b6(qe,nt.u_projection_transition),u_projection_fallback_matrix:new u.bF(qe,nt.u_projection_fallback_matrix)}))(e,$e),this.binderUniforms=c?c.getUniforms(e,$e):[]}draw(e,r,c,d,_,w,P,M,k,L,D,F,G,H,ie,re,se,ce,ve){const xe=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(d),e.setColorMode(_),e.setCullFace(w),M){e.activeTexture.set(xe.TEXTURE2),xe.bindTexture(xe.TEXTURE_2D,M.depthTexture),e.activeTexture.set(xe.TEXTURE3),xe.bindTexture(xe.TEXTURE_2D,M.texture);for(const Ce in this.terrainUniforms)this.terrainUniforms[Ce].set(M[Ce])}if(k)for(const Ce in k)this.projectionUniforms[ql[Ce]].set(k[Ce]);if(P)for(const Ce in this.fixedUniforms)this.fixedUniforms[Ce].set(P[Ce]);re&&re.setUniforms(e,this.binderUniforms,H,{zoom:ie});let Se=0;switch(r){case xe.LINES:Se=2;break;case xe.TRIANGLES:Se=3;break;case xe.LINE_STRIP:Se=1}for(const Ce of G.get()){const Ee=Ce.vaos||(Ce.vaos={});(Ee[L]||(Ee[L]=new Zo)).bind(e,this,D,re?re.getPaintVertexBuffers():[],F,Ce.vertexOffset,se,ce,ve),xe.drawElements(r,Ce.primitiveLength*Se,xe.UNSIGNED_SHORT,Ce.primitiveOffset*Se*2)}}}function Ad(g,e,r){const c=1/u.au(r,1,e.transform.tileZoom),d=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,e.transform.tileZoom)/d,w=_*(r.tileID.canonical.x+r.tileID.wrap*d),P=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[c,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[w>>16,P>>16],u_pixel_coord_lower:[65535&w,65535&P]}}const ya=(g,e,r,c)=>{const d=g.style.light,_=d.properties.get("position"),w=[_.x,_.y,_.z],P=u.bJ();d.properties.get("anchor")==="viewport"&&u.bK(P,g.transform.bearingInRadians),u.bL(w,w,P);const M=g.transform.transformLightDirection(w),k=d.properties.get("color");return{u_lightpos:w,u_lightpos_globe:M,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:c}},zd=(g,e,r,c,d,_,w)=>u.e(ya(g,e,r,c),Ad(_,g,w),{u_height_factor:-Math.pow(2,d.overscaledZ)/w.tileSize/8}),il=(g,e,r,c)=>u.e(Ad(e,g,r),{u_fill_translate:c}),ol=(g,e)=>({u_world:g,u_fill_translate:e}),Rd=(g,e,r,c,d)=>u.e(il(g,e,r,d),{u_world:c}),Yu=(g,e,r,c,d)=>{const _=g.transform;let w,P,M=0;if(r.paint.get("circle-pitch-alignment")==="map"){const k=u.au(e,1,_.zoom);w=!0,P=[k,k],M=k/(u.Y*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else w=!1,P=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:P,u_globe_extrude_scale:M,u_translate:c}},Sh=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),Xu=g=>({u_viewport_size:[g.width,g.height]}),Wl=(g,e=1)=>({u_color:g,u_overlay:0,u_overlay_scale:e}),Ku=(g,e,r,c)=>{const d=u.au(g,1,e)/(u.Y*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:u.au(g,1,e),u_intensity:r,u_globe_extrude_scale:d}},js=(g,e,r,c)=>{const d=u.J();u.bM(d,0,g.width,g.height,0,0,1);const _=g.context.gl;return{u_matrix:d,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:r,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}},Ju=(g,e,r)=>{const c=r.paint.get("hillshade-shadow-color"),d=r.paint.get("hillshade-highlight-color"),_=r.paint.get("hillshade-accent-color");let w=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);return r.paint.get("hillshade-illumination-anchor")==="viewport"&&(w+=g.transform.bearingInRadians),{u_image:0,u_latrange:Hl(0,e.tileID),u_light:[r.paint.get("hillshade-exaggeration"),w],u_shadow:c,u_highlight:d,u_accent:_}},Qu=(g,e)=>{const r=e.stride,c=u.J();return u.bM(c,0,u.Y,-8192,0,0,1),u.K(c,c,[0,-8192,0]),{u_matrix:c,u_image:1,u_dimension:[r,r],u_zoom:g.overscaledZ,u_unpack:e.getUnpackVector()}};function Hl(g,e){const r=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new u.Z(0,c/r).toLngLat().lat,new u.Z(0,(c+1)/r).toLngLat().lat]}const ec=(g,e,r,c)=>{const d=g.transform;return{u_translation:nc(g,e,r),u_ratio:c/u.au(e,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},fi=(g,e,r,c,d)=>u.e(ec(g,e,r,c),{u_image:0,u_image_height:d}),Th=(g,e,r,c,d)=>{const _=g.transform,w=tc(e,_);return{u_translation:nc(g,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:c/u.au(e,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Yl=(g,e,r,c,d,_)=>{const w=g.lineAtlas,P=tc(e,g.transform),M=r.layout.get("line-cap")==="round",k=w.getDash(d.from,M),L=w.getDash(d.to,M),D=k.width*_.fromScale,F=L.width*_.toScale;return u.e(ec(g,e,r,c),{u_patternscale_a:[P/D,-k.height/2],u_patternscale_b:[P/F,-L.height/2],u_sdfgamma:w.width/(256*Math.min(D,F)*g.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:L.y,u_mix:_.t})};function tc(g,e){return 1/u.au(g,1,e.tileZoom)}function nc(g,e,r){return u.av(g.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Ld=(g,e,r,c,d)=>{return{u_tl_parent:g,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(_=c.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Ch(c.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var _,w};function Ch(g){g*=Math.PI/180;const e=Math.sin(g),r=Math.cos(g);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const Ph=(g,e,r,c,d,_,w,P,M,k,L,D,F)=>{const G=w.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:G.width/G.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:P,u_coord_matrix:M,u_is_text:+L,u_pitch_with_map:+c,u_is_along_line:d,u_is_variable_anchor:_,u_texsize:D,u_texture:0,u_translation:k,u_pitched_scale:F}},Xl=(g,e,r,c,d,_,w,P,M,k,L,D,F,G)=>{const H=w.transform;return u.e(Ph(g,e,r,c,d,_,w,P,M,k,L,D,G),{u_gamma_scale:c?Math.cos(H.pitch*Math.PI/180)*H.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},ds=(g,e,r,c,d,_,w,P,M,k,L,D,F)=>u.e(Xl(g,e,r,c,d,_,w,P,M,k,!0,L,0,F),{u_texsize_icon:D,u_texture_icon:1}),Us=(g,e)=>({u_opacity:g,u_color:e}),Eh=(g,e,r,c,d)=>u.e(function(_,w,P,M){const k=P.imageManager.getPattern(_.from.toString()),L=P.imageManager.getPattern(_.to.toString()),{width:D,height:F}=P.imageManager.getPixelSize(),G=Math.pow(2,M.tileID.overscaledZ),H=M.tileSize*Math.pow(2,P.transform.tileZoom)/G,ie=H*(M.tileID.canonical.x+M.tileID.wrap*G),re=H*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[D,F],u_mix:w.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/u.au(M,1,P.transform.tileZoom),u_pixel_coord_upper:[ie>>16,re>>16],u_pixel_coord_lower:[65535&ie,65535&re]}}(r,d,e,c),{u_opacity:g}),rc=(g,e)=>{},ic={fillExtrusion:(g,e)=>({u_lightpos:new u.bH(g,e.u_lightpos),u_lightpos_globe:new u.bH(g,e.u_lightpos_globe),u_lightintensity:new u.b6(g,e.u_lightintensity),u_lightcolor:new u.bH(g,e.u_lightcolor),u_vertical_gradient:new u.b6(g,e.u_vertical_gradient),u_opacity:new u.b6(g,e.u_opacity),u_fill_translate:new u.bI(g,e.u_fill_translate)}),fillExtrusionPattern:(g,e)=>({u_lightpos:new u.bH(g,e.u_lightpos),u_lightpos_globe:new u.bH(g,e.u_lightpos_globe),u_lightintensity:new u.b6(g,e.u_lightintensity),u_lightcolor:new u.bH(g,e.u_lightcolor),u_vertical_gradient:new u.b6(g,e.u_vertical_gradient),u_height_factor:new u.b6(g,e.u_height_factor),u_opacity:new u.b6(g,e.u_opacity),u_fill_translate:new u.bI(g,e.u_fill_translate),u_image:new u.bD(g,e.u_image),u_texsize:new u.bI(g,e.u_texsize),u_pixel_coord_upper:new u.bI(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bI(g,e.u_pixel_coord_lower),u_scale:new u.bH(g,e.u_scale),u_fade:new u.b6(g,e.u_fade)}),fill:(g,e)=>({u_fill_translate:new u.bI(g,e.u_fill_translate)}),fillPattern:(g,e)=>({u_image:new u.bD(g,e.u_image),u_texsize:new u.bI(g,e.u_texsize),u_pixel_coord_upper:new u.bI(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bI(g,e.u_pixel_coord_lower),u_scale:new u.bH(g,e.u_scale),u_fade:new u.b6(g,e.u_fade),u_fill_translate:new u.bI(g,e.u_fill_translate)}),fillOutline:(g,e)=>({u_world:new u.bI(g,e.u_world),u_fill_translate:new u.bI(g,e.u_fill_translate)}),fillOutlinePattern:(g,e)=>({u_world:new u.bI(g,e.u_world),u_image:new u.bD(g,e.u_image),u_texsize:new u.bI(g,e.u_texsize),u_pixel_coord_upper:new u.bI(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bI(g,e.u_pixel_coord_lower),u_scale:new u.bH(g,e.u_scale),u_fade:new u.b6(g,e.u_fade),u_fill_translate:new u.bI(g,e.u_fill_translate)}),circle:(g,e)=>({u_camera_to_center_distance:new u.b6(g,e.u_camera_to_center_distance),u_scale_with_map:new u.bD(g,e.u_scale_with_map),u_pitch_with_map:new u.bD(g,e.u_pitch_with_map),u_extrude_scale:new u.bI(g,e.u_extrude_scale),u_device_pixel_ratio:new u.b6(g,e.u_device_pixel_ratio),u_globe_extrude_scale:new u.b6(g,e.u_globe_extrude_scale),u_translate:new u.bI(g,e.u_translate)}),collisionBox:(g,e)=>({u_pixel_extrude_scale:new u.bI(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_viewport_size:new u.bI(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new u.bE(g,e.u_color),u_overlay:new u.bD(g,e.u_overlay),u_overlay_scale:new u.b6(g,e.u_overlay_scale)}),depth:rc,clippingMask:rc,heatmap:(g,e)=>({u_extrude_scale:new u.b6(g,e.u_extrude_scale),u_intensity:new u.b6(g,e.u_intensity),u_globe_extrude_scale:new u.b6(g,e.u_globe_extrude_scale)}),heatmapTexture:(g,e)=>({u_matrix:new u.bF(g,e.u_matrix),u_world:new u.bI(g,e.u_world),u_image:new u.bD(g,e.u_image),u_color_ramp:new u.bD(g,e.u_color_ramp),u_opacity:new u.b6(g,e.u_opacity)}),hillshade:(g,e)=>({u_image:new u.bD(g,e.u_image),u_latrange:new u.bI(g,e.u_latrange),u_light:new u.bI(g,e.u_light),u_shadow:new u.bE(g,e.u_shadow),u_highlight:new u.bE(g,e.u_highlight),u_accent:new u.bE(g,e.u_accent)}),hillshadePrepare:(g,e)=>({u_matrix:new u.bF(g,e.u_matrix),u_image:new u.bD(g,e.u_image),u_dimension:new u.bI(g,e.u_dimension),u_zoom:new u.b6(g,e.u_zoom),u_unpack:new u.bG(g,e.u_unpack)}),line:(g,e)=>({u_translation:new u.bI(g,e.u_translation),u_ratio:new u.b6(g,e.u_ratio),u_device_pixel_ratio:new u.b6(g,e.u_device_pixel_ratio),u_units_to_pixels:new u.bI(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_translation:new u.bI(g,e.u_translation),u_ratio:new u.b6(g,e.u_ratio),u_device_pixel_ratio:new u.b6(g,e.u_device_pixel_ratio),u_units_to_pixels:new u.bI(g,e.u_units_to_pixels),u_image:new u.bD(g,e.u_image),u_image_height:new u.b6(g,e.u_image_height)}),linePattern:(g,e)=>({u_translation:new u.bI(g,e.u_translation),u_texsize:new u.bI(g,e.u_texsize),u_ratio:new u.b6(g,e.u_ratio),u_device_pixel_ratio:new u.b6(g,e.u_device_pixel_ratio),u_image:new u.bD(g,e.u_image),u_units_to_pixels:new u.bI(g,e.u_units_to_pixels),u_scale:new u.bH(g,e.u_scale),u_fade:new u.b6(g,e.u_fade)}),lineSDF:(g,e)=>({u_translation:new u.bI(g,e.u_translation),u_ratio:new u.b6(g,e.u_ratio),u_device_pixel_ratio:new u.b6(g,e.u_device_pixel_ratio),u_units_to_pixels:new u.bI(g,e.u_units_to_pixels),u_patternscale_a:new u.bI(g,e.u_patternscale_a),u_patternscale_b:new u.bI(g,e.u_patternscale_b),u_sdfgamma:new u.b6(g,e.u_sdfgamma),u_image:new u.bD(g,e.u_image),u_tex_y_a:new u.b6(g,e.u_tex_y_a),u_tex_y_b:new u.b6(g,e.u_tex_y_b),u_mix:new u.b6(g,e.u_mix)}),raster:(g,e)=>({u_tl_parent:new u.bI(g,e.u_tl_parent),u_scale_parent:new u.b6(g,e.u_scale_parent),u_buffer_scale:new u.b6(g,e.u_buffer_scale),u_fade_t:new u.b6(g,e.u_fade_t),u_opacity:new u.b6(g,e.u_opacity),u_image0:new u.bD(g,e.u_image0),u_image1:new u.bD(g,e.u_image1),u_brightness_low:new u.b6(g,e.u_brightness_low),u_brightness_high:new u.b6(g,e.u_brightness_high),u_saturation_factor:new u.b6(g,e.u_saturation_factor),u_contrast_factor:new u.b6(g,e.u_contrast_factor),u_spin_weights:new u.bH(g,e.u_spin_weights),u_coords_top:new u.bG(g,e.u_coords_top),u_coords_bottom:new u.bG(g,e.u_coords_bottom)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new u.bD(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bD(g,e.u_is_size_feature_constant),u_size_t:new u.b6(g,e.u_size_t),u_size:new u.b6(g,e.u_size),u_camera_to_center_distance:new u.b6(g,e.u_camera_to_center_distance),u_pitch:new u.b6(g,e.u_pitch),u_rotate_symbol:new u.bD(g,e.u_rotate_symbol),u_aspect_ratio:new u.b6(g,e.u_aspect_ratio),u_fade_change:new u.b6(g,e.u_fade_change),u_label_plane_matrix:new u.bF(g,e.u_label_plane_matrix),u_coord_matrix:new u.bF(g,e.u_coord_matrix),u_is_text:new u.bD(g,e.u_is_text),u_pitch_with_map:new u.bD(g,e.u_pitch_with_map),u_is_along_line:new u.bD(g,e.u_is_along_line),u_is_variable_anchor:new u.bD(g,e.u_is_variable_anchor),u_texsize:new u.bI(g,e.u_texsize),u_texture:new u.bD(g,e.u_texture),u_translation:new u.bI(g,e.u_translation),u_pitched_scale:new u.b6(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new u.bD(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bD(g,e.u_is_size_feature_constant),u_size_t:new u.b6(g,e.u_size_t),u_size:new u.b6(g,e.u_size),u_camera_to_center_distance:new u.b6(g,e.u_camera_to_center_distance),u_pitch:new u.b6(g,e.u_pitch),u_rotate_symbol:new u.bD(g,e.u_rotate_symbol),u_aspect_ratio:new u.b6(g,e.u_aspect_ratio),u_fade_change:new u.b6(g,e.u_fade_change),u_label_plane_matrix:new u.bF(g,e.u_label_plane_matrix),u_coord_matrix:new u.bF(g,e.u_coord_matrix),u_is_text:new u.bD(g,e.u_is_text),u_pitch_with_map:new u.bD(g,e.u_pitch_with_map),u_is_along_line:new u.bD(g,e.u_is_along_line),u_is_variable_anchor:new u.bD(g,e.u_is_variable_anchor),u_texsize:new u.bI(g,e.u_texsize),u_texture:new u.bD(g,e.u_texture),u_gamma_scale:new u.b6(g,e.u_gamma_scale),u_device_pixel_ratio:new u.b6(g,e.u_device_pixel_ratio),u_is_halo:new u.bD(g,e.u_is_halo),u_translation:new u.bI(g,e.u_translation),u_pitched_scale:new u.b6(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new u.bD(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bD(g,e.u_is_size_feature_constant),u_size_t:new u.b6(g,e.u_size_t),u_size:new u.b6(g,e.u_size),u_camera_to_center_distance:new u.b6(g,e.u_camera_to_center_distance),u_pitch:new u.b6(g,e.u_pitch),u_rotate_symbol:new u.bD(g,e.u_rotate_symbol),u_aspect_ratio:new u.b6(g,e.u_aspect_ratio),u_fade_change:new u.b6(g,e.u_fade_change),u_label_plane_matrix:new u.bF(g,e.u_label_plane_matrix),u_coord_matrix:new u.bF(g,e.u_coord_matrix),u_is_text:new u.bD(g,e.u_is_text),u_pitch_with_map:new u.bD(g,e.u_pitch_with_map),u_is_along_line:new u.bD(g,e.u_is_along_line),u_is_variable_anchor:new u.bD(g,e.u_is_variable_anchor),u_texsize:new u.bI(g,e.u_texsize),u_texsize_icon:new u.bI(g,e.u_texsize_icon),u_texture:new u.bD(g,e.u_texture),u_texture_icon:new u.bD(g,e.u_texture_icon),u_gamma_scale:new u.b6(g,e.u_gamma_scale),u_device_pixel_ratio:new u.b6(g,e.u_device_pixel_ratio),u_is_halo:new u.bD(g,e.u_is_halo),u_translation:new u.bI(g,e.u_translation),u_pitched_scale:new u.b6(g,e.u_pitched_scale)}),background:(g,e)=>({u_opacity:new u.b6(g,e.u_opacity),u_color:new u.bE(g,e.u_color)}),backgroundPattern:(g,e)=>({u_opacity:new u.b6(g,e.u_opacity),u_image:new u.bD(g,e.u_image),u_pattern_tl_a:new u.bI(g,e.u_pattern_tl_a),u_pattern_br_a:new u.bI(g,e.u_pattern_br_a),u_pattern_tl_b:new u.bI(g,e.u_pattern_tl_b),u_pattern_br_b:new u.bI(g,e.u_pattern_br_b),u_texsize:new u.bI(g,e.u_texsize),u_mix:new u.b6(g,e.u_mix),u_pattern_size_a:new u.bI(g,e.u_pattern_size_a),u_pattern_size_b:new u.bI(g,e.u_pattern_size_b),u_scale_a:new u.b6(g,e.u_scale_a),u_scale_b:new u.b6(g,e.u_scale_b),u_pixel_coord_upper:new u.bI(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bI(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new u.b6(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_texture:new u.bD(g,e.u_texture),u_ele_delta:new u.b6(g,e.u_ele_delta),u_fog_matrix:new u.bF(g,e.u_fog_matrix),u_fog_color:new u.bE(g,e.u_fog_color),u_fog_ground_blend:new u.b6(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.b6(g,e.u_fog_ground_blend_opacity),u_horizon_color:new u.bE(g,e.u_horizon_color),u_horizon_fog_blend:new u.b6(g,e.u_horizon_fog_blend),u_is_globe_mode:new u.b6(g,e.u_is_globe_mode)}),terrainDepth:(g,e)=>({u_ele_delta:new u.b6(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_texture:new u.bD(g,e.u_texture),u_terrain_coords_id:new u.b6(g,e.u_terrain_coords_id),u_ele_delta:new u.b6(g,e.u_ele_delta)}),projectionErrorMeasurement:(g,e)=>({u_input:new u.b6(g,e.u_input),u_output_expected:new u.b6(g,e.u_output_expected)}),atmosphere:(g,e)=>({u_sun_pos:new u.bH(g,e.u_sun_pos),u_atmosphere_blend:new u.b6(g,e.u_atmosphere_blend),u_globe_position:new u.bH(g,e.u_globe_position),u_globe_radius:new u.b6(g,e.u_globe_radius),u_inv_proj_matrix:new u.bF(g,e.u_inv_proj_matrix)}),sky:(g,e)=>({u_sky_color:new u.bE(g,e.u_sky_color),u_horizon_color:new u.bE(g,e.u_horizon_color),u_horizon:new u.bI(g,e.u_horizon),u_horizon_normal:new u.bI(g,e.u_horizon_normal),u_sky_horizon_blend:new u.b6(g,e.u_sky_horizon_blend),u_sky_blend:new u.b6(g,e.u_sky_blend)})};class oc{constructor(e,r,c){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Si={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sl{constructor(e,r,c,d){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=d,this.context=e;const _=e.gl;this.buffer=_.createBuffer(),e.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let c=0;c<this.attributes.length;c++){const d=r.attributes[this.attributes[c].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,r,c){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],w=r.attributes[_.name];w!==void 0&&e.vertexAttribPointer(w,_.components,e[Si[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pf extends Fn{getDefault(){return u.b5.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ff extends Fn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class al extends Fn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class so extends Fn{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Dd extends Fn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Fd extends Fn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class sc extends Fn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ac extends Fn{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class lc extends Fn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Mh extends Fn{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ao extends Fn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class Oe extends Fn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class st extends Fn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class tt extends Fn{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ut extends Fn{getDefault(){return u.b5.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class sn extends Fn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Pn extends Fn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class vr extends Fn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class qn extends Fn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class va extends Fn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class uc extends Fn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class $i extends Fn{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ps extends Fn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ll extends Fn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class xa extends Fn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ul extends Fn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Tn extends Fn{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bn extends Fn{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const c=this.gl;In(c)?c.bindVertexArray(e):(r=c.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class mf extends Fn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ih extends Fn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Vs extends Fn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class kh extends Fn{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class gf extends kh{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Bd extends kh{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class cc extends kh{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const So="Framebuffer is not complete";class wa{constructor(e,r,c,d,_){this.context=e,this.width=r,this.height=c;const w=e.gl,P=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new gf(e,P),d)this.depthAttachment=_?new cc(e,P):new Bd(e,P);else if(_)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(So)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class Kl{constructor(e){var r,c;if(this.gl=e,this.clearColor=new pf(this),this.clearDepth=new ff(this),this.clearStencil=new al(this),this.colorMask=new so(this),this.depthMask=new Dd(this),this.stencilMask=new Fd(this),this.stencilFunc=new sc(this),this.stencilOp=new ac(this),this.stencilTest=new lc(this),this.depthRange=new Mh(this),this.depthTest=new ao(this),this.depthFunc=new Oe(this),this.blend=new st(this),this.blendFunc=new tt(this),this.blendColor=new Ut(this),this.blendEquation=new sn(this),this.cullFace=new Pn(this),this.cullFaceSide=new vr(this),this.frontFace=new qn(this),this.program=new va(this),this.activeTexture=new uc(this),this.viewport=new $i(this),this.bindFramebuffer=new ps(this),this.bindRenderbuffer=new ll(this),this.bindTexture=new xa(this),this.bindVertexBuffer=new ul(this),this.bindElementBuffer=new Tn(this),this.bindVertexArray=new Bn(this),this.pixelStoreUnpack=new mf(this),this.pixelStoreUnpackPremultiplyAlpha=new Ih(this),this.pixelStoreUnpackFlipY=new Vs(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),In(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:d==null?void 0:d.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new oc(this,e,r)}createVertexBuffer(e,r,c){return new sl(this,e,r,c)}createRenderbuffer(e,r,c){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,e,r,c),this.bindRenderbuffer.set(null),_}createFramebuffer(e,r,c,d){return new wa(this,e,r,c,d)}clear({color:e,depth:r,stencil:c}){const d=this.gl;let _=0;e&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),d.clear(_)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){u.bA(e.blendFunction,Jn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return In(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return In(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let fs;function Jl(g,e,r,c,d){const _=g.context,w=g.transform,P=_.gl,M=g.useProgram("collisionBox"),k=[];let L=0,D=0;for(let se=0;se<c.length;se++){const ce=c[se],ve=e.getTile(ce).getBucket(r);if(!ve)continue;const xe=d?ve.textCollisionBox:ve.iconCollisionBox,Se=ve.collisionCircleArray;Se.length>0&&(k.push({circleArray:Se,circleOffset:D,coord:ce}),L+=Se.length/4,D=L),xe&&M.draw(_,P.LINES,cn.disabled,Mn.disabled,g.colorModeForRenderPass(),Cn.disabled,Sh(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(ce),w.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,g.transform.zoom,null,null,xe.collisionVertexBuffer)}if(!d||!k.length)return;const F=g.useProgram("collisionCircle"),G=new u.bN;G.resize(4*L),G._trim();let H=0;for(const se of k)for(let ce=0;ce<se.circleArray.length/4;ce++){const ve=4*ce,xe=se.circleArray[ve+0],Se=se.circleArray[ve+1],Ce=se.circleArray[ve+2],Ee=se.circleArray[ve+3];G.emplace(H++,xe,Se,Ce,Ee,0),G.emplace(H++,xe,Se,Ce,Ee,1),G.emplace(H++,xe,Se,Ce,Ee,2),G.emplace(H++,xe,Se,Ce,Ee,3)}(!fs||fs.length<2*L)&&(fs=function(se){const ce=2*se,ve=new u.bP;ve.resize(ce),ve._trim();for(let xe=0;xe<ce;xe++){const Se=6*xe;ve.uint16[Se+0]=4*xe+0,ve.uint16[Se+1]=4*xe+1,ve.uint16[Se+2]=4*xe+2,ve.uint16[Se+3]=4*xe+2,ve.uint16[Se+4]=4*xe+3,ve.uint16[Se+5]=4*xe+0}return ve}(L));const ie=_.createIndexBuffer(fs,!0),re=_.createVertexBuffer(G,u.bO.members,!0);for(const se of k){const ce=Xu(g.transform);F.draw(_,P.TRIANGLES,cn.disabled,Mn.disabled,g.colorModeForRenderPass(),Cn.disabled,ce,g.style.map.terrain&&g.style.map.terrain.getTerrainData(se.coord),null,r.id,re,ie,u.aE.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,g.transform.zoom,null,null,null)}re.destroy(),ie.destroy()}const Ah=u.ar(new Float32Array(16));function ba(g,e,r,c,d,_){const{horizontalAlign:w,verticalAlign:P}=u.az(g);return new u.P((-(w-.5)*e/d+c[0])*_,(-(P-.5)*r/d+c[1])*_)}function Ql(g,e,r,c,d,_){const w=e.tileAnchorPoint.add(new u.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let P=c.mult(_);r||(P=P.rotate(-d));const M=w.add(P);return et(M.x,M.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const P=Ot(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),M=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return g.add(c.rotate(M))}return g.add(c)}function Sa(g,e,r,c,d,_,w,P,M,k,L,D){const F=g.text.placedSymbolArray,G=g.text.dynamicLayoutVertexArray,H=g.icon.dynamicLayoutVertexArray,ie={};G.clear();for(let re=0;re<F.length;re++){const se=F.get(re),ce=se.hidden||!se.crossTileID||g.allowVerticalPlacement&&!se.placedOrientation?null:c[se.crossTileID];if(ce){const ve=new u.P(se.anchorX,se.anchorY),xe={getElevation:D,width:d.width,height:d.height,pitchedLabelPlaneMatrix:_,pitchWithMap:r,transform:d,tileAnchorPoint:ve,translation:k,unwrappedTileID:L},Se=r?En(ve.x,ve.y,xe):Ot(ve.x,ve.y,xe),Ce=Ue(d.cameraToCenterDistance,Se.signedDistanceFromCamera);let Ee=u.ag(g.textSizeData,P,se)*Ce/u.at;r&&(Ee*=g.tilePixelRatio/w);const{width:$e,height:qe,anchor:nt,textOffset:at,textBoxScale:Qe}=ce,lt=ba(nt,$e,qe,at,Qe,Ee),Tt=d.getPitchedTextCorrection(ve.x+k[0],ve.y+k[1],L),ft=Ql(Se.point,xe,e,lt,-d.bearingInRadians,Tt),Et=g.allowVerticalPlacement&&se.placedOrientation===u.af.vertical?Math.PI/2:0;for(let an=0;an<se.numGlyphs;an++)u.am(G,ft,Et);M&&se.associatedIconIndex>=0&&(ie[se.associatedIconIndex]={shiftedAnchor:ft,angle:Et})}else Nr(se.numGlyphs,G)}if(M){H.clear();const re=g.icon.placedSymbolArray;for(let se=0;se<re.length;se++){const ce=re.get(se);if(ce.hidden)Nr(ce.numGlyphs,H);else{const ve=ie[se];if(ve)for(let xe=0;xe<ce.numGlyphs;xe++)u.am(H,ve.shiftedAnchor,ve.angle);else Nr(ce.numGlyphs,H)}}g.icon.dynamicLayoutVertexBuffer.updateData(H)}g.text.dynamicLayoutVertexBuffer.updateData(G)}function Ta(g,e,r){return r.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Ca(g,e,r,c,d,_,w,P,M,k,L,D,F){const G=g.context,H=G.gl,ie=g.transform,re=P==="map",se=M==="map",ce=P!=="viewport"&&r.layout.get("symbol-placement")!=="point",ve=re&&!se&&!ce,xe=!r.layout.get("symbol-sort-key").isConstant();let Se=!1;const Ce=g.getDepthModeForSublayer(0,cn.ReadOnly),Ee=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$e=[],qe=ie.getCircleRadiusCorrection();for(const nt of c){const at=e.getTile(nt),Qe=at.getBucket(r);if(!Qe)continue;const lt=d?Qe.text:Qe.icon;if(!lt||!lt.segments.get().length||!lt.hasVisibleVertices)continue;const Tt=lt.programConfigurations.get(r.id),ft=d||Qe.sdfIcons,Et=d?Qe.textSizeData:Qe.iconSizeData,an=se||ie.pitch!==0,kn=g.useProgram(Ta(ft,d,Qe),Tt),ar=u.ae(Et,ie.zoom),xn=g.style.map.terrain&&g.style.map.terrain.getTerrainData(nt);let lr,On,Nn,Wn,Qr=[0,0],jn=null;if(d)On=at.glyphAtlasTexture,Nn=H.LINEAR,lr=at.glyphAtlasTexture.size,Qe.iconsInText&&(Qr=at.imageAtlasTexture.size,jn=at.imageAtlasTexture,Wn=an||g.options.rotating||g.options.zooming||Et.kind==="composite"||Et.kind==="camera"?H.LINEAR:H.NEAREST);else{const Hn=r.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;On=at.imageAtlasTexture,Nn=ft||g.options.rotating||g.options.zooming||Hn||an?H.LINEAR:H.NEAREST,lr=at.imageAtlasTexture.size}const Qn=u.au(at,1,g.transform.zoom),oi=He(re,g.transform,Qn),Jo=u.J();u.ah(Jo,oi);const Zi=Re(se,re,g.transform,Qn),Ci=u.av(ie,at,_,w),Io=ie.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),xl=Ee&&Qe.hasTextData(),Ba=r.layout.get("icon-text-fit")!=="none"&&xl&&Qe.hasIconData();if(ce){const Hn=g.style.map.terrain?(qi,fr)=>g.style.map.terrain.getElevation(nt,qi,fr):null,er=r.layout.get("text-rotation-alignment")==="map";Pt(Qe,g,d,oi,Jo,se,k,er,nt.toUnwrapped(),ie.width,ie.height,Ci,Hn)}const Hs=d&&Ee||Ba,Pr=ce||Hs?Ah:se?oi:g.transform.clipSpaceToPixelsMatrix,ho=ft&&r.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ur;Ur=ft?Qe.iconsInText?ds(Et.kind,ar,ve,se,ce,Hs,g,Pr,Zi,Ci,lr,Qr,qe):Xl(Et.kind,ar,ve,se,ce,Hs,g,Pr,Zi,Ci,d,lr,0,qe):Ph(Et.kind,ar,ve,se,ce,Hs,g,Pr,Zi,Ci,d,lr,qe);const Pi={program:kn,buffers:lt,uniformValues:Ur,projectionData:Io,atlasTexture:On,atlasTextureIcon:jn,atlasInterpolation:Nn,atlasInterpolationIcon:Wn,isSDF:ft,hasHalo:ho};if(xe&&Qe.canOverlap){Se=!0;const Hn=lt.segments.get();for(const er of Hn)$e.push({segments:new u.aE([er]),sortKey:er.sortKey,state:Pi,terrainData:xn})}else $e.push({segments:lt.segments,sortKey:0,state:Pi,terrainData:xn})}Se&&$e.sort((nt,at)=>nt.sortKey-at.sortKey);for(const nt of $e){const at=nt.state;if(G.activeTexture.set(H.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,H.CLAMP_TO_EDGE),at.atlasTextureIcon&&(G.activeTexture.set(H.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),at.isSDF){const Qe=at.uniformValues;at.hasHalo&&(Qe.u_is_halo=1,Od(at.buffers,nt.segments,r,g,at.program,Ce,L,D,Qe,at.projectionData,nt.terrainData)),Qe.u_is_halo=0}Od(at.buffers,nt.segments,r,g,at.program,Ce,L,D,at.uniformValues,at.projectionData,nt.terrainData)}}function Od(g,e,r,c,d,_,w,P,M,k,L){const D=c.context;d.draw(D,D.gl.TRIANGLES,_,w,P,Cn.backCCW,M,L,k,r.id,g.layoutVertexBuffer,g.indexBuffer,e,r.paint,c.transform.zoom,g.programConfigurations.get(r.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Nd(g,e,r,c,d){const _=g.context,w=_.gl,P=Mn.disabled,M=new Jn([w.ONE,w.ONE],u.b5.transparent,[!0,!0,!0,!0]),k=e.getBucket(r);if(!k)return;const L=c.key;let D=r.heatmapFbos.get(L);D||(D=Pa(_,e.tileSize,e.tileSize),r.heatmapFbos.set(L,D)),_.bindFramebuffer.set(D.framebuffer),_.viewport.set([0,0,e.tileSize,e.tileSize]),_.clear({color:u.b5.transparent});const F=k.programConfigurations.get(r.id),G=g.useProgram("heatmap",F,!d),H=g.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ie=g.style.map.terrain.getTerrainData(c);G.draw(_,w.TRIANGLES,cn.disabled,P,M,Cn.disabled,Ku(e,g.transform.zoom,r.paint.get("heatmap-intensity"),1),ie,H,r.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,r.paint,g.transform.zoom,F)}function hc(g,e,r,c,d){const _=g.context,w=_.gl,P=g.transform;_.setColorMode(g.colorModeForRenderPass());const M=cl(_,e),k=r.key,L=e.heatmapFbos.get(k);if(!L)return;_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,L.colorAttachment.get()),_.activeTexture.set(w.TEXTURE1),M.bind(w.LINEAR,w.CLAMP_TO_EDGE);const D=P.getProjectionData({overscaledTileID:r,applyTerrainMatrix:d,applyGlobeMatrix:!c});g.useProgram("heatmapTexture").draw(_,w.TRIANGLES,cn.disabled,Mn.disabled,g.colorModeForRenderPass(),Cn.disabled,js(g,e,0,1),null,D,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,P.zoom),L.destroy(),e.heatmapFbos.delete(k)}function Pa(g,e,r){var c,d;const _=g.gl,w=_.createTexture();_.bindTexture(_.TEXTURE_2D,w),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const P=(c=g.HALF_FLOAT)!==null&&c!==void 0?c:_.UNSIGNED_BYTE,M=(d=g.RGBA16F)!==null&&d!==void 0?d:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,M,e,r,0,_.RGBA,P,null);const k=g.createFramebuffer(e,r,!1,!1);return k.colorAttachment.set(w),k}function cl(g,e){return e.colorRampTexture||(e.colorRampTexture=new $(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function eu(g,e,r,c,d){if(!r||!c||!c.imageAtlas)return;const _=c.imageAtlas.patternPositions;let w=_[r.to.toString()],P=_[r.from.toString()];if(!w&&P&&(w=P),!P&&w&&(P=w),!w||!P){const M=d.getPaintProperty(e);w=_[M],P=_[M]}w&&P&&g.setConstantPatternPositions(w,P)}function tu(g,e,r,c,d,_,w,P){const M=g.context.gl,k="fill-pattern",L=r.paint.get(k),D=L&&L.constantOr(1),F=r.getCrossfadeParameters();let G,H,ie,re,se;const ce=g.transform,ve=r.paint.get("fill-translate"),xe=r.paint.get("fill-translate-anchor");w?(H=D&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=M.LINES):(H=D?"fillPattern":"fill",G=M.TRIANGLES);const Se=L.constantOr(null);for(const Ce of c){const Ee=e.getTile(Ce);if(D&&!Ee.patternsLoaded())continue;const $e=Ee.getBucket(r);if(!$e)continue;const qe=$e.programConfigurations.get(r.id),nt=g.useProgram(H,qe),at=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ce);D&&(g.context.activeTexture.set(M.TEXTURE0),Ee.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),qe.updatePaintBuffers(F)),eu(qe,k,Se,Ee,r);const Qe=ce.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),lt=u.av(ce,Ee,ve,xe);if(w){re=$e.indexBuffer2,se=$e.segments2;const ft=[M.drawingBufferWidth,M.drawingBufferHeight];ie=H==="fillOutlinePattern"&&D?Rd(g,F,Ee,ft,lt):ol(ft,lt)}else re=$e.indexBuffer,se=$e.segments,ie=D?il(g,F,Ee,lt):{u_fill_translate:lt};let Tt;if(g.renderPass==="translucent"&&P){const[ft]=g.getStencilConfigForOverlapAndUpdateStencilID(c);Tt=ft[Ce.overscaledZ]}else Tt=g.stencilModeForClipping(Ce);nt.draw(g.context,G,d,Tt,_,Cn.backCCW,ie,at,Qe,r.id,$e.layoutVertexBuffer,re,se,r.paint,g.transform.zoom,qe)}}function hl(g,e,r,c,d,_,w,P){const M=g.context,k=M.gl,L="fill-extrusion-pattern",D=r.paint.get(L),F=D.constantOr(1),G=r.getCrossfadeParameters(),H=r.paint.get("fill-extrusion-opacity"),ie=D.constantOr(null),re=g.transform;for(const se of c){const ce=e.getTile(se),ve=ce.getBucket(r);if(!ve)continue;const xe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(se),Se=ve.programConfigurations.get(r.id),Ce=g.useProgram(F?"fillExtrusionPattern":"fillExtrusion",Se);F&&(g.context.activeTexture.set(k.TEXTURE0),ce.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Se.updatePaintBuffers(G));const Ee=re.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!P,applyTerrainMatrix:!0});eu(Se,L,ie,ce,r);const $e=u.av(re,ce,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),qe=r.paint.get("fill-extrusion-vertical-gradient"),nt=F?zd(g,qe,H,$e,se,G,ce):ya(g,qe,H,$e);Ce.draw(M,M.gl.TRIANGLES,d,_,w,Cn.backCCW,nt,xe,Ee,r.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,r.paint,g.transform.zoom,Se,g.style.map.terrain&&ve.centroidVertexBuffer)}}function zh(g,e,r,c,d,_,w,P,M){var k;const L=g.style.projection,D=g.context,F=g.transform,G=D.gl,H=g.useProgram("hillshade"),ie=!g.options.moving;for(const re of c){const se=e.getTile(re),ce=se.fbo;if(!ce)continue;const ve=L.getMeshFromTileID(D,re.canonical,P,!0,"raster"),xe=(k=g.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(re);D.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ce.colorAttachment.get());const Se=F.getProjectionData({overscaledTileID:re,aligned:ie,applyGlobeMatrix:!M,applyTerrainMatrix:!0});H.draw(D,G.TRIANGLES,_,d[re.overscaledZ],w,Cn.backCCW,Ju(g,se,r),xe,Se,r.id,ve.vertexBuffer,ve.indexBuffer,ve.segments)}}const dc=[new u.P(0,0),new u.P(u.Y,0),new u.P(u.Y,u.Y),new u.P(0,u.Y)];function pn(g,e,r,c,d,_,w,P,M=!1,k=!1){const L=c[c.length-1].overscaledZ,D=g.context,F=D.gl,G=g.useProgram("raster"),H=g.transform,ie=g.style.projection,re=g.colorModeForRenderPass(),se=!g.options.moving;for(const ce of c){const ve=g.getDepthModeForSublayer(ce.overscaledZ-L,r.paint.get("raster-opacity")===1?cn.ReadWrite:cn.ReadOnly,F.LESS),xe=e.getTile(ce);xe.registerFadeDuration(r.paint.get("raster-fade-duration"));const Se=e.findLoadedParent(ce,0),Ce=e.findLoadedSibling(ce),Ee=xr(xe,Se||Ce||null,e,r,g.transform,g.style.map.terrain);let $e,qe;const nt=r.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;D.activeTexture.set(F.TEXTURE0),xe.texture.bind(nt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(F.TEXTURE1),Se?(Se.texture.bind(nt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),$e=Math.pow(2,Se.tileID.overscaledZ-xe.tileID.overscaledZ),qe=[xe.tileID.canonical.x*$e%1,xe.tileID.canonical.y*$e%1]):xe.texture.bind(nt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),xe.texture.useMipmap&&D.extTextureFilterAnisotropic&&g.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const at=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ce),Qe=H.getProjectionData({overscaledTileID:ce,aligned:se,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),lt=Ld(qe||[0,0],$e||1,Ee,r,P),Tt=ie.getMeshFromTileID(D,ce.canonical,_,w,"raster");G.draw(D,F.TRIANGLES,ve,d?d[ce.overscaledZ]:Mn.disabled,re,M?Cn.frontCCW:Cn.backCCW,lt,at,Qe,r.id,Tt.vertexBuffer,Tt.indexBuffer,Tt.segments)}}function xr(g,e,r,c,d,_){const w=c.paint.get("raster-fade-duration");if(!_&&w>0){const P=fe.now(),M=(P-g.timeAdded)/w,k=e?(P-e.timeAdded)/w:-1,L=r.getSource(),D=No(d,{tileSize:L.tileSize,roundZoom:L.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-D)>Math.abs(g.tileID.overscaledZ-D),G=F&&g.refreshedUponExpiration?1:u.ac(F?M:1-k,0,1);return g.refreshedUponExpiration&&M>=1&&(g.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const lo=new u.b5(1,0,0,1),Rh=new u.b5(0,1,0,1),pc=new u.b5(0,0,1,1),jd=new u.b5(1,0,1,1),Gs=new u.b5(0,1,1,1);function qo(g,e,r,c){Wo(g,0,e+r/2,g.transform.width,r,c)}function dl(g,e,r,c){Wo(g,e-r/2,0,r,g.transform.height,c)}function Wo(g,e,r,c,d,_){const w=g.context,P=w.gl;P.enable(P.SCISSOR_TEST),P.scissor(e*g.pixelRatio,r*g.pixelRatio,c*g.pixelRatio,d*g.pixelRatio),w.clear({color:_}),P.disable(P.SCISSOR_TEST)}function pl(g,e,r){const c=g.context,d=c.gl,_=g.useProgram("debug"),w=cn.disabled,P=Mn.disabled,M=g.colorModeForRenderPass(),k="$debug",L=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);c.activeTexture.set(d.TEXTURE0);const D=e.getTileByID(r.key).latestRawTileData,F=Math.floor((D&&D.byteLength||0)/1024),G=e.getTile(r).tileSize,H=512/Math.min(G,512)*(r.overscaledZ/g.transform.zoom)*.5;let ie=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(ie+=` => ${r.overscaledZ}`),function(se,ce){se.initDebugOverlayCanvas();const ve=se.debugOverlayCanvas,xe=se.context.gl,Se=se.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,ve.width,ve.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(ce,5,5),Se.strokeText(ce,5,5),se.debugOverlayTexture.update(ve),se.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(g,`${ie} ${F}kB`);const re=g.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(c,d.TRIANGLES,w,P,Jn.alphaBlended,Cn.disabled,Wl(u.b5.transparent,H),null,re,k,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),_.draw(c,d.LINE_STRIP,w,P,M,Cn.disabled,Wl(u.b5.red),L,re,k,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Ea(g,e,r,c){const{isRenderingGlobe:d}=c,_=g.context,w=_.gl,P=g.transform,M=g.colorModeForRenderPass(),k=g.getDepthModeFor3D(),L=g.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,g.width,g.height]);for(const D of r){const F=e.getTerrainMesh(D.tileID),G=g.renderToTexture.getTexture(D),H=e.getTerrainData(D.tileID);_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,G.texture);const ie=e.getMeshFrameDelta(P.zoom),re=P.calculateFogMatrix(D.tileID.toUnwrapped()),se=_a(ie,re,g.style.sky,P.pitch,d),ce=P.getProjectionData({overscaledTileID:D.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});L.draw(_,w.TRIANGLES,k,Mn.disabled,M,Cn.backCCW,se,H,ce,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}function fl(g,e){if(!e.mesh){const r=new u.aD;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const c=new u.aF;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),e.mesh=new bo(g.createVertexBuffer(r,dn.members),g.createIndexBuffer(c),u.aE.simpleSegment(0,0,r.length,c.length))}return e.mesh}class Ma{constructor(e,r){this.context=new Kl(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=W.maxUnderzooming+W.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Uo}resize(e,r,c){if(this.width=Math.floor(e*c),this.height=Math.floor(r*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,r=new u.aD;r.emplaceBack(0,0),r.emplaceBack(u.Y,0),r.emplaceBack(0,u.Y),r.emplaceBack(u.Y,u.Y),this.tileExtentBuffer=e.createVertexBuffer(r,dn.members),this.tileExtentSegments=u.aE.simpleSegment(0,0,4,2);const c=new u.aD;c.emplaceBack(0,0),c.emplaceBack(u.Y,0),c.emplaceBack(0,u.Y),c.emplaceBack(u.Y,u.Y),this.debugBuffer=e.createVertexBuffer(c,dn.members),this.debugSegments=u.aE.simpleSegment(0,0,4,5);const d=new u.bU;d.emplaceBack(0,0,0,0),d.emplaceBack(u.Y,0,u.Y,0),d.emplaceBack(0,u.Y,0,u.Y),d.emplaceBack(u.Y,u.Y,u.Y,u.Y),this.rasterBoundsBuffer=e.createVertexBuffer(d,pr.members),this.rasterBoundsSegments=u.aE.simpleSegment(0,0,4,2);const _=new u.aD;_.emplaceBack(0,0),_.emplaceBack(u.Y,0),_.emplaceBack(0,u.Y),_.emplaceBack(u.Y,u.Y),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(_,dn.members),this.rasterBoundsSegmentsPosOnly=u.aE.simpleSegment(0,0,4,5);const w=new u.aD;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(w,dn.members),this.viewportSegments=u.aE.simpleSegment(0,0,4,2);const P=new u.bV;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(P);const M=new u.aF;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(M);const k=this.context.gl;this.stencilClearMode=new Mn({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.tileExtentMesh=new bo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=u.J();u.bM(c,0,this.width,this.height,0,0,1),u.L(c,c,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const d={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,cn.disabled,this.stencilClearMode,Jn.disabled,Cn.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const d=this.context;d.setColorMode(Jn.disabled),d.setDepthMode(cn.disabled);const _={};for(const w of r)_[w.key]=this.nextStencilID++;this._renderTileMasks(_,r,c,!0),this._renderTileMasks(_,r,c,!1),this._tileClippingMaskIDs=_}_renderTileMasks(e,r,c,d){const _=this.context,w=_.gl,P=this.style.projection,M=this.transform,k=this.useProgram("clippingMask");for(const L of r){const D=e[L.key],F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(L),G=P.getMeshFromTileID(this.context,L.canonical,d,!0,"stencil"),H=M.getProjectionData({overscaledTileID:L,applyGlobeMatrix:!0,applyTerrainMatrix:!0});k.draw(_,w.TRIANGLES,cn.disabled,new Mn({func:w.ALWAYS,mask:0},D,255,w.KEEP,w.KEEP,w.REPLACE),Jn.disabled,c?Cn.disabled:Cn.backCCW,null,F,H,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,c=this.style.projection,d=this.transform,_=this.useProgram("depth"),w=this.getDepthModeFor3D(),P=te(d,{tileSize:d.tileSize});for(const M of P){const k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),L=c.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),D=d.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(e,r.TRIANGLES,w,Mn.disabled,Jn.disabled,Cn.backCCW,null,k,D,"$clipping",L.vertexBuffer,L.indexBuffer,L.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Mn({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Mn({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,c=e.sort((w,P)=>P.overscaledZ-w.overscaledZ),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const w={};for(let P=0;P<_;P++)w[P+d]=new Mn({func:r.GEQUAL,mask:255},P+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[w,c]}return[{[d]:Mn.disabled},c]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,c=e.sort((w,P)=>P.overscaledZ-w.overscaledZ),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(this.clearStencil(),_>1){const w={},P={};for(let M=0;M<_;M++)w[M+d]=new Mn({func:r.GREATER,mask:255},_+1+M,255,r.KEEP,r.KEEP,r.REPLACE),P[M+d]=new Mn({func:r.GREATER,mask:255},1+M,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*_+1,[w,P,c]}return this.nextStencilID=3,[{[d]:new Mn({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[d]:new Mn({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},c]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Jn([e.CONSTANT_COLOR,e.ONE],new u.b5(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Jn.unblended:Jn.alphaBlended}getDepthModeForSublayer(e,r,c){if(!this.opaquePassEnabledForLayer())return cn.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new cn(c||this.context.gl.LEQUAL,r,[d,d])}getDepthModeFor3D(){return new cn(this.context.gl.LEQUAL,cn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var c,d;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(fe.now()),this.imageManager.beginFrame();const _=this.style._order,w=this.style.sourceCaches,P={},M={},k={},L={isRenderingToTexture:!1,isRenderingGlobe:((c=e.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const F in w){const G=w[F];G.used&&G.prepare(this.context),P[F]=G.getVisibleCoordinates(!1),M[F]=P[F].slice().reverse(),k[F]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<_.length;F++)if(this.style._layers[_[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of _){const G=this.style._layers[F];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const H=M[G.source];(G.type==="custom"||H.length)&&this.renderLayer(this,w[G.source],G,H,L)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:F=>this.useProgram(F)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?u.b5.black:u.b5.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(F,G){const H=F.context,ie=H.gl,re=((Ce,Ee,$e)=>{const qe=Math.cos(Ee.rollInRadians),nt=Math.sin(Ee.rollInRadians),at=sr(Ee),Qe=Ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ce.properties.get("sky-color"),u_horizon_color:Ce.properties.get("horizon-color"),u_horizon:[(Ee.width/2-at*nt)*$e,(Ee.height/2+at*qe)*$e],u_horizon_normal:[-nt,qe],u_sky_horizon_blend:Ce.properties.get("sky-horizon-blend")*Ee.height/2*$e,u_sky_blend:Qe}})(G,F.style.map.transform,F.pixelRatio),se=new cn(ie.LEQUAL,cn.ReadWrite,[0,1]),ce=Mn.disabled,ve=F.colorModeForRenderPass(),xe=F.useProgram("sky"),Se=fl(H,G);xe.draw(H,ie.TRIANGLES,se,ce,ve,Cn.disabled,re,null,void 0,"sky",Se.vertexBuffer,Se.indexBuffer,Se.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[_[this.currentLayer]],G=w[F.source],H=P[F.source];this._renderTileClippingMasks(F,H,!1),this.renderLayer(this,G,F,H,L)}this.renderPass="translucent";let D=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const F=this.style._layers[_[this.currentLayer]],G=w[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F,L))continue;this.opaquePassEnabledForLayer()||D||(D=!0,L.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const H=(F.type==="symbol"?k:M)[F.source];this._renderTileClippingMasks(F,P[F.source],!1),this.renderLayer(this,G,F,H,L)}if(L.isRenderingGlobe&&function(F,G,H){const ie=F.context,re=ie.gl,se=F.useProgram("atmosphere"),ce=new cn(re.LEQUAL,cn.ReadOnly,[0,1]),ve=F.transform,xe=function(Qe,lt){const Tt=Qe.properties.get("position"),ft=[-Tt.x,-Tt.y,-Tt.z],Et=u.ar(new Float64Array(16));return Qe.properties.get("anchor")==="map"&&(u.aY(Et,Et,lt.rollInRadians),u.aZ(Et,Et,-lt.pitchInRadians),u.aY(Et,Et,lt.bearingInRadians),u.aZ(Et,Et,lt.center.lat*Math.PI/180),u.bk(Et,Et,-lt.center.lng*Math.PI/180)),u.bT(ft,ft,Et),ft}(H,F.transform),Se=ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ce=G.properties.get("atmosphere-blend")*Se.projectionTransition;if(Ce===0)return;const Ee=io(ve.worldSize,ve.center.lat),$e=ve.inverseProjectionMatrix,qe=new Float64Array(4);qe[3]=1,u.an(qe,qe,ve.modelViewProjectionMatrix),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1,u.an(qe,qe,$e),qe[0]/=qe[3],qe[1]/=qe[3],qe[2]/=qe[3],qe[3]=1;const nt=((Qe,lt,Tt,ft,Et)=>({u_sun_pos:Qe,u_atmosphere_blend:lt,u_globe_position:Tt,u_globe_radius:ft,u_inv_proj_matrix:Et}))(xe,Ce,[qe[0],qe[1],qe[2]],Ee,$e),at=fl(ie,G);se.draw(ie,re.TRIANGLES,ce,Mn.disabled,Jn.alphaBlended,Cn.disabled,nt,null,null,"atmosphere",at.vertexBuffer,at.indexBuffer,at.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const F=function(G,H){let ie=null;const re=Object.values(G._layers).flatMap(xe=>xe.source&&!xe.isHidden(H)?[G.sourceCaches[xe.source]]:[]),se=re.filter(xe=>xe.getSource().type==="vector"),ce=re.filter(xe=>xe.getSource().type!=="vector"),ve=xe=>{(!ie||ie.getSource().maxzoom<xe.getSource().maxzoom)&&(ie=xe)};return se.forEach(xe=>ve(xe)),ie||ce.forEach(xe=>ve(xe)),ie}(this.style,this.transform.zoom);F&&function(G,H,ie){for(let re=0;re<ie.length;re++)pl(G,H,ie[re])}(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const G=F.transform.padding;qo(F,F.transform.height-(G.top||0),3,lo),qo(F,G.bottom||0,3,Rh),dl(F,G.left||0,3,pc),dl(F,F.transform.width-(G.right||0),3,jd);const H=F.transform.centerPoint;(function(ie,re,se,ce){Wo(ie,re-1,se-10,2,20,ce),Wo(ie,re-10,se-1,20,2,ce)})(F,H.x,F.transform.height-H.y,Gs)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!u.bW(r,c):!u.bX(r,c)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(u.bY(r,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,w){const P=_.context,M=P.gl,k=_.transform,L=Jn.unblended,D=new cn(M.LEQUAL,cn.ReadWrite,[0,1]),F=w.sourceCache.getRenderableTiles(),G=_.useProgram("terrainDepth");P.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),P.clear({color:u.b5.transparent,depth:1});for(const H of F){const ie=w.getTerrainMesh(H.tileID),re=w.getTerrainData(H.tileID),se=k.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ce={u_ele_delta:w.getMeshFrameDelta(k.zoom)};G.draw(P,M.TRIANGLES,D,Mn.disabled,L,Cn.backCCW,ce,re,se,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,w){const P=_.context,M=P.gl,k=_.transform,L=Jn.unblended,D=new cn(M.LEQUAL,cn.ReadWrite,[0,1]),F=w.getCoordsTexture(),G=w.sourceCache.getRenderableTiles(),H=_.useProgram("terrainCoords");P.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),P.clear({color:u.b5.transparent,depth:1}),w.coordsIndex=[];for(const ie of G){const re=w.getTerrainMesh(ie.tileID),se=w.getTerrainData(ie.tileID);P.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,F.texture);const ce={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(k.zoom)},ve=k.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});H.draw(P,M.TRIANGLES,D,Mn.disabled,L,Cn.backCCW,ce,se,ve,"terrain",re.vertexBuffer,re.indexBuffer,re.segments),w.coordsIndex.push(ie.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(e,r,c,d,_){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(d||[]).length)&&(this.id=c.id,u.bZ(c)?function(w,P,M,k,L,D){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:F}=D,G=Mn.disabled,H=w.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ie,re,se,ce,ve,xe,Se,Ce,Ee){const $e=re.transform,qe=re.style.map.terrain,nt=ve==="map",at=xe==="map";for(const Qe of ie){const lt=ce.getTile(Qe),Tt=lt.getBucket(se);if(!Tt||!Tt.text||!Tt.text.segments.get().length)continue;const ft=u.ae(Tt.textSizeData,$e.zoom),Et=u.au(lt,1,re.transform.zoom),an=He(nt,re.transform,Et),kn=se.layout.get("icon-text-fit")!=="none"&&Tt.hasIconData();if(ft){const ar=Math.pow(2,$e.zoom-lt.tileID.overscaledZ),xn=qe?(lr,On)=>qe.getElevation(Qe,lr,On):null;Sa(Tt,nt,at,Ee,$e,an,ar,ft,kn,u.av($e,lt,Se,Ce),Qe.toUnwrapped(),xn)}}}(k,w,M,P,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),L),M.paint.get("icon-opacity").constantOr(1)!==0&&Ca(w,P,M,k,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),G,H,F),M.paint.get("text-opacity").constantOr(1)!==0&&Ca(w,P,M,k,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),G,H,F),P.map.showCollisionBoxes&&(Jl(w,P,M,k,!0),Jl(w,P,M,k,!1))}(e,r,c,d,this.style.placement.variableOffsets,_):u.b_(c)?function(w,P,M,k,L){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:D}=L,F=M.paint.get("circle-opacity"),G=M.paint.get("circle-stroke-width"),H=M.paint.get("circle-stroke-opacity"),ie=!M.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(G.constantOr(1)===0||H.constantOr(1)===0))return;const re=w.context,se=re.gl,ce=w.transform,ve=w.getDepthModeForSublayer(0,cn.ReadOnly),xe=Mn.disabled,Se=w.colorModeForRenderPass(),Ce=[],Ee=ce.getCircleRadiusCorrection();for(let $e=0;$e<k.length;$e++){const qe=k[$e],nt=P.getTile(qe),at=nt.getBucket(M);if(!at)continue;const Qe=M.paint.get("circle-translate"),lt=M.paint.get("circle-translate-anchor"),Tt=u.av(ce,nt,Qe,lt),ft=at.programConfigurations.get(M.id),Et=w.useProgram("circle",ft),an=at.layoutVertexBuffer,kn=at.indexBuffer,ar=w.style.map.terrain&&w.style.map.terrain.getTerrainData(qe),xn={programConfiguration:ft,program:Et,layoutVertexBuffer:an,indexBuffer:kn,uniformValues:Yu(w,nt,M,Tt,Ee),terrainData:ar,projectionData:ce.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!D,applyTerrainMatrix:!0})};if(ie){const lr=at.segments.get();for(const On of lr)Ce.push({segments:new u.aE([On]),sortKey:On.sortKey,state:xn})}else Ce.push({segments:at.segments,sortKey:0,state:xn})}ie&&Ce.sort(($e,qe)=>$e.sortKey-qe.sortKey);for(const $e of Ce){const{programConfiguration:qe,program:nt,layoutVertexBuffer:at,indexBuffer:Qe,uniformValues:lt,terrainData:Tt,projectionData:ft}=$e.state;nt.draw(re,se.TRIANGLES,ve,xe,Se,Cn.backCCW,lt,Tt,ft,M.id,at,Qe,$e.segments,M.paint,w.transform.zoom,qe)}}(e,r,c,d,_):u.b$(c)?function(w,P,M,k,L){if(M.paint.get("heatmap-opacity")===0)return;const D=w.context,{isRenderingToTexture:F,isRenderingGlobe:G}=L;if(w.style.map.terrain){for(const H of k){const ie=P.getTile(H);P.hasRenderableParent(H)||(w.renderPass==="offscreen"?Nd(w,ie,M,H,G):w.renderPass==="translucent"&&hc(w,M,H,F,G))}D.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(H,ie,re,se){const ce=H.context,ve=ce.gl,xe=H.transform,Se=Mn.disabled,Ce=new Jn([ve.ONE,ve.ONE],u.b5.transparent,[!0,!0,!0,!0]);(function(Ee,$e,qe){const nt=Ee.gl;Ee.activeTexture.set(nt.TEXTURE1),Ee.viewport.set([0,0,$e.width/4,$e.height/4]);let at=qe.heatmapFbos.get(u.bQ);at?(nt.bindTexture(nt.TEXTURE_2D,at.colorAttachment.get()),Ee.bindFramebuffer.set(at.framebuffer)):(at=Pa(Ee,$e.width/4,$e.height/4),qe.heatmapFbos.set(u.bQ,at))})(ce,H,re),ce.clear({color:u.b5.transparent});for(let Ee=0;Ee<se.length;Ee++){const $e=se[Ee];if(ie.hasRenderableParent($e))continue;const qe=ie.getTile($e),nt=qe.getBucket(re);if(!nt)continue;const at=nt.programConfigurations.get(re.id),Qe=H.useProgram("heatmap",at),lt=xe.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Tt=xe.getCircleRadiusCorrection();Qe.draw(ce,ve.TRIANGLES,cn.disabled,Se,Ce,Cn.backCCW,Ku(qe,xe.zoom,re.paint.get("heatmap-intensity"),Tt),null,lt,re.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,re.paint,xe.zoom,at)}ce.viewport.set([0,0,H.width,H.height])}(w,P,M,k):w.renderPass==="translucent"&&function(H,ie){const re=H.context,se=re.gl;re.setColorMode(H.colorModeForRenderPass());const ce=ie.heatmapFbos.get(u.bQ);ce&&(re.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,ce.colorAttachment.get()),re.activeTexture.set(se.TEXTURE1),cl(re,ie).bind(se.LINEAR,se.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(re,se.TRIANGLES,cn.disabled,Mn.disabled,H.colorModeForRenderPass(),Cn.disabled,js(H,ie,0,1),null,null,ie.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,ie.paint,H.transform.zoom))}(w,M)}(e,r,c,d,_):u.c0(c)?function(w,P,M,k,L){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:D}=L,F=M.paint.get("line-opacity"),G=M.paint.get("line-width");if(F.constantOr(1)===0||G.constantOr(1)===0)return;const H=w.getDepthModeForSublayer(0,cn.ReadOnly),ie=w.colorModeForRenderPass(),re=M.paint.get("line-dasharray"),se=M.paint.get("line-pattern"),ce=se.constantOr(1),ve=M.paint.get("line-gradient"),xe=M.getCrossfadeParameters(),Se=ce?"linePattern":re?"lineSDF":ve?"lineGradient":"line",Ce=w.context,Ee=Ce.gl,$e=w.transform;let qe=!0;for(const nt of k){const at=P.getTile(nt);if(ce&&!at.patternsLoaded())continue;const Qe=at.getBucket(M);if(!Qe)continue;const lt=Qe.programConfigurations.get(M.id),Tt=w.context.program.get(),ft=w.useProgram(Se,lt),Et=qe||ft.program!==Tt,an=w.style.map.terrain&&w.style.map.terrain.getTerrainData(nt),kn=se.constantOr(null);if(kn&&at.imageAtlas){const Nn=at.imageAtlas,Wn=Nn.patternPositions[kn.to.toString()],Qr=Nn.patternPositions[kn.from.toString()];Wn&&Qr&&lt.setConstantPatternPositions(Wn,Qr)}const ar=$e.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),xn=$e.getPixelScale(),lr=ce?Th(w,at,M,xn,xe):re?Yl(w,at,M,xn,re,xe):ve?fi(w,at,M,xn,Qe.lineClipsArray.length):ec(w,at,M,xn);if(ce)Ce.activeTexture.set(Ee.TEXTURE0),at.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),lt.updatePaintBuffers(xe);else if(re&&(Et||w.lineAtlas.dirty))Ce.activeTexture.set(Ee.TEXTURE0),w.lineAtlas.bind(Ce);else if(ve){const Nn=Qe.gradients[M.id];let Wn=Nn.texture;if(M.gradientVersion!==Nn.version){let Qr=256;if(M.stepInterpolant){const jn=P.getSource().maxzoom,Qn=nt.canonical.z===jn?Math.ceil(1<<w.transform.maxZoom-nt.canonical.z):1;Qr=u.ac(u.bR(Qe.maxLineLength/u.Y*1024*Qn),256,Ce.maxTextureSize)}Nn.gradient=u.bS({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:Qr,image:Nn.gradient||void 0,clips:Qe.lineClipsArray}),Nn.texture?Nn.texture.update(Nn.gradient):Nn.texture=new $(Ce,Nn.gradient,Ee.RGBA),Nn.version=M.gradientVersion,Wn=Nn.texture}Ce.activeTexture.set(Ee.TEXTURE0),Wn.bind(M.stepInterpolant?Ee.NEAREST:Ee.LINEAR,Ee.CLAMP_TO_EDGE)}let On;if(D){const[Nn]=w.getStencilConfigForOverlapAndUpdateStencilID(k);On=Nn[nt.overscaledZ]}else On=w.stencilModeForClipping(nt);ft.draw(Ce,Ee.TRIANGLES,H,On,ie,Cn.disabled,lr,an,ar,M.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,M.paint,w.transform.zoom,lt,Qe.layoutVertexBuffer2),qe=!1}}(e,r,c,d,_):u.c1(c)?function(w,P,M,k,L){const D=M.paint.get("fill-color"),F=M.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const{isRenderingToTexture:G}=L,H=w.colorModeForRenderPass(),ie=M.paint.get("fill-pattern"),re=w.opaquePassEnabledForLayer()&&!ie.constantOr(1)&&D.constantOr(u.b5.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===re){const se=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?cn.ReadWrite:cn.ReadOnly);tu(w,P,M,k,se,H,!1,G)}if(w.renderPass==="translucent"&&M.paint.get("fill-antialias")){const se=w.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,cn.ReadOnly);tu(w,P,M,k,se,H,!0,G)}}(e,r,c,d,_):u.c2(c)?function(w,P,M,k,L){const D=M.paint.get("fill-extrusion-opacity");if(D===0)return;const{isRenderingToTexture:F}=L;if(w.renderPass==="translucent"){const G=new cn(w.context.gl.LEQUAL,cn.ReadWrite,w.depthRangeFor3D);if(D!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))hl(w,P,M,k,G,Mn.disabled,Jn.disabled,F),hl(w,P,M,k,G,w.stencilModeFor3D(),w.colorModeForRenderPass(),F);else{const H=w.colorModeForRenderPass();hl(w,P,M,k,G,Mn.disabled,H,F)}}}(e,r,c,d,_):u.c3(c)?function(w,P,M,k,L){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:D}=L,F=w.context,G=w.style.projection.useSubdivision,H=w.getDepthModeForSublayer(0,cn.ReadOnly),ie=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(re,se,ce,ve,xe,Se,Ce){const Ee=re.context,$e=Ee.gl;for(const qe of ce){const nt=se.getTile(qe),at=nt.dem;if(!at||!at.data||!nt.needsHillshadePrepare)continue;const Qe=at.dim,lt=at.stride,Tt=at.getPixels();if(Ee.activeTexture.set($e.TEXTURE1),Ee.pixelStoreUnpackPremultiplyAlpha.set(!1),nt.demTexture=nt.demTexture||re.getTileTexture(lt),nt.demTexture){const Et=nt.demTexture;Et.update(Tt,{premultiply:!1}),Et.bind($e.NEAREST,$e.CLAMP_TO_EDGE)}else nt.demTexture=new $(Ee,Tt,$e.RGBA,{premultiply:!1}),nt.demTexture.bind($e.NEAREST,$e.CLAMP_TO_EDGE);Ee.activeTexture.set($e.TEXTURE0);let ft=nt.fbo;if(!ft){const Et=new $(Ee,{width:Qe,height:Qe,data:null},$e.RGBA);Et.bind($e.LINEAR,$e.CLAMP_TO_EDGE),ft=nt.fbo=Ee.createFramebuffer(Qe,Qe,!0,!1),ft.colorAttachment.set(Et.texture)}Ee.bindFramebuffer.set(ft.framebuffer),Ee.viewport.set([0,0,Qe,Qe]),re.useProgram("hillshadePrepare").draw(Ee,$e.TRIANGLES,xe,Se,Ce,Cn.disabled,Qu(nt.tileID,at),null,null,ve.id,re.rasterBoundsBuffer,re.quadTriangleIndexBuffer,re.rasterBoundsSegments),nt.needsHillshadePrepare=!1}})(w,P,k,M,H,Mn.disabled,ie),F.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(G){const[re,se,ce]=w.stencilConfigForOverlapTwoPass(k);zh(w,P,M,ce,re,H,ie,!1,D),zh(w,P,M,ce,se,H,ie,!0,D)}else{const[re,se]=w.getStencilConfigForOverlapAndUpdateStencilID(k);zh(w,P,M,se,re,H,ie,!1,D)}}(e,r,c,d,_):u.c4(c)?function(w,P,M,k,L){if(w.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!k.length)return;const{isRenderingToTexture:D}=L,F=P.getSource(),G=w.style.projection.useSubdivision;if(F instanceof Kn)pn(w,P,M,k,null,!1,!1,F.tileCoords,F.flippedWindingOrder,D);else if(G){const[H,ie,re]=w.stencilConfigForOverlapTwoPass(k);pn(w,P,M,re,H,!1,!0,dc,!1,D),pn(w,P,M,re,ie,!0,!0,dc,!1,D)}else{const[H,ie]=w.getStencilConfigForOverlapAndUpdateStencilID(k);pn(w,P,M,ie,H,!1,!0,dc,!1,D)}}(e,r,c,d,_):u.c5(c)?function(w,P,M,k,L){const D=M.paint.get("background-color"),F=M.paint.get("background-opacity");if(F===0)return;const{isRenderingToTexture:G}=L,H=w.context,ie=H.gl,re=w.style.projection,se=w.transform,ce=se.tileSize,ve=M.paint.get("background-pattern");if(w.isPatternMissing(ve))return;const xe=!ve&&D.a===1&&F===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==xe)return;const Se=Mn.disabled,Ce=w.getDepthModeForSublayer(0,xe==="opaque"?cn.ReadWrite:cn.ReadOnly),Ee=w.colorModeForRenderPass(),$e=w.useProgram(ve?"backgroundPattern":"background"),qe=k||te(se,{tileSize:ce,terrain:w.style.map.terrain});ve&&(H.activeTexture.set(ie.TEXTURE0),w.imageManager.bind(w.context));const nt=M.getCrossfadeParameters();for(const at of qe){const Qe=se.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),lt=ve?Eh(F,w,ve,{tileID:at,tileSize:ce},nt):Us(F,D),Tt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(at),ft=re.getMeshFromTileID(H,at.canonical,!1,!0,"raster");$e.draw(H,ie.TRIANGLES,Ce,Se,Ee,Cn.backCCW,lt,Tt,Qe,M.id,ft.vertexBuffer,ft.indexBuffer,ft.segments)}}(e,0,c,d,_):u.c6(c)&&function(w,P,M,k){const{isRenderingGlobe:L}=k,D=w.context,F=M.implementation,G=w.style.projection,H=w.transform,ie=H.getProjectionDataForCustomLayer(L),re={farZ:H.farZ,nearZ:H.nearZ,fov:H.fov*Math.PI/180,modelViewProjectionMatrix:H.modelViewProjectionMatrix,projectionMatrix:H.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:ie},se=F.renderingMode?F.renderingMode:"2d";if(w.renderPass==="offscreen"){const ce=F.prerender;ce&&(w.setCustomLayerDefaults(),D.setColorMode(w.colorModeForRenderPass()),ce.call(F,D.gl,re),D.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),D.setColorMode(w.colorModeForRenderPass()),D.setStencilMode(Mn.disabled);const ce=se==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,cn.ReadOnly);D.setDepthMode(ce),F.render(D.gl,re),D.setDirty(),w.setBaseState(),D.bindFramebuffer.set(null)}}(e,0,c,_))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!r||!c}useProgram(e,r,c=!1){this.cache=this.cache||{};const d=!!this.style.map.terrain,_=this.style.projection,w=e+(r?r.cacheKey:"")+`/${c?vh:_.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(d?"/terrain":"");return this.cache[w]||(this.cache[w]=new Hu(this.context,Vo[e],r,ic[e],this._showOverdrawInspector,d,c?Vo.projectionMercator:_.shaderPreludeCode,c?ju:_.shaderDefine)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new $(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function $s(g,e){let r,c=!1,d=null,_=null;const w=()=>{d=null,c&&(g.apply(_,r),d=setTimeout(w,e),c=!1)};return(...P)=>(c=!0,_=this,r=P,d||w(),d)}class Lh{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(c=d)}),(c&&c[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const c=r.join("/");let d=c;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${c}`);let _=window.location.hash.replace(d,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let w=window.location.href.replace(/(#.+)?$/,_);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=$s(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),w=Math.round(r.lng*_)/_,P=Math.round(r.lat*_)/_,M=this._map.getBearing(),k=this._map.getPitch();let L="";if(L+=e?`/${w}/${P}/${c}`:`${c}/${P}/${w}`,(M||k)&&(L+="/"+Math.round(10*M)/10),k&&(L+=`/${Math.round(k)}`),this._hashName){const D=this._hashName;let F=!1;const G=window.location.hash.slice(1).split("&").map(H=>{const ie=H.split("=")[0];return ie===D?(F=!0,`${ie}=${L}`):H}).filter(H=>H);return F||G.push(`${D}=${L}`),`#${G.join("&")}`}return`#${L}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new u.O(+e[2],+e[1])}catch{return!1}const r=+e[0],c=+(e[3]||0),d=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&c>=-180&&c<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const ml={linearity:.3,easing:u.c7(0,0,.3,1)},Ud=u.e({deceleration:2500,maxSpeed:1400},ml),Vd=u.e({deceleration:20,maxSpeed:1400},ml),nu=u.e({deceleration:1e3,maxSpeed:360},ml),gl=u.e({deceleration:1e3,maxSpeed:90},ml),Dh=u.e({deceleration:1e3,maxSpeed:360},ml);class X{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:fe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=fe.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,r.roll+=_.rollDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(r.pan.mag()){const _=Jr(r.pan.mag(),c,u.e({},Ud,e||{})),w=r.pan.mult(_.amount/r.pan.mag()),P=this._map.cameraHelper.handlePanInertia(w,this._map.transform);d.center=P.easingCenter,d.offset=P.easingOffset,To(d,_)}if(r.zoom){const _=Jr(r.zoom,c,Vd);d.zoom=this._map.transform.zoom+_.amount,To(d,_)}if(r.bearing){const _=Jr(r.bearing,c,nu);d.bearing=this._map.transform.bearing+u.ac(_.amount,-179,179),To(d,_)}if(r.pitch){const _=Jr(r.pitch,c,gl);d.pitch=this._map.transform.pitch+_.amount,To(d,_)}if(r.roll){const _=Jr(r.roll,c,Dh);d.roll=this._map.transform.roll+u.ac(_.amount,-179,179),To(d,_)}if(d.zoom||d.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),u.e(d,{noMoveStart:!0})}}function To(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function Jr(g,e,r){const{maxSpeed:c,linearity:d,deceleration:_}=r,w=u.ac(g*d/(e/1e3),-c,c),P=Math.abs(w)/(_*d);return{easing:r.easing,duration:1e3*P,amount:w*(P/2)}}class zn extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c,d={}){const _=oe.mousePos(r.getCanvas(),c),w=r.unproject(_);super(e,u.e({point:_,lngLat:w,originalEvent:c},d)),this._defaultPrevented=!1,this.target=r}}class _n extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){const d=e==="touchend"?c.changedTouches:c.touches,_=oe.touchPos(r.getCanvasContainer(),d),w=_.map(M=>r.unproject(M)),P=_.reduce((M,k,L,D)=>M.add(k.div(D.length)),new u.P(0,0));super(e,{points:_,point:P,lngLats:w,lngLat:r.unproject(P),originalEvent:c}),this._defaultPrevented=!1}}class Co extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class _l{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Co(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new zn(e.type,this._map,e))}mouseup(e){this._map.fire(new zn(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new zn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new zn(e.type,this._map,e))}mouseover(e){this._map.fire(new zn(e.type,this._map,e))}mouseout(e){this._map.fire(new zn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new _n(e.type,this._map,e))}touchmove(e){this._map.fire(new _n(e.type,this._map,e))}touchend(e){this._map.fire(new _n(e.type,this._map,e))}touchcancel(e){this._map.fire(new _n(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _f{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new zn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new zn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Po{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(u.P.convert(e),this._map.terrain)}}class Gd{constructor(e,r){this._map=e,this._tr=new Po(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(oe.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const c=r;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=c,this._box||(this._box=oe.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const _=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),M=Math.max(d.y,c.y);oe.setTransform(this._box,`translate(${_}px,${P}px)`),this._box.style.width=w-_+"px",this._box.style.height=M-P+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const c=this._startPos,d=r;if(this.reset(),oe.suppressClick(),c.x!==d.x||c.y!==d.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:e})),{cameraAnimation:_=>_.fitScreenCoordinates(c,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(oe.remove(this._box),this._box=null),oe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new u.k(e,{originalEvent:r}))}}function Fh(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const r={};for(let c=0;c<g.length;c++)r[g[c].identifier]=e[c];return r}class $d{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){const _=new u.P(0,0);for(const w of d)_._add(w);return _.div(d.length)}(r),this.touches=Fh(c,r)))}touchmove(e,r,c){if(this.aborted||!this.centroid)return;const d=Fh(c,r);for(const _ in this.touches){const w=d[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(e,r,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Ia{constructor(e){this.singleTap=new $d(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,c){this.singleTap.touchstart(e,r,c)}touchmove(e,r,c){this.singleTap.touchmove(e,r,c)}touchend(e,r,c){const d=this.singleTap.touchend(e,r,c);if(d){const _=e.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(_&&w||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class ms{constructor(e){this._tr=new Po(e),this._zoomIn=new Ia({numTouches:1,numTaps:2}),this._zoomOut=new Ia({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,c){this._zoomIn.touchstart(e,r,c),this._zoomOut.touchstart(e,r,c)}touchmove(e,r,c){this._zoomIn.touchmove(e,r,c),this._zoomOut.touchmove(e,r,c)}touchend(e,r,c){const d=this._zoomIn.touchend(e,r,c),_=this._zoomOut.touchend(e,r,c),w=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(d)},{originalEvent:e})}):_?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(_)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class It{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(r)?r[0]:r;return!this._moved&&d.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(c,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&oe.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zd={0:1,2:2};class ka{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=oe.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,c){const d=Zd[c];return r.buttons===void 0||(r.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return oe.mouseButton(e)===this._eventButton}}class qd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class ru{constructor(e=new ka({checkCorrectEvent:()=>!0}),r=new qd){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,c){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const Zs=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}};class Ho{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,c){return this._calculateTransform(e,r,c)}touchmove(e,r,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,r,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,c){this._calculateTransform(e,r,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,c){c.length>0&&(this._active=!0);const d=Fh(c,r),_=new u.P(0,0),w=new u.P(0,0);let P=0;for(const k in d){const L=d[k],D=this._touches[k];D&&(_._add(L),w._add(L.sub(D)),P++,d[k]=L)}if(this._touches=d,this._shouldBePrevented(P)||!w.mag())return;const M=w.div(P);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(P),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,c){if(!this._firstTwoTouches)return;e.preventDefault();const[d,_]=this._firstTwoTouches,w=yl(c,r,d),P=yl(c,r,_);if(!w||!P)return;const M=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],M,e)}touchend(e,r,c){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,w=yl(c,r,d),P=yl(c,r,_);w&&P||(this._active&&oe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function yl(g,e,r){for(let c=0;c<g.length;c++)if(g[c].identifier===r)return e[c]}function Wd(g,e){return Math.log(g/e)/Math.LN2}class fc extends yn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Wd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wd(this._distance,c),pinchAround:r}}}function Hd(g,e){return 180*g.angleWith(e)/Math.PI}class qs extends yn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,c){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hd(this._vector,d),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,c=Hd(e,this._startVector);return Math.abs(c)<r}}function mc(g){return Math.abs(g.y)>Math.abs(g.x)}class gc extends yn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,c){super.touchstart(e,r,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,mc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),_=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,c){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,_=r.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const w=e.y>0==r.y>0;return mc(e)&&mc(r)&&w}}const uo={panStep:100,bearingStep:15,pitchStep:10};class Yd{constructor(e){this._tr=new Po(e);const r=uo;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,c=0,d=0,_=0,w=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),_=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),_=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),w=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:P=>{const M=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Xd,zoom:r?Math.round(M.zoom)+r*(e.shiftKey?2:1):M.zoom,bearing:M.bearing+c*this._bearingStep,pitch:M.pitch+d*this._pitchStep,offset:[-_*this._panStep,-w*this._panStep],center:M.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xd(g){return g*(2-g)}const Kd=4.000244140625;class Jd{constructor(e,r){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new Po(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const c=fe.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%Kd==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=oe.mousePos(this._map.getCanvas(),e),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(u.O.convert(c.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const P=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=P),typeof this._targetZoom=="number"&&(this._targetZoom+=P)}if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Kd?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&M!==0&&(M=1/M);const k=typeof this._targetZoom!="number"?e.scale:u.aG(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,u.a9(k*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,c=this._startZoom,d=this._easing;let _,w=!1;if(this._type==="wheel"&&c&&d){const P=fe.now()-this._lastWheelEventTime,M=Math.min((P+5)/200,1),k=d(M);_=u.z.number(c,r,k),M<1?this._frameId||(this._frameId=!0):w=!0}else _=r,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!w,zoomDelta:_-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=u.c9;if(this._prevEase){const c=this._prevEase,d=(fe.now()-c.start)/c.duration,_=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(_*_+1e-4)*.01,P=Math.sqrt(.0729-w*w);r=u.c7(w,P,.25,1)}return this._prevEase={start:fe.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class gs{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nr{constructor(e){this._tr=new Po(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iu{constructor(){this._tap=new Ia({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,c){if(!this._swipePoint)if(this._tapTime){const d=r[0],_=e.timeStamp-this._tapTime<500,w=this._tapPoint.dist(d)<30;_&&w?c.length>0&&(this._swipePoint=d,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,r,c)}touchmove(e,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=r[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(e,r,c)}touchend(e,r,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const d=this._tap.touchend(e,r,c);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _c{constructor(e,r,c){this._el=e,this._mousePan=r,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bh{constructor(e,r,c,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=c,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ou{constructor(e,r,c,d){this._el=e,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Aa{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=oe.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=r,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=c,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(oe.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new u.k("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const za=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Yo extends u.k{}function Ra(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class Vt{constructor(e,r){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=d.type==="renderFrame"?void 0:d,P={needsRenderFrame:!1},M={},k={},L=d.touches,D=L?this._getMapTouches(L):void 0,F=D?oe.touchPos(this._map.getCanvas(),D):oe.mousePos(this._map.getCanvas(),d);for(const{handlerName:ie,handler:re,allowed:se}of this._handlers){if(!re.isEnabled())continue;let ce;this._blockedByActive(k,se,ie)?re.reset():re[_||d.type]&&(ce=re[_||d.type](d,F,D),this.mergeHandlerResult(P,M,ce,ie,w),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||re.isActive())&&(k[ie]=re)}const G={};for(const ie in this._previousActiveHandlers)k[ie]||(G[ie]=w);this._previousActiveHandlers=k,(Object.keys(G).length||Ra(P))&&(this._changes.push([P,M,G]),this._triggerRenderFrame()),(Object.keys(k).length||Ra(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=P;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new X(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,_,w]of this._listeners)oe.addEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[e,r,c]of this._listeners)oe.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new _l(r,e));const d=r.boxZoom=new Gd(r,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const _=r.cooperativeGestures=new Aa(r,e.cooperativeGestures);this._add("cooperativeGestures",_),e.cooperativeGestures&&_.enable();const w=new ms(r),P=new nr(r);r.doubleClickZoom=new gs(P,w),this._add("tapZoom",w),this._add("clickZoom",P),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const M=new iu;this._add("tapDragZoom",M);const k=r.touchPitch=new gc(r);this._add("touchPitch",k),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const L=()=>r.project(r.getCenter()),D=function({enable:xe,clickTolerance:Se,aroundCenter:Ce=!0,minPixelCenterThreshold:Ee=100,rotateDegreesPerPixelMoved:$e=.8},qe){const nt=new ka({checkCorrectEvent:at=>oe.mouseButton(at)===0&&at.ctrlKey||oe.mouseButton(at)===2&&!at.ctrlKey});return new It({clickTolerance:Se,move:(at,Qe)=>{const lt=qe();if(Ce&&Math.abs(lt.y-at.y)>Ee)return{bearingDelta:u.c8(new u.P(at.x,Qe.y),Qe,lt)};let Tt=(Qe.x-at.x)*$e;return Ce&&Qe.y<lt.y&&(Tt=-Tt),{bearingDelta:Tt}},moveStateManager:nt,enable:xe,assignEvents:Zs})}(e,L),F=function({enable:xe,clickTolerance:Se,pitchDegreesPerPixelMoved:Ce=-.5}){const Ee=new ka({checkCorrectEvent:$e=>oe.mouseButton($e)===0&&$e.ctrlKey||oe.mouseButton($e)===2});return new It({clickTolerance:Se,move:($e,qe)=>({pitchDelta:(qe.y-$e.y)*Ce}),moveStateManager:Ee,enable:xe,assignEvents:Zs})}(e),G=function({enable:xe,clickTolerance:Se,rollDegreesPerPixelMoved:Ce=.3},Ee){const $e=new ka({checkCorrectEvent:qe=>oe.mouseButton(qe)===2&&qe.ctrlKey});return new It({clickTolerance:Se,move:(qe,nt)=>{const at=Ee();let Qe=(nt.x-qe.x)*Ce;return nt.y<at.y&&(Qe=-Qe),{rollDelta:Qe}},moveStateManager:$e,enable:xe,assignEvents:Zs})}(e,L);r.dragRotate=new Bh(e,D,F,G),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",F,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const H=function({enable:xe,clickTolerance:Se}){const Ce=new ka({checkCorrectEvent:Ee=>oe.mouseButton(Ee)===0&&!Ee.ctrlKey});return new It({clickTolerance:Se,move:(Ee,$e)=>({around:$e,panDelta:$e.sub(Ee)}),activateOnStart:!0,moveStateManager:Ce,enable:xe,assignEvents:Zs})}(e),ie=new Ho(e,r);r.dragPan=new _c(c,H,ie),this._add("mousePan",H),this._add("touchPan",ie,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const re=new qs,se=new fc;r.touchZoomRotate=new ou(c,se,re,M),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const ce=r.scrollZoom=new Jd(r,()=>this._triggerRenderFrame());this._add("scrollZoom",ce,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const ve=r.keyboard=new Yd(r);this._add("keyboard",ve),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new _f(r))}_add(e,r,c){this._handlers.push({handlerName:e,handler:r,allowed:c}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!za(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,c){for(const d in e)if(d!==c&&(!r||r.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const c of e)this._el.contains(c.target)&&r.push(c);return r}mergeHandlerResult(e,r,c,d,_){if(!c)return;u.e(e,c);const w={handlerName:d,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(r.zoom=w),c.panDelta!==void 0&&(r.drag=w),c.rollDelta!==void 0&&(r.roll=w),c.pitchDelta!==void 0&&(r.pitch=w),c.bearingDelta!==void 0&&(r.rotate=w)}_applyChanges(){const e={},r={},c={};for(const[d,_,w]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new u.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),u.e(r,_),u.e(c,w);this._updateMapTransform(e,r,c),this._changes=[]}_updateMapTransform(e,r,c){const d=this._map,_=d._getTransformForUpdate(),w=d.terrain;if(!(Ra(e)||w&&this._terrainMovement))return this._fireEvents(r,c,!0);d._stop(!0);let{panDelta:P,zoomDelta:M,bearingDelta:k,pitchDelta:L,rollDelta:D,around:F,pinchAround:G}=e;G!==void 0&&(F=G),F=F||d.transform.centerPoint,w&&!_.isPointOnMapSurface(F)&&(F=_.centerPoint);const H={panDelta:P,zoomDelta:M,rollDelta:D,pitchDelta:L,bearingDelta:k,around:F};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(F)&&(F=_.centerPoint);const ie=F.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(P?F.sub(P):F);w?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(H,_),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?_.setCenter(_.screenPointToLocation(_.centerPoint.sub(P))):this._map.cameraHelper.handleMapControlsPan(H,_,ie):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(H,_,ie))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(H,_),this._map.cameraHelper.handleMapControlsPan(H,_,ie)),d._applyUpdatedTransform(_),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,c,!0)}_fireEvents(e,r,c){const d=za(this._eventsInProgress),_=za(e),w={};for(const D in e){const{originalEvent:F}=e[D];this._eventsInProgress[D]||(w[`${D}start`]=F),this._eventsInProgress[D]=e[D]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const D in w)this._fireEvent(D,w[D]);_&&this._fireEvent("move",_.originalEvent);for(const D in e){const{originalEvent:F}=e[D];this._fireEvent(D,F)}const P={};let M;for(const D in this._eventsInProgress){const{handlerName:F,originalEvent:G}=this._eventsInProgress[D];this._handlersById[F].isActive()||(delete this._eventsInProgress[D],M=r[F]||G,P[`${D}end`]=M)}for(const D in P)this._fireEvent(D,P[D]);const k=za(this._eventsInProgress),L=(d||_)&&!k;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const D=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&D.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(D)}if(c&&L){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!D||!D.essential&&fe.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:M})),F(this._map.getBearing())&&this._map.resetNorth()):(F(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new u.k(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Yo("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gt extends u.E{constructor(e,r,c){super(),this._renderFrameCallback=()=>{const d=Math.min((fe.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new u.O(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,c){return e=u.P.convert(e).mult(-1),this.panTo(this.transform.center,u.e({offset:e},r),c)}panTo(e,r,c){return this.easeTo(u.e({center:e},r),c)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,c){return this.easeTo(u.e({zoom:e},r),c)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new u.k("movestart",r)).fire(new u.k("move",r)).fire(new u.k("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,c){return this.easeTo(u.e({bearing:e},r),c)}resetNorth(e,r){return this.rotateTo(0,u.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=Rt.convert(e).adjustAntiMeridian();const c=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,r)}_cameraForBoxAndBearing(e,r,c,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=u.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const k=d.padding;d.padding={top:k,bottom:k,right:k,left:k}}const w=u.e(_,d.padding);d.padding=w;const P=this.transform,M=new Rt(e,r);return this.cameraHelper.cameraForBoxAndBearing(d,w,M,c,P)}fitBounds(e,r,c){return this._fitInternal(this.cameraForBounds(e,r),r,c)}fitScreenCoordinates(e,r,c,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(e)),this.transform.screenPointToLocation(u.P.convert(r)),c,d),d,_)}_fitInternal(e,r,c){return e?(delete(r=u.e(e,r)).padding,r.linear?this.easeTo(r,c):this.flyTo(r,c)):this}jumpTo(e,r){this.stop();const c=this._getTransformForUpdate();let d=!1,_=!1,w=!1;const P=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,e);const M=c.zoom!==P;return"elevation"in e&&c.elevation!==+e.elevation&&c.setElevation(+e.elevation),"bearing"in e&&c.bearing!==+e.bearing&&(d=!0,c.setBearing(+e.bearing)),"pitch"in e&&c.pitch!==+e.pitch&&(_=!0,c.setPitch(+e.pitch)),"roll"in e&&c.roll!==+e.roll&&(w=!0,c.setRoll(+e.roll)),e.padding==null||c.isPaddingEqual(e.padding)||c.setPadding(e.padding),this._applyUpdatedTransform(c),this.fire(new u.k("movestart",r)).fire(new u.k("move",r)),M&&this.fire(new u.k("zoomstart",r)).fire(new u.k("zoom",r)).fire(new u.k("zoomend",r)),d&&this.fire(new u.k("rotatestart",r)).fire(new u.k("rotate",r)).fire(new u.k("rotateend",r)),_&&this.fire(new u.k("pitchstart",r)).fire(new u.k("pitch",r)).fire(new u.k("pitchend",r)),w&&this.fire(new u.k("rollstart",r)).fire(new u.k("roll",r)).fire(new u.k("rollend",r)),this.fire(new u.k("moveend",r))}calculateCameraOptionsFromTo(e,r,c,d=0){const _=u.Z.fromLngLat(e,r),w=u.Z.fromLngLat(c,d),P=w.x-_.x,M=w.y-_.y,k=w.z-_.z,L=Math.hypot(P,M,k);if(L===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(P,M),F=u.a9(this.transform.cameraToCenterDistance/L/this.transform.tileSize),G=180*Math.atan2(P,-M)/Math.PI;let H=180*Math.acos(D/L)/Math.PI;return H=k<0?90-H:90+H,{center:w.toLngLat(),elevation:d,zoom:F,pitch:H,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,c,d,_){const w=this.transform.calculateCenterFromCameraLngLatAlt(e,r,c,d);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:c,pitch:d,roll:_}}easeTo(e,r){this._stop(!1,e.easeId),((e=u.e({offset:[0,0],duration:500,easing:u.c9},e)).animate===!1||!e.essential&&fe.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),d=this.getBearing(),_=c.pitch,w=c.roll,P="bearing"in e?this._normalizeBearing(e.bearing,d):d,M="pitch"in e?+e.pitch:_,k="roll"in e?this._normalizeBearing(e.roll,w):w,L="padding"in e?e.padding:c.padding,D=u.P.convert(e.offset);let F,G;e.around&&(F=u.O.convert(e.around),G=c.locationToScreenPoint(F));const H={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ie=this.cameraHelper.handleEaseTo(c,{bearing:P,pitch:M,roll:k,padding:L,around:F,aroundPoint:G,offsetAsPoint:D,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==P,this._pitching=this._pitching||M!==_,this._rolling=this._rolling||k!==w,this._padding=!c.isPaddingEqual(L),this._zooming=this._zooming||ie.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,H),this.terrain&&this._prepareElevation(ie.elevationCenter),this._ease(re=>{ie.easeFunc(re),this.terrain&&!e.freezeElevation&&this._updateElevation(re),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},re=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,re)},e),this}_prepareEase(e,r,c={}){this._moving=!0,r||c.moving||this.fire(new u.k("movestart",e)),this._zooming&&!c.zooming&&this.fire(new u.k("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new u.k("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new u.k("pitchstart",e)),this._rolling&&!c.rolling&&this.fire(new u.k("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(r-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(u.z.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),c=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(c<d){const _=this.calculateCameraOptionsFromTo(r,d,e.center,e.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&r.push(d=>this.transformCameraUpdate(d)),!r.length)return;const c=e.clone();for(const d of r){const _=c.clone(),{center:w,zoom:P,roll:M,pitch:k,bearing:L,elevation:D}=d(_);w&&_.setCenter(w),D!==void 0&&_.setElevation(D),P!==void 0&&_.setZoom(P),M!==void 0&&_.setRoll(M),k!==void 0&&_.setPitch(k),L!==void 0&&_.setBearing(L),c.apply(_)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new u.k("move",e)),this._zooming&&this.fire(new u.k("zoom",e)),this._rotating&&this.fire(new u.k("rotate",e)),this._pitching&&this.fire(new u.k("pitch",e)),this._rolling&&this.fire(new u.k("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const c=this._zooming,d=this._rotating,_=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new u.k("zoomend",e)),d&&this.fire(new u.k("rotateend",e)),_&&this.fire(new u.k("pitchend",e)),w&&this.fire(new u.k("rollend",e)),this.fire(new u.k("moveend",e))}flyTo(e,r){if(!e.essential&&fe.prefersReducedMotion){const Qe=u.N(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Qe,r)}this.stop(),e=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.c9},e);const c=this._getTransformForUpdate(),d=c.bearing,_=c.pitch,w=c.roll,P=c.padding,M="bearing"in e?this._normalizeBearing(e.bearing,d):d,k="pitch"in e?+e.pitch:_,L="roll"in e?this._normalizeBearing(e.roll,w):w,D="padding"in e?e.padding:c.padding,F=u.P.convert(e.offset);let G=c.centerPoint.add(F);const H=c.screenPointToLocation(G),ie=this.cameraHelper.handleFlyTo(c,{bearing:M,pitch:k,roll:L,padding:D,locationAtOffset:H,offsetAsPoint:F,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let re=e.curve;const se=Math.max(c.width,c.height),ce=se/ie.scaleOfZoom,ve=ie.pixelPathLength;typeof ie.scaleOfMinZoom=="number"&&(re=Math.sqrt(se/ie.scaleOfMinZoom/ve*2));const xe=re*re;function Se(Qe){const lt=(ce*ce-se*se+(Qe?-1:1)*xe*xe*ve*ve)/(2*(Qe?ce:se)*xe*ve);return Math.log(Math.sqrt(lt*lt+1)-lt)}function Ce(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Ee(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const $e=Se(!1);let qe=function(Qe){return Ee($e)/Ee($e+re*Qe)},nt=function(Qe){return se*((Ee($e)*(Ce(lt=$e+re*Qe)/Ee(lt))-Ce($e))/xe)/ve;var lt},at=(Se(!0)-$e)/re;if(Math.abs(ve)<2e-6||!isFinite(at)){if(Math.abs(se-ce)<1e-6)return this.easeTo(e,r);const Qe=ce<se?-1:1;at=Math.abs(Math.log(ce/se))/re,nt=()=>0,qe=lt=>Math.exp(Qe*re*lt)}return e.duration="duration"in e?+e.duration:1e3*at/("screenSpeed"in e?+e.screenSpeed/re:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==M,this._pitching=k!==_,this._rolling=L!==w,this._padding=!c.isPaddingEqual(D),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(ie.targetCenter),this._ease(Qe=>{const lt=Qe*at,Tt=1/qe(lt),ft=nt(lt);this._rotating&&c.setBearing(u.z.number(d,M,Qe)),this._pitching&&c.setPitch(u.z.number(_,k,Qe)),this._rolling&&c.setRoll(u.z.number(w,L,Qe)),this._padding&&(c.interpolatePadding(P,D,Qe),G=c.centerPoint.add(F)),ie.easeFunc(Qe,Tt,ft,G),this.terrain&&!e.freezeElevation&&this._updateElevation(Qe),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,r)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,r,c){c.animate===!1||c.duration===0?(e(1),r()):(this._easeStart=fe.now(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=u.aJ(e,-180,180);const c=Math.abs(e-r);return Math.abs(e-360-r)<c&&(e-=360),Math.abs(e+360-r)<c&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(u.O.convert(e),this.transform.tileZoom):null}}const La={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Xo{constructor(e=La){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=oe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=oe.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=oe.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){oe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,r){const c=this._map._getUIString(`AttributionControl.${r}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const r=this._map.style.sourceCaches;for(const d in r){const _=r[d];if(_.used||_.usedForTerrain){const w=_.getSource();w.attribution&&e.indexOf(w.attribution)<0&&e.push(w.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,_)=>d.length-_.length),e=e.filter((d,_)=>{for(let w=_+1;w<e.length;w++)if(e[w].indexOf(d)>=0)return!1;return!0});const c=e.join(" | ");c!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=oe.sanitize(c),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class _i{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=oe.create("div","maplibregl-ctrl");const r=oe.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){oe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ti{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const d of c)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Oh=u.aB([{name:"a_pos3d",type:"Int16",components:3}]);class Eo extends u.E{constructor(e){super(),this._lastTilesetChange=fe.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const c={};for(const d of te(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))c[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),u.bM(d.terrainRttPosMatrix32f,0,u.Y,u.Y,0,0,1),this._tiles[d.key]=new to(d,this.tileSize),this._lastTilesetChange=fe.now());for(const d in this._tiles)c[d]||delete this._tiles[d]}freeRtt(e){for(const r in this._tiles){const c=this._tiles[r];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const r={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID,_=e.clone(),w=u.b0();if(d.canonical.equals(e.canonical))u.bM(w,0,u.Y,u.Y,0,0,1);else if(d.canonical.isChildOf(e.canonical)){const P=d.canonical.z-e.canonical.z,M=d.canonical.x-(d.canonical.x>>P<<P),k=d.canonical.y-(d.canonical.y>>P<<P),L=u.Y>>P;u.bM(w,0,L,L,0,0,1),u.K(w,w,[-M*L,-k*L,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{const P=e.canonical.z-d.canonical.z,M=e.canonical.x-(e.canonical.x>>P<<P),k=e.canonical.y-(e.canonical.y>>P<<P),L=u.Y>>P;u.bM(w,0,u.Y,u.Y,0,0,1),u.K(w,w,[M*L,k*L,0]),u.L(w,w,[1/2**P,1/2**P,0])}}_.terrainRttPosMatrix32f=new Float32Array(w),r[c]=_}return r}getSourceTile(e,r){const c=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>c.maxzoom&&(d=c.maxzoom),d<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!_||!_.dem)&&r)for(;d>=c.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(e.scaledTo(d--).key);return _}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class su{constructor(e,r,c){this._meshCache={},this.painter=e,this.sourceCache=new Eo(r),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,c,d=u.Y){var _;if(!(r>=0&&r<d&&c>=0&&c<d))return 0;const w=this.getTerrainData(e),P=(_=w.tile)===null||_===void 0?void 0:_.dem;if(!P)return 0;const M=u.ca([],[r/d*u.Y,c/d*u.Y],w.u_terrain_matrix),k=[M[0]*P.dim,M[1]*P.dim],L=Math.floor(k[0]),D=Math.floor(k[1]),F=k[0]-L,G=k[1]-D;return P.get(L,D)*(1-F)*(1-G)+P.get(L+1,D)*F*(1-G)+P.get(L,D+1)*(1-F)*G+P.get(L+1,D+1)*F*G}getElevationForLngLatZoom(e,r){if(!u.cb(r,e.wrap()))return 0;const{tileID:c,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(c,d%u.Y,_%u.Y,u.Y)}getElevation(e,r,c,d=u.Y){return this.getDEMElevation(e,r,c,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,_=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new $(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new $(d,new u.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.ar([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const d=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new $(d,r.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),r.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const c=r&&r+r.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){const d=this.sourceCache.sourceCache._source.maxzoom;let _=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?_=e.canonical.z-d:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=e.canonical.x-(e.canonical.x>>_<<_),P=e.canonical.y-(e.canonical.y>>_<<_),M=u.cc(new Float64Array(16),[1/(u.Y<<_),1/(u.Y<<_),0]);u.K(M,M,[w*u.Y,P*u.Y,0]),this._demMatrixCache[e.key]={matrix:M,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,c=r.width/devicePixelRatio,d=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new $(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new $(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(c,d,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,c,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,w=0;_<this._coordsTextureSize;_++)for(let P=0;P<this._coordsTextureSize;P++,w+=4)r[w+0]=255&P,r[w+1]=255&_,r[w+2]=P>>8<<4|_>>8,r[w+3]=0;const c=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),d=new $(e,c,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),c=this.painter.context,d=c.gl,_=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,P-w-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null);const M=r[0]+(r[2]>>4<<8),k=r[1]+((15&r[2])<<8),L=this.coordsIndex[255-r[3]],D=L&&this.sourceCache.getTileByID(L);if(!D)return null;const F=this._coordsTextureSize,G=(1<<D.tileID.canonical.z)*F;return new u.Z((D.tileID.canonical.x*F+M)/G+D.tileID.wrap,(D.tileID.canonical.y*F+k)/G,this.getElevation(D.tileID,M,k,F))}depthAtPoint(e){const r=new Uint8Array(4),c=this.painter.context,d=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const c=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,d=c&&e.canonical.y===0,_=c&&e.canonical.y===(1<<e.canonical.z)-1,w=`m_${d?"n":""}_${_?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const P=this.painter.context,M=new u.cd,k=new u.aF,L=this.meshSize,D=u.Y/L,F=L*L;for(let Ee=0;Ee<=L;Ee++)for(let $e=0;$e<=L;$e++)M.emplaceBack($e*D,Ee*D,0);for(let Ee=0;Ee<F;Ee+=L+1)for(let $e=0;$e<L;$e++)k.emplaceBack($e+Ee,L+$e+Ee+1,L+$e+Ee+2),k.emplaceBack($e+Ee,L+$e+Ee+2,$e+Ee+1);const G=M.length,H=G+(L+1),ie=(L+1)*L,re=d?u.b7:0,se=d?0:1,ce=_?u.b8:u.Y,ve=_?0:1;for(let Ee=0;Ee<=L;Ee++)M.emplaceBack(Ee*D,re,se);for(let Ee=0;Ee<=L;Ee++)M.emplaceBack(Ee*D,ce,ve);for(let Ee=0;Ee<L;Ee++)k.emplaceBack(ie+Ee,H+Ee,H+Ee+1),k.emplaceBack(ie+Ee,H+Ee+1,ie+Ee+1),k.emplaceBack(0+Ee,G+Ee+1,G+Ee),k.emplaceBack(0+Ee,0+Ee+1,G+Ee+1);const xe=M.length,Se=xe+2*(L+1);for(const Ee of[0,1])for(let $e=0;$e<=L;$e++)for(const qe of[0,1])M.emplaceBack(Ee*u.Y,$e*D,qe);for(let Ee=0;Ee<2*L;Ee+=2)k.emplaceBack(xe+Ee,xe+Ee+1,xe+Ee+3),k.emplaceBack(xe+Ee,xe+Ee+3,xe+Ee+2),k.emplaceBack(Se+Ee,Se+Ee+3,Se+Ee+1),k.emplaceBack(Se+Ee,Se+Ee+2,Se+Ee+3);const Ce=new bo(P.createVertexBuffer(M,Oh.members),P.createIndexBuffer(k),u.aE.simpleSegment(0,0,M.length,k.length));return this._meshCache[w]=Ce,Ce}getMeshFrameDelta(e){return 2*Math.PI*u.bp/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var c;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(c=this.getMinMaxElevation(d).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return r&&r.dem&&(c.minElevation=r.dem.min*this.exaggeration,c.maxElevation=r.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,r){const c=u.Z.fromLngLat(e.wrap()),d=(1<<r)*u.Y,_=c.x*d,w=c.y*d,P=Math.floor(_/u.Y),M=Math.floor(w/u.Y);return{tileID:new u.X(r,0,r,P,M),mercatorX:_,mercatorY:w}}}class co{constructor(e,r,c){this._context=e,this._size=r,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new $(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(c.texture),{id:e,fbo:r,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Yn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cr{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new co(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(c=>!e._layers[c].isHidden(r)),this._coordsAscending={};for(const c in e.sourceCaches){this._coordsAscending[c]={};const d=e.sourceCaches[c].getVisibleCoordinates();for(const _ of d){const w=this.terrain.sourceCache.getTerrainCoords(_);for(const P in w)this._coordsAscending[c][P]||(this._coordsAscending[c][P]=[]),this._coordsAscending[c][P].push(w[P])}}this._coordsAscendingStr={};for(const c of e._order){const d=e._layers[c],_=d.source;if(Yn[d.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const w in this._coordsAscending[_])this._coordsAscendingStr[_][w]=this._coordsAscending[_][w].map(P=>P.key).sort().join()}}for(const c of this._renderableTiles)for(const d in this._coordsAscendingStr){const _=this._coordsAscendingStr[d][c.tileID.key];_&&_!==c.rttCoords[d]&&(c.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),d=e.type,_=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Yn[d]&&(this._prevType&&Yn[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!w))return!0;if(Yn[this._prevType]||Yn[d]&&w){this._prevType=d;const P=this._stacks.length-1,M=this._stacks[P]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(Ea(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[P]){const D=this.pool.getObjectForId(k.rtt[P].id);if(D.stamp===k.rtt[P].stamp){this.pool.useObject(D);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),k.rtt[P]={id:L.id,stamp:L.stamp},_.context.bindFramebuffer.set(L.fbo.framebuffer),_.context.clear({color:u.b5.transparent,stencil:0}),_.currentStencilSource=void 0;for(let D=0;D<M.length;D++){const F=_.style._layers[M[D]],G=F.source?this._coordsAscending[F.source][k.tileID.key]:[k.tileID];_.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),_._renderTileClippingMasks(F,G,!0),_.renderLayer(_,_.style.sourceCaches[F.source],F,G,c),F.source&&(k.rttCoords[F.source]=this._coordsAscendingStr[F.source][k.tileID.key])}}return Ea(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),Yn[d]}return!1}}const au={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},lu=j,vl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:La,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},jr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class uu{constructor(e,r,c=!1){this.mousedown=_=>{this.startMove(_,oe.mousePos(this.element,_)),oe.addEventListener(window,"mousemove",this.mousemove),oe.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,oe.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHanlder.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=oe.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),oe.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=oe.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const d=new ru;this._rotatePitchHanlder=new It({clickTolerance:3,move:(_,w)=>{const P=r.getBoundingClientRect(),M=new u.P((P.bottom-P.top)/2,(P.right-P.left)/2);return{bearingDelta:u.c8(new u.P(_.x,w.y),w,M),pitchDelta:c?-.5*(w.y-_.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,oe.addEventListener(r,"mousedown",this.mousedown),oe.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),oe.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHanlder.dragStart(e,r),oe.disableDrag()}move(e,r){const c=this.map,{bearingDelta:d,pitchDelta:_}=this._rotatePitchHanlder.dragMove(e,r)||{};d&&c.setBearing(c.getBearing()+d),_&&c.setPitch(c.getPitch()+_)}off(){const e=this.element;oe.removeEventListener(e,"mousedown",this.mousedown),oe.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),oe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.removeEventListener(window,"touchend",this.touchend),oe.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){oe.enableDrag(),oe.removeEventListener(window,"mousemove",this.mousemove),oe.removeEventListener(window,"mouseup",this.mouseup),oe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.removeEventListener(window,"touchend",this.touchend)}}let Ko;function yi(g,e,r){const c=new u.O(g.lng,g.lat);if(g=new u.O(g.lng,g.lat),e){const d=new u.O(g.lng-360,g.lat),_=new u.O(g.lng+360,g.lat),w=r.locationToScreenPoint(g).distSqr(e);r.locationToScreenPoint(d).distSqr(e)<w?g=d:r.locationToScreenPoint(_).distSqr(e)<w&&(g=_)}for(;Math.abs(g.lng-r.center.lng)>180;){const d=r.locationToScreenPoint(g);if(d.x>=0&&d.y>=0&&d.x<=r.width&&d.y<=r.height)break;g.lng>r.center.lng?g.lng-=360:g.lng+=360}return g.lng!==c.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(g))?g:c}const Da={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Fa(g,e,r){const c=g.classList;for(const d in Da)c.remove(`maplibregl-${r}-anchor-${d}`);c.add(`maplibregl-${r}-anchor-${e}`)}class Mo extends u.E{constructor(e){if(super(),this._onKeyPress=r=>{const c=r.code,d=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=r=>{const c=r.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()},this._update=r=>{var c;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?yi(this._lngLat,this._flatPos,this._map.transform):(c=this._lngLat)===null||c===void 0?void 0:c.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),oe.setTransform(this._element,`${Da[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${_}`),fe.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=u.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=oe.create("div");const r=oe.createNS("http://www.w3.org/2000/svg","svg"),c=41,d=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${c}px`),r.setAttributeNS(null,"width",`${d}px`),r.setAttributeNS(null,"viewBox",`0 0 ${d} ${c}`);const _=oe.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const w=oe.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const P=oe.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of M){const ce=oe.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",se.rx),ce.setAttributeNS(null,"ry",se.ry),P.appendChild(ce)}const k=oe.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const L=oe.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(L);const D=oe.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");const F=oe.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(F);const G=oe.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const H=oe.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=oe.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const re=oe.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),H.appendChild(ie),H.appendChild(re),w.appendChild(P),w.appendChild(k),w.appendChild(D),w.appendChild(G),w.appendChild(H),r.appendChild(w),r.setAttributeNS(null,"height",c*this._scale+"px"),r.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(r),this._offset=u.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Fa(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),oe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=u.O.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,c;if(!(!((r=this._map)===null||r===void 0)&&r.terrain)){const D=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==D&&(this._element.style.opacity=D))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,_=d.terrain.depthAtPoint(this._pos),w=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,w)-_<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/d.transform.pixelsPerMeter,M=Math.sin(d.getPitch()*Math.PI/180)*P,k=d.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),L=d.transform.lngLatToCameraDepth(this._lngLat,w+M)-k>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=u.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const yc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let zr=0,_s=!1;const Nh={maxWidth:100,unit:"metric"};function vc(g,e,r){const c=r&&r.maxWidth||100,d=g._container.clientHeight/2,_=g._container.clientWidth/2,w=g.unproject([_-c/2,d]),P=g.unproject([_+c/2,d]),M=Math.round(g.project(P).x-g.project(w).x),k=Math.min(c,M,g._container.clientWidth),L=w.distanceTo(P);if(r&&r.unit==="imperial"){const D=3.2808*L;D>5280?Ws(e,k,D/5280,g._getUIString("ScaleControl.Miles")):Ws(e,k,D,g._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Ws(e,k,L/1852,g._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Ws(e,k,L/1e3,g._getUIString("ScaleControl.Kilometers")):Ws(e,k,L,g._getUIString("ScaleControl.Meters"))}function Ws(g,e,r,c){const d=function(_){const w=Math.pow(10,`${Math.floor(_)}`.length-1);let P=_/w;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(M){const k=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*k)/k}(P),w*P}(r);g.style.width=e*(d/r)+"px",g.innerHTML=`${d}&nbsp;${c}`}const cu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},jh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ys(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,g),"top-left":new u.P(e,e),"top-right":new u.P(-e,e),bottom:new u.P(0,-g),"bottom-left":new u.P(e,-e),"bottom-right":new u.P(-e,-e),left:new u.P(g,0),right:new u.P(-g,0)}}if(g instanceof u.P||Array.isArray(g)){const e=u.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:u.P.convert(g.center||[0,0]),top:u.P.convert(g.top||[0,0]),"top-left":u.P.convert(g["top-left"]||[0,0]),"top-right":u.P.convert(g["top-right"]||[0,0]),bottom:u.P.convert(g.bottom||[0,0]),"bottom-left":u.P.convert(g["bottom-left"]||[0,0]),"bottom-right":u.P.convert(g["bottom-right"]||[0,0]),left:u.P.convert(g.left||[0,0]),right:u.P.convert(g.right||[0,0])}}return ys(new u.P(0,0))}const xc=j;b.AJAXError=u.ch,b.Event=u.k,b.Evented=u.E,b.LngLat=u.O,b.MercatorCoordinate=u.Z,b.Point=u.P,b.addProtocol=u.ci,b.config=u.a,b.removeProtocol=u.cj,b.AttributionControl=Xo,b.BoxZoomHandler=Gd,b.CanvasSource=Di,b.CooperativeGesturesHandler=Aa,b.DoubleClickZoomHandler=gs,b.DragPanHandler=_c,b.DragRotateHandler=Bh,b.EdgeInsets=ri,b.FullscreenControl=class extends u.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){oe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=oe.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);oe.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=hi,b.GeolocateControl=class extends u.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new u.O(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,d=this._map.getBearing(),_=u.e({bearing:d},this.options.fitBoundsOptions),w=Rt.fromLngLat(r,c);this._map.fitBounds(w,_,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new u.O(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&_s)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=oe.create("button","maplibregl-ctrl-geolocate",this._container),oe.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Mo({element:this._dotElement}),this._circleElement=oe.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")),this.fire(new u.k("userlocationlostfocus")))})}},this.options=u.e({},yc,g)}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(e=!1){if(Ko!==void 0&&!e)return Ko;if(window.navigator.permissions===void 0)return Ko=!!window.navigator.geolocation,Ko;try{Ko=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ko=!!window.navigator.geolocation}return Ko})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),oe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zr=0,_s=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),r=g.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),e=g.getSouthEast(),r=g.getNorthEast(),c=e.distanceTo(r),d=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zr--,_s=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart")),this.fire(new u.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zr++,zr>1?(g={maximumAge:6e5,timeout:0},_s=!0):(g=this.options.positionOptions,_s=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const e=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=oe.create("button","maplibregl-ctrl-globe",this._container),oe.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){oe.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=Lh,b.ImageSource=Kn,b.KeyboardHandler=Yd,b.LngLatBounds=Rt,b.LogoControl=_i,b.Map=class extends Gt{constructor(g){var e,r;u.ce.mark(u.cf.create);const c=Object.assign(Object.assign(Object.assign({},vl),g),{canvasContextAttributes:Object.assign(Object.assign({},vl.canvasContextAttributes),g.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new $o,_=new Gu;if(c.minZoom!==void 0&&d.setMinZoom(c.minZoom),c.maxZoom!==void 0&&d.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&d.setMinPitch(c.minPitch),c.maxPitch!==void 0&&d.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&d.setRenderWorldCopies(c.renderWorldCopies),super(d,_,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ti,this._controls=[],this._mapId=u.a2(),this._contextLost=P=>{P.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:P}))},this._contextRestored=P=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:P}))},this._onMapScroll=P=>{if(P.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},au),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ne.addThrottleControl(()=>this.isMoving()),this._requestManager=new ut(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let P=!1;const M=$s(k=>{this._trackResize&&!this._removed&&(this.resize(k),this.redraw())},50);this._resizeObserver=new ResizeObserver(k=>{P?M(k):P=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Vt(this,c),this._hash=c.hash&&new Lh(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,u.e({},c.fitBoundsOptions,{duration:0}))));const w=typeof c.style=="string"||((r=(e=c.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Xo(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new _i,c.logoPosition),this.on("style.load",()=>{if(w||this._resizeTransform(),this.transform.unmodified){const P=u.N(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(P)}}),this.on("data",P=>{this._update(P.dataType==="style"),this.fire(new u.k(`${P.dataType}data`,P))}),this.on("dataloading",P=>{this.fire(new u.k(`${P.dataType}dataloading`,P))}),this.on("dataabort",P=>{this.fire(new u.k("sourcedataabort",P))})}_getMapId(){return this._mapId}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=g.onAdd(this);this._controls.push(g);const c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,e,r,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,r,c)}resize(g,e=!0){const[r,c]=this._containerDimensions(),d=this._getClampedPixelRatio(r,c);if(this._resizeCanvas(r,c,d),this.painter.resize(r,c,d),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const P=this._getClampedPixelRatio(r,c);this._resizeCanvas(r,c,P),this.painter.resize(r,c,P)}this._resizeTransform(e);const _=!this._moving;return _&&(this.stop(),this.fire(new u.k("movestart",g)).fire(new u.k("move",g))),this.fire(new u.k("resize",g)),_&&this.fire(new u.k("moveend",g)),this}_resizeTransform(g=!0){var e;const[r,c]=this._containerDimensions();this.transform.resize(r,c,g),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,c,g)}_getClampedPixelRatio(g,e){const{0:r,1:c}=this._maxCanvasSize,d=this.getPixelRatio(),_=g*d,w=e*d;return Math.min(_>r?r/_:1,w>c?c/w:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Rt.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(u.O.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(u.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,r){if(g==="mouseenter"||g==="mouseover"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:_=>{const w=e.filter(M=>this.getLayer(M)),P=w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[];P.length?c||(c=!0,r.call(this,new zn(g,this,_.originalEvent,{features:P}))):c=!1},mouseout:()=>{c=!1}}}}if(g==="mouseleave"||g==="mouseout"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:w=>{const P=e.filter(M=>this.getLayer(M));(P.length!==0?this.queryRenderedFeatures(w.point,{layers:P}):[]).length?c=!0:c&&(c=!1,r.call(this,new zn(g,this,w.originalEvent)))},mouseout:w=>{c&&(c=!1,r.call(this,new zn(g,this,w.originalEvent)))}}}}{const c=d=>{const _=e.filter(P=>this.getLayer(P)),w=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];w.length&&(d.features=w,r.call(this,d),delete d.features)};return{layers:e,listener:r,delegates:{[g]:c}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,r){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const c=this._delegatedListeners[g];for(let d=0;d<c.length;d++){const _=c[d];if(_.listener===r&&_.layers.length===e.length&&_.layers.every(w=>e.includes(w))){for(const w in _.delegates)this.off(w,_.delegates[w]);return void c.splice(d,1)}}}on(g,e,r){if(r===void 0)return super.on(g,e);const c=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,c,r);this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(g,c,r)}}}once(g,e,r){if(r===void 0)return super.once(g,e);const c=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,c,r);for(const _ in d.delegates){const w=d.delegates[_];d.delegates[_]=(...P)=>{this._removeDelegatedListener(g,c,r),w(...P)}}this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(g,e,r){return r===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let r;const c=g instanceof u.P||Array.isArray(g),d=c?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:g)||{},d instanceof u.P||typeof d[0]=="number")r=[u.P.convert(d)];else{const _=u.P.convert(d[0]),w=u.P.convert(d[1]);r=[_,new u.P(w.x,_.y),w,new u.P(_.x,w.y),_]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){var r,c;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,e));const d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new bi(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,d):this.style.loadJSON(g,e,d),this):((c=(r=this.style)===null||r===void 0?void 0:r.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const r=this._requestManager.transformRequest(g,"Style");u.h(r,new AbortController).then(c=>{this._updateDiff(c.data,e)}).catch(c=>{c&&this.fire(new u.j(c))})}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(r){u.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.sourceCaches[g];if(e!==void 0)return e.loaded();this.fire(new u.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.sourceCaches[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const c=this.style._layers[r];c.type==="hillshade"&&c.source===g.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new su(this.painter,e,g),this.painter.renderToTexture=new Cr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.k("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const e in g){const r=g[e]._tiles;for(const c in r){const d=r[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,e,r={}){const{pixelRatio:c=1,sdf:d=!1,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:k}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||u.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:D,data:F}=e,G=e;return this.style.addImage(g,{data:new u.R({width:L,height:D},new Uint8Array(F)),pixelRatio:c,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:k,sdf:d,version:0,userImage:G}),G.onAdd&&G.onAdd(this,g),this}}{const{width:L,height:D,data:F}=fe.getImageData(e);this.style.addImage(g,{data:new u.R({width:L,height:D},F),pixelRatio:c,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:k,sdf:d,version:0})}}updateImage(g,e){const r=this.style.getImage(g);if(!r)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=e instanceof HTMLImageElement||u.b(e)?fe.getImageData(e):e,{width:d,height:_,data:w}=c;if(d===void 0||_===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==r.data.width||_!==r.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(e instanceof HTMLImageElement||u.b(e));return r.data.replace(w,P),this.style.updateImage(g,r),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return Ne.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,r){return this.style.setLayerZoomRange(g,e,r),this._update(!0)}setFilter(g,e,r={}){return this.style.setFilter(g,e,r),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,r,c={}){return this.style.setPaintProperty(g,e,r,c),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,r,c={}){return this.style.setLayoutProperty(g,e,r,c),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,r,c=>{c||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,r=>{r||this._update(!0)}),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=oe.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=oe.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),c=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],c);const d=this._controlContainer=oe.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=oe.create("div",`maplibregl-ctrl-${w} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,r){this._canvas.width=Math.floor(r*g),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{e={requestedAttributes:g},c&&(e.statusMessage=c.statusMessage,e.type=c.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!r){const c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new Ma(r,this.transform),Be.testSupport(r)}migrateProjection(g,e){super.migrateProjection(g,e),this.painter.transform=g,this.fire(new u.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var e,r,c,d,_;const w=this._idleTriggered?this._fadeDuration:0,P=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,F=fe.now();this.style.zoomHistory.update(D,F);const G=new u.B(D,{now:F,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=G.crossFadingFactor();H===1&&H===this._crossFadingFactor||(M=!0,this._crossFadingFactor=H),this.style.update(G)}const k=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==P;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||k)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,k),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.ce.mark(u.cf.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,u.ce.mark(u.cf.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ne.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),oe.remove(this._canvasContainer),oe.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.ce.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,fe.frame(this._frameRequest,g=>{u.ce.frame(g),this._frameRequest=null;try{this._render(g)}catch(e){if(!u.cg(e)&&!function(r){return r.message===So}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return lu}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},b.MapMouseEvent=zn,b.MapTouchEvent=_n,b.MapWheelEvent=Co,b.Marker=Mo,b.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const c=this._map._getUIString(`NavigationControl.${r}`);e.title=c,e.setAttribute("aria-label",c)},this.options=u.e({},jr,g),this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),oe.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),oe.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=oe.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){oe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const r=oe.create("button",g,this._container);return r.type="button",r.addEventListener("click",e),r}},b.Popup=class extends u.E{constructor(g){super(),this.remove=()=>(this._content&&oe.remove(this._content),this._container&&(oe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var r;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=oe.create("div","maplibregl-popup",this._map.getContainer()),this._tip=oe.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?yi(this._lngLat,this._flatPos,this._map.transform):(r=this._lngLat)===null||r===void 0?void 0:r.wrap(),this._trackPointer&&!e)return;const c=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let d=this.options.anchor;const _=ys(this.options.offset);if(!d){const P=this._container.offsetWidth,M=this._container.offsetHeight;let k;k=c.y+_.bottom.y<M?["top"]:c.y>this._map.transform.height-M?["bottom"]:[],c.x<P/2?k.push("left"):c.x>this._map.transform.width-P/2&&k.push("right"),d=k.length===0?"bottom":k.join("-")}let w=c.add(_[d]);this.options.subpixelPositioning||(w=w.round()),oe.setTransform(this._container,`${Da[d]} translate(${w.x}px,${w.y}px)`),Fa(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(cu),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=u.O.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=g;c=r.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=oe.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=oe.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(jh);g&&g.focus()}},b.RasterDEMTileSource=Br,b.RasterTileSource=Un,b.ScaleControl=class{constructor(g){this._onMove=()=>{vc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,vc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Nh),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){oe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Jd,b.Style=bi,b.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=oe.create("button","maplibregl-ctrl-terrain",this._container),oe.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){oe.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=gc,b.TwoFingersTouchRotateHandler=qs,b.TwoFingersTouchZoomHandler=fc,b.TwoFingersTouchZoomRotateHandler=ou,b.VectorTileSource=Fr,b.VideoSource=Or,b.addSourceType=(g,e)=>u._(void 0,void 0,void 0,function*(){if(Fs(g))throw new Error(`A source type called "${g}" already exists.`);((r,c)=>{Fi[r]=c})(g,e)}),b.clearPrewarmedResources=function(){const g=Lt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(ue),Lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=$l,b.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return di().getRTLTextPluginStatus()},b.getVersion=function(){return xc},b.getWorkerCount=function(){return gt.workerCount},b.getWorkerUrl=function(){return u.a.WORKER_URL},b.importScriptInWorkers=function(g){return Kt().broadcast("IS",g)},b.prewarm=function(){zt().acquire(ue)},b.setMaxParallelImageRequests=function(g){u.a.MAX_PARALLEL_IMAGE_REQUESTS=g},b.setRTLTextPlugin=function(g,e){return di().setRTLTextPlugin(g,e)},b.setWorkerCount=function(g){gt.workerCount=g},b.setWorkerUrl=function(g){u.a.WORKER_URL=g}});var T=a;return T})})(UT);var OI=UT.exports;const NI=Zy(OI),jI=()=>{const[n,i]=en.useState(null);return en.useEffect(()=>{(async()=>{const a=await PT();i(a)})()},[]),n},UI="#C8F0BF",VI="#1E710C",GI=async n=>{const i=await PT();GT(n,i,{fillColor:UI,fillOpacity:1,strokeColor:VI,strokeOpacity:1,strokeWidth:1})},$I=[[1,1],[10,40],[20,400]].reduce((n,[i,a])=>[...n,Number(i),Number(a)],[]),ZI=async n=>{const i=await l0();n.addLayer({id:Dy,type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:i.map(a=>({type:"Feature",geometry:{type:"Point",coordinates:[a.nameLon,a.nameLat]},properties:{name:a.name,endonym:`
`+(a.endonyms[0]??"")}}))}},layout:{visibility:"none","text-field":["format",["get","name"],{"font-scale":1,"text-opacity":1}," ",{},["get","endonym"],{"font-scale":.7,"text-opacity":.7}],"text-size":["interpolate",["exponential",1.1],["zoom"],...$I],"text-font":["NotoSansRegular"],"symbol-placement":"point","text-allow-overlap":!0},paint:{"text-color":"#000000","text-halo-color":"#FFFFFF","text-halo-width":2,"text-halo-blur":1,"text-opacity":["interpolate",["linear"],["zoom"],1,0,2,1]}})},qI="#99AEF3";let Ri=null;const r1=()=>Ri,WI=()=>{const n=ew(),i=jI();en.useEffect(()=>{if(i)return Ri=new NI.Map({container:mT,style:{glyphs:"/{fontstack}/{range}.pbf",layers:[{id:"background",type:"background",paint:{"background-color":qI}}],sources:{},version:8},center:[27,-17],zoom:2.5}),Ri.on("style.load",()=>{Ri.setProjection({type:"globe"})}),Ri.on("load",async()=>{await GI(Ri),await ZI(Ri),n(af.actions.setIsMapInitialized(!0))}),()=>{n(af.actions.setIsMapInitialized(!1)),Ri.remove(),Ri=null}},[i,n])},hf=()=>{const n=dg(i=>i.main.isMapInitialized);return en.useCallback(i=>{if(!n||Ri===null)return()=>null;const a=i();return typeof a=="function"?()=>{!n||Ri===null||a()}:a},[n])},HI=()=>{const n=hf();return en.useCallback((i,a,f)=>n(()=>{Ri.setLayoutProperty(i,a,f)}),[n])},YI=()=>{const n=hf();return en.useCallback(()=>n(()=>{Ri.resize()}),[n])},XI=()=>{const n=hf();return en.useCallback((i,a)=>n(()=>(Ri.on(i,a),()=>Ri.off(i,a))),[n])},Nb={strokeColor:"black",strokeOpacity:1,strokeWidth:2,fillColor:"white",fillOpacity:.5},KI=()=>{const n=hf();return en.useCallback((i,a,f)=>n(()=>GT(Ri,i,a,f)),[n])},GT=(n,i,a=Nb,f)=>{const x=j=>a[j]??Nb[j],T=`geo-json-${Math.random()}`,b=`${T}-fill`,u=`${T}-stroke`;return n.addSource(T,{type:"geojson",data:i}),n.addLayer({id:b,type:"fill",source:T,paint:{"fill-color":x("fillColor"),"fill-opacity":x("fillOpacity")}},f),n.addLayer({id:u,type:"line",source:T,paint:{"line-color":x("strokeColor"),"line-opacity":x("strokeOpacity"),"line-width":x("strokeWidth")}},f),()=>{n.removeLayer(b),n.removeLayer(u),n.removeSource(T)}},JI={padding:100},QI=()=>{const n=hf();return en.useCallback((i,a=JI)=>n(()=>{Ri.fitBounds([[i[0],i[1]],[i[2],i[3]]],a)}),[n])},ek={},tk=()=>{const n=hf();return en.useCallback((i,a,f,x=ek)=>n(()=>{Ri.flyTo({center:[i,a],zoom:f,...x})}),[n])},nk=3,iw=()=>{const n=QI(),i=tk();return en.useCallback(a=>{const f=a.bbox[0];if(a.bbox[2]-f>180){const[b,u]=a.coordLonLat;i(b,u,nk)}else try{n(a.bbox)}catch(b){console.warn(b)}},[n,i])},rk="_container_1frtg_1",ik="_content_1frtg_15",ok="_title_1frtg_20",sk="_inputContainer_1frtg_26",ak="_input_1frtg_26",lk="_button_1frtg_48",uk="_guess_1frtg_60",ck="_isCorrect_1frtg_70",hk="_suggestions_1frtg_75",dk="_suggestion_1frtg_75",pk="_playAgainButton_1frtg_110",ia={container:rk,content:ik,title:ok,inputContainer:sk,input:ak,button:lk,guess:uk,isCorrect:ck,suggestions:hk,suggestion:dk,playAgainButton:pk},fk=3,jb=3,mk=vd.shuffle(["Not quite, but you're getting there!","Close, but no cigar. Try again!","Almost! You're on the right track.","Not that one, but I admire the confidence.","You're thinking globally, but not quite correctly.","Nope, but I like where your head's at.","Thats a bold guess! Give it another go!","Youre circling the right area. Try again!","Not this time, but your world knowledge is expanding.","A good effort! But lets take another shot.","Youve got the spirit, now find the right spot!","A solid attempt, but the map says otherwise.","Wrong border, right energy!","You missed it this time, but youre learning fast.","Not this one, but hey, youre one guess smarter now.","Thats a respectable miss! Keep going!","Youre exploring, and thats what counts! Try again.","Geography is tricky, but so are you. Go again!","I see where youre coming from, but nope!","Youre sharpening your atlas skills, even when you miss!","The world is big, and so is your potential! Guess again!","That guess had style, even if it wasnt right.","Not quite, but that was a thoughtful choice!","You might be off by a few borders, but keep at it!","You're not lost, just discovering! Try again."]),Ub=n=>n.toLowerCase().replace(/[^a-z0-9]+/gi,""),gk=()=>{const[n,i]=en.useState(""),a=en.useMemo(()=>Ub(n),[n]),f=ET(),x=u0(),[T,b]=en.useState([]);en.useEffect(()=>{(async()=>{const Ne={},ut=(await l0()).map(ct=>{const ht=Ub(ct.name);if(Ne[ht]){const $=`Error: two countries share the name when sanitized: ${ht}`;throw alert($),Error($)}return Ne[ht]=!0,{...ct,cleanName:ht}});b(ut)})()},[]);const u=en.useMemo(()=>{const Ne={};return f.forEach(ut=>Ne[ut.name]=!0),T.filter(ut=>!Ne[ut.name])},[T,f]),j=en.useMemo(()=>{for(const Ne of u)if(a===Ne.cleanName)return!0;return!1},[a,u]),Z=en.useMemo(()=>{if(n.length<1)return[];for(const Ne of u)if(Ne.name===n)return[];return vd(u).filter(Ne=>Ne.cleanName.includes(a)).sortBy(Ne=>Ne.cleanName.indexOf(a)).filter((Ne,ut)=>ut<fk).value()},[a,u,n]),me=en.useMemo(()=>{for(const Ne of f)if(x!=null&&x.name&&x.name===Ne.name)return!0;return!1},[x,f]),ge=en.useMemo(()=>!me&&f.length===jb,[me,f]),fe=en.useMemo(()=>me||ge,[ge,me]),oe=HI();en.useEffect(()=>{oe(Dy,"visibility",fe?"visible":"none")},[fe,oe]);const Be=ew(),_t=iw(),xt=en.useCallback(()=>{if(!j)return;const Ne=T.find(ct=>ct.cleanName===a);if(!Ne){const ct=`Could not find country "${a}"`;throw alert(ct),Error(ct)}i(""),Be(af.actions.addGuessedCountryName(Ne.name)),Ne.name===x.name?Be(af.actions.setIsWinModalVisible(!0)):_t(Ne)},[a,T,x,Be,_t,j]),Ie=en.useMemo(()=>fe,[fe]),ne=en.useMemo(()=>me&&f.length===1?`Wow! First try! ${x==null?void 0:x.name} is correct!`:me&&f.length>1?`That's correct, you win! The answer was ${x==null?void 0:x.name}!`:ge?`Nice try! The answer was ${x==null?void 0:x.name}!`:f.length===0?"Guess the highlighted country":mk[f.length-1],[x==null?void 0:x.name,ge,me,f.length]),Te=()=>window.location.reload();return bn.jsx("div",{className:ia.container,children:bn.jsxs("div",{className:ia.content,children:[bn.jsx("div",{className:ia.title,children:ne}),fe?bn.jsx("button",{className:of(ia.button,ia.playAgainButton),onClick:Te,children:"Play again"}):bn.jsxs("div",{className:ia.inputContainer,children:[bn.jsx("input",{disabled:Ie,className:ia.input,value:n,onChange:Ne=>i(Ne.target.value)}),bn.jsx("button",{className:ia.button,disabled:Ie||!j,onClick:xt,children:"Submit"}),bn.jsx("div",{className:ia.suggestions,children:Z.map(Ne=>{const ut=()=>{i(Ne.name)};return bn.jsx("div",{onClick:ut,className:ia.suggestion,children:Ne.name},Ne.cleanName)})})]}),vd.range(jb).map(Ne=>{var ct,ht;const ut=(x==null?void 0:x.name)&&(x==null?void 0:x.name)===((ct=f[Ne])==null?void 0:ct.name);return bn.jsxs("div",{className:of(ia.guess,{[ia.isCorrect]:ut}),children:[Ne+1,". ",((ht=f[Ne])==null?void 0:ht.name)??""]},`guess-${Ne}`)})]})})},_k="_container_1r806_1",yk="_title_1r806_12",vk="_titleStart_1r806_22",xk="_titleEnd_1r806_27",X_={container:_k,title:yk,titleStart:vk,titleEnd:xk},wk=()=>bn.jsx("div",{className:X_.container,children:bn.jsxs("div",{className:X_.title,children:[bn.jsx("div",{className:X_.titleStart,children:"Blundle"}),bn.jsx("div",{className:X_.titleEnd,children:"Countries"})]})}),bk=40,Sk=1e3;let Vb=Date.now();const Tk=()=>{const n=XI(),i=u0(),[a,f]=en.useState(!1);en.useEffect(()=>{const b=vd.debounce(()=>{if(Date.now()-Vb<Sk)return;const j=Ck(i),Z=Pk(i),me=!j||Z>bk;f(me)},100,{maxWait:300,trailing:!0,leading:!1}),u=[n("move",b),n("zoom",b)];return()=>u.forEach(j=>j())},[n,i]);const x=iw(),T=en.useCallback(()=>{f(!1),Vb=Date.now(),x(i)},[i,x]);return[a,T]},Ck=n=>{if(!n)return!1;const[i,a]=n.coordLonLat,f=r1().getBounds(),x=f.getWest(),T=f.getEast(),b=f.getSouth(),u=f.getNorth();return a<b||a>u?!1:x<=T?i>=x&&i<=T:i>=x||i<=T},Pk=n=>{const i=r1().getCenter().lng,a=r1().getCenter().lat,[f,x]=n.coordLonLat,T=oe=>oe*(Math.PI/180),b=oe=>oe*(180/Math.PI),u=T(a),j=T(x),Z=T(i),ge=T(f)-Z,fe=Math.acos(Math.sin(u)*Math.sin(j)+Math.cos(u)*Math.cos(j)*Math.cos(ge));return b(fe)},Ek="_container_yd3t1_1",Mk="_map_yd3t1_10",Ik="_isVisible_yd3t1_19",kk="_returnToCountryButton_yd3t1_23",Ak="_loading_yd3t1_48",kp={container:Ek,map:Mk,isVisible:Ik,returnToCountryButton:kk,loading:Ak},zk=()=>{WI();const n=dg(j=>j.main.isMapInitialized),[i,a]=Tk(),f=en.useRef(),x=YI(),[T,b]=en.useState(window.innerHeight/2),u=en.useCallback(()=>{if(f.current){const j=f.current.getBoundingClientRect();b(j.height),x()}},[x]);return en.useEffect(()=>{if(f.current){u();const j=vd.debounce(u,75,{maxWait:300,leading:!1,trailing:!0}),Z=new ResizeObserver(j);return Z.observe(f.current),()=>Z.disconnect()}},[u]),bn.jsxs("div",{className:kp.container,ref:f,children:[bn.jsx("button",{className:of(kp.returnToCountryButton,{[kp.isVisible]:i}),onClick:a,children:"Return to country"}),!n&&bn.jsx("div",{className:kp.loading,children:"Loading..."}),bn.jsx("div",{id:mT,className:of(kp.map,{[kp.isVisible]:n}),style:{height:`${T}px`}})]})},Rk="_container_1viwr_1",Lk="_star_1viwr_11",Gb={container:Rk,star:Lk},Dk=()=>{const n=en.useMemo(()=>vd.range(1e3).map(()=>({x:Math.random()*100,y:Math.random()*100,blur:Math.random()**2*5,size:Math.random()*3})),[]);return bn.jsx("div",{className:Gb.container,children:n.map((i,a)=>bn.jsx("div",{className:Gb.star,style:{left:`${i.x}%`,top:`${i.y}%`,width:i.size,height:i.size,filter:`blur(${i.blur}px)`}},`star-${a}`))})},Fk="_button_ajwwa_1",Bk="_isSecondary_ajwwa_16",Ok="_isDisabled_ajwwa_21",Kv={button:Fk,isSecondary:Bk,isDisabled:Ok},$b=({onClick:n,className:i,isDisabled:a,isSecondary:f,children:x})=>{const T=()=>{a||n()};return bn.jsx("button",{onClick:T,className:of(Kv.button,i,{[Kv.isSecondary]:f,[Kv.isDisabled]:a}),children:x})};var pg={};(function n(i,a,f,x){var T=!!(i.Worker&&i.Blob&&i.Promise&&i.OffscreenCanvas&&i.OffscreenCanvasRenderingContext2D&&i.HTMLCanvasElement&&i.HTMLCanvasElement.prototype.transferControlToOffscreen&&i.URL&&i.URL.createObjectURL),b=typeof Path2D=="function"&&typeof DOMMatrix=="function",u=function(){if(!i.OffscreenCanvas)return!1;var ye=new OffscreenCanvas(1,1),ue=ye.getContext("2d");ue.fillRect(0,0,1,1);var gt=ye.transferToImageBitmap();try{ue.createPattern(gt,"no-repeat")}catch{return!1}return!0}();function j(){}function Z(ye){var ue=a.exports.Promise,gt=ue!==void 0?ue:i.Promise;return typeof gt=="function"?new gt(ye):(ye(j,j),null)}var me=function(ye,ue){return{transform:function(gt){if(ye)return gt;if(ue.has(gt))return ue.get(gt);var At=new OffscreenCanvas(gt.width,gt.height),Lt=At.getContext("2d");return Lt.drawImage(gt,0,0),ue.set(gt,At),At},clear:function(){ue.clear()}}}(u,new Map),ge=function(){var ye=Math.floor(16.666666666666668),ue,gt,At={},Lt=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(ue=function(bt){var zt=Math.random();return At[zt]=requestAnimationFrame(function Ft(Kt){Lt===Kt||Lt+ye-1<Kt?(Lt=Kt,delete At[zt],bt()):At[zt]=requestAnimationFrame(Ft)}),zt},gt=function(bt){At[bt]&&cancelAnimationFrame(At[bt])}):(ue=function(bt){return setTimeout(bt,ye)},gt=function(bt){return clearTimeout(bt)}),{frame:ue,cancel:gt}}(),fe=function(){var ye,ue,gt={};function At(Lt){function bt(zt,Ft){Lt.postMessage({options:zt||{},callback:Ft})}Lt.init=function(Ft){var Kt=Ft.transferControlToOffscreen();Lt.postMessage({canvas:Kt},[Kt])},Lt.fire=function(Ft,Kt,on){if(ue)return bt(Ft,null),ue;var Dn=Math.random().toString(36).slice(2);return ue=Z(function(Ht){function tn(gn){gn.data.callback===Dn&&(delete gt[Dn],Lt.removeEventListener("message",tn),ue=null,me.clear(),on(),Ht())}Lt.addEventListener("message",tn),bt(Ft,Dn),gt[Dn]=tn.bind(null,{data:{callback:Dn}})}),ue},Lt.reset=function(){Lt.postMessage({reset:!0});for(var Ft in gt)gt[Ft](),delete gt[Ft]}}return function(){if(ye)return ye;if(!f&&T){var Lt=["var CONFETTI, SIZE = {}, module = {};","("+n.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{ye=new Worker(URL.createObjectURL(new Blob([Lt])))}catch(bt){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn(" Could not load worker",bt),null}At(ye)}return ye}}(),oe={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function Be(ye,ue){return ue?ue(ye):ye}function _t(ye){return ye!=null}function xt(ye,ue,gt){return Be(ye&&_t(ye[ue])?ye[ue]:oe[ue],gt)}function Ie(ye){return ye<0?0:Math.floor(ye)}function ne(ye,ue){return Math.floor(Math.random()*(ue-ye))+ye}function Te(ye){return parseInt(ye,16)}function Ne(ye){return ye.map(ut)}function ut(ye){var ue=String(ye).replace(/[^0-9a-f]/gi,"");return ue.length<6&&(ue=ue[0]+ue[0]+ue[1]+ue[1]+ue[2]+ue[2]),{r:Te(ue.substring(0,2)),g:Te(ue.substring(2,4)),b:Te(ue.substring(4,6))}}function ct(ye){var ue=xt(ye,"origin",Object);return ue.x=xt(ue,"x",Number),ue.y=xt(ue,"y",Number),ue}function ht(ye){ye.width=document.documentElement.clientWidth,ye.height=document.documentElement.clientHeight}function $(ye){var ue=ye.getBoundingClientRect();ye.width=ue.width,ye.height=ue.height}function le(ye){var ue=document.createElement("canvas");return ue.style.position="fixed",ue.style.top="0px",ue.style.left="0px",ue.style.pointerEvents="none",ue.style.zIndex=ye,ue}function pe(ye,ue,gt,At,Lt,bt,zt,Ft,Kt){ye.save(),ye.translate(ue,gt),ye.rotate(bt),ye.scale(At,Lt),ye.arc(0,0,1,zt,Ft,Kt),ye.restore()}function Ve(ye){var ue=ye.angle*(Math.PI/180),gt=ye.spread*(Math.PI/180);return{x:ye.x,y:ye.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:ye.startVelocity*.5+Math.random()*ye.startVelocity,angle2D:-ue+(.5*gt-Math.random()*gt),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:ye.color,shape:ye.shape,tick:0,totalTicks:ye.ticks,decay:ye.decay,drift:ye.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:ye.gravity*3,ovalScalar:.6,scalar:ye.scalar,flat:ye.flat}}function Fe(ye,ue){ue.x+=Math.cos(ue.angle2D)*ue.velocity+ue.drift,ue.y+=Math.sin(ue.angle2D)*ue.velocity+ue.gravity,ue.velocity*=ue.decay,ue.flat?(ue.wobble=0,ue.wobbleX=ue.x+10*ue.scalar,ue.wobbleY=ue.y+10*ue.scalar,ue.tiltSin=0,ue.tiltCos=0,ue.random=1):(ue.wobble+=ue.wobbleSpeed,ue.wobbleX=ue.x+10*ue.scalar*Math.cos(ue.wobble),ue.wobbleY=ue.y+10*ue.scalar*Math.sin(ue.wobble),ue.tiltAngle+=.1,ue.tiltSin=Math.sin(ue.tiltAngle),ue.tiltCos=Math.cos(ue.tiltAngle),ue.random=Math.random()+2);var gt=ue.tick++/ue.totalTicks,At=ue.x+ue.random*ue.tiltCos,Lt=ue.y+ue.random*ue.tiltSin,bt=ue.wobbleX+ue.random*ue.tiltCos,zt=ue.wobbleY+ue.random*ue.tiltSin;if(ye.fillStyle="rgba("+ue.color.r+", "+ue.color.g+", "+ue.color.b+", "+(1-gt)+")",ye.beginPath(),b&&ue.shape.type==="path"&&typeof ue.shape.path=="string"&&Array.isArray(ue.shape.matrix))ye.fill(We(ue.shape.path,ue.shape.matrix,ue.x,ue.y,Math.abs(bt-At)*.1,Math.abs(zt-Lt)*.1,Math.PI/10*ue.wobble));else if(ue.shape.type==="bitmap"){var Ft=Math.PI/10*ue.wobble,Kt=Math.abs(bt-At)*.1,on=Math.abs(zt-Lt)*.1,Dn=ue.shape.bitmap.width*ue.scalar,Ht=ue.shape.bitmap.height*ue.scalar,tn=new DOMMatrix([Math.cos(Ft)*Kt,Math.sin(Ft)*Kt,-Math.sin(Ft)*on,Math.cos(Ft)*on,ue.x,ue.y]);tn.multiplySelf(new DOMMatrix(ue.shape.matrix));var gn=ye.createPattern(me.transform(ue.shape.bitmap),"no-repeat");gn.setTransform(tn),ye.globalAlpha=1-gt,ye.fillStyle=gn,ye.fillRect(ue.x-Dn/2,ue.y-Ht/2,Dn,Ht),ye.globalAlpha=1}else if(ue.shape==="circle")ye.ellipse?ye.ellipse(ue.x,ue.y,Math.abs(bt-At)*ue.ovalScalar,Math.abs(zt-Lt)*ue.ovalScalar,Math.PI/10*ue.wobble,0,2*Math.PI):pe(ye,ue.x,ue.y,Math.abs(bt-At)*ue.ovalScalar,Math.abs(zt-Lt)*ue.ovalScalar,Math.PI/10*ue.wobble,0,2*Math.PI);else if(ue.shape==="star")for(var Rt=Math.PI/2*3,rn=4*ue.scalar,Fr=8*ue.scalar,Un=ue.x,Br=ue.y,hi=5,Kn=Math.PI/hi;hi--;)Un=ue.x+Math.cos(Rt)*Fr,Br=ue.y+Math.sin(Rt)*Fr,ye.lineTo(Un,Br),Rt+=Kn,Un=ue.x+Math.cos(Rt)*rn,Br=ue.y+Math.sin(Rt)*rn,ye.lineTo(Un,Br),Rt+=Kn;else ye.moveTo(Math.floor(ue.x),Math.floor(ue.y)),ye.lineTo(Math.floor(ue.wobbleX),Math.floor(Lt)),ye.lineTo(Math.floor(bt),Math.floor(zt)),ye.lineTo(Math.floor(At),Math.floor(ue.wobbleY));return ye.closePath(),ye.fill(),ue.tick<ue.totalTicks}function je(ye,ue,gt,At,Lt){var bt=ue.slice(),zt=ye.getContext("2d"),Ft,Kt,on=Z(function(Dn){function Ht(){Ft=Kt=null,zt.clearRect(0,0,At.width,At.height),me.clear(),Lt(),Dn()}function tn(){f&&!(At.width===x.width&&At.height===x.height)&&(At.width=ye.width=x.width,At.height=ye.height=x.height),!At.width&&!At.height&&(gt(ye),At.width=ye.width,At.height=ye.height),zt.clearRect(0,0,At.width,At.height),bt=bt.filter(function(gn){return Fe(zt,gn)}),bt.length?Ft=ge.frame(tn):Ht()}Ft=ge.frame(tn),Kt=Ht});return{addFettis:function(Dn){return bt=bt.concat(Dn),on},canvas:ye,promise:on,reset:function(){Ft&&ge.cancel(Ft),Kt&&Kt()}}}function Ye(ye,ue){var gt=!ye,At=!!xt(ue||{},"resize"),Lt=!1,bt=xt(ue,"disableForReducedMotion",Boolean),zt=T&&!!xt(ue||{},"useWorker"),Ft=zt?fe():null,Kt=gt?ht:$,on=ye&&Ft?!!ye.__confetti_initialized:!1,Dn=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,Ht;function tn(Rt,rn,Fr){for(var Un=xt(Rt,"particleCount",Ie),Br=xt(Rt,"angle",Number),hi=xt(Rt,"spread",Number),Kn=xt(Rt,"startVelocity",Number),Or=xt(Rt,"decay",Number),Di=xt(Rt,"gravity",Number),Fi=xt(Rt,"drift",Number),Fs=xt(Rt,"colors",Ne),Bi=xt(Rt,"ticks",Number),eo=xt(Rt,"shapes"),Oi=xt(Rt,"scalar"),di=!!xt(Rt,"flat"),to=ct(Rt),Ni=Un,no=[],Oo=ye.width*to.x,ls=ye.height*to.y;Ni--;)no.push(Ve({x:Oo,y:ls,angle:Br,spread:hi,startVelocity:Kn,color:Fs[Ni%Fs.length],shape:eo[ne(0,eo.length)],ticks:Bi,decay:Or,gravity:Di,drift:Fi,scalar:Oi,flat:di}));return Ht?Ht.addFettis(no):(Ht=je(ye,no,Kt,rn,Fr),Ht.promise)}function gn(Rt){var rn=bt||xt(Rt,"disableForReducedMotion",Boolean),Fr=xt(Rt,"zIndex",Number);if(rn&&Dn)return Z(function(Kn){Kn()});gt&&Ht?ye=Ht.canvas:gt&&!ye&&(ye=le(Fr),document.body.appendChild(ye)),At&&!on&&Kt(ye);var Un={width:ye.width,height:ye.height};Ft&&!on&&Ft.init(ye),on=!0,Ft&&(ye.__confetti_initialized=!0);function Br(){if(Ft){var Kn={getBoundingClientRect:function(){if(!gt)return ye.getBoundingClientRect()}};Kt(Kn),Ft.postMessage({resize:{width:Kn.width,height:Kn.height}});return}Un.width=Un.height=null}function hi(){Ht=null,At&&(Lt=!1,i.removeEventListener("resize",Br)),gt&&ye&&(document.body.contains(ye)&&document.body.removeChild(ye),ye=null,on=!1)}return At&&!Lt&&(Lt=!0,i.addEventListener("resize",Br,!1)),Ft?Ft.fire(Rt,Un,hi):tn(Rt,Un,hi)}return gn.reset=function(){Ft&&Ft.reset(),Ht&&Ht.reset()},gn}var Le;function ze(){return Le||(Le=Ye(null,{useWorker:!0,resize:!0})),Le}function We(ye,ue,gt,At,Lt,bt,zt){var Ft=new Path2D(ye),Kt=new Path2D;Kt.addPath(Ft,new DOMMatrix(ue));var on=new Path2D;return on.addPath(Kt,new DOMMatrix([Math.cos(zt)*Lt,Math.sin(zt)*Lt,-Math.sin(zt)*bt,Math.cos(zt)*bt,gt,At])),on}function be(ye){if(!b)throw new Error("path confetti are not supported in this browser");var ue,gt;typeof ye=="string"?ue=ye:(ue=ye.path,gt=ye.matrix);var At=new Path2D(ue),Lt=document.createElement("canvas"),bt=Lt.getContext("2d");if(!gt){for(var zt=1e3,Ft=zt,Kt=zt,on=0,Dn=0,Ht,tn,gn=0;gn<zt;gn+=2)for(var Rt=0;Rt<zt;Rt+=2)bt.isPointInPath(At,gn,Rt,"nonzero")&&(Ft=Math.min(Ft,gn),Kt=Math.min(Kt,Rt),on=Math.max(on,gn),Dn=Math.max(Dn,Rt));Ht=on-Ft,tn=Dn-Kt;var rn=10,Fr=Math.min(rn/Ht,rn/tn);gt=[Fr,0,0,Fr,-Math.round(Ht/2+Ft)*Fr,-Math.round(tn/2+Kt)*Fr]}return{type:"path",path:ue,matrix:gt}}function Ke(ye){var ue,gt=1,At="#000000",Lt='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof ye=="string"?ue=ye:(ue=ye.text,gt="scalar"in ye?ye.scalar:gt,Lt="fontFamily"in ye?ye.fontFamily:Lt,At="color"in ye?ye.color:At);var bt=10*gt,zt=""+bt+"px "+Lt,Ft=new OffscreenCanvas(bt,bt),Kt=Ft.getContext("2d");Kt.font=zt;var on=Kt.measureText(ue),Dn=Math.ceil(on.actualBoundingBoxRight+on.actualBoundingBoxLeft),Ht=Math.ceil(on.actualBoundingBoxAscent+on.actualBoundingBoxDescent),tn=2,gn=on.actualBoundingBoxLeft+tn,Rt=on.actualBoundingBoxAscent+tn;Dn+=tn+tn,Ht+=tn+tn,Ft=new OffscreenCanvas(Dn,Ht),Kt=Ft.getContext("2d"),Kt.font=zt,Kt.fillStyle=At,Kt.fillText(ue,gn,Rt);var rn=1/gt;return{type:"bitmap",bitmap:Ft.transferToImageBitmap(),matrix:[rn,0,0,rn,-Dn*rn/2,-Ht*rn/2]}}a.exports=function(){return ze().apply(this,arguments)},a.exports.reset=function(){ze().reset()},a.exports.create=Ye,a.exports.shapeFromPath=be,a.exports.shapeFromText=Ke})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),pg,!1);const Nk=pg.exports;pg.exports.create;const jk=.8,Uk=.5,Jv=(n,i)=>Math.random()*(i-n)+n;var og,Xp;class Vk{constructor(i){_v(this,og,!0);_v(this,Xp,1);const a=Nk.create(i,{resize:!0}),f=()=>{yv(this,Xp,Math.max(.8,I_(this,Xp)-.001)),a({particleCount:2,startVelocity:0,ticks:400,origin:{x:Math.random(),y:Math.random()*I_(this,Xp)-.2},colors:["#008FFF","#007002"],gravity:Jv(.4,.6)*Uk,scalar:Jv(.4,1)*jk,drift:Jv(-.4,.4)}),I_(this,og)&&requestAnimationFrame(f)};f()}stop(){yv(this,og,!1)}}og=new WeakMap,Xp=new WeakMap;const Gk="_container_wxlkd_1",$k="_content_wxlkd_15",Zb={container:Gk,content:$k},qb=500,Zk=({children:n,isVisible:i,className:a,backgroundChildren:f})=>{const[x,T]=en.useState(!1),[b,u]=en.useState(0);return en.useEffect(()=>{i&&!x&&T(!0)},[x,i]),en.useEffect(()=>{i&&x&&u(1)},[x,i]),en.useEffect(()=>{!i&&x&&(u(0),setTimeout(()=>T(!1),qb))},[x,i]),x?bn.jsxs("div",{className:Zb.container,style:{transition:`all ${qb}ms`,opacity:b},children:[f??null,bn.jsx("div",{className:of(Zb.content,a),children:n})]}):null},qk="_modal_jyc0j_1",Wk="_content_jyc0j_11",Hk="_title_jyc0j_14",Yk="_gif_jyc0j_18",Xk="_buttons_jyc0j_25",Kk="_button_jyc0j_25",Jk="_confettiCanvas_jyc0j_37",qc={modal:qk,content:Wk,title:Hk,gif:Yk,buttons:Xk,button:Kk,confettiCanvas:Jk},Qk=()=>{const n=dg(Z=>Z.main.isWinModalVisible),i=ew();en.useEffect(()=>{},[]);const a=en.useCallback(Z=>i(af.actions.setIsWinModalVisible(Z)),[i]),f=u0();en.useEffect(()=>{new Image().src="dance.gif"},[]);const[x,T]=en.useState(null),b=en.useCallback(Z=>T(Z),[]);en.useEffect(()=>{if(n&&x){const Z=new Vk(x);return()=>Z.stop()}},[x,n]);const u=()=>a(!1),j=()=>window.location.reload();return bn.jsx(bn.Fragment,{children:bn.jsx(Zk,{isVisible:n,className:qc.modal,backgroundChildren:bn.jsx("canvas",{className:qc.confettiCanvas,ref:b}),children:bn.jsxs("div",{className:qc.content,children:[bn.jsxs("div",{className:qc.title,children:["Correct! It's ",bn.jsx("b",{children:f==null?void 0:f.name}),"!"]}),bn.jsx("img",{src:"dance.gif",className:qc.gif}),bn.jsxs("div",{className:qc.buttons,children:[bn.jsx($b,{isSecondary:!0,className:qc.button,onClick:u,children:"Close"}),bn.jsx($b,{className:qc.button,onClick:j,children:"Play again"})]})]})})})},eA="_container_o3qfk_1",tA="_content_o3qfk_11",Wb={container:eA,content:tA},nA="#26D800",rA="#CCCCCC",Hb="#000000";let Yb=!1;const iA=()=>{const n=u0(),i=dg(T=>T.main.isMapInitialized),a=iw();en.useEffect(()=>{i&&n!==null&&!Yb&&(Yb=!0,a(n))},[n,a,i]);const f=KI();en.useEffect(()=>{if(n)return f(n.geojson,{fillColor:nA,fillOpacity:.3,strokeColor:Hb,strokeOpacity:1,strokeWidth:2},Dy)},[n,f]);const x=ET();return en.useEffect(()=>{const T=x.filter(b=>b.name!==n.name).map(b=>f(b.geojson,{fillColor:rA,fillOpacity:.5,strokeColor:Hb,strokeOpacity:1,strokeWidth:2},Dy));return()=>T.forEach(b=>b())},[n,x,f]),bn.jsxs("div",{className:Wb.container,children:[bn.jsxs("div",{className:Wb.content,children:[bn.jsx(wk,{}),bn.jsx(zk,{}),bn.jsx(gk,{})]}),bn.jsx(Dk,{}),bn.jsx(Qk,{})]})},oA=CI({reducer:{main:af.reducer}});Qv.createRoot(document.getElementById("root")).render(bn.jsx(l1.StrictMode,{children:bn.jsx(gM,{store:oA,children:bn.jsx(iA,{})})}))});export default sA();
